---
title: Construire des applications Web progressives Blazor avec ASP.NET WebAssembly Core
author: guardrex
description: Découvrez comment créer Blazorune application Web progressive (PWA) basée sur la technologie qui utilise les fonctionnalités modernes du navigateur pour se comporter comme une application de bureau.
monikerRange: '>= aspnetcore-3.1'
ms.author: riande
ms.custom: mvc
ms.date: 03/23/2020
no-loc:
- Blazor
- SignalR
uid: blazor/progressive-web-app
ms.openlocfilehash: fe69e51aefae9c80e5bb4b78151d384ce25d41a7
ms.sourcegitcommit: f7886fd2e219db9d7ce27b16c0dc5901e658d64e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/06/2020
ms.locfileid: "80218945"
---
# <a name="build-progressive-web-applications-with-aspnet-core-blazor-webassembly"></a><span data-ttu-id="b2166-103">Construire des applications Web progressives avec ASP.NET Core Blazor WebAssembly</span><span class="sxs-lookup"><span data-stu-id="b2166-103">Build Progressive Web Applications with ASP.NET Core Blazor WebAssembly</span></span>

<span data-ttu-id="b2166-104">Par [Steve Sanderson](https://github.com/SteveSandersonMS)</span><span class="sxs-lookup"><span data-stu-id="b2166-104">By [Steve Sanderson](https://github.com/SteveSandersonMS)</span></span>

[!INCLUDE[](~/includes/blazorwasm-preview-notice.md)]

[!INCLUDE[](~/includes/blazorwasm-3.2-template-article-notice.md)]

<span data-ttu-id="b2166-105">Une application Web progressive (PWA) est une application à une page unique (SPA) qui utilise des API et des capacités modernes pour se comporter comme une application de bureau.</span><span class="sxs-lookup"><span data-stu-id="b2166-105">A Progressive Web Application (PWA) is a Single Page Application (SPA) that uses modern browser APIs and capabilities to behave like a desktop app.</span></span> <span data-ttu-id="b2166-106">Blazor WebAssembly est une plate-forme d’applications Web axée sur les normes, de sorte qu’elle peut utiliser n’importe quel navigateur API, y compris les API PWA nécessaires pour les fonctionnalités suivantes :</span><span class="sxs-lookup"><span data-stu-id="b2166-106">Blazor WebAssembly is a standards-based client-side web app platform, so it can use any browser API, including PWA APIs required for the following capabilities:</span></span>

* <span data-ttu-id="b2166-107">Travailler hors ligne et charger instantanément, indépendamment de la vitesse du réseau.</span><span class="sxs-lookup"><span data-stu-id="b2166-107">Working offline and loading instantly, independent of network speed.</span></span>
* <span data-ttu-id="b2166-108">Exécution dans sa propre fenêtre d’application, pas seulement une fenêtre de navigateur.</span><span class="sxs-lookup"><span data-stu-id="b2166-108">Running in its own app window, not just a browser window.</span></span>
* <span data-ttu-id="b2166-109">Lancement à partir du menu de démarrage du système d’exploitation de l’hôte, du dock ou de l’écran d’accueil.</span><span class="sxs-lookup"><span data-stu-id="b2166-109">Being launched from the host's operating system start menu, dock, or home screen.</span></span>
* <span data-ttu-id="b2166-110">Recevoir des notifications push à partir d’un serveur backend, même si l’utilisateur n’utilise pas l’application.</span><span class="sxs-lookup"><span data-stu-id="b2166-110">Receiving push notifications from a backend server, even while the user isn't using the app.</span></span>
* <span data-ttu-id="b2166-111">Mise à jour automatique en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="b2166-111">Automatically updating in the background.</span></span>

<span data-ttu-id="b2166-112">Le mot *progressif* est utilisé pour décrire ces applications parce que :</span><span class="sxs-lookup"><span data-stu-id="b2166-112">The word *progressive* is used to describe such apps because:</span></span>

* <span data-ttu-id="b2166-113">Un utilisateur peut d’abord découvrir et utiliser l’application dans son navigateur Web comme n’importe quel autre SPA.</span><span class="sxs-lookup"><span data-stu-id="b2166-113">A user might first discover and use the app within their web browser like any other SPA.</span></span>
* <span data-ttu-id="b2166-114">Plus tard, l’utilisateur progresse à l’installer dans leur système d’exploitation et à activer les notifications push.</span><span class="sxs-lookup"><span data-stu-id="b2166-114">Later, the user progresses to installing it in their OS and enabling push notifications.</span></span>

## <a name="create-a-project-from-the-pwa-template"></a><span data-ttu-id="b2166-115">Créer un projet à partir du modèle PWA</span><span class="sxs-lookup"><span data-stu-id="b2166-115">Create a project from the PWA template</span></span>

# <a name="visual-studio"></a>[<span data-ttu-id="b2166-116">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="b2166-116">Visual Studio</span></span>](#tab/visual-studio)

<span data-ttu-id="b2166-117">Lors de la création d’une nouvelle **application Blazor WebAssembly** dans le dialogue **Créer un nouveau projet,** sélectionnez la case de cocher **Progress Web Application** :</span><span class="sxs-lookup"><span data-stu-id="b2166-117">When creating a new **Blazor WebAssembly App** in the **Create a New Project** dialog, select the **Progress Web Application** check box:</span></span>

![La case à cocher 'Progressive Web Application' est sélectionnée dans le nouveau dialogue de projet visual Studio.](progressive-web-app/_static/image1.png)

<!--

# [Visual Studio for Mac](#tab/visual-studio-mac)

-->

# <a name="visual-studio-code--net-core-cli"></a>[<span data-ttu-id="b2166-119">Visual Studio Code/.NET Core CLI</span><span class="sxs-lookup"><span data-stu-id="b2166-119">Visual Studio Code / .NET Core CLI</span></span>](#tab/visual-studio-code+netcore-cli)

<span data-ttu-id="b2166-120">Créez un projet PWA dans `--pwa` une coque de commande avec le commutateur :</span><span class="sxs-lookup"><span data-stu-id="b2166-120">Create a PWA project in a command shell with the `--pwa` switch:</span></span>

```dotnetcli
dotnet new blazorwasm -o MyNewProject --pwa
```

---

<span data-ttu-id="b2166-121">En option, PWA peut être configuré pour une application créée à partir du modèle hébergé ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="b2166-121">Optionally, PWA can be configured for an app created from the ASP.NET Core Hosted template.</span></span> <span data-ttu-id="b2166-122">Le scénario PWA est indépendant du modèle d’hébergement.</span><span class="sxs-lookup"><span data-stu-id="b2166-122">The PWA scenario is independent of the hosting model.</span></span>

## <a name="installation-and-app-manifest"></a><span data-ttu-id="b2166-123">Manifeste d’installation et d’application</span><span class="sxs-lookup"><span data-stu-id="b2166-123">Installation and app manifest</span></span>

<span data-ttu-id="b2166-124">Lors de la visite d’une application créée à l’aide du modèle PWA, les utilisateurs ont la possibilité d’installer l’application dans le menu de démarrage, le dock ou l’écran d’accueil de leur système d’exploitation.</span><span class="sxs-lookup"><span data-stu-id="b2166-124">When visiting an app created using the PWA template, users have the option of installing the app into their OS's start menu, dock, or home screen.</span></span> <span data-ttu-id="b2166-125">La façon dont cette option est présentée dépend du navigateur de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="b2166-125">The way this option is presented depends on the user's browser.</span></span> <span data-ttu-id="b2166-126">Lorsque vous utilisez des navigateurs basés sur le chrome de bureau, tels que Edge ou Chrome, un bouton **Add** apparaît dans la barre d’URL.</span><span class="sxs-lookup"><span data-stu-id="b2166-126">When using desktop Chromium-based browsers, such as Edge or Chrome, an **Add** button appears within the URL bar.</span></span> <span data-ttu-id="b2166-127">Une fois que l’utilisateur sélectionne le bouton **Ajouter,** il reçoit un dialogue de confirmation :</span><span class="sxs-lookup"><span data-stu-id="b2166-127">After the user selects the **Add** button, they receive a confirmation dialog:</span></span>

![Le dialogue de confirmation dans Google Chrome présente un bouton Installer à l’utilisateur pour l’application 'MyBlazorPwa'.](progressive-web-app/_static/image2.png)

<span data-ttu-id="b2166-129">Sur iOS, les visiteurs peuvent installer le PWA à l’aide du bouton **Partager** de Safari et de son option **Add to Homescreen.**</span><span class="sxs-lookup"><span data-stu-id="b2166-129">On iOS, visitors can install the PWA using Safari's **Share** button and its **Add to Homescreen** option.</span></span> <span data-ttu-id="b2166-130">Sur Chrome pour Android, les utilisateurs doivent sélectionner le bouton **Menu** dans le coin supérieur droit, suivi de **Add to Home screen**.</span><span class="sxs-lookup"><span data-stu-id="b2166-130">On Chrome for Android, users should select the **Menu** button in the upper-right corner, followed by **Add to Home screen**.</span></span>

<span data-ttu-id="b2166-131">Une fois installée, l’application apparaît dans sa propre fenêtre sans barre d’adresse :</span><span class="sxs-lookup"><span data-stu-id="b2166-131">Once installed, the app appears in its own window without an address bar:</span></span>

![L’application 'MyBlazorPwa' s’exécute dans Google Chrome sans barre d’adresse.](progressive-web-app/_static/image3.png)

<span data-ttu-id="b2166-133">Pour personnaliser le titre, le schéma de couleurs, l’icône ou d’autres détails de la fenêtre, consultez le fichier *manifest.json* dans l’annuaire *wwwroot* du projet.</span><span class="sxs-lookup"><span data-stu-id="b2166-133">To customize the window's title, color scheme, icon, or other details, see the *manifest.json* file in the project's *wwwroot* directory.</span></span> <span data-ttu-id="b2166-134">Le schéma de ce fichier est défini par les normes web.</span><span class="sxs-lookup"><span data-stu-id="b2166-134">The schema of this file is defined by web standards.</span></span> <span data-ttu-id="b2166-135">Pour plus d’informations, voir [DOCs web MDN: Web App Manifest](https://developer.mozilla.org/docs/Web/Manifest).</span><span class="sxs-lookup"><span data-stu-id="b2166-135">For more information, see [MDN web docs: Web App Manifest](https://developer.mozilla.org/docs/Web/Manifest).</span></span>

## <a name="offline-support"></a><span data-ttu-id="b2166-136">Soutien hors ligne</span><span class="sxs-lookup"><span data-stu-id="b2166-136">Offline support</span></span>

<span data-ttu-id="b2166-137">Par défaut, les applications créées à l’aide de l’option modèle PWA ont la prise en charge de l’exécution hors ligne.</span><span class="sxs-lookup"><span data-stu-id="b2166-137">By default, apps created using the PWA template option have support for running offline.</span></span> <span data-ttu-id="b2166-138">Un utilisateur doit d’abord visiter l’application pendant qu’il est en ligne.</span><span class="sxs-lookup"><span data-stu-id="b2166-138">A user must first visit the app while they're online.</span></span> <span data-ttu-id="b2166-139">Le navigateur télécharge et cache automatiquement toutes les ressources nécessaires pour fonctionner hors connexion.</span><span class="sxs-lookup"><span data-stu-id="b2166-139">The browser automatically downloads and caches all of the resources required to operate offline.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b2166-140">Le soutien au développement interfèrerait avec le cycle de développement habituel d’apporter des changements et de les tester.</span><span class="sxs-lookup"><span data-stu-id="b2166-140">Development support would interfere with the usual development cycle of making changes and testing them.</span></span> <span data-ttu-id="b2166-141">Par conséquent, le support hors ligne n’est activé que pour les applications *publiées.*</span><span class="sxs-lookup"><span data-stu-id="b2166-141">Therefore, offline support is only enabled for *published* apps.</span></span> 

> [!WARNING]
> <span data-ttu-id="b2166-142">Si vous avez l’intention de distribuer un PWA hors ligne, il ya [plusieurs avertissements importants et mises en garde](#caveats-for-offline-pwas).</span><span class="sxs-lookup"><span data-stu-id="b2166-142">If you intend to distribute an offline-enabled PWA, there are [several important warnings and caveats](#caveats-for-offline-pwas).</span></span> <span data-ttu-id="b2166-143">Ces scénarios sont inhérents aux APS Blazorhors ligne et ne sont pas spécifiques à .</span><span class="sxs-lookup"><span data-stu-id="b2166-143">These scenarios are inherent to offline PWAs and not specific to Blazor.</span></span> <span data-ttu-id="b2166-144">Assurez-vous de lire et de comprendre ces mises en garde avant de faire des hypothèses sur la façon dont votre application hors connexion fonctionnera.</span><span class="sxs-lookup"><span data-stu-id="b2166-144">Be sure to read and understand these caveats before making assumptions about how your offline-enabled app will work.</span></span>

<span data-ttu-id="b2166-145">Pour voir comment fonctionne le support hors ligne :</span><span class="sxs-lookup"><span data-stu-id="b2166-145">To see how offline support works:</span></span>

1. <span data-ttu-id="b2166-146">Publiez l’application.</span><span class="sxs-lookup"><span data-stu-id="b2166-146">Publish the app.</span></span> <span data-ttu-id="b2166-147">Pour plus d’informations, consultez <xref:host-and-deploy/blazor/index#publish-the-app>.</span><span class="sxs-lookup"><span data-stu-id="b2166-147">For more information, see <xref:host-and-deploy/blazor/index#publish-the-app>.</span></span>
1. <span data-ttu-id="b2166-148">Déployez l’application sur un serveur qui prend en charge HTTPS et accédez à l’application dans un navigateur à son adresse HTTPS sécurisée.</span><span class="sxs-lookup"><span data-stu-id="b2166-148">Deploy the app to a server that supports HTTPS, and access the app in a browser at its secure HTTPS address.</span></span>
1. <span data-ttu-id="b2166-149">Ouvrez les outils de développement du navigateur et vérifiez qu’un *travailleur de service* est inscrit à l’hôte sur **l’onglet Application** :</span><span class="sxs-lookup"><span data-stu-id="b2166-149">Open the browser's dev tools and verify that a *Service Worker* is registered for the host on the **Application** tab:</span></span>

   ![L’onglet 'Application' des outils de développeur Google Chrome affiche un service Worker activé et en cours d’exécution.](progressive-web-app/_static/image4.png)

1. <span data-ttu-id="b2166-151">Rechargez la page et examinez **l’onglet Réseau.** **Le travailleur de service** ou le cache de **mémoire** sont répertoriés comme sources pour tous les actifs de la page :</span><span class="sxs-lookup"><span data-stu-id="b2166-151">Reload the page and examine the **Network** tab. **Service Worker** or **memory cache** are listed as the sources for all of the page's assets:</span></span>

   ![Google Chrome outils de développeur onglet 'Network' onglet montrant les sources pour tous les actifs de la page.](progressive-web-app/_static/image5.png)

1. <span data-ttu-id="b2166-153">Pour vérifier que le navigateur ne dépend pas non plus de l’accès au réseau pour charger l’application :</span><span class="sxs-lookup"><span data-stu-id="b2166-153">To verify that the browser isn't dependent on network access to load the app, either:</span></span>

   * <span data-ttu-id="b2166-154">Arrêtez le serveur web et voyez comment l’application continue de fonctionner normalement, ce qui inclut les rechargements de page.</span><span class="sxs-lookup"><span data-stu-id="b2166-154">Shut down the web server and see how the app continues to function normally, which includes page reloads.</span></span> <span data-ttu-id="b2166-155">De même, l’application continue de fonctionner normalement lorsqu’il y a une connexion réseau lente.</span><span class="sxs-lookup"><span data-stu-id="b2166-155">Likewise, the app continues to function normally when there's a slow network connection.</span></span>
   * <span data-ttu-id="b2166-156">Instruire le navigateur pour simuler le mode hors connexion dans l’onglet **Réseau** :</span><span class="sxs-lookup"><span data-stu-id="b2166-156">Instruct the browser to simulate offline mode in the **Network** tab:</span></span>

   ![Google Chrome outils de développeur onglet 'Network' onglet avec le mode navigateur tomber en cours de changement de «en ligne» à «Offline».](progressive-web-app/_static/image6.png)

<span data-ttu-id="b2166-158">Le support hors ligne utilisant un travailleur de Blazorservice est une norme web, non spécifique à .</span><span class="sxs-lookup"><span data-stu-id="b2166-158">Offline support using a service worker is a web standard, not specific to Blazor.</span></span> <span data-ttu-id="b2166-159">Pour plus d’informations sur les travailleurs des services, consultez [MDN web docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span><span class="sxs-lookup"><span data-stu-id="b2166-159">For more information on service workers, see [MDN web docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span></span> <span data-ttu-id="b2166-160">Pour en savoir plus sur les habitudes d’utilisation courantes pour les travailleurs du service, consultez [Google Web: The Service Worker Lifecycle](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span><span class="sxs-lookup"><span data-stu-id="b2166-160">To learn more about common usage patterns for service workers, see [Google Web: The Service Worker Lifecycle](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span></span>

Blazor<span data-ttu-id="b2166-161">le modèle PWA produit deux dossiers de travailleurs de service :</span><span class="sxs-lookup"><span data-stu-id="b2166-161">'s PWA template produces two service worker files:</span></span>

* <span data-ttu-id="b2166-162">*wwwroot/service-worker.js*, qui est utilisé pendant le développement.</span><span class="sxs-lookup"><span data-stu-id="b2166-162">*wwwroot/service-worker.js*, which is used during development.</span></span>
* <span data-ttu-id="b2166-163">*wwwroot/service-worker.published.js*, qui est utilisé après la publication de l’application.</span><span class="sxs-lookup"><span data-stu-id="b2166-163">*wwwroot/service-worker.published.js*, which is used after the app is published.</span></span>

<span data-ttu-id="b2166-164">Pour partager la logique entre les deux dossiers des travailleurs de service, considérez l’approche suivante :</span><span class="sxs-lookup"><span data-stu-id="b2166-164">To share logic between the two service worker files, consider the following approach:</span></span>

* <span data-ttu-id="b2166-165">Ajoutez un troisième fichier JavaScript pour tenir la logique commune.</span><span class="sxs-lookup"><span data-stu-id="b2166-165">Add a third JavaScript file to hold the common logic.</span></span>
* <span data-ttu-id="b2166-166">Utilisez [self.importScripts](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) pour charger la logique commune dans les deux fichiers des travailleurs de service.</span><span class="sxs-lookup"><span data-stu-id="b2166-166">Use [self.importScripts](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) to load the common logic into both service worker files.</span></span>

### <a name="cache-first-fetch-strategy"></a><span data-ttu-id="b2166-167">Stratégie Cache-first fetch</span><span class="sxs-lookup"><span data-stu-id="b2166-167">Cache-first fetch strategy</span></span>

<span data-ttu-id="b2166-168">Le *travailleur-service intégré.published.js* service travailleur résout les demandes en utilisant une stratégie *cache-premier.*</span><span class="sxs-lookup"><span data-stu-id="b2166-168">The built-in *service-worker.published.js* service worker resolves requests using a *cache-first* strategy.</span></span> <span data-ttu-id="b2166-169">Cela signifie que le travailleur du service préfère retourner le contenu mis en cache, que l’utilisateur ait accès au réseau ou que du contenu plus récent soit disponible sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="b2166-169">This means that the service worker prefers to return cached content, regardless of whether the user has network access or newer content is available on the server.</span></span>

<span data-ttu-id="b2166-170">La stratégie cache-première est précieuse parce que :</span><span class="sxs-lookup"><span data-stu-id="b2166-170">The cache-first strategy is valuable because:</span></span>

* <span data-ttu-id="b2166-171">**Il assure la fiabilité.**</span><span class="sxs-lookup"><span data-stu-id="b2166-171">**It ensures reliability.**</span></span> <span data-ttu-id="b2166-172">&ndash;L’accès au réseau n’est pas un état boolean.</span><span class="sxs-lookup"><span data-stu-id="b2166-172">&ndash; Network access isn't a boolean state.</span></span> <span data-ttu-id="b2166-173">Un utilisateur n’est pas simplement en ligne ou hors ligne :</span><span class="sxs-lookup"><span data-stu-id="b2166-173">A user isn't simply online or offline:</span></span>

  * <span data-ttu-id="b2166-174">L’appareil de l’utilisateur peut supposer qu’il est en ligne, mais le réseau peut être si lent qu’il n’est pas pratique à attendre.</span><span class="sxs-lookup"><span data-stu-id="b2166-174">The user's device may assume it's online, but the network might be so slow as to be impractical to wait for.</span></span>
  * <span data-ttu-id="b2166-175">Le réseau peut retourner des résultats invalides pour certaines URL, comme lorsqu’il existe un portail WIFI captif qui bloque ou redirige actuellement certaines demandes.</span><span class="sxs-lookup"><span data-stu-id="b2166-175">The network might return invalid results for certain URLs, such as when there's a captive WIFI portal that's currently blocking or redirecting certain requests.</span></span>
  
  <span data-ttu-id="b2166-176">C’est pourquoi l’API du `navigator.onLine` navigateur n’est pas fiable et ne devrait pas être dépendu.</span><span class="sxs-lookup"><span data-stu-id="b2166-176">This is why the browser's `navigator.onLine` API isn't reliable and shouldn't be depended upon.</span></span>

* <span data-ttu-id="b2166-177">**Il assure la justesse.**</span><span class="sxs-lookup"><span data-stu-id="b2166-177">**It ensures correctness.**</span></span> <span data-ttu-id="b2166-178">&ndash;Lors de la construction d’une cache de ressources hors ligne, le travailleur du service utilise le hachage de contenu pour garantir qu’il a obtenu un instantané complet et auto-cohérent des ressources à un seul instant dans le temps.</span><span class="sxs-lookup"><span data-stu-id="b2166-178">&ndash; When building a cache of offline resources, the service worker uses content hashing to guarantee it has fetched a complete and self-consistent snapshot of resources at a single instant in time.</span></span> <span data-ttu-id="b2166-179">Ce cache est ensuite utilisé comme une unité atomique.</span><span class="sxs-lookup"><span data-stu-id="b2166-179">This cache is then used as an atomic unit.</span></span> <span data-ttu-id="b2166-180">Il est inutile de demander au réseau des ressources plus nouvelles, puisque les seules versions requises sont ceux déjà mis en cache.</span><span class="sxs-lookup"><span data-stu-id="b2166-180">There's no point asking the network for newer resources, since the only versions required are the ones already cached.</span></span> <span data-ttu-id="b2166-181">Tout le reste risque d’incohérence et d’incompatibilité (par exemple, essayer d’utiliser des versions d’assemblages .NET qui n’ont pas été compilés ensemble).</span><span class="sxs-lookup"><span data-stu-id="b2166-181">Anything else risks inconsistency and incompatibility (for example, trying to use versions of .NET assemblies that weren't compiled together).</span></span>

### <a name="background-updates"></a><span data-ttu-id="b2166-182">Mises à jour de fond</span><span class="sxs-lookup"><span data-stu-id="b2166-182">Background updates</span></span>

<span data-ttu-id="b2166-183">En tant que modèle mental, vous pouvez penser à un PWA hors ligne comme se comportant comme une application mobile qui peut être installé.</span><span class="sxs-lookup"><span data-stu-id="b2166-183">As a mental model, you can think of an offline-first PWA as behaving like a mobile app that can be installed.</span></span> <span data-ttu-id="b2166-184">L’application démarre immédiatement indépendamment de la connectivité réseau, mais la logique de l’application installée provient d’un instantané point-dans-temps qui pourrait ne pas être la dernière version.</span><span class="sxs-lookup"><span data-stu-id="b2166-184">The app starts up immediately regardless of network connectivity, but the installed app logic comes from a point-in-time snapshot that might not be the latest version.</span></span>

<span data-ttu-id="b2166-185">Le Blazor modèle PWA produit des applications qui essaient automatiquement de se mettre à jour en arrière-plan chaque fois que l’utilisateur visite et dispose d’une connexion réseau de travail.</span><span class="sxs-lookup"><span data-stu-id="b2166-185">The Blazor PWA template produces apps that automatically try to update themselves in the background whenever the user visits and has a working network connection.</span></span> <span data-ttu-id="b2166-186">La façon dont cela fonctionne est la suivante:</span><span class="sxs-lookup"><span data-stu-id="b2166-186">The way this works is as follows:</span></span>

* <span data-ttu-id="b2166-187">Au cours de la compilation, le projet génère un *actif de travailleur de service manifeste.*</span><span class="sxs-lookup"><span data-stu-id="b2166-187">During compilation, the project generates a *service worker assets manifest*.</span></span> <span data-ttu-id="b2166-188">Par défaut, c’est ce *qu’on appelle service-travailleur-actifs.js*.</span><span class="sxs-lookup"><span data-stu-id="b2166-188">By default, this is called *service-worker-assets.js*.</span></span> <span data-ttu-id="b2166-189">Le manifeste répertorie toutes les ressources statiques dont l’application a besoin pour fonctionner hors connexion, telles que les assemblages .NET, les fichiers JavaScript et le CSS, y compris leurs hachages de contenu.</span><span class="sxs-lookup"><span data-stu-id="b2166-189">The manifest lists all the static resources that the app requires to function offline, such as .NET assemblies, JavaScript files, and CSS, including their content hashes.</span></span> <span data-ttu-id="b2166-190">La liste des ressources est chargée par le travailleur de service afin qu’il sache quelles ressources mettre en cache.</span><span class="sxs-lookup"><span data-stu-id="b2166-190">The resource list is loaded by the service worker so that it knows which resources to cache.</span></span>
* <span data-ttu-id="b2166-191">Chaque fois que l’utilisateur visite l’application, le navigateur ré-demande *service-worker.js* et *service-travailleur-assets.js* en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="b2166-191">Each time the user visits the app, the browser re-requests *service-worker.js* and *service-worker-assets.js* in the background.</span></span> <span data-ttu-id="b2166-192">Les fichiers sont comparés byte-for-byte avec le travailleur de service installé existant.</span><span class="sxs-lookup"><span data-stu-id="b2166-192">The files are compared byte-for-byte with the existing installed service worker.</span></span> <span data-ttu-id="b2166-193">Si le serveur retourne le contenu modifié pour l’un ou l’autre de ces fichiers, le travailleur du service tente d’installer une nouvelle version de lui-même.</span><span class="sxs-lookup"><span data-stu-id="b2166-193">If the server returns changed content for either of these files, the service worker attempts to install a new version of itself.</span></span>
* <span data-ttu-id="b2166-194">Lors de l’installation d’une nouvelle version de lui-même, le travailleur du service crée un nouveau cache distinct pour les ressources hors ligne et commence à remplir le cache avec des ressources répertoriées dans *service-travailleur-actifs.js*.</span><span class="sxs-lookup"><span data-stu-id="b2166-194">When installing a new version of itself, the service worker creates a new, separate cache for offline resources and starts populating the cache with resources listed in *service-worker-assets.js*.</span></span> <span data-ttu-id="b2166-195">Cette logique est `onInstall` mise en œuvre dans la fonction à l’intérieur *de service-worker.published.js*.</span><span class="sxs-lookup"><span data-stu-id="b2166-195">This logic is implemented in the `onInstall` function inside *service-worker.published.js*.</span></span>
* <span data-ttu-id="b2166-196">Le processus se termine avec succès lorsque toutes les ressources sont chargées sans erreur et que tous les hashes de contenu correspondent.</span><span class="sxs-lookup"><span data-stu-id="b2166-196">The process completes successfully when all of the resources are loaded without error and all content hashes match.</span></span> <span data-ttu-id="b2166-197">En cas de succès, le nouveau travailleur de service entre dans un état *d’activation en attente.*</span><span class="sxs-lookup"><span data-stu-id="b2166-197">If successful, the new service worker enters a *waiting for activation* state.</span></span> <span data-ttu-id="b2166-198">Dès que l’utilisateur ferme l’application (aucun onglet ou fenêtre d’application restant), le nouveau travailleur du service devient *actif* et est utilisé pour les visites ultérieures de l’application.</span><span class="sxs-lookup"><span data-stu-id="b2166-198">As soon as the user closes the app (no remaining app tabs or windows), the new service worker becomes *active* and is used for subsequent app visits.</span></span> <span data-ttu-id="b2166-199">L’ancien travailleur de service et son cache sont supprimés.</span><span class="sxs-lookup"><span data-stu-id="b2166-199">The old service worker and its cache are deleted.</span></span>
* <span data-ttu-id="b2166-200">Si le processus ne se termine pas avec succès, l’instance du nouveau travailleur de service est écartée.</span><span class="sxs-lookup"><span data-stu-id="b2166-200">If the process doesn't complete successfully, the new service worker instance is discarded.</span></span> <span data-ttu-id="b2166-201">Le processus de mise à jour est tenté à nouveau sur la prochaine visite de l’utilisateur, quand j’espère que le client a une meilleure connexion réseau qui peut remplir les demandes.</span><span class="sxs-lookup"><span data-stu-id="b2166-201">The update process is attempted again on the user's next visit, when hopefully the client has a better network connection that can complete the requests.</span></span>

<span data-ttu-id="b2166-202">Personnalisez ce processus en modifiant la logique des travailleurs du service.</span><span class="sxs-lookup"><span data-stu-id="b2166-202">Customize this process by editing the service worker logic.</span></span> <span data-ttu-id="b2166-203">Aucun des comportements précédents Blazor n’est spécifique à, mais est simplement l’expérience par défaut fournie par l’option modèle PWA.</span><span class="sxs-lookup"><span data-stu-id="b2166-203">None of the preceding behavior is specific to Blazor but is merely the default experience provided by the PWA template option.</span></span> <span data-ttu-id="b2166-204">Pour plus d’informations, voir [DOCs Web MDN: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span><span class="sxs-lookup"><span data-stu-id="b2166-204">For more information, see [MDN web docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span></span>

### <a name="how-requests-are-resolved"></a><span data-ttu-id="b2166-205">Comment les demandes sont résolues</span><span class="sxs-lookup"><span data-stu-id="b2166-205">How requests are resolved</span></span>

<span data-ttu-id="b2166-206">Tel que décrit dans la section [stratégie Cache-first fetch,](#cache-first-fetch-strategy) le travailleur du service par défaut utilise une stratégie *cache-première,* ce qui signifie qu’il essaie de servir du contenu mis en cache lorsqu’il est disponible.</span><span class="sxs-lookup"><span data-stu-id="b2166-206">As described in the [Cache-first fetch strategy](#cache-first-fetch-strategy) section, the default service worker uses a *cache-first* strategy, meaning that it tries to serve cached content when available.</span></span> <span data-ttu-id="b2166-207">S’il n’y a pas de contenu mis en cache pour une certaine URL, par exemple lors de la demande de données d’une API backend, le travailleur du service revient sur une demande de réseau régulière.</span><span class="sxs-lookup"><span data-stu-id="b2166-207">If there is no content cached for a certain URL, for example when requesting data from a backend API, the service worker falls back on a regular network request.</span></span> <span data-ttu-id="b2166-208">La demande de réseau réussit si le serveur est accessible.</span><span class="sxs-lookup"><span data-stu-id="b2166-208">The network request succeeds if the server is reachable.</span></span> <span data-ttu-id="b2166-209">Cette logique est `onFetch` mise en œuvre à l’intérieur de la fonction au sein *de service-worker.published.js*.</span><span class="sxs-lookup"><span data-stu-id="b2166-209">This logic is implemented inside `onFetch` function within *service-worker.published.js*.</span></span>

<span data-ttu-id="b2166-210">Si les composants Razor de l’application s’appuient sur la demande de données des API backend et que vous souhaitez fournir une expérience utilisateur amicale pour les demandes échouées en raison de l’indisponibilité du réseau, implémentez la logique dans les composants de l’application.</span><span class="sxs-lookup"><span data-stu-id="b2166-210">If the app's Razor components rely on requesting data from backend APIs and you want to provide a friendly user experience for failed requests due to network unavailability, implement logic within the app's components.</span></span> <span data-ttu-id="b2166-211">Par exemple, `try/catch` `HttpClient` utiliser autour des demandes.</span><span class="sxs-lookup"><span data-stu-id="b2166-211">For example, use `try/catch` around `HttpClient` requests.</span></span>

### <a name="support-server-rendered-pages"></a><span data-ttu-id="b2166-212">Prendre en charge les pages rendues par le serveur</span><span class="sxs-lookup"><span data-stu-id="b2166-212">Support server-rendered pages</span></span>

<span data-ttu-id="b2166-213">Considérez ce qui se passe lorsque l’utilisateur navigue pour la première fois vers une URL telle que `/counter` ou tout autre lien profond dans l’application.</span><span class="sxs-lookup"><span data-stu-id="b2166-213">Consider what happens when the user first navigates to a URL such as `/counter` or any other deep link in the app.</span></span> <span data-ttu-id="b2166-214">Dans ces cas, vous ne souhaitez pas `/counter`retourner le contenu mis en cache comme `/index.html` , mais Blazor au lieu de cela besoin du navigateur pour charger le contenu mis en cache comme pour démarrer votre application WebAssembly.</span><span class="sxs-lookup"><span data-stu-id="b2166-214">In these cases, you don't want to return content cached as `/counter`, but instead need the browser to load the content cached as `/index.html` to start up your Blazor WebAssembly app.</span></span> <span data-ttu-id="b2166-215">Ces demandes initiales sont connues sous le nom de demandes de *navigation,* au lieu de :</span><span class="sxs-lookup"><span data-stu-id="b2166-215">These initial requests are known as *navigation* requests, as opposed to:</span></span>

* <span data-ttu-id="b2166-216">*sous-résourcent les* demandes d’images, de feuilles de style ou d’autres fichiers.</span><span class="sxs-lookup"><span data-stu-id="b2166-216">*subresource* requests for images, stylesheets, or other files.</span></span>
* <span data-ttu-id="b2166-217">*demandes d’API par les utilisateurs de l’API/ XHR.*</span><span class="sxs-lookup"><span data-stu-id="b2166-217">*fetch/XHR* requests for API data.</span></span>

<span data-ttu-id="b2166-218">Le travailleur du service par défaut contient une logique de cas spécial pour les demandes de navigation.</span><span class="sxs-lookup"><span data-stu-id="b2166-218">The default service worker contains special-case logic for navigation requests.</span></span> <span data-ttu-id="b2166-219">Le travailleur du service résout les `/index.html`demandes en retournant le contenu mis en cache pour , indépendamment de l’URL demandée.</span><span class="sxs-lookup"><span data-stu-id="b2166-219">The service worker resolves the requests by returning the cached content for `/index.html`, regardless of the requested URL.</span></span> <span data-ttu-id="b2166-220">Cette logique est `onFetch` mise en œuvre dans la fonction à l’intérieur *de service-worker.published.js*.</span><span class="sxs-lookup"><span data-stu-id="b2166-220">This logic is implemented in the `onFetch` function inside *service-worker.published.js*.</span></span>

<span data-ttu-id="b2166-221">Si votre application dispose de certaines URL qui doivent retourner `/index.html` HTML rendu serveur, et ne pas servir à partir du cache, alors vous devez modifier la logique dans votre travailleur de service.</span><span class="sxs-lookup"><span data-stu-id="b2166-221">If your app has certain URLs that must return server-rendered HTML, and not serve `/index.html` from the cache, then you need to edit the logic in your service worker.</span></span> <span data-ttu-id="b2166-222">Si toutes les `/Identity/` URL contenant doivent être traitées comme des demandes régulières en ligne uniquement sur le serveur, puis modifier *service-worker.published.js* `onFetch` logique.</span><span class="sxs-lookup"><span data-stu-id="b2166-222">If all URLs containing `/Identity/` need to be handled as regular online-only requests to the server, then modify *service-worker.published.js* `onFetch` logic.</span></span> <span data-ttu-id="b2166-223">Recherchez le code suivant :</span><span class="sxs-lookup"><span data-stu-id="b2166-223">Locate the following code:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate';
```

<span data-ttu-id="b2166-224">Modifier le code pour les suivants :</span><span class="sxs-lookup"><span data-stu-id="b2166-224">Change the code to the following:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate'
    && !event.request.url.includes('/Identity/');
```

<span data-ttu-id="b2166-225">Si vous ne le faites pas, alors indépendamment de la connectivité réseau, le travailleur de `/index.html`service intercepte les demandes pour ces URL et les résout à l’aide .</span><span class="sxs-lookup"><span data-stu-id="b2166-225">If you don't do this, then regardless of network connectivity, the service worker intercepts requests for such URLs and resolves them using `/index.html`.</span></span>

### <a name="control-asset-caching"></a><span data-ttu-id="b2166-226">Mise en cache d’actifs de contrôle</span><span class="sxs-lookup"><span data-stu-id="b2166-226">Control asset caching</span></span>

<span data-ttu-id="b2166-227">Si votre projet `ServiceWorkerAssetsManifest` définit la propriété BlazorMSBuild, « l’outillage de construction génère un actif de travailleur de service manifeste avec le nom spécifié.</span><span class="sxs-lookup"><span data-stu-id="b2166-227">If your project defines the `ServiceWorkerAssetsManifest` MSBuild property, Blazor's build tooling generates a service worker assets manifest with the specified name.</span></span> <span data-ttu-id="b2166-228">Le modèle PWA par défaut produit un fichier de projet contenant la propriété suivante :</span><span class="sxs-lookup"><span data-stu-id="b2166-228">The default PWA template produces a project file containing the following property:</span></span>

```xml
<ServiceWorkerAssetsManifest>service-worker-assets.js</ServiceWorkerAssetsManifest>
```

<span data-ttu-id="b2166-229">Le fichier est placé dans l’annuaire de sortie *wwwroot,* `/service-worker-assets.js`de sorte que le navigateur peut récupérer ce fichier en demandant .</span><span class="sxs-lookup"><span data-stu-id="b2166-229">The file is placed in the *wwwroot* output directory, so the browser can retrieve this file by requesting `/service-worker-assets.js`.</span></span> <span data-ttu-id="b2166-230">Pour voir le contenu de ce fichier, ouvrez */bin/Debug/TARGET FRAMEWORK/wwwroot/service-worker-assets.js* dans un éditeur de texte.</span><span class="sxs-lookup"><span data-stu-id="b2166-230">To see the contents of this file, open */bin/Debug/{TARGET FRAMEWORK}/wwwroot/service-worker-assets.js* in a text editor.</span></span> <span data-ttu-id="b2166-231">Cependant, ne modifiez pas le fichier, car il est régénéré sur chaque version.</span><span class="sxs-lookup"><span data-stu-id="b2166-231">However, don't edit the file, as it's regenerated on each build.</span></span>

<span data-ttu-id="b2166-232">Par défaut, ce manifeste énumère :</span><span class="sxs-lookup"><span data-stu-id="b2166-232">By default, this manifest lists:</span></span>

* <span data-ttu-id="b2166-233">Toutes Blazorles ressources gérées, telles que les assemblages .NET et les fichiers .NET WebAssembly runtime nécessaires pour fonctionner hors ligne.</span><span class="sxs-lookup"><span data-stu-id="b2166-233">Any Blazor-managed resources, such as .NET assemblies and the .NET WebAssembly runtime files required to function offline.</span></span>
* <span data-ttu-id="b2166-234">Toutes les ressources pour la publication à l’annuaire *wwwroot* de l’application, telles que les images, les feuilles de style et les fichiers JavaScript, y compris les actifs Web statiques fournis par des projets externes et des forfaits NuGet.</span><span class="sxs-lookup"><span data-stu-id="b2166-234">All resources for publishing to the app's *wwwroot* directory, such as images, stylesheets, and JavaScript files, including static web assets supplied by external projects and NuGet packages.</span></span>

<span data-ttu-id="b2166-235">Vous pouvez contrôler laquelle de ces ressources sont récupérées et mises `onInstall` en cache par le travailleur de service en éditant la logique dans *service-worker.published.js*.</span><span class="sxs-lookup"><span data-stu-id="b2166-235">You can control which of these resources are fetched and cached by the service worker by editing the logic in `onInstall` in *service-worker.published.js*.</span></span> <span data-ttu-id="b2166-236">Par défaut, le travailleur de service récupère et cache des fichiers correspondant à des extensions typiques de nom de fichier Web Blazor tels que *.html*, *.css*, *.js*, et *.wasm*, plus les types de fichiers spécifiques à WebAssembly (*.dll*, *.pdb*).</span><span class="sxs-lookup"><span data-stu-id="b2166-236">By default, the service worker fetches and caches files matching typical web filename extensions such as *.html*, *.css*, *.js*, and *.wasm*, plus file types specific to Blazor WebAssembly (*.dll*, *.pdb*).</span></span>

<span data-ttu-id="b2166-237">Pour inclure des ressources supplémentaires qui ne sont pas présentes dans le répertoire `ItemGroup` *wwwroot* de l’application, définissez les entrées extra MSBuild, comme le montre l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="b2166-237">To include additional resources that aren't present in the app's *wwwroot* directory, define extra MSBuild `ItemGroup` entries, as shown in the following example:</span></span>

```xml
<ItemGroup>
  <ServiceWorkerAssetsManifestItem Include="MyDirectory\AnotherFile.json"
    RelativePath="MyDirectory\AnotherFile.json" AssetUrl="files/AnotherFile.json" />
</ItemGroup>
```

<span data-ttu-id="b2166-238">Les `AssetUrl` métadonnées spécifient l’URL de base relative que le navigateur doit utiliser lorsque vous allez chercher la ressource à cacher.</span><span class="sxs-lookup"><span data-stu-id="b2166-238">The `AssetUrl` metadata specifies the base-relative URL that the browser should use when fetching the resource to cache.</span></span> <span data-ttu-id="b2166-239">Cela peut être indépendant de son nom de fichier source d’origine sur le disque.</span><span class="sxs-lookup"><span data-stu-id="b2166-239">This can be independent of its original source file name on disk.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b2166-240">L’ajout d’un `ServiceWorkerAssetsManifestItem` n’entraîne pas la publication du fichier dans l’annuaire *wwwroot* de l’application.</span><span class="sxs-lookup"><span data-stu-id="b2166-240">Adding a `ServiceWorkerAssetsManifestItem` doesn't cause the file to be published in the app's *wwwroot* directory.</span></span> <span data-ttu-id="b2166-241">La sortie de publication doit être contrôlée séparément.</span><span class="sxs-lookup"><span data-stu-id="b2166-241">The publish output must be controlled separately.</span></span> <span data-ttu-id="b2166-242">La `ServiceWorkerAssetsManifestItem` seule cause l’apparition d’une entrée supplémentaire dans les biens des travailleurs de service.</span><span class="sxs-lookup"><span data-stu-id="b2166-242">The `ServiceWorkerAssetsManifestItem` only causes an additional entry to appear in the service worker assets manifest.</span></span>

## <a name="push-notifications"></a><span data-ttu-id="b2166-243">Notifications Push</span><span class="sxs-lookup"><span data-stu-id="b2166-243">Push notifications</span></span>

<span data-ttu-id="b2166-244">Comme tout autre PWA, un Blazor PWA WebAssembly peut recevoir des notifications push à partir d’un serveur backend.</span><span class="sxs-lookup"><span data-stu-id="b2166-244">Like any other PWA, a Blazor WebAssembly PWA can receive push notifications from a backend server.</span></span> <span data-ttu-id="b2166-245">Le serveur peut envoyer des notifications push à tout moment, même lorsque l’utilisateur n’utilise pas activement l’application.</span><span class="sxs-lookup"><span data-stu-id="b2166-245">The server can send push notifications at any time, even when the user isn't actively using the app.</span></span> <span data-ttu-id="b2166-246">Par exemple, des notifications push peuvent être envoyées lorsqu’un autre utilisateur effectue une action pertinente.</span><span class="sxs-lookup"><span data-stu-id="b2166-246">For example, push notifications can be sent when a different user performs a relevant action.</span></span>

<span data-ttu-id="b2166-247">Le mécanisme d’envoi d’une Blazor notification push est entièrement indépendant de WebAssembly, car il est implémenté par le serveur backend qui peut utiliser n’importe quelle technologie.</span><span class="sxs-lookup"><span data-stu-id="b2166-247">The mechanism for sending a push notification is entirely independent of Blazor WebAssembly, since it's implemented by the backend server which can use any technology.</span></span> <span data-ttu-id="b2166-248">Si vous souhaitez envoyer des notifications push à partir d’un serveur ASP.NET Core, envisagez [d’utiliser une technique similaire à l’approche adoptée dans l’atelier Blazing Pizza](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span><span class="sxs-lookup"><span data-stu-id="b2166-248">If you want to send push notifications from an ASP.NET Core server, consider [using a technique similar to the approach taken in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span></span>

<span data-ttu-id="b2166-249">Le mécanisme de réception et d’affichage d’une notification push sur le client est également indépendant de Blazor WebAssembly, car il est implémenté dans le fichier JavaScript du travailleur de service.</span><span class="sxs-lookup"><span data-stu-id="b2166-249">The mechanism for receiving and displaying a push notification on the client is also independent of Blazor WebAssembly, since it's implemented in the service worker JavaScript file.</span></span> <span data-ttu-id="b2166-250">Par exemple, voir [l’approche utilisée dans l’atelier Blazing Pizza](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span><span class="sxs-lookup"><span data-stu-id="b2166-250">For an example, see [the approach used in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span></span>

## <a name="caveats-for-offline-pwas"></a><span data-ttu-id="b2166-251">Mises en garde pour les APR hors ligne</span><span class="sxs-lookup"><span data-stu-id="b2166-251">Caveats for offline PWAs</span></span>

<span data-ttu-id="b2166-252">Toutes les applications ne devraient pas tenter de prendre en charge l’utilisation hors connexion.</span><span class="sxs-lookup"><span data-stu-id="b2166-252">Not all apps should attempt to support offline use.</span></span> <span data-ttu-id="b2166-253">Le soutien hors ligne ajoute une complexité importante, tout en n’étant pas toujours pertinent pour les cas d’utilisation requis.</span><span class="sxs-lookup"><span data-stu-id="b2166-253">Offline support adds significant complexity, while not always being relevant for the use cases required.</span></span>

<span data-ttu-id="b2166-254">Le support hors ligne n’est généralement pertinent que :</span><span class="sxs-lookup"><span data-stu-id="b2166-254">Offline support is usually relevant only:</span></span>

* <span data-ttu-id="b2166-255">Si le principal magasin de données est local pour le navigateur.</span><span class="sxs-lookup"><span data-stu-id="b2166-255">If the primary data store is local to the browser.</span></span> <span data-ttu-id="b2166-256">Par exemple, l’approche est pertinente dans une application avec une interface `localStorage` utilisateur pour un appareil [IoT](https://en.wikipedia.org/wiki/Internet_of_things) qui stocke les données dans ou [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span><span class="sxs-lookup"><span data-stu-id="b2166-256">For example, the approach is relevant in an app with a UI for an [IoT](https://en.wikipedia.org/wiki/Internet_of_things) device that stores data in `localStorage` or [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span></span>
* <span data-ttu-id="b2166-257">Si l’application effectue une quantité importante de travail pour aller chercher et mettre en cache les données API backend pertinentes pour chaque utilisateur afin qu’ils puissent naviguer à travers les données hors ligne.</span><span class="sxs-lookup"><span data-stu-id="b2166-257">If the app performs a significant amount of work to fetch and cache the backend API data relevant to each user so that they can navigate through the data offline.</span></span> <span data-ttu-id="b2166-258">Si l’application doit prendre en charge l’édition, un système de suivi des modifications et de synchronisation des données avec le backend doit être construit.</span><span class="sxs-lookup"><span data-stu-id="b2166-258">If the app must support editing, a system for tracking changes and synchronizing data with the backend must be built.</span></span>
* <span data-ttu-id="b2166-259">Si l’objectif est de garantir que l’application se charge immédiatement indépendamment des conditions du réseau.</span><span class="sxs-lookup"><span data-stu-id="b2166-259">If the goal is to guarantee that the app loads immediately regardless of network conditions.</span></span> <span data-ttu-id="b2166-260">Implémentez une expérience utilisateur appropriée autour des demandes d’API backend pour montrer l’avancement des demandes et se comporter gracieusement lorsque les demandes échouent en raison de l’indisponibilité du réseau.</span><span class="sxs-lookup"><span data-stu-id="b2166-260">Implement a suitable user experience around backend API requests to show the progress of requests and behave gracefully when requests fail due to network unavailability.</span></span>

<span data-ttu-id="b2166-261">En outre, les APE hors ligne doivent faire face à une série de complications supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="b2166-261">Additionally, offline-capable PWAs must deal with a range of additional complications.</span></span> <span data-ttu-id="b2166-262">Les développeurs doivent se familiariser soigneusement avec les mises en garde dans les sections suivantes.</span><span class="sxs-lookup"><span data-stu-id="b2166-262">Developers should carefully familiarize themselves with the caveats in the following sections.</span></span>

### <a name="offline-support-only-when-published"></a><span data-ttu-id="b2166-263">Soutien hors ligne uniquement lorsqu’il est publié</span><span class="sxs-lookup"><span data-stu-id="b2166-263">Offline support only when published</span></span>

<span data-ttu-id="b2166-264">Pendant le développement, vous voulez généralement voir chaque changement reflété immédiatement dans le navigateur sans passer par un processus de mise à jour d’arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="b2166-264">During development you typically want to see each change reflected immediately in the browser without going through a background update process.</span></span> <span data-ttu-id="b2166-265">Par Blazorconséquent, le modèle PWA de 's ne permet le support hors ligne que lorsqu’il est publié.</span><span class="sxs-lookup"><span data-stu-id="b2166-265">Therefore, Blazor's PWA template enables offline support only when published.</span></span>

<span data-ttu-id="b2166-266">Lors de la construction d’une application hors connexion, il ne suffit pas de tester l’application dans l’environnement développement.</span><span class="sxs-lookup"><span data-stu-id="b2166-266">When building an offline-capable app, it's not enough to test the app in the Development environment.</span></span> <span data-ttu-id="b2166-267">Vous devez tester l’application dans son état publié pour comprendre comment elle répond aux différentes conditions du réseau.</span><span class="sxs-lookup"><span data-stu-id="b2166-267">You must test the app in its published state to understand how it responds to different network conditions.</span></span>

### <a name="update-completion-after-user-navigation-away-from-app"></a><span data-ttu-id="b2166-268">Mettre à jour l’achèvement après la navigation de l’utilisateur loin de l’application</span><span class="sxs-lookup"><span data-stu-id="b2166-268">Update completion after user navigation away from app</span></span>

<span data-ttu-id="b2166-269">Les mises à jour ne sont pas terminées tant que l’utilisateur n’a pas navigué loin de l’application dans tous les onglets.</span><span class="sxs-lookup"><span data-stu-id="b2166-269">Updates don't complete until the user has navigated away from the app in all tabs.</span></span> <span data-ttu-id="b2166-270">Comme expliqué dans la section [mises à jour De fond,](#background-updates) après avoir déployé une mise à jour de l’application, le navigateur récupère les fichiers des travailleurs de service mis à jour pour commencer le processus de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="b2166-270">As explained in the [Background updates](#background-updates) section, after you deploy an update to the app, the browser fetches the updated service worker files to begin the update process.</span></span>

<span data-ttu-id="b2166-271">Ce qui surprend de nombreux développeurs, c’est que, même lorsque cette mise à jour se termine, elle ne prend **effet que** lorsque l’utilisateur n’a pas navigué loin dans tous les onglets.</span><span class="sxs-lookup"><span data-stu-id="b2166-271">What surprises many developers is that, even when this update completes, it does **not** take effect until the user has navigated away in all tabs.</span></span> <span data-ttu-id="b2166-272">Il **ne** suffit pas de rafraîchir l’onglet affichant l’application, même si c’est le seul onglet affichant l’application.</span><span class="sxs-lookup"><span data-stu-id="b2166-272">It is **not** sufficient to refresh the tab displaying the app, even if it's the only tab displaying the app.</span></span> <span data-ttu-id="b2166-273">Jusqu’à ce que votre application soit complètement fermée, le nouveau travailleur de service reste dans *l’attente d’activer* l’état.</span><span class="sxs-lookup"><span data-stu-id="b2166-273">Until your app is completely closed, the new service worker remains in the *waiting to activate* status.</span></span> <span data-ttu-id="b2166-274">**Ce n’est Blazorpas spécifique à , mais plutôt est un comportement de plate-forme web standard.**</span><span class="sxs-lookup"><span data-stu-id="b2166-274">**This is not specific to Blazor, but rather is a standard web platform behavior.**</span></span>

<span data-ttu-id="b2166-275">Cela dérange généralement les développeurs qui essaient de tester les mises à jour de leur travailleur de service ou hors ligne mis en cache des ressources.</span><span class="sxs-lookup"><span data-stu-id="b2166-275">This commonly troubles developers who are trying to test updates to their service worker or offline cached resources.</span></span> <span data-ttu-id="b2166-276">Si vous vérifiez les outils de développeur du navigateur, vous pouvez voir quelque chose comme ce qui suit:</span><span class="sxs-lookup"><span data-stu-id="b2166-276">If you check in the browser's developer tools, you may see something like the following:</span></span>

![L’onglet « Application » de Google Chrome montre que le serviceier de l’application « attend d’activer ».](progressive-web-app/_static/image7.png)

<span data-ttu-id="b2166-278">Tant que la liste des « clients », qui sont des onglets ou des fenêtres affichant votre application, n’est pas tentante, le travailleur continue d’attendre.</span><span class="sxs-lookup"><span data-stu-id="b2166-278">For as long as the list of "clients," which are tabs or windows displaying your app, is nonempty, the worker continues waiting.</span></span> <span data-ttu-id="b2166-279">La raison pour laquelle les travailleurs des services le font est de garantir l’uniformité.</span><span class="sxs-lookup"><span data-stu-id="b2166-279">The reason service workers do this is to guarantee consistency.</span></span> <span data-ttu-id="b2166-280">La cohérence signifie que toutes les ressources sont récupérées à partir de la même cache atomique.</span><span class="sxs-lookup"><span data-stu-id="b2166-280">Consistency means that all resources are fetched from the same atomic cache.</span></span>

<span data-ttu-id="b2166-281">Lorsque vous testez des modifications, vous pouvez trouver pratique de cliquer sur le lien "skipWaiting" tel qu’indiqué dans la capture d’écran précédente, puis recharger la page.</span><span class="sxs-lookup"><span data-stu-id="b2166-281">When testing changes, you may find it convenient to click the "skipWaiting" link as shown in the preceding screenshot, then reload the page.</span></span> <span data-ttu-id="b2166-282">Vous pouvez automatiser cela pour tous les utilisateurs en codant votre serviceur pour [sauter la phase «attente» et activer immédiatement sur la mise à jour](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span><span class="sxs-lookup"><span data-stu-id="b2166-282">You can automate this for all users by coding your service worker to [skip the "waiting" phase and immediately activate on update](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span></span> <span data-ttu-id="b2166-283">Si vous sautez la phase d’attente, vous renoncez à la garantie que les ressources sont toujours récupérées de la même instance de cache.</span><span class="sxs-lookup"><span data-stu-id="b2166-283">If you skip the waiting phase, you're giving up the guarantee that resources are always fetched consistently from the same cache instance.</span></span>

### <a name="users-may-run-any-historical-version-of-the-app"></a><span data-ttu-id="b2166-284">Les utilisateurs peuvent exécuter n’importe quelle version historique de l’application</span><span class="sxs-lookup"><span data-stu-id="b2166-284">Users may run any historical version of the app</span></span>

<span data-ttu-id="b2166-285">Les développeurs Web s’attendent habituellement à ce que les utilisateurs n’exécutent que la dernière version déployée de leur application web, puisque c’est normal dans le modèle de distribution Web traditionnel.</span><span class="sxs-lookup"><span data-stu-id="b2166-285">Web developers habitually expect that users only run the latest deployed version of their web app, since that's normal within the traditional web distribution model.</span></span> <span data-ttu-id="b2166-286">Cependant, un PWA hors ligne d’abord est plus proche d’une application mobile native, où les utilisateurs ne sont pas nécessairement en cours d’exécution de la dernière version.</span><span class="sxs-lookup"><span data-stu-id="b2166-286">However, an offline-first PWA is more akin to a native mobile app, where users aren't necessarily running the latest version.</span></span>

<span data-ttu-id="b2166-287">Comme expliqué dans la section [mises à jour De fond,](#background-updates) après avoir déployé une mise à jour de votre application, chaque utilisateur existant continue **d’utiliser une version précédente pour au moins une autre visite** parce que la mise à jour se produit en arrière-plan et n’est pas activée jusqu’à ce que l’utilisateur navigue par la suite.</span><span class="sxs-lookup"><span data-stu-id="b2166-287">As explained in the [Background updates](#background-updates) section, after you deploy an update to your app, **each existing user continues to use a previous version for at least one further visit** because the update occurs in the background and isn't activated until the user thereafter navigates away.</span></span> <span data-ttu-id="b2166-288">De plus, la version précédente utilisée n’est pas nécessairement la précédente que vous avez déployée.</span><span class="sxs-lookup"><span data-stu-id="b2166-288">Plus, the previous version being used isn't necessarily the previous one you deployed.</span></span> <span data-ttu-id="b2166-289">La version précédente peut être *n’importe quelle* version historique, selon le moment où l’utilisateur a terminé une dernière mise à jour.</span><span class="sxs-lookup"><span data-stu-id="b2166-289">The previous version can be *any* historical version, depending on when the user last completed an update.</span></span>

<span data-ttu-id="b2166-290">Cela peut être un problème si les parties frontend et backend de votre app exigent un accord sur le schéma pour les demandes API.</span><span class="sxs-lookup"><span data-stu-id="b2166-290">This can be an issue if the frontend and backend parts of your app require agreement about the schema for API requests.</span></span> <span data-ttu-id="b2166-291">Vous ne devez pas déployer de modifications de schéma aPI rétrogrades jusqu’à ce que vous puissiez être sûr que tous les utilisateurs ont mis à niveau.</span><span class="sxs-lookup"><span data-stu-id="b2166-291">You must not deploy backward-incompatible API schema changes until you can be sure that all users have upgraded.</span></span> <span data-ttu-id="b2166-292">Alternativement, empêcher les utilisateurs d’utiliser des versions plus anciennes incompatibles de l’application.</span><span class="sxs-lookup"><span data-stu-id="b2166-292">Alternatively, block users from using incompatible older versions of the app.</span></span> <span data-ttu-id="b2166-293">Cette exigence de scénario est la même que pour les applications mobiles natives.</span><span class="sxs-lookup"><span data-stu-id="b2166-293">This scenario requirement is the same as for native mobile apps.</span></span> <span data-ttu-id="b2166-294">Si vous déployez un changement de rupture dans les API serveur, l’application client est cassée pour les utilisateurs qui n’ont pas encore mis à jour.</span><span class="sxs-lookup"><span data-stu-id="b2166-294">If you deploy a breaking change in server APIs, the client app is broken for users who haven't yet updated.</span></span>

<span data-ttu-id="b2166-295">Si possible, ne déployez pas de modifications de rupture dans vos API backend.</span><span class="sxs-lookup"><span data-stu-id="b2166-295">If possible, don't deploy breaking changes to your backend APIs.</span></span> <span data-ttu-id="b2166-296">Si vous devez le faire, envisagez d’utiliser [des API standard de travailleurs de service tels que ServiceWorkerRegistration](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) pour déterminer si l’application est à jour, et sinon, pour empêcher l’utilisation.</span><span class="sxs-lookup"><span data-stu-id="b2166-296">If you must do so, consider using [standard Service Worker APIs such as ServiceWorkerRegistration](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) to determine whether the app is up-to-date, and if not, to prevent usage.</span></span>

### <a name="interference-with-server-rendered-pages"></a><span data-ttu-id="b2166-297">Interférence avec les pages rendues par le serveur</span><span class="sxs-lookup"><span data-stu-id="b2166-297">Interference with server-rendered pages</span></span>

<span data-ttu-id="b2166-298">Tel que décrit dans la section [des pages rendues par le serveur support,](#support-server-rendered-pages) si vous souhaitez contourner le comportement du travailleur du service de retourner `/index.html` le contenu pour toutes les demandes de navigation, modifiez la logique dans votre service.</span><span class="sxs-lookup"><span data-stu-id="b2166-298">As described in the [Support server-rendered pages](#support-server-rendered-pages) section, if you want to bypass the service worker's behavior of returning `/index.html` contents for all navigation requests, edit the logic in your service worker.</span></span>

### <a name="all-service-worker-asset-manifest-contents-are-cached-by-default"></a><span data-ttu-id="b2166-299">Tous les contenus manifestes de l’actif des travailleurs de service sont mis en cache par défaut</span><span class="sxs-lookup"><span data-stu-id="b2166-299">All service worker asset manifest contents are cached by default</span></span>

<span data-ttu-id="b2166-300">Tel que décrit dans la section [de mise en cache d’actifs de contrôle,](#control-asset-caching) le service de *fichiers-travailleur-assets.js* est généré pendant la construction et répertorie tous les actifs que le travailleur de service doit aller chercher et mettre en cache.</span><span class="sxs-lookup"><span data-stu-id="b2166-300">As described in the [Control asset caching](#control-asset-caching) section, the file *service-worker-assets.js* is generated during build and lists all assets the service worker should fetch and cache.</span></span>

<span data-ttu-id="b2166-301">Étant donné que cette liste comprend par défaut tout ce qui est émis à *wwwroot*, y compris le contenu fourni par des paquets externes et des projets, vous devez faire attention de ne pas y mettre trop de contenu.</span><span class="sxs-lookup"><span data-stu-id="b2166-301">Since this list by default includes everything emitted to *wwwroot*, including content supplied by external packages and projects, you must be careful not to put too much content there.</span></span> <span data-ttu-id="b2166-302">Si le répertoire *wwwroot* contient des millions d’images, le travailleur de service essaie de les chercher et de les mettre en cache tous, consommant une bande passante excessive et très probablement ne pas terminer avec succès.</span><span class="sxs-lookup"><span data-stu-id="b2166-302">If the *wwwroot* directory contains millions of images, the service worker tries to fetch and cache them all, consuming excessive bandwidth and most likely not completing successfully.</span></span>

<span data-ttu-id="b2166-303">Mettre en œuvre une logique arbitraire pour contrôler quel sous-ensemble du `onInstall` contenu du manifeste doit être récupéré et mis en cache en modifiant la fonction dans *service-worker.published.js*.</span><span class="sxs-lookup"><span data-stu-id="b2166-303">Implement arbitrary logic to control which subset of the manifest's contents should be fetched and cached by editing the `onInstall` function in *service-worker.published.js*.</span></span>

### <a name="interaction-with-authentication"></a><span data-ttu-id="b2166-304">Interaction avec l’authentification</span><span class="sxs-lookup"><span data-stu-id="b2166-304">Interaction with authentication</span></span>

<span data-ttu-id="b2166-305">Il est possible d’utiliser l’option modèle PWA en conjonction avec les options d’authentification.</span><span class="sxs-lookup"><span data-stu-id="b2166-305">It's possible to use the PWA template option in conjunction with the authentication options.</span></span> <span data-ttu-id="b2166-306">Un PWA hors connexion peut également prendre en charge l’authentification lorsque l’utilisateur a une connectivité réseau.</span><span class="sxs-lookup"><span data-stu-id="b2166-306">An offline-capable PWA can also support authentication when the user has network connectivity.</span></span>

<span data-ttu-id="b2166-307">Lorsqu’un utilisateur n’a pas de connectivité réseau, il ne peut pas authentifier ou obtenir des jetons d’accès.</span><span class="sxs-lookup"><span data-stu-id="b2166-307">When a user doesn't have network connectivity, they can't authenticate or obtain access tokens.</span></span> <span data-ttu-id="b2166-308">Par défaut, tenter de visiter la page de connexion sans accès réseau se traduit par un message d'« erreur réseau ».</span><span class="sxs-lookup"><span data-stu-id="b2166-308">By default, attempting to visit the login page without network access results in a "network error" message.</span></span>

<span data-ttu-id="b2166-309">Vous devez concevoir un flux d’interface utilisateur qui permet à l’utilisateur de faire des choses utiles tout en hors ligne sans tenter d’authentifier ou d’obtenir des jetons d’accès.</span><span class="sxs-lookup"><span data-stu-id="b2166-309">You must design a UI flow that lets the user do useful things while offline without attempting to authenticate or obtain access tokens.</span></span> <span data-ttu-id="b2166-310">Alternativement, vous pouvez concevoir l’application pour échouer d’une manière gracieuse lorsque le réseau n’est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="b2166-310">Alternatively, you can design the app to fail in a graceful way when the network isn't available.</span></span> <span data-ttu-id="b2166-311">Si cela n’est pas possible dans votre application, vous ne voudrez peut-être pas activer le support hors ligne.</span><span class="sxs-lookup"><span data-stu-id="b2166-311">If this isn't possible in your app, you might not want to enable offline support.</span></span>
