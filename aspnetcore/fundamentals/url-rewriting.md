---
title: Intergiciel (middleware) de réécriture d’URL dans ASP.NET Core
author: rick-anderson
description: Découvrez la réécriture et la redirection d’URL avec l’intergiciel (middleware) de réécriture d’URL dans les applications ASP.NET Core.
monikerRange: '>= aspnetcore-2.1'
ms.author: riande
ms.custom: mvc
ms.date: 08/16/2019
no-loc:
- Blazor
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: fundamentals/url-rewriting
ms.openlocfilehash: 9e12831f57af02cd427d2a66d9d4c4d654905106
ms.sourcegitcommit: 70e5f982c218db82aa54aa8b8d96b377cfc7283f
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/04/2020
ms.locfileid: "82774858"
---
# <a name="url-rewriting-middleware-in-aspnet-core"></a><span data-ttu-id="ab2c8-103">Intergiciel (middleware) de réécriture d’URL dans ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="ab2c8-103">URL Rewriting Middleware in ASP.NET Core</span></span>

<span data-ttu-id="ab2c8-104">Par [Mikael Mengistu](https://github.com/mikaelm12)</span><span class="sxs-lookup"><span data-stu-id="ab2c8-104">By [Mikael Mengistu](https://github.com/mikaelm12)</span></span>

::: moniker range=">= aspnetcore-3.0"

<span data-ttu-id="ab2c8-105">Ce document présente la réécriture d’URL avec des instructions sur la façon d’utiliser l’intergiciel (middleware) de réécriture d’URL dans les applications ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-105">This document introduces URL rewriting with instructions on how to use URL Rewriting Middleware in ASP.NET Core apps.</span></span>

<span data-ttu-id="ab2c8-106">La réécriture d’URL consiste à modifier des URL de requête en fonction d’une ou de plusieurs règles prédéfinies.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-106">URL rewriting is the act of modifying request URLs based on one or more predefined rules.</span></span> <span data-ttu-id="ab2c8-107">La réécriture d’URL crée une abstraction entre les emplacements des ressources et leurs adresses pour que les emplacements et les adresses ne soient pas étroitement liés.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-107">URL rewriting creates an abstraction between resource locations and their addresses so that the locations and addresses aren't tightly linked.</span></span> <span data-ttu-id="ab2c8-108">La réécriture d’URL est utile dans plusieurs scénarios pour :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-108">URL rewriting is valuable in several scenarios to:</span></span>

* <span data-ttu-id="ab2c8-109">Déplacer ou remplacer de façon temporaire ou permanente les ressources d’un serveur, tout en conservant des localisateurs stables pour ces ressources.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-109">Move or replace server resources temporarily or permanently and maintain stable locators for those resources.</span></span>
* <span data-ttu-id="ab2c8-110">Diviser le traitement des requêtes entre différentes applications ou entre différentes parties d’une même application.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-110">Split request processing across different apps or across areas of one app.</span></span>
* <span data-ttu-id="ab2c8-111">Supprimer, ajouter ou réorganiser les segments d’URL sur des requêtes entrantes.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-111">Remove, add, or reorganize URL segments on incoming requests.</span></span>
* <span data-ttu-id="ab2c8-112">Optimiser les URL publiques pour l’optimisation du référencement d’un site auprès d’un moteur de recherche (SEO).</span><span class="sxs-lookup"><span data-stu-id="ab2c8-112">Optimize public URLs for Search Engine Optimization (SEO).</span></span>
* <span data-ttu-id="ab2c8-113">Permettre l’utilisation des URL publiques conviviales pour aider les visiteurs à prédire le contenu retourné en demandant une ressource.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-113">Permit the use of friendly public URLs to help visitors predict the content returned by requesting a resource.</span></span>
* <span data-ttu-id="ab2c8-114">Rediriger des requêtes non sécurisées vers des points de terminaison sécurisés.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-114">Redirect insecure requests to secure endpoints.</span></span>
* <span data-ttu-id="ab2c8-115">Empêcher les liaisons à chaud, où un site externe utilise une ressource statique hébergée sur un autre site en liant la ressource dans son propre contenu.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-115">Prevent hotlinking, where an external site uses a hosted static asset on another site by linking the asset into its own content.</span></span>

> [!NOTE]
> <span data-ttu-id="ab2c8-116">La réécriture d’URL peut réduire les performances d’une application.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-116">URL rewriting can reduce the performance of an app.</span></span> <span data-ttu-id="ab2c8-117">Quand c’est possible, limitez le nombre et la complexité des règles.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-117">Where feasible, limit the number and complexity of rules.</span></span>

<span data-ttu-id="ab2c8-118">[Afficher ou télécharger l’exemple de code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/) ([procédure de téléchargement](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="ab2c8-118">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="url-redirect-and-url-rewrite"></a><span data-ttu-id="ab2c8-119">Redirection d’URL et réécriture d’URL</span><span class="sxs-lookup"><span data-stu-id="ab2c8-119">URL redirect and URL rewrite</span></span>

<span data-ttu-id="ab2c8-120">La différence de formulation entre la *redirection d’URL* et la *réécriture d’URL* est subtile, mais elle a des implications importantes sur la fourniture de ressources aux clients.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-120">The difference in wording between *URL redirect* and *URL rewrite* is subtle but has important implications for providing resources to clients.</span></span> <span data-ttu-id="ab2c8-121">L’intergiciel de réécriture d’URL d’ASP.NET Core est capables de répondre aux besoins des deux.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-121">ASP.NET Core's URL Rewriting Middleware is capable of meeting the need for both.</span></span>

<span data-ttu-id="ab2c8-122">Une *redirection d’URL* implique une opération côté client, où le client est invité à accéder à une ressource à une autre adresse que celle demandée à l’origine.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-122">A *URL redirect* involves a client-side operation, where the client is instructed to access a resource at a different address than the client originally requested.</span></span> <span data-ttu-id="ab2c8-123">Ceci nécessite un aller-retour avec le serveur.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-123">This requires a round trip to the server.</span></span> <span data-ttu-id="ab2c8-124">L’URL de redirection retournée au client s’affiche dans la barre d’adresse du navigateur quand le client effectue une nouvelle requête pour la ressource.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-124">The redirect URL returned to the client appears in the browser's address bar when the client makes a new request for the resource.</span></span>

<span data-ttu-id="ab2c8-125">Si `/resource` est *redirigée* vers `/different-resource`, le serveur répond que le client doit obtenir la ressource à l’emplacement `/different-resource` avec un code d’état indiquant que la redirection est temporaire ou permanente.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-125">If `/resource` is *redirected* to `/different-resource`, the server responds that the client should obtain the resource at `/different-resource` with a status code indicating that the redirect is either temporary or permanent.</span></span>

![Un point de terminaison de service WebAPI a été changé temporairement de la version 1 (v1) à la version 2 (v2) sur le serveur.](url-rewriting/_static/url_redirect.png)

<span data-ttu-id="ab2c8-131">Lors de la redirection des requêtes vers une URL différente, indiquez si la redirection est permanente ou temporaire en spécifiant le code d’état avec la réponse :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-131">When redirecting requests to a different URL, indicate whether the redirect is permanent or temporary by specifying the status code with the response:</span></span>

* <span data-ttu-id="ab2c8-132">Le code d’état *301 - Déplacé de façon permanente* est utilisé quand la ressource a une nouvelle URL permanente et que vous voulez indiquer au client que toutes les requêtes futures pour la ressource doivent utiliser la nouvelle URL.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-132">The *301 - Moved Permanently* status code is used where the resource has a new, permanent URL and you wish to instruct the client that all future requests for the resource should use the new URL.</span></span> <span data-ttu-id="ab2c8-133">*Le client peut mettre en cache et réutiliser la réponse quand un code d’état 301 est reçu.*</span><span class="sxs-lookup"><span data-stu-id="ab2c8-133">*The client may cache and reuse the response when a 301 status code is received.*</span></span>

* <span data-ttu-id="ab2c8-134">Le code d’état *302 - Trouvé* est utilisé quand la redirection est temporaire ou généralement susceptible d’être modifiée.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-134">The *302 - Found* status code is used where the redirection is temporary or generally subject to change.</span></span> <span data-ttu-id="ab2c8-135">Le code d’état 302 indique au client de ne pas stocker l’URL et de ne plus l’utiliser.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-135">The 302 status code indicates to the client not to store the URL and use it in the future.</span></span>

<span data-ttu-id="ab2c8-136">Pour plus d’informations sur les codes d’état, consultez [RFC 2616: Status Code Definitions](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html).</span><span class="sxs-lookup"><span data-stu-id="ab2c8-136">For more information on status codes, see [RFC 2616: Status Code Definitions](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html).</span></span>

<span data-ttu-id="ab2c8-137">Une *réécriture d’URL* est une opération côté serveur qui fournit une ressource à partir d’une adresse de ressource différente de celle demandée par le client.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-137">A *URL rewrite* is a server-side operation that provides a resource from a different resource address than the client requested.</span></span> <span data-ttu-id="ab2c8-138">La réécriture d’URL ne nécessite pas d’aller-retour avec le serveur.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-138">Rewriting a URL doesn't require a round trip to the server.</span></span> <span data-ttu-id="ab2c8-139">L’URL réécrite n’est pas retournée au client et n’apparaît pas dans la barre d’adresse du navigateur.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-139">The rewritten URL isn't returned to the client and doesn't appear in the browser's address bar.</span></span>

<span data-ttu-id="ab2c8-140">Si `/resource` est *réécrite* en `/different-resource`, le serveur récupère la ressource *en interne* à l’emplacement `/different-resource`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-140">If `/resource` is *rewritten* to `/different-resource`, the server *internally* fetches and returns the resource at `/different-resource`.</span></span>

<span data-ttu-id="ab2c8-141">Même si le client peut récupérer la ressource à l’URL réécrite, il n’est pas informé que la ressource existe à l’URL réécrite quand il fait sa requête et reçoit la réponse.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-141">Although the client might be able to retrieve the resource at the rewritten URL, the client isn't informed that the resource exists at the rewritten URL when it makes its request and receives the response.</span></span>

![Un point de terminaison de service WebAPI a été changé de la version 1 (v1) à la version 2 (v2) sur le serveur.](url-rewriting/_static/url_rewrite.png)

## <a name="url-rewriting-sample-app"></a><span data-ttu-id="ab2c8-146">Exemple d’application de réécriture d’URL</span><span class="sxs-lookup"><span data-stu-id="ab2c8-146">URL rewriting sample app</span></span>

<span data-ttu-id="ab2c8-147">Vous pouvez explorer les fonctionnalités du middleware de réécriture d’URL avec [l’exemple d’application](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/).</span><span class="sxs-lookup"><span data-stu-id="ab2c8-147">You can explore the features of the URL Rewriting Middleware with the [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/).</span></span> <span data-ttu-id="ab2c8-148">L’application applique des règles de redirection et de réécriture, et montre l’URL redirigée ou réécrite pour plusieurs scénarios.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-148">The app applies redirect and rewrite rules and shows the redirected or rewritten URL for several scenarios.</span></span>

## <a name="when-to-use-url-rewriting-middleware"></a><span data-ttu-id="ab2c8-149">Quand utiliser l’intergiciel (middleware) de réécriture d’URL</span><span class="sxs-lookup"><span data-stu-id="ab2c8-149">When to use URL Rewriting Middleware</span></span>

<span data-ttu-id="ab2c8-150">Utilisez le middleware de réécriture d’URL quand vous ne pouvez pas utiliser les approches suivantes :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-150">Use URL Rewriting Middleware when you're unable to use the following approaches:</span></span>

* [<span data-ttu-id="ab2c8-151">Module de réécriture d’URL avec IIS sur Windows Server</span><span class="sxs-lookup"><span data-stu-id="ab2c8-151">URL Rewrite module with IIS on Windows Server</span></span>](https://www.iis.net/downloads/microsoft/url-rewrite)
* [<span data-ttu-id="ab2c8-152">Module mod_rewrite Apache sur Apache Server</span><span class="sxs-lookup"><span data-stu-id="ab2c8-152">Apache mod_rewrite module on Apache Server</span></span>](https://httpd.apache.org/docs/2.4/rewrite/)
* [<span data-ttu-id="ab2c8-153">URL de réécriture sur Nginx</span><span class="sxs-lookup"><span data-stu-id="ab2c8-153">URL rewriting on Nginx</span></span>](https://www.nginx.com/blog/creating-nginx-rewrite-rules/)

<span data-ttu-id="ab2c8-154">Utilisez aussi le middleware quand l’application est hébergée sur le [serveur HTTP.sys](xref:fundamentals/servers/httpsys) (anciennement appelé WebListener).</span><span class="sxs-lookup"><span data-stu-id="ab2c8-154">Also, use the middleware when the app is hosted on [HTTP.sys server](xref:fundamentals/servers/httpsys) (formerly called WebListener).</span></span>

<span data-ttu-id="ab2c8-155">Les principales raisons d’utiliser les technologies de réécriture d’URL basée sur le serveur dans IIS, Apache et Nginx sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-155">The main reasons to use the server-based URL rewriting technologies in IIS, Apache, and Nginx are:</span></span>

* <span data-ttu-id="ab2c8-156">Le middleware ne prend pas en charge toutes les fonctionnalités de ces modules.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-156">The middleware doesn't support the full features of these modules.</span></span>

  <span data-ttu-id="ab2c8-157">Certaines des fonctionnalités des modules serveur ne fonctionnent pas avec les projets ASP.NET Core, comme les contraintes `IsFile` et `IsDirectory` du module Réécriture IIS.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-157">Some of the features of the server modules don't work with ASP.NET Core projects, such as the `IsFile` and `IsDirectory` constraints of the IIS Rewrite module.</span></span> <span data-ttu-id="ab2c8-158">Dans ces scénarios, utilisez plutôt l’intergiciel.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-158">In these scenarios, use the middleware instead.</span></span>
* <span data-ttu-id="ab2c8-159">Les performances du middleware ne correspondent probablement pas à celles des modules.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-159">The performance of the middleware probably doesn't match that of the modules.</span></span>

  <span data-ttu-id="ab2c8-160">Mener des tests de performances est la seule façon de savoir exactement quelle approche dégrade le plus les performances ou si la dégradation des performances est négligeable.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-160">Benchmarking is the only way to know for sure which approach degrades performance the most or if degraded performance is negligible.</span></span>

## <a name="package"></a><span data-ttu-id="ab2c8-161">Package</span><span class="sxs-lookup"><span data-stu-id="ab2c8-161">Package</span></span>

<span data-ttu-id="ab2c8-162">L’intergiciel (middleware) de réécriture d’URL est fourni par le package [Microsoft.AspNetCore.Rewrite](https://www.nuget.org/packages/Microsoft.AspNetCore.Rewrite), qui est implicitement inclus dans les applications ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-162">URL Rewriting Middleware is provided by the [Microsoft.AspNetCore.Rewrite](https://www.nuget.org/packages/Microsoft.AspNetCore.Rewrite) package, which is implicitly included in ASP.NET Core apps.</span></span>

## <a name="extension-and-options"></a><span data-ttu-id="ab2c8-163">Extension et options</span><span class="sxs-lookup"><span data-stu-id="ab2c8-163">Extension and options</span></span>

<span data-ttu-id="ab2c8-164">Établissez des règles de réécriture et de redirection d’URL en créant une instance de la classe [RewriteOptions](xref:Microsoft.AspNetCore.Rewrite.RewriteOptions) avec des méthodes d’extension pour chacune de vos règles de réécriture.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-164">Establish URL rewrite and redirect rules by creating an instance of the [RewriteOptions](xref:Microsoft.AspNetCore.Rewrite.RewriteOptions) class with extension methods for each of your rewrite rules.</span></span> <span data-ttu-id="ab2c8-165">Chaînez plusieurs règles dans l’ordre dans lequel vous voulez qu’elles soient traitées.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-165">Chain multiple rules in the order that you would like them processed.</span></span> <span data-ttu-id="ab2c8-166">Les `RewriteOptions` sont passées dans le middleware de réécriture d’URL quand il est ajouté au pipeline de requête avec <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*> :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-166">The `RewriteOptions` are passed into the URL Rewriting Middleware as it's added to the request pipeline with <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*>:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1)]

### <a name="redirect-non-www-to-www"></a><span data-ttu-id="ab2c8-167">Redirection de demandes non-www en demandes www</span><span class="sxs-lookup"><span data-stu-id="ab2c8-167">Redirect non-www to www</span></span>

<span data-ttu-id="ab2c8-168">Trois options permettent à l’application de rediriger des demandes non-`www` en demandes `www` :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-168">Three options permit the app to redirect non-`www` requests to `www`:</span></span>

* <span data-ttu-id="ab2c8-169"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWwwPermanent*>&ndash; Rediriger définitivement la demande vers le `www` sous-`www`domaine si la demande n’est pas.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-169"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWwwPermanent*> &ndash; Permanently redirect the request to the `www` subdomain if the request is non-`www`.</span></span> <span data-ttu-id="ab2c8-170">Redirige avec un code d’état [Status308PermanentRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status308PermanentRedirect).</span><span class="sxs-lookup"><span data-stu-id="ab2c8-170">Redirects with a [Status308PermanentRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status308PermanentRedirect) status code.</span></span>

* <span data-ttu-id="ab2c8-171"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWww*>&ndash; Redirigez la demande vers `www` le sous-`www`domaine si la demande entrante n’est pas.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-171"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWww*> &ndash; Redirect the request to the `www` subdomain if the incoming request is non-`www`.</span></span> <span data-ttu-id="ab2c8-172">Redirige avec un code d’état [Status307TemporaryRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status307TemporaryRedirect).</span><span class="sxs-lookup"><span data-stu-id="ab2c8-172">Redirects with a [Status307TemporaryRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status307TemporaryRedirect) status code.</span></span> <span data-ttu-id="ab2c8-173">Une surcharge vous permet de fournir le code d’état pour la réponse.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-173">An overload permits you to provide the status code for the response.</span></span> <span data-ttu-id="ab2c8-174">Utilisez un champ de la classe <xref:Microsoft.AspNetCore.Http.StatusCodes> pour une affectation de code d’état.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-174">Use a field of the <xref:Microsoft.AspNetCore.Http.StatusCodes> class for a status code assignment.</span></span>

### <a name="url-redirect"></a><span data-ttu-id="ab2c8-175">Redirection d’URL</span><span class="sxs-lookup"><span data-stu-id="ab2c8-175">URL redirect</span></span>

<span data-ttu-id="ab2c8-176">Utilisez <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirect*> pour rediriger des requêtes.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-176">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirect*> to redirect requests.</span></span> <span data-ttu-id="ab2c8-177">Le premier paramètre contient votre expression régulière pour la mise en correspondance sur le chemin de l’URL entrante.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-177">The first parameter contains your regex for matching on the path of the incoming URL.</span></span> <span data-ttu-id="ab2c8-178">Le deuxième paramètre est la chaîne de remplacement.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-178">The second parameter is the replacement string.</span></span> <span data-ttu-id="ab2c8-179">Le troisième paramètre, le cas échéant, spécifie le code d’état.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-179">The third parameter, if present, specifies the status code.</span></span> <span data-ttu-id="ab2c8-180">Si vous ne spécifiez pas le code d’état, sa valeur par défaut est *302 - Trouvé*, ce qui indique que la ressource est temporairement déplacée ou remplacée.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-180">If you don't specify the status code, the status code defaults to *302 - Found*, which indicates that the resource is temporarily moved or replaced.</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=9)]

<span data-ttu-id="ab2c8-181">Dans un navigateur dans lequel les outils de développement sont activés, effectuez une requête à l’exemple d’application avec le chemin `/redirect-rule/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-181">In a browser with developer tools enabled, make a request to the sample app with the path `/redirect-rule/1234/5678`.</span></span> <span data-ttu-id="ab2c8-182">L’expression régulière établit une correspondance avec le chemin de la requête sur `redirect-rule/(.*)`, et le chemin est remplacé par `/redirected/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-182">The regex matches the request path on `redirect-rule/(.*)`, and the path is replaced with `/redirected/1234/5678`.</span></span> <span data-ttu-id="ab2c8-183">L’URL de redirection est renvoyée au client avec le code d’état *302 - Trouvé*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-183">The redirect URL is sent back to the client with a *302 - Found* status code.</span></span> <span data-ttu-id="ab2c8-184">Le navigateur effectue une nouvelle requête à l’URL de redirection, qui apparaît dans la barre d’adresse du navigateur.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-184">The browser makes a new request at the redirect URL, which appears in the browser's address bar.</span></span> <span data-ttu-id="ab2c8-185">Comme aucune règle de l’exemple d’application ne correspond sur l’URL de redirection :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-185">Since no rules in the sample app match on the redirect URL:</span></span>

* <span data-ttu-id="ab2c8-186">La deuxième requête reçoit une réponse *200 - OK* de l’application.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-186">The second request receives a *200 - OK* response from the app.</span></span>
* <span data-ttu-id="ab2c8-187">Le corps de la réponse montre l’URL de redirection.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-187">The body of the response shows the redirect URL.</span></span>

<span data-ttu-id="ab2c8-188">Un aller-retour est effectué avec le serveur quand une URL est *redirigée*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-188">A round trip is made to the server when a URL is *redirected*.</span></span>

> [!WARNING]
> <span data-ttu-id="ab2c8-189">Soyez prudent lors de l’établissement de règles de redirection.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-189">Be cautious when establishing redirect rules.</span></span> <span data-ttu-id="ab2c8-190">Les règles de redirection sont évaluées à chaque requête effectuée à l’application, notamment après une redirection.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-190">Redirect rules are evaluated on every request to the app, including after a redirect.</span></span> <span data-ttu-id="ab2c8-191">Il est facile de créer accidentellement une *boucle de redirections infinies*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-191">It's easy to accidentally create a *loop of infinite redirects*.</span></span>

<span data-ttu-id="ab2c8-192">Requête d’origine : `/redirect-rule/1234/5678`</span><span class="sxs-lookup"><span data-stu-id="ab2c8-192">Original Request: `/redirect-rule/1234/5678`</span></span>

![Fenêtre de navigateur avec les requêtes et les réponses suivies par les Outils de développement](url-rewriting/_static/add_redirect.png)

<span data-ttu-id="ab2c8-194">La partie de l’expression entre parenthèses est appelée *groupe de capture*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-194">The part of the expression contained within parentheses is called a *capture group*.</span></span> <span data-ttu-id="ab2c8-195">Le point (`.`) de l’expression signifie *mettre en correspondance n’importe quel caractère*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-195">The dot (`.`) of the expression means *match any character*.</span></span> <span data-ttu-id="ab2c8-196">L’astérisque (`*`) indique *mettre en correspondance zéro occurrence ou plus du caractère précédent*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-196">The asterisk (`*`) indicates *match the preceding character zero or more times*.</span></span> <span data-ttu-id="ab2c8-197">Par conséquent, les deux derniers segments de chemin de l’URL, `1234/5678`, sont capturés par le groupe de capture `(.*)`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-197">Therefore, the last two path segments of the URL, `1234/5678`, are captured by capture group `(.*)`.</span></span> <span data-ttu-id="ab2c8-198">Toute valeur fournie dans l’URL de la requête après `redirect-rule/` est capturée par ce groupe de capture unique.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-198">Any value you provide in the request URL after `redirect-rule/` is captured by this single capture group.</span></span>

<span data-ttu-id="ab2c8-199">Dans la chaîne de remplacement, les groupes capturés sont injectés dans la chaîne avec le signe dollar (`$`) suivi du numéro de séquence de la capture.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-199">In the replacement string, captured groups are injected into the string with the dollar sign (`$`) followed by the sequence number of the capture.</span></span> <span data-ttu-id="ab2c8-200">La valeur du premier groupe de capture est obtenue avec `$1`, la deuxième avec `$2`, et ainsi de suite en séquence pour les groupes de capture de votre expression régulière.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-200">The first capture group value is obtained with `$1`, the second with `$2`, and they continue in sequence for the capture groups in your regex.</span></span> <span data-ttu-id="ab2c8-201">Comme il n’y a qu’un seul groupe capturé dans l’expression régulière de la règle de redirection de l’exemple d’application, un seul groupe est injecté dans la chaîne de remplacement, à savoir `$1`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-201">There's only one captured group in the redirect rule regex in the sample app, so there's only one injected group in the replacement string, which is `$1`.</span></span> <span data-ttu-id="ab2c8-202">Quand la règle est appliquée, l’URL devient `/redirected/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-202">When the rule is applied, the URL becomes `/redirected/1234/5678`.</span></span>

### <a name="url-redirect-to-a-secure-endpoint"></a><span data-ttu-id="ab2c8-203">Redirection d’URL vers un point de terminaison sécurisé</span><span class="sxs-lookup"><span data-stu-id="ab2c8-203">URL redirect to a secure endpoint</span></span>

<span data-ttu-id="ab2c8-204">Utilisez <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttps*> pour rediriger les requêtes HTTP vers le même hôte et le même chemin avec le protocole HTTPS.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-204">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttps*> to redirect HTTP requests to the same host and path using the HTTPS protocol.</span></span> <span data-ttu-id="ab2c8-205">Si le code d’état n’est pas fourni, le middleware utilise par défaut *302 - Trouvé*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-205">If the status code isn't supplied, the middleware defaults to *302 - Found*.</span></span> <span data-ttu-id="ab2c8-206">Si le port n’est pas fourni :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-206">If the port isn't supplied:</span></span>

* <span data-ttu-id="ab2c8-207">Le middleware utilise par défaut `null`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-207">The middleware defaults to `null`.</span></span>
* <span data-ttu-id="ab2c8-208">Le schéma change en `https` (protocole HTTPS), et le client accède à la ressource sur le port 443.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-208">The scheme changes to `https` (HTTPS protocol), and the client accesses the resource on port 443.</span></span>

<span data-ttu-id="ab2c8-209">L’exemple suivant montre comment définir le code d’état sur *301 - Déplacé de façon permanente* et changer le port en 5001.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-209">The following example shows how to set the status code to *301 - Moved Permanently* and change the port to 5001.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    var options = new RewriteOptions()
        .AddRedirectToHttps(301, 5001);

    app.UseRewriter(options);
}
```

<span data-ttu-id="ab2c8-210">Utilisez <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttpsPermanent*> pour rediriger les requêtes non sécurisées vers le même hôte et le même chemin avec le protocole HTTPS sécurisé sur le port 443.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-210">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttpsPermanent*> to redirect insecure requests to the same host and path with secure HTTPS protocol on port 443.</span></span> <span data-ttu-id="ab2c8-211">Le middleware définit le code d’état sur *301 - Déplacé de façon permanente*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-211">The middleware sets the status code to *301 - Moved Permanently*.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    var options = new RewriteOptions()
        .AddRedirectToHttpsPermanent();

    app.UseRewriter(options);
}
```

> [!NOTE]
> <span data-ttu-id="ab2c8-212">Si vous effectuez une redirection vers un point de terminaison sécurisé et que vous n’avez pas besoin de règles de redirection supplémentaires, nous vous recommandons d’utiliser le middleware de redirection HTTPS.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-212">When redirecting to a secure endpoint without the requirement for additional redirect rules, we recommend using HTTPS Redirection Middleware.</span></span> <span data-ttu-id="ab2c8-213">Pour plus d’informations, consultez la rubrique [Appliquer HTTPS](xref:security/enforcing-ssl#require-https).</span><span class="sxs-lookup"><span data-stu-id="ab2c8-213">For more information, see the [Enforce HTTPS](xref:security/enforcing-ssl#require-https) topic.</span></span>

<span data-ttu-id="ab2c8-214">L’exemple d’application peut montrer comment utiliser `AddRedirectToHttps` ou `AddRedirectToHttpsPermanent`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-214">The sample app is capable of demonstrating how to use `AddRedirectToHttps` or `AddRedirectToHttpsPermanent`.</span></span> <span data-ttu-id="ab2c8-215">Ajoutez la méthode d’extension à `RewriteOptions`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-215">Add the extension method to the `RewriteOptions`.</span></span> <span data-ttu-id="ab2c8-216">Effectuez une requête non sécurisée à l’application à n’importe quelle URL.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-216">Make an insecure request to the app at any URL.</span></span> <span data-ttu-id="ab2c8-217">Ignorez l’avertissement de sécurité du navigateur indiquant que le certificat auto-signé n’est pas approuvé ou créez une exception pour approuver le certificat.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-217">Dismiss the browser security warning that the self-signed certificate is untrusted or create an exception to trust the certificate.</span></span>

<span data-ttu-id="ab2c8-218">Requête d’origine utilisant `AddRedirectToHttps(301, 5001)` : `http://localhost:5000/secure`</span><span class="sxs-lookup"><span data-stu-id="ab2c8-218">Original Request using `AddRedirectToHttps(301, 5001)`: `http://localhost:5000/secure`</span></span>

![Fenêtre de navigateur avec les requêtes et les réponses suivies par les Outils de développement](url-rewriting/_static/add_redirect_to_https.png)

<span data-ttu-id="ab2c8-220">Requête d’origine utilisant `AddRedirectToHttpsPermanent` : `http://localhost:5000/secure`</span><span class="sxs-lookup"><span data-stu-id="ab2c8-220">Original Request using `AddRedirectToHttpsPermanent`: `http://localhost:5000/secure`</span></span>

![Fenêtre de navigateur avec les requêtes et les réponses suivies par les Outils de développement](url-rewriting/_static/add_redirect_to_https_permanent.png)

### <a name="url-rewrite"></a><span data-ttu-id="ab2c8-222">Réécrire URL</span><span class="sxs-lookup"><span data-stu-id="ab2c8-222">URL rewrite</span></span>

<span data-ttu-id="ab2c8-223">Utilisez <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRewrite*> pour créer une règle pour la réécriture d’URL.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-223">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRewrite*> to create a rule for rewriting URLs.</span></span> <span data-ttu-id="ab2c8-224">Le premier paramètre contient l’expression régulière pour la mise en correspondance sur le chemin de l’URL entrante.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-224">The first parameter contains the regex for matching on the incoming URL path.</span></span> <span data-ttu-id="ab2c8-225">Le deuxième paramètre est la chaîne de remplacement.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-225">The second parameter is the replacement string.</span></span> <span data-ttu-id="ab2c8-226">Le troisième paramètre, `skipRemainingRules: {true|false}`, indique à l’intergiciel d’ignorer, ou non, les règles de réécriture supplémentaires si la règle actuelle est appliquée.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-226">The third parameter, `skipRemainingRules: {true|false}`, indicates to the middleware whether or not to skip additional rewrite rules if the current rule is applied.</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=10-11)]

<span data-ttu-id="ab2c8-227">Requête d’origine : `/rewrite-rule/1234/5678`</span><span class="sxs-lookup"><span data-stu-id="ab2c8-227">Original Request: `/rewrite-rule/1234/5678`</span></span>

![Fenêtre de navigateur avec la requête et la réponse suivies par les Outils de développement](url-rewriting/_static/add_rewrite.png)

<span data-ttu-id="ab2c8-229">Le caret (`^`) au début de l’expression signifie que la correspondance commence au début du chemin de l’URL.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-229">The carat (`^`) at the beginning of the expression means that matching starts at the beginning of the URL path.</span></span>

<span data-ttu-id="ab2c8-230">Dans l’exemple précédent avec la règle de redirection, `redirect-rule/(.*)`, il n’existe pas de caret (`^`) au début de l’expression régulière.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-230">In the earlier example with the redirect rule, `redirect-rule/(.*)`, there's no carat (`^`) at the start of the regex.</span></span> <span data-ttu-id="ab2c8-231">Ainsi, n’importe quel caractère peut précéder `redirect-rule/` dans le chemin pour qu’une correspondance soit établie.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-231">Therefore, any characters may precede `redirect-rule/` in the path for a successful match.</span></span>

| <span data-ttu-id="ab2c8-232">Path</span><span class="sxs-lookup"><span data-stu-id="ab2c8-232">Path</span></span>                               | <span data-ttu-id="ab2c8-233">Correspond</span><span class="sxs-lookup"><span data-stu-id="ab2c8-233">Match</span></span> |
| ---------------------------------- | :---: |
| `/redirect-rule/1234/5678`         | <span data-ttu-id="ab2c8-234">Oui</span><span class="sxs-lookup"><span data-stu-id="ab2c8-234">Yes</span></span>   |
| `/my-cool-redirect-rule/1234/5678` | <span data-ttu-id="ab2c8-235">Oui</span><span class="sxs-lookup"><span data-stu-id="ab2c8-235">Yes</span></span>   |
| `/anotherredirect-rule/1234/5678`  | <span data-ttu-id="ab2c8-236">Oui</span><span class="sxs-lookup"><span data-stu-id="ab2c8-236">Yes</span></span>   |

<span data-ttu-id="ab2c8-237">La règle de réécriture, `^rewrite-rule/(\d+)/(\d+)`, établit une correspondance uniquement avec des chemins d’accès s’ils commencent par `rewrite-rule/`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-237">The rewrite rule, `^rewrite-rule/(\d+)/(\d+)`, only matches paths if they start with `rewrite-rule/`.</span></span> <span data-ttu-id="ab2c8-238">Dans le tableau suivant, notez la différence de correspondance.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-238">In the following table, note the difference in matching.</span></span>

| <span data-ttu-id="ab2c8-239">Path</span><span class="sxs-lookup"><span data-stu-id="ab2c8-239">Path</span></span>                              | <span data-ttu-id="ab2c8-240">Correspond</span><span class="sxs-lookup"><span data-stu-id="ab2c8-240">Match</span></span> |
| --------------------------------- | :---: |
| `/rewrite-rule/1234/5678`         | <span data-ttu-id="ab2c8-241">Oui</span><span class="sxs-lookup"><span data-stu-id="ab2c8-241">Yes</span></span>   |
| `/my-cool-rewrite-rule/1234/5678` | <span data-ttu-id="ab2c8-242">Non</span><span class="sxs-lookup"><span data-stu-id="ab2c8-242">No</span></span>    |
| `/anotherrewrite-rule/1234/5678`  | <span data-ttu-id="ab2c8-243">Non</span><span class="sxs-lookup"><span data-stu-id="ab2c8-243">No</span></span>    |

<span data-ttu-id="ab2c8-244">À la suite de la partie `^rewrite-rule/` de l’expression se trouvent deux groupes de capture, `(\d+)/(\d+)`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-244">Following the `^rewrite-rule/` portion of the expression, there are two capture groups, `(\d+)/(\d+)`.</span></span> <span data-ttu-id="ab2c8-245">`\d` signifie *établir une correspondance avec un chiffre (nombre)*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-245">The `\d` signifies *match a digit (number)*.</span></span> <span data-ttu-id="ab2c8-246">Le signe plus (`+`) signifie *établir une correspondance avec une ou plusieurs occurrences du caractère précédent*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-246">The plus sign (`+`) means *match one or more of the preceding character*.</span></span> <span data-ttu-id="ab2c8-247">Par conséquent, l’URL doit contenir un nombre suivi d’une barre oblique, elle-même suivie d’un autre nombre.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-247">Therefore, the URL must contain a number followed by a forward-slash followed by another number.</span></span> <span data-ttu-id="ab2c8-248">Ces groupes sont injectés dans l’URL réécrite sous la forme `$1` et `$2`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-248">These capture groups are injected into the rewritten URL as `$1` and `$2`.</span></span> <span data-ttu-id="ab2c8-249">La chaîne de remplacement de la règle de réécriture place les groupes capturés dans la chaîne de requête.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-249">The rewrite rule replacement string places the captured groups into the query string.</span></span> <span data-ttu-id="ab2c8-250">Le chemin demandé `/rewrite-rule/1234/5678` est réécrit pour obtenir la ressource à l’emplacement `/rewritten?var1=1234&var2=5678`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-250">The requested path of `/rewrite-rule/1234/5678` is rewritten to obtain the resource at `/rewritten?var1=1234&var2=5678`.</span></span> <span data-ttu-id="ab2c8-251">Si une chaîne de requête est présente dans la requête d’origine, elle est conservée lors de la réécriture de l’URL.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-251">If a query string is present on the original request, it's preserved when the URL is rewritten.</span></span>

<span data-ttu-id="ab2c8-252">Il n’y a pas d’aller-retour avec le serveur pour obtenir la ressource.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-252">There's no round trip to the server to obtain the resource.</span></span> <span data-ttu-id="ab2c8-253">Si la ressource existe, elle est récupérée et retournée au client avec le code d’état *200 - OK*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-253">If the resource exists, it's fetched and returned to the client with a *200 - OK* status code.</span></span> <span data-ttu-id="ab2c8-254">Comme le client n’est pas redirigé, l’URL dans la barre d’adresse du navigateur ne change pas.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-254">Because the client isn't redirected, the URL in the browser's address bar doesn't change.</span></span> <span data-ttu-id="ab2c8-255">Les clients ne peuvent pas détecter qu’une opération de réécriture d’URL s’est produite sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-255">Clients can't detect that a URL rewrite operation occurred on the server.</span></span>

> [!NOTE]
> <span data-ttu-id="ab2c8-256">Quand c’est possible, utilisez `skipRemainingRules: true`, car la mise en correspondance de règles est un processus gourmand en ressources qui augmente le temps de réponse de l’application.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-256">Use `skipRemainingRules: true` whenever possible because matching rules is computationally expensive and increases app response time.</span></span> <span data-ttu-id="ab2c8-257">Pour obtenir la réponse d’application la plus rapide :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-257">For the fastest app response:</span></span>
>
> * <span data-ttu-id="ab2c8-258">Classez vos règles de réécriture en partant de la règle la plus souvent mise en correspondance jusqu’à la règle la moins souvent mise en correspondance.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-258">Order rewrite rules from the most frequently matched rule to the least frequently matched rule.</span></span>
> * <span data-ttu-id="ab2c8-259">Ignorez le traitement des règles restantes quand une correspondance est trouvée et qu’aucun traitement de règle supplémentaire n’est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-259">Skip the processing of the remaining rules when a match occurs and no additional rule processing is required.</span></span>

### <a name="apache-mod_rewrite"></a><span data-ttu-id="ab2c8-260">Apache mod_rewrite</span><span class="sxs-lookup"><span data-stu-id="ab2c8-260">Apache mod_rewrite</span></span>

<span data-ttu-id="ab2c8-261">Appliquez des règles Apache mod_rewrite avec <xref:Microsoft.AspNetCore.Rewrite.ApacheModRewriteOptionsExtensions.AddApacheModRewrite*>.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-261">Apply Apache mod_rewrite rules with <xref:Microsoft.AspNetCore.Rewrite.ApacheModRewriteOptionsExtensions.AddApacheModRewrite*>.</span></span> <span data-ttu-id="ab2c8-262">Vérifiez que le fichier de règles est déployé avec l’application.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-262">Make sure that the rules file is deployed with the app.</span></span> <span data-ttu-id="ab2c8-263">Pour obtenir plus d’informations et des exemples de règles mod_rewrite, consultez [Apache mod_rewrite](https://httpd.apache.org/docs/2.4/rewrite/).</span><span class="sxs-lookup"><span data-stu-id="ab2c8-263">For more information and examples of mod_rewrite rules, see [Apache mod_rewrite](https://httpd.apache.org/docs/2.4/rewrite/).</span></span>

<span data-ttu-id="ab2c8-264">Un <xref:System.IO.StreamReader> est utilisé pour lire les règles à partir du fichier de règles *ApacheModRewrite. txt* :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-264">A <xref:System.IO.StreamReader> is used to read the rules from the *ApacheModRewrite.txt* rules file:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=3-4,12)]

<span data-ttu-id="ab2c8-265">L’exemple d’application redirige les requêtes de `/apache-mod-rules-redirect/(.\*)` vers `/redirected?id=$1`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-265">The sample app redirects requests from `/apache-mod-rules-redirect/(.\*)` to `/redirected?id=$1`.</span></span> <span data-ttu-id="ab2c8-266">Le code d’état de la réponse est *302 - Trouvé*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-266">The response status code is *302 - Found*.</span></span>

[!code[](url-rewriting/samples/3.x/SampleApp/ApacheModRewrite.txt)]

<span data-ttu-id="ab2c8-267">Requête d’origine : `/apache-mod-rules-redirect/1234`</span><span class="sxs-lookup"><span data-stu-id="ab2c8-267">Original Request: `/apache-mod-rules-redirect/1234`</span></span>

![Fenêtre de navigateur avec les requêtes et les réponses suivies par les Outils de développement](url-rewriting/_static/add_apache_mod_redirect.png)

<span data-ttu-id="ab2c8-269">L’intergiciel prend en charge les variables de serveur Apache mod_rewrite suivantes :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-269">The middleware supports the following Apache mod_rewrite server variables:</span></span>

* <span data-ttu-id="ab2c8-270">CONN_REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="ab2c8-270">CONN_REMOTE_ADDR</span></span>
* <span data-ttu-id="ab2c8-271">HTTP_ACCEPT</span><span class="sxs-lookup"><span data-stu-id="ab2c8-271">HTTP_ACCEPT</span></span>
* <span data-ttu-id="ab2c8-272">HTTP_CONNECTION</span><span class="sxs-lookup"><span data-stu-id="ab2c8-272">HTTP_CONNECTION</span></span>
* <span data-ttu-id="ab2c8-273">HTTP_COOKIE</span><span class="sxs-lookup"><span data-stu-id="ab2c8-273">HTTP_COOKIE</span></span>
* <span data-ttu-id="ab2c8-274">HTTP_FORWARDED</span><span class="sxs-lookup"><span data-stu-id="ab2c8-274">HTTP_FORWARDED</span></span>
* <span data-ttu-id="ab2c8-275">HTTP_HOST</span><span class="sxs-lookup"><span data-stu-id="ab2c8-275">HTTP_HOST</span></span>
* <span data-ttu-id="ab2c8-276">HTTP_REFERER</span><span class="sxs-lookup"><span data-stu-id="ab2c8-276">HTTP_REFERER</span></span>
* <span data-ttu-id="ab2c8-277">HTTP_USER_AGENT</span><span class="sxs-lookup"><span data-stu-id="ab2c8-277">HTTP_USER_AGENT</span></span>
* <span data-ttu-id="ab2c8-278">HTTPS</span><span class="sxs-lookup"><span data-stu-id="ab2c8-278">HTTPS</span></span>
* <span data-ttu-id="ab2c8-279">IPV6</span><span class="sxs-lookup"><span data-stu-id="ab2c8-279">IPV6</span></span>
* <span data-ttu-id="ab2c8-280">QUERY_STRING</span><span class="sxs-lookup"><span data-stu-id="ab2c8-280">QUERY_STRING</span></span>
* <span data-ttu-id="ab2c8-281">REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="ab2c8-281">REMOTE_ADDR</span></span>
* <span data-ttu-id="ab2c8-282">REMOTE_PORT</span><span class="sxs-lookup"><span data-stu-id="ab2c8-282">REMOTE_PORT</span></span>
* <span data-ttu-id="ab2c8-283">REQUEST_FILENAME</span><span class="sxs-lookup"><span data-stu-id="ab2c8-283">REQUEST_FILENAME</span></span>
* <span data-ttu-id="ab2c8-284">REQUEST_METHOD</span><span class="sxs-lookup"><span data-stu-id="ab2c8-284">REQUEST_METHOD</span></span>
* <span data-ttu-id="ab2c8-285">REQUEST_SCHEME</span><span class="sxs-lookup"><span data-stu-id="ab2c8-285">REQUEST_SCHEME</span></span>
* <span data-ttu-id="ab2c8-286">REQUEST_URI</span><span class="sxs-lookup"><span data-stu-id="ab2c8-286">REQUEST_URI</span></span>
* <span data-ttu-id="ab2c8-287">SCRIPT_FILENAME</span><span class="sxs-lookup"><span data-stu-id="ab2c8-287">SCRIPT_FILENAME</span></span>
* <span data-ttu-id="ab2c8-288">SERVER_ADDR</span><span class="sxs-lookup"><span data-stu-id="ab2c8-288">SERVER_ADDR</span></span>
* <span data-ttu-id="ab2c8-289">SERVER_PORT</span><span class="sxs-lookup"><span data-stu-id="ab2c8-289">SERVER_PORT</span></span>
* <span data-ttu-id="ab2c8-290">SERVER_PROTOCOL</span><span class="sxs-lookup"><span data-stu-id="ab2c8-290">SERVER_PROTOCOL</span></span>
* <span data-ttu-id="ab2c8-291">TEMPS</span><span class="sxs-lookup"><span data-stu-id="ab2c8-291">TIME</span></span>
* <span data-ttu-id="ab2c8-292">TIME_DAY</span><span class="sxs-lookup"><span data-stu-id="ab2c8-292">TIME_DAY</span></span>
* <span data-ttu-id="ab2c8-293">TIME_HOUR</span><span class="sxs-lookup"><span data-stu-id="ab2c8-293">TIME_HOUR</span></span>
* <span data-ttu-id="ab2c8-294">TIME_MIN</span><span class="sxs-lookup"><span data-stu-id="ab2c8-294">TIME_MIN</span></span>
* <span data-ttu-id="ab2c8-295">TIME_MON</span><span class="sxs-lookup"><span data-stu-id="ab2c8-295">TIME_MON</span></span>
* <span data-ttu-id="ab2c8-296">TIME_SEC</span><span class="sxs-lookup"><span data-stu-id="ab2c8-296">TIME_SEC</span></span>
* <span data-ttu-id="ab2c8-297">TIME_WDAY</span><span class="sxs-lookup"><span data-stu-id="ab2c8-297">TIME_WDAY</span></span>
* <span data-ttu-id="ab2c8-298">TIME_YEAR</span><span class="sxs-lookup"><span data-stu-id="ab2c8-298">TIME_YEAR</span></span>

### <a name="iis-url-rewrite-module-rules"></a><span data-ttu-id="ab2c8-299">Règles du module de réécriture d’URL IIS</span><span class="sxs-lookup"><span data-stu-id="ab2c8-299">IIS URL Rewrite Module rules</span></span>

<span data-ttu-id="ab2c8-300">Pour utiliser le même ensemble de règles que celui qui s’applique au module de réécriture d’URL IIS, utilisez <xref:Microsoft.AspNetCore.Rewrite.IISUrlRewriteOptionsExtensions.AddIISUrlRewrite*>.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-300">To use the same rule set that applies to the IIS URL Rewrite Module, use <xref:Microsoft.AspNetCore.Rewrite.IISUrlRewriteOptionsExtensions.AddIISUrlRewrite*>.</span></span> <span data-ttu-id="ab2c8-301">Vérifiez que le fichier de règles est déployé avec l’application.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-301">Make sure that the rules file is deployed with the app.</span></span> <span data-ttu-id="ab2c8-302">N’indiquez pas au middleware d’utiliser le fichier *web.config* de l’application en cas d’exécution sur Windows Server IIS.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-302">Don't direct the middleware to use the app's *web.config* file when running on Windows Server IIS.</span></span> <span data-ttu-id="ab2c8-303">Avec IIS, ces règles doivent être stockées en dehors du fichier *web.config* de l’application pour éviter les conflits avec le module de réécriture IIS.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-303">With IIS, these rules should be stored outside of the app's *web.config* file in order to avoid conflicts with the IIS Rewrite module.</span></span> <span data-ttu-id="ab2c8-304">Pour obtenir plus d’informations et des exemples de règles du module de réécriture d’URL IIS, consultez [Utilisation du module de réécriture d’URL 2.0](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) et [Informations de référence sur la configuration du module de réécriture d’URL](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference).</span><span class="sxs-lookup"><span data-stu-id="ab2c8-304">For more information and examples of IIS URL Rewrite Module rules, see [Using Url Rewrite Module 2.0](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) and [URL Rewrite Module Configuration Reference](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference).</span></span>

<span data-ttu-id="ab2c8-305">Un <xref:System.IO.StreamReader> est utilisé pour lire les règles à partir du fichier de règles *IISUrlRewrite. xml* :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-305">A <xref:System.IO.StreamReader> is used to read the rules from the *IISUrlRewrite.xml* rules file:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=5-6,13)]

<span data-ttu-id="ab2c8-306">L’exemple d’application réécrit les requêtes de `/iis-rules-rewrite/(.*)` vers `/rewritten?id=$1`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-306">The sample app rewrites requests from `/iis-rules-rewrite/(.*)` to `/rewritten?id=$1`.</span></span> <span data-ttu-id="ab2c8-307">La réponse est envoyée au client avec le code d’état *200 - OK*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-307">The response is sent to the client with a *200 - OK* status code.</span></span>

[!code-xml[](url-rewriting/samples/3.x/SampleApp/IISUrlRewrite.xml)]

<span data-ttu-id="ab2c8-308">Requête d’origine : `/iis-rules-rewrite/1234`</span><span class="sxs-lookup"><span data-stu-id="ab2c8-308">Original Request: `/iis-rules-rewrite/1234`</span></span>

![Fenêtre de navigateur avec la requête et la réponse suivies par les Outils de développement](url-rewriting/_static/add_iis_url_rewrite.png)

<span data-ttu-id="ab2c8-310">Si vous avez un module de réécriture IIS actif pour lequel des règles au niveau du serveur qui affecteraient de façon non souhaitée votre application sont configurées, vous pouvez le désactiver pour une application.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-310">If you have an active IIS Rewrite Module with server-level rules configured that would impact your app in undesirable ways, you can disable the IIS Rewrite Module for an app.</span></span> <span data-ttu-id="ab2c8-311">Pour plus d’informations, consultez [Désactivation de modules IIS](xref:host-and-deploy/iis/modules#disabling-iis-modules).</span><span class="sxs-lookup"><span data-stu-id="ab2c8-311">For more information, see [Disabling IIS modules](xref:host-and-deploy/iis/modules#disabling-iis-modules).</span></span>

#### <a name="unsupported-features"></a><span data-ttu-id="ab2c8-312">Fonctionnalités non prises en charge</span><span class="sxs-lookup"><span data-stu-id="ab2c8-312">Unsupported features</span></span>

<span data-ttu-id="ab2c8-313">L’intergiciel intégré à ASP.NET Core 2.x ne prend pas en charge les fonctionnalités de module de réécriture d’URL IIS suivantes :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-313">The middleware released with ASP.NET Core 2.x doesn't support the following IIS URL Rewrite Module features:</span></span>

* <span data-ttu-id="ab2c8-314">Règles de trafic sortant</span><span class="sxs-lookup"><span data-stu-id="ab2c8-314">Outbound Rules</span></span>
* <span data-ttu-id="ab2c8-315">Variables serveur personnalisées</span><span class="sxs-lookup"><span data-stu-id="ab2c8-315">Custom Server Variables</span></span>
* <span data-ttu-id="ab2c8-316">Caractères génériques</span><span class="sxs-lookup"><span data-stu-id="ab2c8-316">Wildcards</span></span>
* <span data-ttu-id="ab2c8-317">LogRewrittenUrl</span><span class="sxs-lookup"><span data-stu-id="ab2c8-317">LogRewrittenUrl</span></span>

#### <a name="supported-server-variables"></a><span data-ttu-id="ab2c8-318">Variables de serveur prises en charge</span><span class="sxs-lookup"><span data-stu-id="ab2c8-318">Supported server variables</span></span>

<span data-ttu-id="ab2c8-319">L’intergiciel prend en charge les variables serveur du module de réécriture d’URL IIS suivantes :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-319">The middleware supports the following IIS URL Rewrite Module server variables:</span></span>

* <span data-ttu-id="ab2c8-320">CONTENT_LENGTH</span><span class="sxs-lookup"><span data-stu-id="ab2c8-320">CONTENT_LENGTH</span></span>
* <span data-ttu-id="ab2c8-321">CONTENT_TYPE</span><span class="sxs-lookup"><span data-stu-id="ab2c8-321">CONTENT_TYPE</span></span>
* <span data-ttu-id="ab2c8-322">HTTP_ACCEPT</span><span class="sxs-lookup"><span data-stu-id="ab2c8-322">HTTP_ACCEPT</span></span>
* <span data-ttu-id="ab2c8-323">HTTP_CONNECTION</span><span class="sxs-lookup"><span data-stu-id="ab2c8-323">HTTP_CONNECTION</span></span>
* <span data-ttu-id="ab2c8-324">HTTP_COOKIE</span><span class="sxs-lookup"><span data-stu-id="ab2c8-324">HTTP_COOKIE</span></span>
* <span data-ttu-id="ab2c8-325">HTTP_HOST</span><span class="sxs-lookup"><span data-stu-id="ab2c8-325">HTTP_HOST</span></span>
* <span data-ttu-id="ab2c8-326">HTTP_REFERER</span><span class="sxs-lookup"><span data-stu-id="ab2c8-326">HTTP_REFERER</span></span>
* <span data-ttu-id="ab2c8-327">HTTP_URL</span><span class="sxs-lookup"><span data-stu-id="ab2c8-327">HTTP_URL</span></span>
* <span data-ttu-id="ab2c8-328">HTTP_USER_AGENT</span><span class="sxs-lookup"><span data-stu-id="ab2c8-328">HTTP_USER_AGENT</span></span>
* <span data-ttu-id="ab2c8-329">HTTPS</span><span class="sxs-lookup"><span data-stu-id="ab2c8-329">HTTPS</span></span>
* <span data-ttu-id="ab2c8-330">LOCAL_ADDR</span><span class="sxs-lookup"><span data-stu-id="ab2c8-330">LOCAL_ADDR</span></span>
* <span data-ttu-id="ab2c8-331">QUERY_STRING</span><span class="sxs-lookup"><span data-stu-id="ab2c8-331">QUERY_STRING</span></span>
* <span data-ttu-id="ab2c8-332">REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="ab2c8-332">REMOTE_ADDR</span></span>
* <span data-ttu-id="ab2c8-333">REMOTE_PORT</span><span class="sxs-lookup"><span data-stu-id="ab2c8-333">REMOTE_PORT</span></span>
* <span data-ttu-id="ab2c8-334">REQUEST_FILENAME</span><span class="sxs-lookup"><span data-stu-id="ab2c8-334">REQUEST_FILENAME</span></span>
* <span data-ttu-id="ab2c8-335">REQUEST_URI</span><span class="sxs-lookup"><span data-stu-id="ab2c8-335">REQUEST_URI</span></span>

> [!NOTE]
> <span data-ttu-id="ab2c8-336">Vous pouvez également obtenir un <xref:Microsoft.Extensions.FileProviders.IFileProvider> par le biais d’un <xref:Microsoft.Extensions.FileProviders.PhysicalFileProvider>.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-336">You can also obtain an <xref:Microsoft.Extensions.FileProviders.IFileProvider> via a <xref:Microsoft.Extensions.FileProviders.PhysicalFileProvider>.</span></span> <span data-ttu-id="ab2c8-337">Cette approche peut fournir davantage de flexibilité pour l’emplacement de vos fichiers de règles de réécriture.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-337">This approach may provide greater flexibility for the location of your rewrite rules files.</span></span> <span data-ttu-id="ab2c8-338">Vérifiez que vos fichiers de règles de réécriture sont déployés sur le serveur dans le chemin que vous fournissez.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-338">Make sure that your rewrite rules files are deployed to the server at the path you provide.</span></span>
>
> ```csharp
> PhysicalFileProvider fileProvider = new PhysicalFileProvider(Directory.GetCurrentDirectory());
> ```

### <a name="method-based-rule"></a><span data-ttu-id="ab2c8-339">Règle basée sur une méthode</span><span class="sxs-lookup"><span data-stu-id="ab2c8-339">Method-based rule</span></span>

<span data-ttu-id="ab2c8-340">Utilisez <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> pour implémenter votre propre logique de règle dans une méthode.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-340">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> to implement your own rule logic in a method.</span></span> <span data-ttu-id="ab2c8-341">`Add` expose <xref:Microsoft.AspNetCore.Rewrite.RewriteContext>, ce qui rend <xref:Microsoft.AspNetCore.Http.HttpContext> disponible pour une utilisation dans votre méthode.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-341">`Add` exposes the <xref:Microsoft.AspNetCore.Rewrite.RewriteContext>, which makes available the <xref:Microsoft.AspNetCore.Http.HttpContext> for use in your method.</span></span> <span data-ttu-id="ab2c8-342">[RewriteContext.Result](xref:Microsoft.AspNetCore.Rewrite.RewriteContext.Result*) détermine la façon dont le traitement du pipeline supplémentaire est géré.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-342">The [RewriteContext.Result](xref:Microsoft.AspNetCore.Rewrite.RewriteContext.Result*) determines how additional pipeline processing is handled.</span></span> <span data-ttu-id="ab2c8-343">Définissez la valeur sur un des champs <xref:Microsoft.AspNetCore.Rewrite.RuleResult> décrits dans le tableau suivant.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-343">Set the value to one of the <xref:Microsoft.AspNetCore.Rewrite.RuleResult> fields described in the following table.</span></span>

| `RewriteContext.Result`              | <span data-ttu-id="ab2c8-344">Action</span><span class="sxs-lookup"><span data-stu-id="ab2c8-344">Action</span></span>                                                           |
| ------------------------------------ | ---------------------------------------------------------------- |
| <span data-ttu-id="ab2c8-345">`RuleResult.ContinueRules` (par défaut)</span><span class="sxs-lookup"><span data-stu-id="ab2c8-345">`RuleResult.ContinueRules` (default)</span></span> | <span data-ttu-id="ab2c8-346">Continuer à appliquer les règles.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-346">Continue applying rules.</span></span>                                         |
| `RuleResult.EndResponse`             | <span data-ttu-id="ab2c8-347">Cesser d’appliquer les règles et envoyer la réponse.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-347">Stop applying rules and send the response.</span></span>                       |
| `RuleResult.SkipRemainingRules`      | <span data-ttu-id="ab2c8-348">Cesser d’appliquer les règles et envoyer le contexte au middleware suivant.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-348">Stop applying rules and send the context to the next middleware.</span></span> |

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=14)]

<span data-ttu-id="ab2c8-349">L’exemple d’application présente une méthode qui redirige les requêtes de chemins qui se terminent par *.xml*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-349">The sample app demonstrates a method that redirects requests for paths that end with *.xml*.</span></span> <span data-ttu-id="ab2c8-350">Si une requête est faite pour `/file.xml`, la requête est redirigée vers `/xmlfiles/file.xml`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-350">If a request is made for `/file.xml`, the request is redirected to `/xmlfiles/file.xml`.</span></span> <span data-ttu-id="ab2c8-351">Le code d’état est défini sur *301 - Déplacé de façon permanente*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-351">The status code is set to *301 - Moved Permanently*.</span></span> <span data-ttu-id="ab2c8-352">Quand le navigateur fait une nouvelle requête pour */xmlfiles/file.xml*, le middleware de fichiers statiques délivre le fichier au client à partir du dossier *wwwroot/xmlfiles*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-352">When the browser makes a new request for */xmlfiles/file.xml*, Static File Middleware serves the file to the client from the *wwwroot/xmlfiles* folder.</span></span> <span data-ttu-id="ab2c8-353">Pour une redirection, définissez explicitement le code d’état de la réponse.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-353">For a redirect, explicitly set the status code of the response.</span></span> <span data-ttu-id="ab2c8-354">Sinon, un code d’état *200 - OK* est retourné et la redirection ne se produit pas sur le client.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-354">Otherwise, a *200 - OK* status code is returned, and the redirect doesn't occur on the client.</span></span>

<span data-ttu-id="ab2c8-355">*RewriteRules.cs* :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-355">*RewriteRules.cs*:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/RewriteRules.cs?name=snippet_RedirectXmlFileRequests&highlight=14-18)]

<span data-ttu-id="ab2c8-356">Cette approche peut également réécrire des requêtes.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-356">This approach can also rewrite requests.</span></span> <span data-ttu-id="ab2c8-357">L’exemple d’application montre la réécriture du chemin pour toute requête demandant de délivrer le fichier texte *file.txt* à partir du dossier *wwwroot*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-357">The sample app demonstrates rewriting the path for any text file request to serve the *file.txt* text file from the *wwwroot* folder.</span></span> <span data-ttu-id="ab2c8-358">Le middleware de fichiers statiques délivre le fichier en fonction du chemin de requête mis à jour :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-358">Static File Middleware serves the file based on the updated request path:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=15,22)]

<span data-ttu-id="ab2c8-359">*RewriteRules.cs* :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-359">*RewriteRules.cs*:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/RewriteRules.cs?name=snippet_RewriteTextFileRequests&highlight=7-8)]

### <a name="irule-based-rule"></a><span data-ttu-id="ab2c8-360">Règle basée sur IRule</span><span class="sxs-lookup"><span data-stu-id="ab2c8-360">IRule-based rule</span></span>

<span data-ttu-id="ab2c8-361">Utilisez <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> pour insérer votre propre logique de règle dans une classe qui implémente l’interface <xref:Microsoft.AspNetCore.Rewrite.IRule>.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-361">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> to use rule logic in a class that implements the <xref:Microsoft.AspNetCore.Rewrite.IRule> interface.</span></span> <span data-ttu-id="ab2c8-362">`IRule` offre davantage de flexibilité par rapport à l’approche de la règle basée sur une méthode.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-362">`IRule` provides greater flexibility over using the method-based rule approach.</span></span> <span data-ttu-id="ab2c8-363">Votre classe d’implémentation peut inclure un constructeur qui vous permet de passer des paramètres pour la méthode <xref:Microsoft.AspNetCore.Rewrite.IRule.ApplyRule*>.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-363">Your implementation class may include a constructor that allows you can pass in parameters for the <xref:Microsoft.AspNetCore.Rewrite.IRule.ApplyRule*> method.</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=16-17)]

<span data-ttu-id="ab2c8-364">Les valeurs des paramètres dans l’exemple d’application pour `extension` et `newPath` sont vérifiées afin de remplir plusieurs conditions.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-364">The values of the parameters in the sample app for the `extension` and the `newPath` are checked to meet several conditions.</span></span> <span data-ttu-id="ab2c8-365">`extension` doit contenir une valeur, laquelle doit être *.png*, *.jpg* ou *.gif*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-365">The `extension` must contain a value, and the value must be *.png*, *.jpg*, or *.gif*.</span></span> <span data-ttu-id="ab2c8-366">Si `newPath` n’est pas valide, un <xref:System.ArgumentException> est levé.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-366">If the `newPath` isn't valid, an <xref:System.ArgumentException> is thrown.</span></span> <span data-ttu-id="ab2c8-367">Si une requête est faite pour *image.png*, la requête est redirigée vers `/png-images/image.png`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-367">If a request is made for *image.png*, the request is redirected to `/png-images/image.png`.</span></span> <span data-ttu-id="ab2c8-368">Si une requête est faite pour *image.jpg*, la requête est redirigée vers `/jpg-images/image.jpg`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-368">If a request is made for *image.jpg*, the request is redirected to `/jpg-images/image.jpg`.</span></span> <span data-ttu-id="ab2c8-369">Le code d’état est défini sur *301 - Déplacé de façon permanente*, et `context.Result` est défini de façon à cesser le traitement des règles et envoyer la réponse.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-369">The status code is set to *301 - Moved Permanently*, and the `context.Result` is set to stop processing rules and send the response.</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/RewriteRules.cs?name=snippet_RedirectImageRequests)]

<span data-ttu-id="ab2c8-370">Requête d’origine : `/image.png`</span><span class="sxs-lookup"><span data-stu-id="ab2c8-370">Original Request: `/image.png`</span></span>

![Fenêtre de navigateur avec les requêtes et les réponses suivies par les Outils de développement pour image.png](url-rewriting/_static/add_redirect_png_requests.png)

<span data-ttu-id="ab2c8-372">Requête d’origine : `/image.jpg`</span><span class="sxs-lookup"><span data-stu-id="ab2c8-372">Original Request: `/image.jpg`</span></span>

![Fenêtre de navigateur avec les requêtes et les réponses suivies par les Outils de développement pour image.jpg](url-rewriting/_static/add_redirect_jpg_requests.png)

## <a name="regex-examples"></a><span data-ttu-id="ab2c8-374">Exemples d’expressions régulières</span><span class="sxs-lookup"><span data-stu-id="ab2c8-374">Regex examples</span></span>

| <span data-ttu-id="ab2c8-375">Objectif</span><span class="sxs-lookup"><span data-stu-id="ab2c8-375">Goal</span></span> | <span data-ttu-id="ab2c8-376">Chaîne d’expression régulière et</span><span class="sxs-lookup"><span data-stu-id="ab2c8-376">Regex String &</span></span><br><span data-ttu-id="ab2c8-377">exemple de correspondance</span><span class="sxs-lookup"><span data-stu-id="ab2c8-377">Match Example</span></span> | <span data-ttu-id="ab2c8-378">Chaîne de remplacement et</span><span class="sxs-lookup"><span data-stu-id="ab2c8-378">Replacement String &</span></span><br><span data-ttu-id="ab2c8-379">exemple de sortie</span><span class="sxs-lookup"><span data-stu-id="ab2c8-379">Output Example</span></span> |
| ---- | ------------------------------- | -------------------------------------- |
| <span data-ttu-id="ab2c8-380">Réécrire le chemin dans la chaîne de requête</span><span class="sxs-lookup"><span data-stu-id="ab2c8-380">Rewrite path into querystring</span></span> | `^path/(.*)/(.*)`<br>`/path/abc/123` | `path?var1=$1&var2=$2`<br>`/path?var1=abc&var2=123` |
| <span data-ttu-id="ab2c8-381">Supprimer la barre oblique finale</span><span class="sxs-lookup"><span data-stu-id="ab2c8-381">Strip trailing slash</span></span> | `(.*)/$`<br>`/path/` | `$1`<br>`/path` |
| <span data-ttu-id="ab2c8-382">Appliquer une barre oblique finale</span><span class="sxs-lookup"><span data-stu-id="ab2c8-382">Enforce trailing slash</span></span> | `(.*[^/])$`<br>`/path` | `$1/`<br>`/path/` |
| <span data-ttu-id="ab2c8-383">Éviter la réécriture des requêtes spécifiques</span><span class="sxs-lookup"><span data-stu-id="ab2c8-383">Avoid rewriting specific requests</span></span> | <span data-ttu-id="ab2c8-384">`^(.*)(?<!\.axd)$` ou `^(?!.*\.axd$)(.*)$`</span><span class="sxs-lookup"><span data-stu-id="ab2c8-384">`^(.*)(?<!\.axd)$` or `^(?!.*\.axd$)(.*)$`</span></span><br><span data-ttu-id="ab2c8-385">Oui : `/resource.htm`</span><span class="sxs-lookup"><span data-stu-id="ab2c8-385">Yes: `/resource.htm`</span></span><br><span data-ttu-id="ab2c8-386">Non : `/resource.axd`</span><span class="sxs-lookup"><span data-stu-id="ab2c8-386">No: `/resource.axd`</span></span> | `rewritten/$1`<br>`/rewritten/resource.htm`<br>`/resource.axd` |
| <span data-ttu-id="ab2c8-387">Réorganiser les segments d’URL</span><span class="sxs-lookup"><span data-stu-id="ab2c8-387">Rearrange URL segments</span></span> | `path/(.*)/(.*)/(.*)`<br>`path/1/2/3` | `path/$3/$2/$1`<br>`path/3/2/1` |
| <span data-ttu-id="ab2c8-388">Remplacer un segment d’URL</span><span class="sxs-lookup"><span data-stu-id="ab2c8-388">Replace a URL segment</span></span> | `^(.*)/segment2/(.*)`<br>`/segment1/segment2/segment3` | `$1/replaced/$2`<br>`/segment1/replaced/segment3` |

::: moniker-end

::: moniker range="< aspnetcore-3.0"

<span data-ttu-id="ab2c8-389">Ce document présente la réécriture d’URL avec des instructions sur la façon d’utiliser l’intergiciel (middleware) de réécriture d’URL dans les applications ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-389">This document introduces URL rewriting with instructions on how to use URL Rewriting Middleware in ASP.NET Core apps.</span></span>

<span data-ttu-id="ab2c8-390">La réécriture d’URL consiste à modifier des URL de requête en fonction d’une ou de plusieurs règles prédéfinies.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-390">URL rewriting is the act of modifying request URLs based on one or more predefined rules.</span></span> <span data-ttu-id="ab2c8-391">La réécriture d’URL crée une abstraction entre les emplacements des ressources et leurs adresses pour que les emplacements et les adresses ne soient pas étroitement liés.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-391">URL rewriting creates an abstraction between resource locations and their addresses so that the locations and addresses aren't tightly linked.</span></span> <span data-ttu-id="ab2c8-392">La réécriture d’URL est utile dans plusieurs scénarios pour :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-392">URL rewriting is valuable in several scenarios to:</span></span>

* <span data-ttu-id="ab2c8-393">Déplacer ou remplacer de façon temporaire ou permanente les ressources d’un serveur, tout en conservant des localisateurs stables pour ces ressources.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-393">Move or replace server resources temporarily or permanently and maintain stable locators for those resources.</span></span>
* <span data-ttu-id="ab2c8-394">Diviser le traitement des requêtes entre différentes applications ou entre différentes parties d’une même application.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-394">Split request processing across different apps or across areas of one app.</span></span>
* <span data-ttu-id="ab2c8-395">Supprimer, ajouter ou réorganiser les segments d’URL sur des requêtes entrantes.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-395">Remove, add, or reorganize URL segments on incoming requests.</span></span>
* <span data-ttu-id="ab2c8-396">Optimiser les URL publiques pour l’optimisation du référencement d’un site auprès d’un moteur de recherche (SEO).</span><span class="sxs-lookup"><span data-stu-id="ab2c8-396">Optimize public URLs for Search Engine Optimization (SEO).</span></span>
* <span data-ttu-id="ab2c8-397">Permettre l’utilisation des URL publiques conviviales pour aider les visiteurs à prédire le contenu retourné en demandant une ressource.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-397">Permit the use of friendly public URLs to help visitors predict the content returned by requesting a resource.</span></span>
* <span data-ttu-id="ab2c8-398">Rediriger des requêtes non sécurisées vers des points de terminaison sécurisés.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-398">Redirect insecure requests to secure endpoints.</span></span>
* <span data-ttu-id="ab2c8-399">Empêcher les liaisons à chaud, où un site externe utilise une ressource statique hébergée sur un autre site en liant la ressource dans son propre contenu.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-399">Prevent hotlinking, where an external site uses a hosted static asset on another site by linking the asset into its own content.</span></span>

> [!NOTE]
> <span data-ttu-id="ab2c8-400">La réécriture d’URL peut réduire les performances d’une application.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-400">URL rewriting can reduce the performance of an app.</span></span> <span data-ttu-id="ab2c8-401">Quand c’est possible, limitez le nombre et la complexité des règles.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-401">Where feasible, limit the number and complexity of rules.</span></span>

<span data-ttu-id="ab2c8-402">[Afficher ou télécharger l’exemple de code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/) ([procédure de téléchargement](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="ab2c8-402">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="url-redirect-and-url-rewrite"></a><span data-ttu-id="ab2c8-403">Redirection d’URL et réécriture d’URL</span><span class="sxs-lookup"><span data-stu-id="ab2c8-403">URL redirect and URL rewrite</span></span>

<span data-ttu-id="ab2c8-404">La différence de formulation entre la *redirection d’URL* et la *réécriture d’URL* est subtile, mais elle a des implications importantes sur la fourniture de ressources aux clients.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-404">The difference in wording between *URL redirect* and *URL rewrite* is subtle but has important implications for providing resources to clients.</span></span> <span data-ttu-id="ab2c8-405">L’intergiciel de réécriture d’URL d’ASP.NET Core est capables de répondre aux besoins des deux.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-405">ASP.NET Core's URL Rewriting Middleware is capable of meeting the need for both.</span></span>

<span data-ttu-id="ab2c8-406">Une *redirection d’URL* implique une opération côté client, où le client est invité à accéder à une ressource à une autre adresse que celle demandée à l’origine.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-406">A *URL redirect* involves a client-side operation, where the client is instructed to access a resource at a different address than the client originally requested.</span></span> <span data-ttu-id="ab2c8-407">Ceci nécessite un aller-retour avec le serveur.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-407">This requires a round trip to the server.</span></span> <span data-ttu-id="ab2c8-408">L’URL de redirection retournée au client s’affiche dans la barre d’adresse du navigateur quand le client effectue une nouvelle requête pour la ressource.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-408">The redirect URL returned to the client appears in the browser's address bar when the client makes a new request for the resource.</span></span>

<span data-ttu-id="ab2c8-409">Si `/resource` est *redirigée* vers `/different-resource`, le serveur répond que le client doit obtenir la ressource à l’emplacement `/different-resource` avec un code d’état indiquant que la redirection est temporaire ou permanente.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-409">If `/resource` is *redirected* to `/different-resource`, the server responds that the client should obtain the resource at `/different-resource` with a status code indicating that the redirect is either temporary or permanent.</span></span>

![Un point de terminaison de service WebAPI a été changé temporairement de la version 1 (v1) à la version 2 (v2) sur le serveur.](url-rewriting/_static/url_redirect.png)

<span data-ttu-id="ab2c8-415">Lors de la redirection des requêtes vers une URL différente, indiquez si la redirection est permanente ou temporaire en spécifiant le code d’état avec la réponse :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-415">When redirecting requests to a different URL, indicate whether the redirect is permanent or temporary by specifying the status code with the response:</span></span>

* <span data-ttu-id="ab2c8-416">Le code d’état *301 - Déplacé de façon permanente* est utilisé quand la ressource a une nouvelle URL permanente et que vous voulez indiquer au client que toutes les requêtes futures pour la ressource doivent utiliser la nouvelle URL.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-416">The *301 - Moved Permanently* status code is used where the resource has a new, permanent URL and you wish to instruct the client that all future requests for the resource should use the new URL.</span></span> <span data-ttu-id="ab2c8-417">*Le client peut mettre en cache et réutiliser la réponse quand un code d’état 301 est reçu.*</span><span class="sxs-lookup"><span data-stu-id="ab2c8-417">*The client may cache and reuse the response when a 301 status code is received.*</span></span>

* <span data-ttu-id="ab2c8-418">Le code d’état *302 - Trouvé* est utilisé quand la redirection est temporaire ou généralement susceptible d’être modifiée.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-418">The *302 - Found* status code is used where the redirection is temporary or generally subject to change.</span></span> <span data-ttu-id="ab2c8-419">Le code d’état 302 indique au client de ne pas stocker l’URL et de ne plus l’utiliser.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-419">The 302 status code indicates to the client not to store the URL and use it in the future.</span></span>

<span data-ttu-id="ab2c8-420">Pour plus d’informations sur les codes d’état, consultez [RFC 2616: Status Code Definitions](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html).</span><span class="sxs-lookup"><span data-stu-id="ab2c8-420">For more information on status codes, see [RFC 2616: Status Code Definitions](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html).</span></span>

<span data-ttu-id="ab2c8-421">Une *réécriture d’URL* est une opération côté serveur qui fournit une ressource à partir d’une adresse de ressource différente de celle demandée par le client.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-421">A *URL rewrite* is a server-side operation that provides a resource from a different resource address than the client requested.</span></span> <span data-ttu-id="ab2c8-422">La réécriture d’URL ne nécessite pas d’aller-retour avec le serveur.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-422">Rewriting a URL doesn't require a round trip to the server.</span></span> <span data-ttu-id="ab2c8-423">L’URL réécrite n’est pas retournée au client et n’apparaît pas dans la barre d’adresse du navigateur.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-423">The rewritten URL isn't returned to the client and doesn't appear in the browser's address bar.</span></span>

<span data-ttu-id="ab2c8-424">Si `/resource` est *réécrite* en `/different-resource`, le serveur récupère la ressource *en interne* à l’emplacement `/different-resource`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-424">If `/resource` is *rewritten* to `/different-resource`, the server *internally* fetches and returns the resource at `/different-resource`.</span></span>

<span data-ttu-id="ab2c8-425">Même si le client peut récupérer la ressource à l’URL réécrite, il n’est pas informé que la ressource existe à l’URL réécrite quand il fait sa requête et reçoit la réponse.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-425">Although the client might be able to retrieve the resource at the rewritten URL, the client isn't informed that the resource exists at the rewritten URL when it makes its request and receives the response.</span></span>

![Un point de terminaison de service WebAPI a été changé de la version 1 (v1) à la version 2 (v2) sur le serveur.](url-rewriting/_static/url_rewrite.png)

## <a name="url-rewriting-sample-app"></a><span data-ttu-id="ab2c8-430">Exemple d’application de réécriture d’URL</span><span class="sxs-lookup"><span data-stu-id="ab2c8-430">URL rewriting sample app</span></span>

<span data-ttu-id="ab2c8-431">Vous pouvez explorer les fonctionnalités du middleware de réécriture d’URL avec [l’exemple d’application](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/).</span><span class="sxs-lookup"><span data-stu-id="ab2c8-431">You can explore the features of the URL Rewriting Middleware with the [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/).</span></span> <span data-ttu-id="ab2c8-432">L’application applique des règles de redirection et de réécriture, et montre l’URL redirigée ou réécrite pour plusieurs scénarios.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-432">The app applies redirect and rewrite rules and shows the redirected or rewritten URL for several scenarios.</span></span>

## <a name="when-to-use-url-rewriting-middleware"></a><span data-ttu-id="ab2c8-433">Quand utiliser l’intergiciel (middleware) de réécriture d’URL</span><span class="sxs-lookup"><span data-stu-id="ab2c8-433">When to use URL Rewriting Middleware</span></span>

<span data-ttu-id="ab2c8-434">Utilisez le middleware de réécriture d’URL quand vous ne pouvez pas utiliser les approches suivantes :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-434">Use URL Rewriting Middleware when you're unable to use the following approaches:</span></span>

* [<span data-ttu-id="ab2c8-435">Module de réécriture d’URL avec IIS sur Windows Server</span><span class="sxs-lookup"><span data-stu-id="ab2c8-435">URL Rewrite module with IIS on Windows Server</span></span>](https://www.iis.net/downloads/microsoft/url-rewrite)
* [<span data-ttu-id="ab2c8-436">Module mod_rewrite Apache sur Apache Server</span><span class="sxs-lookup"><span data-stu-id="ab2c8-436">Apache mod_rewrite module on Apache Server</span></span>](https://httpd.apache.org/docs/2.4/rewrite/)
* [<span data-ttu-id="ab2c8-437">URL de réécriture sur Nginx</span><span class="sxs-lookup"><span data-stu-id="ab2c8-437">URL rewriting on Nginx</span></span>](https://www.nginx.com/blog/creating-nginx-rewrite-rules/)

<span data-ttu-id="ab2c8-438">Utilisez aussi le middleware quand l’application est hébergée sur le [serveur HTTP.sys](xref:fundamentals/servers/httpsys) (anciennement appelé WebListener).</span><span class="sxs-lookup"><span data-stu-id="ab2c8-438">Also, use the middleware when the app is hosted on [HTTP.sys server](xref:fundamentals/servers/httpsys) (formerly called WebListener).</span></span>

<span data-ttu-id="ab2c8-439">Les principales raisons d’utiliser les technologies de réécriture d’URL basée sur le serveur dans IIS, Apache et Nginx sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-439">The main reasons to use the server-based URL rewriting technologies in IIS, Apache, and Nginx are:</span></span>

* <span data-ttu-id="ab2c8-440">Le middleware ne prend pas en charge toutes les fonctionnalités de ces modules.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-440">The middleware doesn't support the full features of these modules.</span></span>

  <span data-ttu-id="ab2c8-441">Certaines des fonctionnalités des modules serveur ne fonctionnent pas avec les projets ASP.NET Core, comme les contraintes `IsFile` et `IsDirectory` du module Réécriture IIS.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-441">Some of the features of the server modules don't work with ASP.NET Core projects, such as the `IsFile` and `IsDirectory` constraints of the IIS Rewrite module.</span></span> <span data-ttu-id="ab2c8-442">Dans ces scénarios, utilisez plutôt l’intergiciel.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-442">In these scenarios, use the middleware instead.</span></span>
* <span data-ttu-id="ab2c8-443">Les performances du middleware ne correspondent probablement pas à celles des modules.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-443">The performance of the middleware probably doesn't match that of the modules.</span></span>

  <span data-ttu-id="ab2c8-444">Mener des tests de performances est la seule façon de savoir exactement quelle approche dégrade le plus les performances ou si la dégradation des performances est négligeable.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-444">Benchmarking is the only way to know for sure which approach degrades performance the most or if degraded performance is negligible.</span></span>

## <a name="package"></a><span data-ttu-id="ab2c8-445">Package</span><span class="sxs-lookup"><span data-stu-id="ab2c8-445">Package</span></span>

<span data-ttu-id="ab2c8-446">Pour inclure le middleware dans votre projet, ajoutez une référence de package au [métapackage Microsoft.AspNetCore.App](xref:fundamentals/metapackage-app) dans le fichier projet, qui contient le package [Microsoft.AspNetCore.Rewrite](https://www.nuget.org/packages/Microsoft.AspNetCore.Rewrite).</span><span class="sxs-lookup"><span data-stu-id="ab2c8-446">To include the middleware in your project, add a package reference to the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) in the project file, which contains the [Microsoft.AspNetCore.Rewrite](https://www.nuget.org/packages/Microsoft.AspNetCore.Rewrite) package.</span></span>

<span data-ttu-id="ab2c8-447">Quand vous n’utilisez pas le métapackage `Microsoft.AspNetCore.App`, ajoutez une référence de projet au package `Microsoft.AspNetCore.Rewrite`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-447">When not using the `Microsoft.AspNetCore.App` metapackage, add a project reference to the `Microsoft.AspNetCore.Rewrite` package.</span></span>

## <a name="extension-and-options"></a><span data-ttu-id="ab2c8-448">Extension et options</span><span class="sxs-lookup"><span data-stu-id="ab2c8-448">Extension and options</span></span>

<span data-ttu-id="ab2c8-449">Établissez des règles de réécriture et de redirection d’URL en créant une instance de la classe [RewriteOptions](xref:Microsoft.AspNetCore.Rewrite.RewriteOptions) avec des méthodes d’extension pour chacune de vos règles de réécriture.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-449">Establish URL rewrite and redirect rules by creating an instance of the [RewriteOptions](xref:Microsoft.AspNetCore.Rewrite.RewriteOptions) class with extension methods for each of your rewrite rules.</span></span> <span data-ttu-id="ab2c8-450">Chaînez plusieurs règles dans l’ordre dans lequel vous voulez qu’elles soient traitées.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-450">Chain multiple rules in the order that you would like them processed.</span></span> <span data-ttu-id="ab2c8-451">Les `RewriteOptions` sont passées dans le middleware de réécriture d’URL quand il est ajouté au pipeline de requête avec <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*> :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-451">The `RewriteOptions` are passed into the URL Rewriting Middleware as it's added to the request pipeline with <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*>:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1)]

### <a name="redirect-non-www-to-www"></a><span data-ttu-id="ab2c8-452">Redirection de demandes non-www en demandes www</span><span class="sxs-lookup"><span data-stu-id="ab2c8-452">Redirect non-www to www</span></span>

<span data-ttu-id="ab2c8-453">Trois options permettent à l’application de rediriger des demandes non-`www` en demandes `www` :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-453">Three options permit the app to redirect non-`www` requests to `www`:</span></span>

* <span data-ttu-id="ab2c8-454"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWwwPermanent*>&ndash; Rediriger définitivement la demande vers le `www` sous-`www`domaine si la demande n’est pas.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-454"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWwwPermanent*> &ndash; Permanently redirect the request to the `www` subdomain if the request is non-`www`.</span></span> <span data-ttu-id="ab2c8-455">Redirige avec un code d’état [Status308PermanentRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status308PermanentRedirect).</span><span class="sxs-lookup"><span data-stu-id="ab2c8-455">Redirects with a [Status308PermanentRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status308PermanentRedirect) status code.</span></span>

* <span data-ttu-id="ab2c8-456"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWww*>&ndash; Redirigez la demande vers `www` le sous-`www`domaine si la demande entrante n’est pas.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-456"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWww*> &ndash; Redirect the request to the `www` subdomain if the incoming request is non-`www`.</span></span> <span data-ttu-id="ab2c8-457">Redirige avec un code d’état [Status307TemporaryRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status307TemporaryRedirect).</span><span class="sxs-lookup"><span data-stu-id="ab2c8-457">Redirects with a [Status307TemporaryRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status307TemporaryRedirect) status code.</span></span> <span data-ttu-id="ab2c8-458">Une surcharge vous permet de fournir le code d’état pour la réponse.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-458">An overload permits you to provide the status code for the response.</span></span> <span data-ttu-id="ab2c8-459">Utilisez un champ de la classe <xref:Microsoft.AspNetCore.Http.StatusCodes> pour une affectation de code d’état.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-459">Use a field of the <xref:Microsoft.AspNetCore.Http.StatusCodes> class for a status code assignment.</span></span>

### <a name="url-redirect"></a><span data-ttu-id="ab2c8-460">Redirection d’URL</span><span class="sxs-lookup"><span data-stu-id="ab2c8-460">URL redirect</span></span>

<span data-ttu-id="ab2c8-461">Utilisez <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirect*> pour rediriger des requêtes.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-461">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirect*> to redirect requests.</span></span> <span data-ttu-id="ab2c8-462">Le premier paramètre contient votre expression régulière pour la mise en correspondance sur le chemin de l’URL entrante.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-462">The first parameter contains your regex for matching on the path of the incoming URL.</span></span> <span data-ttu-id="ab2c8-463">Le deuxième paramètre est la chaîne de remplacement.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-463">The second parameter is the replacement string.</span></span> <span data-ttu-id="ab2c8-464">Le troisième paramètre, le cas échéant, spécifie le code d’état.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-464">The third parameter, if present, specifies the status code.</span></span> <span data-ttu-id="ab2c8-465">Si vous ne spécifiez pas le code d’état, sa valeur par défaut est *302 - Trouvé*, ce qui indique que la ressource est temporairement déplacée ou remplacée.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-465">If you don't specify the status code, the status code defaults to *302 - Found*, which indicates that the resource is temporarily moved or replaced.</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=9)]

<span data-ttu-id="ab2c8-466">Dans un navigateur dans lequel les outils de développement sont activés, effectuez une requête à l’exemple d’application avec le chemin `/redirect-rule/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-466">In a browser with developer tools enabled, make a request to the sample app with the path `/redirect-rule/1234/5678`.</span></span> <span data-ttu-id="ab2c8-467">L’expression régulière établit une correspondance avec le chemin de la requête sur `redirect-rule/(.*)`, et le chemin est remplacé par `/redirected/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-467">The regex matches the request path on `redirect-rule/(.*)`, and the path is replaced with `/redirected/1234/5678`.</span></span> <span data-ttu-id="ab2c8-468">L’URL de redirection est renvoyée au client avec le code d’état *302 - Trouvé*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-468">The redirect URL is sent back to the client with a *302 - Found* status code.</span></span> <span data-ttu-id="ab2c8-469">Le navigateur effectue une nouvelle requête à l’URL de redirection, qui apparaît dans la barre d’adresse du navigateur.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-469">The browser makes a new request at the redirect URL, which appears in the browser's address bar.</span></span> <span data-ttu-id="ab2c8-470">Comme aucune règle de l’exemple d’application ne correspond sur l’URL de redirection :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-470">Since no rules in the sample app match on the redirect URL:</span></span>

* <span data-ttu-id="ab2c8-471">La deuxième requête reçoit une réponse *200 - OK* de l’application.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-471">The second request receives a *200 - OK* response from the app.</span></span>
* <span data-ttu-id="ab2c8-472">Le corps de la réponse montre l’URL de redirection.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-472">The body of the response shows the redirect URL.</span></span>

<span data-ttu-id="ab2c8-473">Un aller-retour est effectué avec le serveur quand une URL est *redirigée*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-473">A round trip is made to the server when a URL is *redirected*.</span></span>

> [!WARNING]
> <span data-ttu-id="ab2c8-474">Soyez prudent lors de l’établissement de règles de redirection.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-474">Be cautious when establishing redirect rules.</span></span> <span data-ttu-id="ab2c8-475">Les règles de redirection sont évaluées à chaque requête effectuée à l’application, notamment après une redirection.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-475">Redirect rules are evaluated on every request to the app, including after a redirect.</span></span> <span data-ttu-id="ab2c8-476">Il est facile de créer accidentellement une *boucle de redirections infinies*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-476">It's easy to accidentally create a *loop of infinite redirects*.</span></span>

<span data-ttu-id="ab2c8-477">Requête d’origine : `/redirect-rule/1234/5678`</span><span class="sxs-lookup"><span data-stu-id="ab2c8-477">Original Request: `/redirect-rule/1234/5678`</span></span>

![Fenêtre de navigateur avec les requêtes et les réponses suivies par les Outils de développement](url-rewriting/_static/add_redirect.png)

<span data-ttu-id="ab2c8-479">La partie de l’expression entre parenthèses est appelée *groupe de capture*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-479">The part of the expression contained within parentheses is called a *capture group*.</span></span> <span data-ttu-id="ab2c8-480">Le point (`.`) de l’expression signifie *mettre en correspondance n’importe quel caractère*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-480">The dot (`.`) of the expression means *match any character*.</span></span> <span data-ttu-id="ab2c8-481">L’astérisque (`*`) indique *mettre en correspondance zéro occurrence ou plus du caractère précédent*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-481">The asterisk (`*`) indicates *match the preceding character zero or more times*.</span></span> <span data-ttu-id="ab2c8-482">Par conséquent, les deux derniers segments de chemin de l’URL, `1234/5678`, sont capturés par le groupe de capture `(.*)`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-482">Therefore, the last two path segments of the URL, `1234/5678`, are captured by capture group `(.*)`.</span></span> <span data-ttu-id="ab2c8-483">Toute valeur fournie dans l’URL de la requête après `redirect-rule/` est capturée par ce groupe de capture unique.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-483">Any value you provide in the request URL after `redirect-rule/` is captured by this single capture group.</span></span>

<span data-ttu-id="ab2c8-484">Dans la chaîne de remplacement, les groupes capturés sont injectés dans la chaîne avec le signe dollar (`$`) suivi du numéro de séquence de la capture.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-484">In the replacement string, captured groups are injected into the string with the dollar sign (`$`) followed by the sequence number of the capture.</span></span> <span data-ttu-id="ab2c8-485">La valeur du premier groupe de capture est obtenue avec `$1`, la deuxième avec `$2`, et ainsi de suite en séquence pour les groupes de capture de votre expression régulière.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-485">The first capture group value is obtained with `$1`, the second with `$2`, and they continue in sequence for the capture groups in your regex.</span></span> <span data-ttu-id="ab2c8-486">Comme il n’y a qu’un seul groupe capturé dans l’expression régulière de la règle de redirection de l’exemple d’application, un seul groupe est injecté dans la chaîne de remplacement, à savoir `$1`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-486">There's only one captured group in the redirect rule regex in the sample app, so there's only one injected group in the replacement string, which is `$1`.</span></span> <span data-ttu-id="ab2c8-487">Quand la règle est appliquée, l’URL devient `/redirected/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-487">When the rule is applied, the URL becomes `/redirected/1234/5678`.</span></span>

### <a name="url-redirect-to-a-secure-endpoint"></a><span data-ttu-id="ab2c8-488">Redirection d’URL vers un point de terminaison sécurisé</span><span class="sxs-lookup"><span data-stu-id="ab2c8-488">URL redirect to a secure endpoint</span></span>

<span data-ttu-id="ab2c8-489">Utilisez <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttps*> pour rediriger les requêtes HTTP vers le même hôte et le même chemin avec le protocole HTTPS.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-489">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttps*> to redirect HTTP requests to the same host and path using the HTTPS protocol.</span></span> <span data-ttu-id="ab2c8-490">Si le code d’état n’est pas fourni, le middleware utilise par défaut *302 - Trouvé*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-490">If the status code isn't supplied, the middleware defaults to *302 - Found*.</span></span> <span data-ttu-id="ab2c8-491">Si le port n’est pas fourni :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-491">If the port isn't supplied:</span></span>

* <span data-ttu-id="ab2c8-492">Le middleware utilise par défaut `null`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-492">The middleware defaults to `null`.</span></span>
* <span data-ttu-id="ab2c8-493">Le schéma change en `https` (protocole HTTPS), et le client accède à la ressource sur le port 443.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-493">The scheme changes to `https` (HTTPS protocol), and the client accesses the resource on port 443.</span></span>

<span data-ttu-id="ab2c8-494">L’exemple suivant montre comment définir le code d’état sur *301 - Déplacé de façon permanente* et changer le port en 5001.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-494">The following example shows how to set the status code to *301 - Moved Permanently* and change the port to 5001.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    var options = new RewriteOptions()
        .AddRedirectToHttps(301, 5001);

    app.UseRewriter(options);
}
```

<span data-ttu-id="ab2c8-495">Utilisez <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttpsPermanent*> pour rediriger les requêtes non sécurisées vers le même hôte et le même chemin avec le protocole HTTPS sécurisé sur le port 443.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-495">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttpsPermanent*> to redirect insecure requests to the same host and path with secure HTTPS protocol on port 443.</span></span> <span data-ttu-id="ab2c8-496">Le middleware définit le code d’état sur *301 - Déplacé de façon permanente*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-496">The middleware sets the status code to *301 - Moved Permanently*.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    var options = new RewriteOptions()
        .AddRedirectToHttpsPermanent();

    app.UseRewriter(options);
}
```

> [!NOTE]
> <span data-ttu-id="ab2c8-497">Si vous effectuez une redirection vers un point de terminaison sécurisé et que vous n’avez pas besoin de règles de redirection supplémentaires, nous vous recommandons d’utiliser le middleware de redirection HTTPS.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-497">When redirecting to a secure endpoint without the requirement for additional redirect rules, we recommend using HTTPS Redirection Middleware.</span></span> <span data-ttu-id="ab2c8-498">Pour plus d’informations, consultez la rubrique [Appliquer HTTPS](xref:security/enforcing-ssl#require-https).</span><span class="sxs-lookup"><span data-stu-id="ab2c8-498">For more information, see the [Enforce HTTPS](xref:security/enforcing-ssl#require-https) topic.</span></span>

<span data-ttu-id="ab2c8-499">L’exemple d’application peut montrer comment utiliser `AddRedirectToHttps` ou `AddRedirectToHttpsPermanent`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-499">The sample app is capable of demonstrating how to use `AddRedirectToHttps` or `AddRedirectToHttpsPermanent`.</span></span> <span data-ttu-id="ab2c8-500">Ajoutez la méthode d’extension à `RewriteOptions`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-500">Add the extension method to the `RewriteOptions`.</span></span> <span data-ttu-id="ab2c8-501">Effectuez une requête non sécurisée à l’application à n’importe quelle URL.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-501">Make an insecure request to the app at any URL.</span></span> <span data-ttu-id="ab2c8-502">Ignorez l’avertissement de sécurité du navigateur indiquant que le certificat auto-signé n’est pas approuvé ou créez une exception pour approuver le certificat.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-502">Dismiss the browser security warning that the self-signed certificate is untrusted or create an exception to trust the certificate.</span></span>

<span data-ttu-id="ab2c8-503">Requête d’origine utilisant `AddRedirectToHttps(301, 5001)` : `http://localhost:5000/secure`</span><span class="sxs-lookup"><span data-stu-id="ab2c8-503">Original Request using `AddRedirectToHttps(301, 5001)`: `http://localhost:5000/secure`</span></span>

![Fenêtre de navigateur avec les requêtes et les réponses suivies par les Outils de développement](url-rewriting/_static/add_redirect_to_https.png)

<span data-ttu-id="ab2c8-505">Requête d’origine utilisant `AddRedirectToHttpsPermanent` : `http://localhost:5000/secure`</span><span class="sxs-lookup"><span data-stu-id="ab2c8-505">Original Request using `AddRedirectToHttpsPermanent`: `http://localhost:5000/secure`</span></span>

![Fenêtre de navigateur avec les requêtes et les réponses suivies par les Outils de développement](url-rewriting/_static/add_redirect_to_https_permanent.png)

### <a name="url-rewrite"></a><span data-ttu-id="ab2c8-507">Réécrire URL</span><span class="sxs-lookup"><span data-stu-id="ab2c8-507">URL rewrite</span></span>

<span data-ttu-id="ab2c8-508">Utilisez <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRewrite*> pour créer une règle pour la réécriture d’URL.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-508">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRewrite*> to create a rule for rewriting URLs.</span></span> <span data-ttu-id="ab2c8-509">Le premier paramètre contient l’expression régulière pour la mise en correspondance sur le chemin de l’URL entrante.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-509">The first parameter contains the regex for matching on the incoming URL path.</span></span> <span data-ttu-id="ab2c8-510">Le deuxième paramètre est la chaîne de remplacement.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-510">The second parameter is the replacement string.</span></span> <span data-ttu-id="ab2c8-511">Le troisième paramètre, `skipRemainingRules: {true|false}`, indique à l’intergiciel d’ignorer, ou non, les règles de réécriture supplémentaires si la règle actuelle est appliquée.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-511">The third parameter, `skipRemainingRules: {true|false}`, indicates to the middleware whether or not to skip additional rewrite rules if the current rule is applied.</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=10-11)]

<span data-ttu-id="ab2c8-512">Requête d’origine : `/rewrite-rule/1234/5678`</span><span class="sxs-lookup"><span data-stu-id="ab2c8-512">Original Request: `/rewrite-rule/1234/5678`</span></span>

![Fenêtre de navigateur avec la requête et la réponse suivies par les Outils de développement](url-rewriting/_static/add_rewrite.png)

<span data-ttu-id="ab2c8-514">Le caret (`^`) au début de l’expression signifie que la correspondance commence au début du chemin de l’URL.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-514">The carat (`^`) at the beginning of the expression means that matching starts at the beginning of the URL path.</span></span>

<span data-ttu-id="ab2c8-515">Dans l’exemple précédent avec la règle de redirection, `redirect-rule/(.*)`, il n’existe pas de caret (`^`) au début de l’expression régulière.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-515">In the earlier example with the redirect rule, `redirect-rule/(.*)`, there's no carat (`^`) at the start of the regex.</span></span> <span data-ttu-id="ab2c8-516">Ainsi, n’importe quel caractère peut précéder `redirect-rule/` dans le chemin pour qu’une correspondance soit établie.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-516">Therefore, any characters may precede `redirect-rule/` in the path for a successful match.</span></span>

| <span data-ttu-id="ab2c8-517">Path</span><span class="sxs-lookup"><span data-stu-id="ab2c8-517">Path</span></span>                               | <span data-ttu-id="ab2c8-518">Correspond</span><span class="sxs-lookup"><span data-stu-id="ab2c8-518">Match</span></span> |
| ---------------------------------- | :---: |
| `/redirect-rule/1234/5678`         | <span data-ttu-id="ab2c8-519">Oui</span><span class="sxs-lookup"><span data-stu-id="ab2c8-519">Yes</span></span>   |
| `/my-cool-redirect-rule/1234/5678` | <span data-ttu-id="ab2c8-520">Oui</span><span class="sxs-lookup"><span data-stu-id="ab2c8-520">Yes</span></span>   |
| `/anotherredirect-rule/1234/5678`  | <span data-ttu-id="ab2c8-521">Oui</span><span class="sxs-lookup"><span data-stu-id="ab2c8-521">Yes</span></span>   |

<span data-ttu-id="ab2c8-522">La règle de réécriture, `^rewrite-rule/(\d+)/(\d+)`, établit une correspondance uniquement avec des chemins d’accès s’ils commencent par `rewrite-rule/`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-522">The rewrite rule, `^rewrite-rule/(\d+)/(\d+)`, only matches paths if they start with `rewrite-rule/`.</span></span> <span data-ttu-id="ab2c8-523">Dans le tableau suivant, notez la différence de correspondance.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-523">In the following table, note the difference in matching.</span></span>

| <span data-ttu-id="ab2c8-524">Path</span><span class="sxs-lookup"><span data-stu-id="ab2c8-524">Path</span></span>                              | <span data-ttu-id="ab2c8-525">Correspond</span><span class="sxs-lookup"><span data-stu-id="ab2c8-525">Match</span></span> |
| --------------------------------- | :---: |
| `/rewrite-rule/1234/5678`         | <span data-ttu-id="ab2c8-526">Oui</span><span class="sxs-lookup"><span data-stu-id="ab2c8-526">Yes</span></span>   |
| `/my-cool-rewrite-rule/1234/5678` | <span data-ttu-id="ab2c8-527">Non</span><span class="sxs-lookup"><span data-stu-id="ab2c8-527">No</span></span>    |
| `/anotherrewrite-rule/1234/5678`  | <span data-ttu-id="ab2c8-528">Non</span><span class="sxs-lookup"><span data-stu-id="ab2c8-528">No</span></span>    |

<span data-ttu-id="ab2c8-529">À la suite de la partie `^rewrite-rule/` de l’expression se trouvent deux groupes de capture, `(\d+)/(\d+)`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-529">Following the `^rewrite-rule/` portion of the expression, there are two capture groups, `(\d+)/(\d+)`.</span></span> <span data-ttu-id="ab2c8-530">`\d` signifie *établir une correspondance avec un chiffre (nombre)*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-530">The `\d` signifies *match a digit (number)*.</span></span> <span data-ttu-id="ab2c8-531">Le signe plus (`+`) signifie *établir une correspondance avec une ou plusieurs occurrences du caractère précédent*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-531">The plus sign (`+`) means *match one or more of the preceding character*.</span></span> <span data-ttu-id="ab2c8-532">Par conséquent, l’URL doit contenir un nombre suivi d’une barre oblique, elle-même suivie d’un autre nombre.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-532">Therefore, the URL must contain a number followed by a forward-slash followed by another number.</span></span> <span data-ttu-id="ab2c8-533">Ces groupes sont injectés dans l’URL réécrite sous la forme `$1` et `$2`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-533">These capture groups are injected into the rewritten URL as `$1` and `$2`.</span></span> <span data-ttu-id="ab2c8-534">La chaîne de remplacement de la règle de réécriture place les groupes capturés dans la chaîne de requête.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-534">The rewrite rule replacement string places the captured groups into the query string.</span></span> <span data-ttu-id="ab2c8-535">Le chemin demandé `/rewrite-rule/1234/5678` est réécrit pour obtenir la ressource à l’emplacement `/rewritten?var1=1234&var2=5678`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-535">The requested path of `/rewrite-rule/1234/5678` is rewritten to obtain the resource at `/rewritten?var1=1234&var2=5678`.</span></span> <span data-ttu-id="ab2c8-536">Si une chaîne de requête est présente dans la requête d’origine, elle est conservée lors de la réécriture de l’URL.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-536">If a query string is present on the original request, it's preserved when the URL is rewritten.</span></span>

<span data-ttu-id="ab2c8-537">Il n’y a pas d’aller-retour avec le serveur pour obtenir la ressource.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-537">There's no round trip to the server to obtain the resource.</span></span> <span data-ttu-id="ab2c8-538">Si la ressource existe, elle est récupérée et retournée au client avec le code d’état *200 - OK*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-538">If the resource exists, it's fetched and returned to the client with a *200 - OK* status code.</span></span> <span data-ttu-id="ab2c8-539">Comme le client n’est pas redirigé, l’URL dans la barre d’adresse du navigateur ne change pas.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-539">Because the client isn't redirected, the URL in the browser's address bar doesn't change.</span></span> <span data-ttu-id="ab2c8-540">Les clients ne peuvent pas détecter qu’une opération de réécriture d’URL s’est produite sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-540">Clients can't detect that a URL rewrite operation occurred on the server.</span></span>

> [!NOTE]
> <span data-ttu-id="ab2c8-541">Quand c’est possible, utilisez `skipRemainingRules: true`, car la mise en correspondance de règles est un processus gourmand en ressources qui augmente le temps de réponse de l’application.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-541">Use `skipRemainingRules: true` whenever possible because matching rules is computationally expensive and increases app response time.</span></span> <span data-ttu-id="ab2c8-542">Pour obtenir la réponse d’application la plus rapide :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-542">For the fastest app response:</span></span>
>
> * <span data-ttu-id="ab2c8-543">Classez vos règles de réécriture en partant de la règle la plus souvent mise en correspondance jusqu’à la règle la moins souvent mise en correspondance.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-543">Order rewrite rules from the most frequently matched rule to the least frequently matched rule.</span></span>
> * <span data-ttu-id="ab2c8-544">Ignorez le traitement des règles restantes quand une correspondance est trouvée et qu’aucun traitement de règle supplémentaire n’est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-544">Skip the processing of the remaining rules when a match occurs and no additional rule processing is required.</span></span>

### <a name="apache-mod_rewrite"></a><span data-ttu-id="ab2c8-545">Apache mod_rewrite</span><span class="sxs-lookup"><span data-stu-id="ab2c8-545">Apache mod_rewrite</span></span>

<span data-ttu-id="ab2c8-546">Appliquez des règles Apache mod_rewrite avec <xref:Microsoft.AspNetCore.Rewrite.ApacheModRewriteOptionsExtensions.AddApacheModRewrite*>.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-546">Apply Apache mod_rewrite rules with <xref:Microsoft.AspNetCore.Rewrite.ApacheModRewriteOptionsExtensions.AddApacheModRewrite*>.</span></span> <span data-ttu-id="ab2c8-547">Vérifiez que le fichier de règles est déployé avec l’application.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-547">Make sure that the rules file is deployed with the app.</span></span> <span data-ttu-id="ab2c8-548">Pour obtenir plus d’informations et des exemples de règles mod_rewrite, consultez [Apache mod_rewrite](https://httpd.apache.org/docs/2.4/rewrite/).</span><span class="sxs-lookup"><span data-stu-id="ab2c8-548">For more information and examples of mod_rewrite rules, see [Apache mod_rewrite](https://httpd.apache.org/docs/2.4/rewrite/).</span></span>

<span data-ttu-id="ab2c8-549">Un <xref:System.IO.StreamReader> est utilisé pour lire les règles à partir du fichier de règles *ApacheModRewrite. txt* :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-549">A <xref:System.IO.StreamReader> is used to read the rules from the *ApacheModRewrite.txt* rules file:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=3-4,12)]

<span data-ttu-id="ab2c8-550">L’exemple d’application redirige les requêtes de `/apache-mod-rules-redirect/(.\*)` vers `/redirected?id=$1`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-550">The sample app redirects requests from `/apache-mod-rules-redirect/(.\*)` to `/redirected?id=$1`.</span></span> <span data-ttu-id="ab2c8-551">Le code d’état de la réponse est *302 - Trouvé*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-551">The response status code is *302 - Found*.</span></span>

[!code[](url-rewriting/samples/2.x/SampleApp/ApacheModRewrite.txt)]

<span data-ttu-id="ab2c8-552">Requête d’origine : `/apache-mod-rules-redirect/1234`</span><span class="sxs-lookup"><span data-stu-id="ab2c8-552">Original Request: `/apache-mod-rules-redirect/1234`</span></span>

![Fenêtre de navigateur avec les requêtes et les réponses suivies par les Outils de développement](url-rewriting/_static/add_apache_mod_redirect.png)

<span data-ttu-id="ab2c8-554">L’intergiciel prend en charge les variables de serveur Apache mod_rewrite suivantes :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-554">The middleware supports the following Apache mod_rewrite server variables:</span></span>

* <span data-ttu-id="ab2c8-555">CONN_REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="ab2c8-555">CONN_REMOTE_ADDR</span></span>
* <span data-ttu-id="ab2c8-556">HTTP_ACCEPT</span><span class="sxs-lookup"><span data-stu-id="ab2c8-556">HTTP_ACCEPT</span></span>
* <span data-ttu-id="ab2c8-557">HTTP_CONNECTION</span><span class="sxs-lookup"><span data-stu-id="ab2c8-557">HTTP_CONNECTION</span></span>
* <span data-ttu-id="ab2c8-558">HTTP_COOKIE</span><span class="sxs-lookup"><span data-stu-id="ab2c8-558">HTTP_COOKIE</span></span>
* <span data-ttu-id="ab2c8-559">HTTP_FORWARDED</span><span class="sxs-lookup"><span data-stu-id="ab2c8-559">HTTP_FORWARDED</span></span>
* <span data-ttu-id="ab2c8-560">HTTP_HOST</span><span class="sxs-lookup"><span data-stu-id="ab2c8-560">HTTP_HOST</span></span>
* <span data-ttu-id="ab2c8-561">HTTP_REFERER</span><span class="sxs-lookup"><span data-stu-id="ab2c8-561">HTTP_REFERER</span></span>
* <span data-ttu-id="ab2c8-562">HTTP_USER_AGENT</span><span class="sxs-lookup"><span data-stu-id="ab2c8-562">HTTP_USER_AGENT</span></span>
* <span data-ttu-id="ab2c8-563">HTTPS</span><span class="sxs-lookup"><span data-stu-id="ab2c8-563">HTTPS</span></span>
* <span data-ttu-id="ab2c8-564">IPV6</span><span class="sxs-lookup"><span data-stu-id="ab2c8-564">IPV6</span></span>
* <span data-ttu-id="ab2c8-565">QUERY_STRING</span><span class="sxs-lookup"><span data-stu-id="ab2c8-565">QUERY_STRING</span></span>
* <span data-ttu-id="ab2c8-566">REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="ab2c8-566">REMOTE_ADDR</span></span>
* <span data-ttu-id="ab2c8-567">REMOTE_PORT</span><span class="sxs-lookup"><span data-stu-id="ab2c8-567">REMOTE_PORT</span></span>
* <span data-ttu-id="ab2c8-568">REQUEST_FILENAME</span><span class="sxs-lookup"><span data-stu-id="ab2c8-568">REQUEST_FILENAME</span></span>
* <span data-ttu-id="ab2c8-569">REQUEST_METHOD</span><span class="sxs-lookup"><span data-stu-id="ab2c8-569">REQUEST_METHOD</span></span>
* <span data-ttu-id="ab2c8-570">REQUEST_SCHEME</span><span class="sxs-lookup"><span data-stu-id="ab2c8-570">REQUEST_SCHEME</span></span>
* <span data-ttu-id="ab2c8-571">REQUEST_URI</span><span class="sxs-lookup"><span data-stu-id="ab2c8-571">REQUEST_URI</span></span>
* <span data-ttu-id="ab2c8-572">SCRIPT_FILENAME</span><span class="sxs-lookup"><span data-stu-id="ab2c8-572">SCRIPT_FILENAME</span></span>
* <span data-ttu-id="ab2c8-573">SERVER_ADDR</span><span class="sxs-lookup"><span data-stu-id="ab2c8-573">SERVER_ADDR</span></span>
* <span data-ttu-id="ab2c8-574">SERVER_PORT</span><span class="sxs-lookup"><span data-stu-id="ab2c8-574">SERVER_PORT</span></span>
* <span data-ttu-id="ab2c8-575">SERVER_PROTOCOL</span><span class="sxs-lookup"><span data-stu-id="ab2c8-575">SERVER_PROTOCOL</span></span>
* <span data-ttu-id="ab2c8-576">TEMPS</span><span class="sxs-lookup"><span data-stu-id="ab2c8-576">TIME</span></span>
* <span data-ttu-id="ab2c8-577">TIME_DAY</span><span class="sxs-lookup"><span data-stu-id="ab2c8-577">TIME_DAY</span></span>
* <span data-ttu-id="ab2c8-578">TIME_HOUR</span><span class="sxs-lookup"><span data-stu-id="ab2c8-578">TIME_HOUR</span></span>
* <span data-ttu-id="ab2c8-579">TIME_MIN</span><span class="sxs-lookup"><span data-stu-id="ab2c8-579">TIME_MIN</span></span>
* <span data-ttu-id="ab2c8-580">TIME_MON</span><span class="sxs-lookup"><span data-stu-id="ab2c8-580">TIME_MON</span></span>
* <span data-ttu-id="ab2c8-581">TIME_SEC</span><span class="sxs-lookup"><span data-stu-id="ab2c8-581">TIME_SEC</span></span>
* <span data-ttu-id="ab2c8-582">TIME_WDAY</span><span class="sxs-lookup"><span data-stu-id="ab2c8-582">TIME_WDAY</span></span>
* <span data-ttu-id="ab2c8-583">TIME_YEAR</span><span class="sxs-lookup"><span data-stu-id="ab2c8-583">TIME_YEAR</span></span>

### <a name="iis-url-rewrite-module-rules"></a><span data-ttu-id="ab2c8-584">Règles du module de réécriture d’URL IIS</span><span class="sxs-lookup"><span data-stu-id="ab2c8-584">IIS URL Rewrite Module rules</span></span>

<span data-ttu-id="ab2c8-585">Pour utiliser le même ensemble de règles que celui qui s’applique au module de réécriture d’URL IIS, utilisez <xref:Microsoft.AspNetCore.Rewrite.IISUrlRewriteOptionsExtensions.AddIISUrlRewrite*>.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-585">To use the same rule set that applies to the IIS URL Rewrite Module, use <xref:Microsoft.AspNetCore.Rewrite.IISUrlRewriteOptionsExtensions.AddIISUrlRewrite*>.</span></span> <span data-ttu-id="ab2c8-586">Vérifiez que le fichier de règles est déployé avec l’application.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-586">Make sure that the rules file is deployed with the app.</span></span> <span data-ttu-id="ab2c8-587">N’indiquez pas au middleware d’utiliser le fichier *web.config* de l’application en cas d’exécution sur Windows Server IIS.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-587">Don't direct the middleware to use the app's *web.config* file when running on Windows Server IIS.</span></span> <span data-ttu-id="ab2c8-588">Avec IIS, ces règles doivent être stockées en dehors du fichier *web.config* de l’application pour éviter les conflits avec le module de réécriture IIS.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-588">With IIS, these rules should be stored outside of the app's *web.config* file in order to avoid conflicts with the IIS Rewrite module.</span></span> <span data-ttu-id="ab2c8-589">Pour obtenir plus d’informations et des exemples de règles du module de réécriture d’URL IIS, consultez [Utilisation du module de réécriture d’URL 2.0](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) et [Informations de référence sur la configuration du module de réécriture d’URL](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference).</span><span class="sxs-lookup"><span data-stu-id="ab2c8-589">For more information and examples of IIS URL Rewrite Module rules, see [Using Url Rewrite Module 2.0](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) and [URL Rewrite Module Configuration Reference](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference).</span></span>

<span data-ttu-id="ab2c8-590">Un <xref:System.IO.StreamReader> est utilisé pour lire les règles à partir du fichier de règles *IISUrlRewrite. xml* :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-590">A <xref:System.IO.StreamReader> is used to read the rules from the *IISUrlRewrite.xml* rules file:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=5-6,13)]

<span data-ttu-id="ab2c8-591">L’exemple d’application réécrit les requêtes de `/iis-rules-rewrite/(.*)` vers `/rewritten?id=$1`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-591">The sample app rewrites requests from `/iis-rules-rewrite/(.*)` to `/rewritten?id=$1`.</span></span> <span data-ttu-id="ab2c8-592">La réponse est envoyée au client avec le code d’état *200 - OK*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-592">The response is sent to the client with a *200 - OK* status code.</span></span>

[!code-xml[](url-rewriting/samples/2.x/SampleApp/IISUrlRewrite.xml)]

<span data-ttu-id="ab2c8-593">Requête d’origine : `/iis-rules-rewrite/1234`</span><span class="sxs-lookup"><span data-stu-id="ab2c8-593">Original Request: `/iis-rules-rewrite/1234`</span></span>

![Fenêtre de navigateur avec la requête et la réponse suivies par les Outils de développement](url-rewriting/_static/add_iis_url_rewrite.png)

<span data-ttu-id="ab2c8-595">Si vous avez un module de réécriture IIS actif pour lequel des règles au niveau du serveur qui affecteraient de façon non souhaitée votre application sont configurées, vous pouvez le désactiver pour une application.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-595">If you have an active IIS Rewrite Module with server-level rules configured that would impact your app in undesirable ways, you can disable the IIS Rewrite Module for an app.</span></span> <span data-ttu-id="ab2c8-596">Pour plus d’informations, consultez [Désactivation de modules IIS](xref:host-and-deploy/iis/modules#disabling-iis-modules).</span><span class="sxs-lookup"><span data-stu-id="ab2c8-596">For more information, see [Disabling IIS modules](xref:host-and-deploy/iis/modules#disabling-iis-modules).</span></span>

#### <a name="unsupported-features"></a><span data-ttu-id="ab2c8-597">Fonctionnalités non prises en charge</span><span class="sxs-lookup"><span data-stu-id="ab2c8-597">Unsupported features</span></span>

<span data-ttu-id="ab2c8-598">L’intergiciel intégré à ASP.NET Core 2.x ne prend pas en charge les fonctionnalités de module de réécriture d’URL IIS suivantes :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-598">The middleware released with ASP.NET Core 2.x doesn't support the following IIS URL Rewrite Module features:</span></span>

* <span data-ttu-id="ab2c8-599">Règles de trafic sortant</span><span class="sxs-lookup"><span data-stu-id="ab2c8-599">Outbound Rules</span></span>
* <span data-ttu-id="ab2c8-600">Variables serveur personnalisées</span><span class="sxs-lookup"><span data-stu-id="ab2c8-600">Custom Server Variables</span></span>
* <span data-ttu-id="ab2c8-601">Caractères génériques</span><span class="sxs-lookup"><span data-stu-id="ab2c8-601">Wildcards</span></span>
* <span data-ttu-id="ab2c8-602">LogRewrittenUrl</span><span class="sxs-lookup"><span data-stu-id="ab2c8-602">LogRewrittenUrl</span></span>

#### <a name="supported-server-variables"></a><span data-ttu-id="ab2c8-603">Variables de serveur prises en charge</span><span class="sxs-lookup"><span data-stu-id="ab2c8-603">Supported server variables</span></span>

<span data-ttu-id="ab2c8-604">L’intergiciel prend en charge les variables serveur du module de réécriture d’URL IIS suivantes :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-604">The middleware supports the following IIS URL Rewrite Module server variables:</span></span>

* <span data-ttu-id="ab2c8-605">CONTENT_LENGTH</span><span class="sxs-lookup"><span data-stu-id="ab2c8-605">CONTENT_LENGTH</span></span>
* <span data-ttu-id="ab2c8-606">CONTENT_TYPE</span><span class="sxs-lookup"><span data-stu-id="ab2c8-606">CONTENT_TYPE</span></span>
* <span data-ttu-id="ab2c8-607">HTTP_ACCEPT</span><span class="sxs-lookup"><span data-stu-id="ab2c8-607">HTTP_ACCEPT</span></span>
* <span data-ttu-id="ab2c8-608">HTTP_CONNECTION</span><span class="sxs-lookup"><span data-stu-id="ab2c8-608">HTTP_CONNECTION</span></span>
* <span data-ttu-id="ab2c8-609">HTTP_COOKIE</span><span class="sxs-lookup"><span data-stu-id="ab2c8-609">HTTP_COOKIE</span></span>
* <span data-ttu-id="ab2c8-610">HTTP_HOST</span><span class="sxs-lookup"><span data-stu-id="ab2c8-610">HTTP_HOST</span></span>
* <span data-ttu-id="ab2c8-611">HTTP_REFERER</span><span class="sxs-lookup"><span data-stu-id="ab2c8-611">HTTP_REFERER</span></span>
* <span data-ttu-id="ab2c8-612">HTTP_URL</span><span class="sxs-lookup"><span data-stu-id="ab2c8-612">HTTP_URL</span></span>
* <span data-ttu-id="ab2c8-613">HTTP_USER_AGENT</span><span class="sxs-lookup"><span data-stu-id="ab2c8-613">HTTP_USER_AGENT</span></span>
* <span data-ttu-id="ab2c8-614">HTTPS</span><span class="sxs-lookup"><span data-stu-id="ab2c8-614">HTTPS</span></span>
* <span data-ttu-id="ab2c8-615">LOCAL_ADDR</span><span class="sxs-lookup"><span data-stu-id="ab2c8-615">LOCAL_ADDR</span></span>
* <span data-ttu-id="ab2c8-616">QUERY_STRING</span><span class="sxs-lookup"><span data-stu-id="ab2c8-616">QUERY_STRING</span></span>
* <span data-ttu-id="ab2c8-617">REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="ab2c8-617">REMOTE_ADDR</span></span>
* <span data-ttu-id="ab2c8-618">REMOTE_PORT</span><span class="sxs-lookup"><span data-stu-id="ab2c8-618">REMOTE_PORT</span></span>
* <span data-ttu-id="ab2c8-619">REQUEST_FILENAME</span><span class="sxs-lookup"><span data-stu-id="ab2c8-619">REQUEST_FILENAME</span></span>
* <span data-ttu-id="ab2c8-620">REQUEST_URI</span><span class="sxs-lookup"><span data-stu-id="ab2c8-620">REQUEST_URI</span></span>

> [!NOTE]
> <span data-ttu-id="ab2c8-621">Vous pouvez également obtenir un <xref:Microsoft.Extensions.FileProviders.IFileProvider> par le biais d’un <xref:Microsoft.Extensions.FileProviders.PhysicalFileProvider>.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-621">You can also obtain an <xref:Microsoft.Extensions.FileProviders.IFileProvider> via a <xref:Microsoft.Extensions.FileProviders.PhysicalFileProvider>.</span></span> <span data-ttu-id="ab2c8-622">Cette approche peut fournir davantage de flexibilité pour l’emplacement de vos fichiers de règles de réécriture.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-622">This approach may provide greater flexibility for the location of your rewrite rules files.</span></span> <span data-ttu-id="ab2c8-623">Vérifiez que vos fichiers de règles de réécriture sont déployés sur le serveur dans le chemin que vous fournissez.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-623">Make sure that your rewrite rules files are deployed to the server at the path you provide.</span></span>
>
> ```csharp
> PhysicalFileProvider fileProvider = new PhysicalFileProvider(Directory.GetCurrentDirectory());
> ```

### <a name="method-based-rule"></a><span data-ttu-id="ab2c8-624">Règle basée sur une méthode</span><span class="sxs-lookup"><span data-stu-id="ab2c8-624">Method-based rule</span></span>

<span data-ttu-id="ab2c8-625">Utilisez <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> pour implémenter votre propre logique de règle dans une méthode.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-625">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> to implement your own rule logic in a method.</span></span> <span data-ttu-id="ab2c8-626">`Add` expose <xref:Microsoft.AspNetCore.Rewrite.RewriteContext>, ce qui rend <xref:Microsoft.AspNetCore.Http.HttpContext> disponible pour une utilisation dans votre méthode.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-626">`Add` exposes the <xref:Microsoft.AspNetCore.Rewrite.RewriteContext>, which makes available the <xref:Microsoft.AspNetCore.Http.HttpContext> for use in your method.</span></span> <span data-ttu-id="ab2c8-627">[RewriteContext.Result](xref:Microsoft.AspNetCore.Rewrite.RewriteContext.Result*) détermine la façon dont le traitement du pipeline supplémentaire est géré.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-627">The [RewriteContext.Result](xref:Microsoft.AspNetCore.Rewrite.RewriteContext.Result*) determines how additional pipeline processing is handled.</span></span> <span data-ttu-id="ab2c8-628">Définissez la valeur sur un des champs <xref:Microsoft.AspNetCore.Rewrite.RuleResult> décrits dans le tableau suivant.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-628">Set the value to one of the <xref:Microsoft.AspNetCore.Rewrite.RuleResult> fields described in the following table.</span></span>

| `RewriteContext.Result`              | <span data-ttu-id="ab2c8-629">Action</span><span class="sxs-lookup"><span data-stu-id="ab2c8-629">Action</span></span>                                                           |
| ------------------------------------ | ---------------------------------------------------------------- |
| <span data-ttu-id="ab2c8-630">`RuleResult.ContinueRules` (par défaut)</span><span class="sxs-lookup"><span data-stu-id="ab2c8-630">`RuleResult.ContinueRules` (default)</span></span> | <span data-ttu-id="ab2c8-631">Continuer à appliquer les règles.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-631">Continue applying rules.</span></span>                                         |
| `RuleResult.EndResponse`             | <span data-ttu-id="ab2c8-632">Cesser d’appliquer les règles et envoyer la réponse.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-632">Stop applying rules and send the response.</span></span>                       |
| `RuleResult.SkipRemainingRules`      | <span data-ttu-id="ab2c8-633">Cesser d’appliquer les règles et envoyer le contexte au middleware suivant.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-633">Stop applying rules and send the context to the next middleware.</span></span> |

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=14)]

<span data-ttu-id="ab2c8-634">L’exemple d’application présente une méthode qui redirige les requêtes de chemins qui se terminent par *.xml*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-634">The sample app demonstrates a method that redirects requests for paths that end with *.xml*.</span></span> <span data-ttu-id="ab2c8-635">Si une requête est faite pour `/file.xml`, la requête est redirigée vers `/xmlfiles/file.xml`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-635">If a request is made for `/file.xml`, the request is redirected to `/xmlfiles/file.xml`.</span></span> <span data-ttu-id="ab2c8-636">Le code d’état est défini sur *301 - Déplacé de façon permanente*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-636">The status code is set to *301 - Moved Permanently*.</span></span> <span data-ttu-id="ab2c8-637">Quand le navigateur fait une nouvelle requête pour */xmlfiles/file.xml*, le middleware de fichiers statiques délivre le fichier au client à partir du dossier *wwwroot/xmlfiles*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-637">When the browser makes a new request for */xmlfiles/file.xml*, Static File Middleware serves the file to the client from the *wwwroot/xmlfiles* folder.</span></span> <span data-ttu-id="ab2c8-638">Pour une redirection, définissez explicitement le code d’état de la réponse.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-638">For a redirect, explicitly set the status code of the response.</span></span> <span data-ttu-id="ab2c8-639">Sinon, un code d’état *200 - OK* est retourné et la redirection ne se produit pas sur le client.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-639">Otherwise, a *200 - OK* status code is returned, and the redirect doesn't occur on the client.</span></span>

<span data-ttu-id="ab2c8-640">*RewriteRules.cs* :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-640">*RewriteRules.cs*:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/RewriteRules.cs?name=snippet_RedirectXmlFileRequests&highlight=14-18)]

<span data-ttu-id="ab2c8-641">Cette approche peut également réécrire des requêtes.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-641">This approach can also rewrite requests.</span></span> <span data-ttu-id="ab2c8-642">L’exemple d’application montre la réécriture du chemin pour toute requête demandant de délivrer le fichier texte *file.txt* à partir du dossier *wwwroot*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-642">The sample app demonstrates rewriting the path for any text file request to serve the *file.txt* text file from the *wwwroot* folder.</span></span> <span data-ttu-id="ab2c8-643">Le middleware de fichiers statiques délivre le fichier en fonction du chemin de requête mis à jour :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-643">Static File Middleware serves the file based on the updated request path:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=15,22)]

<span data-ttu-id="ab2c8-644">*RewriteRules.cs* :</span><span class="sxs-lookup"><span data-stu-id="ab2c8-644">*RewriteRules.cs*:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/RewriteRules.cs?name=snippet_RewriteTextFileRequests&highlight=7-8)]

### <a name="irule-based-rule"></a><span data-ttu-id="ab2c8-645">Règle basée sur IRule</span><span class="sxs-lookup"><span data-stu-id="ab2c8-645">IRule-based rule</span></span>

<span data-ttu-id="ab2c8-646">Utilisez <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> pour insérer votre propre logique de règle dans une classe qui implémente l’interface <xref:Microsoft.AspNetCore.Rewrite.IRule>.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-646">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> to use rule logic in a class that implements the <xref:Microsoft.AspNetCore.Rewrite.IRule> interface.</span></span> <span data-ttu-id="ab2c8-647">`IRule` offre davantage de flexibilité par rapport à l’approche de la règle basée sur une méthode.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-647">`IRule` provides greater flexibility over using the method-based rule approach.</span></span> <span data-ttu-id="ab2c8-648">Votre classe d’implémentation peut inclure un constructeur qui vous permet de passer des paramètres pour la méthode <xref:Microsoft.AspNetCore.Rewrite.IRule.ApplyRule*>.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-648">Your implementation class may include a constructor that allows you can pass in parameters for the <xref:Microsoft.AspNetCore.Rewrite.IRule.ApplyRule*> method.</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=16-17)]

<span data-ttu-id="ab2c8-649">Les valeurs des paramètres dans l’exemple d’application pour `extension` et `newPath` sont vérifiées afin de remplir plusieurs conditions.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-649">The values of the parameters in the sample app for the `extension` and the `newPath` are checked to meet several conditions.</span></span> <span data-ttu-id="ab2c8-650">`extension` doit contenir une valeur, laquelle doit être *.png*, *.jpg* ou *.gif*.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-650">The `extension` must contain a value, and the value must be *.png*, *.jpg*, or *.gif*.</span></span> <span data-ttu-id="ab2c8-651">Si `newPath` n’est pas valide, un <xref:System.ArgumentException> est levé.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-651">If the `newPath` isn't valid, an <xref:System.ArgumentException> is thrown.</span></span> <span data-ttu-id="ab2c8-652">Si une requête est faite pour *image.png*, la requête est redirigée vers `/png-images/image.png`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-652">If a request is made for *image.png*, the request is redirected to `/png-images/image.png`.</span></span> <span data-ttu-id="ab2c8-653">Si une requête est faite pour *image.jpg*, la requête est redirigée vers `/jpg-images/image.jpg`.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-653">If a request is made for *image.jpg*, the request is redirected to `/jpg-images/image.jpg`.</span></span> <span data-ttu-id="ab2c8-654">Le code d’état est défini sur *301 - Déplacé de façon permanente*, et `context.Result` est défini de façon à cesser le traitement des règles et envoyer la réponse.</span><span class="sxs-lookup"><span data-stu-id="ab2c8-654">The status code is set to *301 - Moved Permanently*, and the `context.Result` is set to stop processing rules and send the response.</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/RewriteRules.cs?name=snippet_RedirectImageRequests)]

<span data-ttu-id="ab2c8-655">Requête d’origine : `/image.png`</span><span class="sxs-lookup"><span data-stu-id="ab2c8-655">Original Request: `/image.png`</span></span>

![Fenêtre de navigateur avec les requêtes et les réponses suivies par les Outils de développement pour image.png](url-rewriting/_static/add_redirect_png_requests.png)

<span data-ttu-id="ab2c8-657">Requête d’origine : `/image.jpg`</span><span class="sxs-lookup"><span data-stu-id="ab2c8-657">Original Request: `/image.jpg`</span></span>

![Fenêtre de navigateur avec les requêtes et les réponses suivies par les Outils de développement pour image.jpg](url-rewriting/_static/add_redirect_jpg_requests.png)

## <a name="regex-examples"></a><span data-ttu-id="ab2c8-659">Exemples d’expressions régulières</span><span class="sxs-lookup"><span data-stu-id="ab2c8-659">Regex examples</span></span>

| <span data-ttu-id="ab2c8-660">Objectif</span><span class="sxs-lookup"><span data-stu-id="ab2c8-660">Goal</span></span> | <span data-ttu-id="ab2c8-661">Chaîne d’expression régulière et</span><span class="sxs-lookup"><span data-stu-id="ab2c8-661">Regex String &</span></span><br><span data-ttu-id="ab2c8-662">exemple de correspondance</span><span class="sxs-lookup"><span data-stu-id="ab2c8-662">Match Example</span></span> | <span data-ttu-id="ab2c8-663">Chaîne de remplacement et</span><span class="sxs-lookup"><span data-stu-id="ab2c8-663">Replacement String &</span></span><br><span data-ttu-id="ab2c8-664">exemple de sortie</span><span class="sxs-lookup"><span data-stu-id="ab2c8-664">Output Example</span></span> |
| ---- | ------------------------------- | -------------------------------------- |
| <span data-ttu-id="ab2c8-665">Réécrire le chemin dans la chaîne de requête</span><span class="sxs-lookup"><span data-stu-id="ab2c8-665">Rewrite path into querystring</span></span> | `^path/(.*)/(.*)`<br>`/path/abc/123` | `path?var1=$1&var2=$2`<br>`/path?var1=abc&var2=123` |
| <span data-ttu-id="ab2c8-666">Supprimer la barre oblique finale</span><span class="sxs-lookup"><span data-stu-id="ab2c8-666">Strip trailing slash</span></span> | `(.*)/$`<br>`/path/` | `$1`<br>`/path` |
| <span data-ttu-id="ab2c8-667">Appliquer une barre oblique finale</span><span class="sxs-lookup"><span data-stu-id="ab2c8-667">Enforce trailing slash</span></span> | `(.*[^/])$`<br>`/path` | `$1/`<br>`/path/` |
| <span data-ttu-id="ab2c8-668">Éviter la réécriture des requêtes spécifiques</span><span class="sxs-lookup"><span data-stu-id="ab2c8-668">Avoid rewriting specific requests</span></span> | <span data-ttu-id="ab2c8-669">`^(.*)(?<!\.axd)$` ou `^(?!.*\.axd$)(.*)$`</span><span class="sxs-lookup"><span data-stu-id="ab2c8-669">`^(.*)(?<!\.axd)$` or `^(?!.*\.axd$)(.*)$`</span></span><br><span data-ttu-id="ab2c8-670">Oui : `/resource.htm`</span><span class="sxs-lookup"><span data-stu-id="ab2c8-670">Yes: `/resource.htm`</span></span><br><span data-ttu-id="ab2c8-671">Non : `/resource.axd`</span><span class="sxs-lookup"><span data-stu-id="ab2c8-671">No: `/resource.axd`</span></span> | `rewritten/$1`<br>`/rewritten/resource.htm`<br>`/resource.axd` |
| <span data-ttu-id="ab2c8-672">Réorganiser les segments d’URL</span><span class="sxs-lookup"><span data-stu-id="ab2c8-672">Rearrange URL segments</span></span> | `path/(.*)/(.*)/(.*)`<br>`path/1/2/3` | `path/$3/$2/$1`<br>`path/3/2/1` |
| <span data-ttu-id="ab2c8-673">Remplacer un segment d’URL</span><span class="sxs-lookup"><span data-stu-id="ab2c8-673">Replace a URL segment</span></span> | `^(.*)/segment2/(.*)`<br>`/segment1/segment2/segment3` | `$1/replaced/$2`<br>`/segment1/replaced/segment3` |

::: moniker-end

## <a name="additional-resources"></a><span data-ttu-id="ab2c8-674">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="ab2c8-674">Additional resources</span></span>

* <xref:fundamentals/startup>
* <xref:fundamentals/middleware/index>
* [<span data-ttu-id="ab2c8-675">Expressions régulières dans .NET</span><span class="sxs-lookup"><span data-stu-id="ab2c8-675">Regular expressions in .NET</span></span>](/dotnet/articles/standard/base-types/regular-expressions)
* [<span data-ttu-id="ab2c8-676">Langage des expressions régulières-aide-mémoire</span><span class="sxs-lookup"><span data-stu-id="ab2c8-676">Regular expression language - quick reference</span></span>](/dotnet/articles/standard/base-types/quick-ref)
* [<span data-ttu-id="ab2c8-677">Apache mod_rewrite</span><span class="sxs-lookup"><span data-stu-id="ab2c8-677">Apache mod_rewrite</span></span>](https://httpd.apache.org/docs/2.4/rewrite/)
* [<span data-ttu-id="ab2c8-678">Utilisation du module de réécriture d’URL 2.0 (pour IIS)</span><span class="sxs-lookup"><span data-stu-id="ab2c8-678">Using Url Rewrite Module 2.0 (for IIS)</span></span>](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20)
* [<span data-ttu-id="ab2c8-679">Informations de référence sur la configuration du module de réécriture d’URL</span><span class="sxs-lookup"><span data-stu-id="ab2c8-679">URL Rewrite Module Configuration Reference</span></span>](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference)
* [<span data-ttu-id="ab2c8-680">Forum du module de réécriture d’URL IIS</span><span class="sxs-lookup"><span data-stu-id="ab2c8-680">IIS URL Rewrite Module Forum</span></span>](https://forums.iis.net/1152.aspx)
* [<span data-ttu-id="ab2c8-681">Maintenir une structure d’URL simple</span><span class="sxs-lookup"><span data-stu-id="ab2c8-681">Keep a simple URL structure</span></span>](https://support.google.com/webmasters/answer/76329?hl=en)
* [<span data-ttu-id="ab2c8-682">10 conseils et astuces pour la réécriture d’URL</span><span class="sxs-lookup"><span data-stu-id="ab2c8-682">10 URL Rewriting Tips and Tricks</span></span>](https://ruslany.net/2009/04/10-url-rewriting-tips-and-tricks/)
* [<span data-ttu-id="ab2c8-683">Mettre ou ne pas mettre une barre oblique</span><span class="sxs-lookup"><span data-stu-id="ab2c8-683">To slash or not to slash</span></span>](https://webmasters.googleblog.com/2010/04/to-slash-or-not-to-slash.html)
