---
title: Implémentation du serveur web HTTP.sys dans ASP.NET Core
author: guardrex
description: Découvrez HTTP.sys, un serveur web pour ASP.NET Core sous Windows. Basé sur le pilote en mode noyau HTTP.sys, HTTP.sys est une solution qui permet d’établir une connexion directe à Internet sans IIS ni Kestrel.
monikerRange: '>= aspnetcore-2.0'
ms.author: tdykstra
ms.custom: mvc
ms.date: 12/18/2018
uid: fundamentals/servers/httpsys
ms.openlocfilehash: a779fee53109d4c1cabb2005896e757f23467540
ms.sourcegitcommit: 816f39e852a8f453e8682081871a31bc66db153a
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/19/2018
ms.locfileid: "53637623"
---
# <a name="httpsys-web-server-implementation-in-aspnet-core"></a><span data-ttu-id="927dc-104">Implémentation du serveur web HTTP.sys dans ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="927dc-104">HTTP.sys web server implementation in ASP.NET Core</span></span>

<span data-ttu-id="927dc-105">[Tom Dykstra](https://github.com/tdykstra), [Chris Ross](https://github.com/Tratcher) et [Luke Latham](https://github.com/guardrex)</span><span class="sxs-lookup"><span data-stu-id="927dc-105">By [Tom Dykstra](https://github.com/tdykstra), [Chris Ross](https://github.com/Tratcher), and [Luke Latham](https://github.com/guardrex)</span></span>

<span data-ttu-id="927dc-106">[HTTP.sys](/iis/get-started/introduction-to-iis/introduction-to-iis-architecture#hypertext-transfer-protocol-stack-httpsys) est un [serveur web pour ASP.NET Core](xref:fundamentals/servers/index) qui s’exécute uniquement sous Windows.</span><span class="sxs-lookup"><span data-stu-id="927dc-106">[HTTP.sys](/iis/get-started/introduction-to-iis/introduction-to-iis-architecture#hypertext-transfer-protocol-stack-httpsys) is a [web server for ASP.NET Core](xref:fundamentals/servers/index) that only runs on Windows.</span></span> <span data-ttu-id="927dc-107">HTTP.sys est une alternative au serveur [Kestrel](xref:fundamentals/servers/kestrel) et offre des fonctionnalités supplémentaires par rapport à celui-ci.</span><span class="sxs-lookup"><span data-stu-id="927dc-107">HTTP.sys is an alternative to [Kestrel](xref:fundamentals/servers/kestrel) server and offers some features that Kestrel doesn't provide.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="927dc-108">HTTP.sys est incompatible avec le [Module ASP.NET Core](xref:host-and-deploy/aspnet-core-module) et n’est pas utilisable avec IIS ni IIS Express.</span><span class="sxs-lookup"><span data-stu-id="927dc-108">HTTP.sys is incompatible with the [ASP.NET Core Module](xref:host-and-deploy/aspnet-core-module) and can't be used with IIS or IIS Express.</span></span>

<span data-ttu-id="927dc-109">HTTP.sys prend en charge les fonctionnalités suivantes :</span><span class="sxs-lookup"><span data-stu-id="927dc-109">HTTP.sys supports the following features:</span></span>

* [<span data-ttu-id="927dc-110">Authentification Windows</span><span class="sxs-lookup"><span data-stu-id="927dc-110">Windows Authentication</span></span>](xref:security/authentication/windowsauth)
* <span data-ttu-id="927dc-111">Partage de port</span><span class="sxs-lookup"><span data-stu-id="927dc-111">Port sharing</span></span>
* <span data-ttu-id="927dc-112">HTTPS avec SNI</span><span class="sxs-lookup"><span data-stu-id="927dc-112">HTTPS with SNI</span></span>
* <span data-ttu-id="927dc-113">HTTP/2 sur TLS (Windows 10 et versions ultérieures)</span><span class="sxs-lookup"><span data-stu-id="927dc-113">HTTP/2 over TLS (Windows 10 or later)</span></span>
* <span data-ttu-id="927dc-114">Transmission de fichier directe</span><span class="sxs-lookup"><span data-stu-id="927dc-114">Direct file transmission</span></span>
* <span data-ttu-id="927dc-115">Mise en cache des réponses</span><span class="sxs-lookup"><span data-stu-id="927dc-115">Response caching</span></span>
* <span data-ttu-id="927dc-116">WebSockets (Windows 8 et versions ultérieures)</span><span class="sxs-lookup"><span data-stu-id="927dc-116">WebSockets (Windows 8 or later)</span></span>

<span data-ttu-id="927dc-117">Versions Windows prises en charge :</span><span class="sxs-lookup"><span data-stu-id="927dc-117">Supported Windows versions:</span></span>

* <span data-ttu-id="927dc-118">Windows 7 ou version ultérieure</span><span class="sxs-lookup"><span data-stu-id="927dc-118">Windows 7 or later</span></span>
* <span data-ttu-id="927dc-119">Windows Server 2008 R2 ou une version ultérieure</span><span class="sxs-lookup"><span data-stu-id="927dc-119">Windows Server 2008 R2 or later</span></span>

<span data-ttu-id="927dc-120">[Affichez ou téléchargez l’exemple de code](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/servers/httpsys/sample) ([procédure de téléchargement](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="927dc-120">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/servers/httpsys/sample) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="when-to-use-httpsys"></a><span data-ttu-id="927dc-121">Quand utiliser HTTP.sys</span><span class="sxs-lookup"><span data-stu-id="927dc-121">When to use HTTP.sys</span></span>

<span data-ttu-id="927dc-122">HTTP.sys est utile pour les déploiements lorsque :</span><span class="sxs-lookup"><span data-stu-id="927dc-122">HTTP.sys is useful for deployments where:</span></span>

* <span data-ttu-id="927dc-123">Il est nécessaire d’exposer directement le serveur à Internet sans passer par IIS.</span><span class="sxs-lookup"><span data-stu-id="927dc-123">There's a need to expose the server directly to the Internet without using IIS.</span></span>

  ![HTTP.sys communique directement avec Internet](httpsys/_static/httpsys-to-internet.png)

* <span data-ttu-id="927dc-125">Un déploiement interne implique une fonctionnalité qui n’est pas disponible dans Kestrel, par exemple, [l’authentification Windows](xref:security/authentication/windowsauth).</span><span class="sxs-lookup"><span data-stu-id="927dc-125">An internal deployment requires a feature not available in Kestrel, such as [Windows Authentication](xref:security/authentication/windowsauth).</span></span>

  ![HTTP.sys communique directement avec le réseau interne](httpsys/_static/httpsys-to-internal.png)

<span data-ttu-id="927dc-127">HTTP.sys est une technologie aboutie qui assure une protection contre de nombreux types d’attaques et offre la robustesse, la sécurité et l’extensibilité d’un serveur web haut de gamme.</span><span class="sxs-lookup"><span data-stu-id="927dc-127">HTTP.sys is mature technology that protects against many types of attacks and provides the robustness, security, and scalability of a full-featured web server.</span></span> <span data-ttu-id="927dc-128">Pour sa part, IIS s’exécute en tant qu’écouteur HTTP sur HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="927dc-128">IIS itself runs as an HTTP listener on top of HTTP.sys.</span></span>

## <a name="http2-support"></a><span data-ttu-id="927dc-129">Prise en charge de HTTP/2</span><span class="sxs-lookup"><span data-stu-id="927dc-129">HTTP/2 support</span></span>

<span data-ttu-id="927dc-130">[HTTP/2](https://httpwg.org/specs/rfc7540.html) est activé pour les applications ASP.NET Core si les conditions de base suivantes sont remplies :</span><span class="sxs-lookup"><span data-stu-id="927dc-130">[HTTP/2](https://httpwg.org/specs/rfc7540.html) is enabled for ASP.NET Core apps if the following base requirements are met:</span></span>

* <span data-ttu-id="927dc-131">Windows Server 2016/Windows 10 ou version ultérieure</span><span class="sxs-lookup"><span data-stu-id="927dc-131">Windows Server 2016/Windows 10 or later</span></span>
* <span data-ttu-id="927dc-132">Connexion [ALPN (Application-Layer Protocol Negotiation)](https://tools.ietf.org/html/rfc7301#section-3)</span><span class="sxs-lookup"><span data-stu-id="927dc-132">[Application-Layer Protocol Negotiation (ALPN)](https://tools.ietf.org/html/rfc7301#section-3) connection</span></span>
* <span data-ttu-id="927dc-133">TLS 1.2 ou connexion ultérieure</span><span class="sxs-lookup"><span data-stu-id="927dc-133">TLS 1.2 or later connection</span></span>

::: moniker range=">= aspnetcore-2.2"

<span data-ttu-id="927dc-134">Si une connexion HTTP/2 est établie, [HttpRequest.Protocol](xref:Microsoft.AspNetCore.Http.HttpRequest.Protocol*) retourne `HTTP/2`.</span><span class="sxs-lookup"><span data-stu-id="927dc-134">If an HTTP/2 connection is established, [HttpRequest.Protocol](xref:Microsoft.AspNetCore.Http.HttpRequest.Protocol*) reports `HTTP/2`.</span></span>

::: moniker-end

::: moniker range="< aspnetcore-2.2"

<span data-ttu-id="927dc-135">Si une connexion HTTP/2 est établie, [HttpRequest.Protocol](xref:Microsoft.AspNetCore.Http.HttpRequest.Protocol*) retourne `HTTP/1.1`.</span><span class="sxs-lookup"><span data-stu-id="927dc-135">If an HTTP/2 connection is established, [HttpRequest.Protocol](xref:Microsoft.AspNetCore.Http.HttpRequest.Protocol*) reports `HTTP/1.1`.</span></span>

::: moniker-end

<span data-ttu-id="927dc-136">HTTP/2 est activé par défaut.</span><span class="sxs-lookup"><span data-stu-id="927dc-136">HTTP/2 is enabled by default.</span></span> <span data-ttu-id="927dc-137">Si une connexion HTTP/2 n’est pas établie, la connexion revient à HTTP/1.1.</span><span class="sxs-lookup"><span data-stu-id="927dc-137">If an HTTP/2 connection isn't established, the connection falls back to HTTP/1.1.</span></span> <span data-ttu-id="927dc-138">Dans une prochaine version de Windows, les indicateurs de configuration HTTP/2 seront disponibles, y compris la possibilité de désactivation de HTTP/2 avec HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="927dc-138">In a future release of Windows, HTTP/2 configuration flags will be available, including the ability to disable HTTP/2 with HTTP.sys.</span></span>

## <a name="kernel-mode-authentication-with-kerberos"></a><span data-ttu-id="927dc-139">Authentification en mode noyau avec Kerberos</span><span class="sxs-lookup"><span data-stu-id="927dc-139">Kernel mode authentication with Kerberos</span></span>

<span data-ttu-id="927dc-140">HTTP.sys délègue l’authentification en mode noyau avec le protocole d’authentification Kerberos.</span><span class="sxs-lookup"><span data-stu-id="927dc-140">HTTP.sys delegates to kernel mode authentication with the Kerberos authentication protocol.</span></span> <span data-ttu-id="927dc-141">L’authentification en mode utilisateur n’est pas prise en charge avec Kerberos et HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="927dc-141">User mode authentication isn't supported with Kerberos and HTTP.sys.</span></span> <span data-ttu-id="927dc-142">Le compte d’ordinateur doit être utilisé pour déchiffrer le ticket/jeton Kerberos obtenu à partir d’Active Directory et transféré par le client au serveur afin d’authentifier l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="927dc-142">The machine account must be used to decrypt the Kerberos token/ticket that's obtained from Active Directory and forwarded by the client to the server to authenticate the user.</span></span> <span data-ttu-id="927dc-143">Inscrivez le nom de principal du service (SPN) pour l’hôte, et non l’utilisateur de l’application.</span><span class="sxs-lookup"><span data-stu-id="927dc-143">Register the Service Principal Name (SPN) for the host, not the user of the app.</span></span>

## <a name="how-to-use-httpsys"></a><span data-ttu-id="927dc-144">Comment utiliser HTTP.sys</span><span class="sxs-lookup"><span data-stu-id="927dc-144">How to use HTTP.sys</span></span>

### <a name="configure-the-aspnet-core-app-to-use-httpsys"></a><span data-ttu-id="927dc-145">Configurer l’application ASP.NET Core afin d’utiliser HTTP.sys</span><span class="sxs-lookup"><span data-stu-id="927dc-145">Configure the ASP.NET Core app to use HTTP.sys</span></span>

1. <span data-ttu-id="927dc-146">Il n’est pas nécessaire d’ajouter une référence de package dans le fichier projet dès lors que le [métapaquet Microsoft.AspNetCore.App](xref:fundamentals/metapackage-app) ([nuget.org](https://www.nuget.org/packages/Microsoft.AspNetCore.App/)) est utilisé (ASP.NET Core 2.1 ou ultérieur).</span><span class="sxs-lookup"><span data-stu-id="927dc-146">A package reference in the project file isn't required when using the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) ([nuget.org](https://www.nuget.org/packages/Microsoft.AspNetCore.App/)) (ASP.NET Core 2.1 or later).</span></span> <span data-ttu-id="927dc-147">Si vous n'utilisez pas le métapaquet `Microsoft.AspNetCore.App`, ajoutez une référence de package à [Microsoft.AspNetCore.Server.HttpSys](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.HttpSys/).</span><span class="sxs-lookup"><span data-stu-id="927dc-147">When not using the `Microsoft.AspNetCore.App` metapackage, add a package reference to [Microsoft.AspNetCore.Server.HttpSys](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.HttpSys/).</span></span>

2. <span data-ttu-id="927dc-148">Appelez la méthode d’extension [UseHttpSys](/dotnet/api/microsoft.aspnetcore.hosting.webhostbuilderhttpsysextensions.usehttpsys) au moment de générer l’hôte web, en spécifiant les [options HTTP.sys](/dotnet/api/microsoft.aspnetcore.server.httpsys.httpsysoptions) requises :</span><span class="sxs-lookup"><span data-stu-id="927dc-148">Call the [UseHttpSys](/dotnet/api/microsoft.aspnetcore.hosting.webhostbuilderhttpsysextensions.usehttpsys) extension method when building the web host, specifying any required [HTTP.sys options](/dotnet/api/microsoft.aspnetcore.server.httpsys.httpsysoptions):</span></span>

   [!code-csharp[](httpsys/sample/Program.cs?name=snippet1&highlight=4-12)]

   <span data-ttu-id="927dc-149">Le reste de la configuration de HTTP.sys est géré par le biais des [paramètres du Registre](https://support.microsoft.com/help/820129/http-sys-registry-settings-for-windows).</span><span class="sxs-lookup"><span data-stu-id="927dc-149">Additional HTTP.sys configuration is handled through [registry settings](https://support.microsoft.com/help/820129/http-sys-registry-settings-for-windows).</span></span>

   <span data-ttu-id="927dc-150">**Options HTTP.sys**</span><span class="sxs-lookup"><span data-stu-id="927dc-150">**HTTP.sys options**</span></span>

   | <span data-ttu-id="927dc-151">Property</span><span class="sxs-lookup"><span data-stu-id="927dc-151">Property</span></span> | <span data-ttu-id="927dc-152">Description</span><span class="sxs-lookup"><span data-stu-id="927dc-152">Description</span></span> | <span data-ttu-id="927dc-153">Par défaut</span><span class="sxs-lookup"><span data-stu-id="927dc-153">Default</span></span> |
   | -------- | ----------- | :-----: |
   | [<span data-ttu-id="927dc-154">AllowSynchronousIO</span><span class="sxs-lookup"><span data-stu-id="927dc-154">AllowSynchronousIO</span></span>](/dotnet/api/microsoft.aspnetcore.server.httpsys.httpsysoptions.allowsynchronousio) | <span data-ttu-id="927dc-155">Contrôle si l’entrée/sortie synchrone est autorisée pour le `HttpContext.Request.Body` et le `HttpContext.Response.Body`.</span><span class="sxs-lookup"><span data-stu-id="927dc-155">Control whether synchronous input/output is allowed for the `HttpContext.Request.Body` and `HttpContext.Response.Body`.</span></span> | `true` |
   | [<span data-ttu-id="927dc-156">Authentication.AllowAnonymous</span><span class="sxs-lookup"><span data-stu-id="927dc-156">Authentication.AllowAnonymous</span></span>](/dotnet/api/microsoft.aspnetcore.server.httpsys.authenticationmanager.allowanonymous) | <span data-ttu-id="927dc-157">Autorise les requêtes anonymes.</span><span class="sxs-lookup"><span data-stu-id="927dc-157">Allow anonymous requests.</span></span> | `true` |
   | [<span data-ttu-id="927dc-158">Authentication.Schemes</span><span class="sxs-lookup"><span data-stu-id="927dc-158">Authentication.Schemes</span></span>](/dotnet/api/microsoft.aspnetcore.server.httpsys.authenticationmanager.schemes) | <span data-ttu-id="927dc-159">Spécifie les schémas d’authentification autorisés.</span><span class="sxs-lookup"><span data-stu-id="927dc-159">Specify the allowed authentication schemes.</span></span> <span data-ttu-id="927dc-160">Peut être modifié à tout moment avant la suppression de l’écouteur.</span><span class="sxs-lookup"><span data-stu-id="927dc-160">May be modified at any time prior to disposing the listener.</span></span> <span data-ttu-id="927dc-161">Les valeurs sont fournies par [l’enum AuthenticationSchemes](/dotnet/api/microsoft.aspnetcore.server.httpsys.authenticationschemes) : `Basic`, `Kerberos`, `Negotiate`, `None` et `NTLM`.</span><span class="sxs-lookup"><span data-stu-id="927dc-161">Values are provided by the [AuthenticationSchemes enum](/dotnet/api/microsoft.aspnetcore.server.httpsys.authenticationschemes): `Basic`, `Kerberos`, `Negotiate`, `None`, and `NTLM`.</span></span> | `None` |
   | [<span data-ttu-id="927dc-162">EnableResponseCaching</span><span class="sxs-lookup"><span data-stu-id="927dc-162">EnableResponseCaching</span></span>](/dotnet/api/microsoft.aspnetcore.server.httpsys.httpsysoptions.enableresponsecaching) | <span data-ttu-id="927dc-163">Tente la mise en cache [en mode noyau](/windows-hardware/drivers/gettingstarted/user-mode-and-kernel-mode) pour les réponses comportant un en-tête compatible.</span><span class="sxs-lookup"><span data-stu-id="927dc-163">Attempt [kernel-mode](/windows-hardware/drivers/gettingstarted/user-mode-and-kernel-mode) caching for responses with eligible headers.</span></span> <span data-ttu-id="927dc-164">La réponse peut ne pas inclure d’en-tête `Set-Cookie`, `Vary` ou `Pragma`.</span><span class="sxs-lookup"><span data-stu-id="927dc-164">The response may not include `Set-Cookie`, `Vary`, or `Pragma` headers.</span></span> <span data-ttu-id="927dc-165">Elle doit comporter un en-tête `Cache-Control` `public` et soit une valeur `shared-max-age` ou `max-age`, soit un en-tête `Expires`.</span><span class="sxs-lookup"><span data-stu-id="927dc-165">It must include a `Cache-Control` header that's `public` and either a `shared-max-age` or `max-age` value, or an `Expires` header.</span></span> | `true` |
   | [<span data-ttu-id="927dc-166">MaxAccepts</span><span class="sxs-lookup"><span data-stu-id="927dc-166">MaxAccepts</span></span>](/dotnet/api/microsoft.aspnetcore.server.httpsys.httpsysoptions.maxaccepts) | <span data-ttu-id="927dc-167">Nombre maximal d'acceptations simultanées.</span><span class="sxs-lookup"><span data-stu-id="927dc-167">The maximum number of concurrent accepts.</span></span> | <span data-ttu-id="927dc-168">5 &times; [Environment.<br>ProcessorCount](/dotnet/api/system.environment.processorcount)</span><span class="sxs-lookup"><span data-stu-id="927dc-168">5 &times; [Environment.<br>ProcessorCount](/dotnet/api/system.environment.processorcount)</span></span> |
   | [<span data-ttu-id="927dc-169">MaxConnections</span><span class="sxs-lookup"><span data-stu-id="927dc-169">MaxConnections</span></span>](/dotnet/api/microsoft.aspnetcore.server.httpsys.httpsysoptions.maxconnections) | <span data-ttu-id="927dc-170">Nombre maximum de connexions simultanées à accepter.</span><span class="sxs-lookup"><span data-stu-id="927dc-170">The maximum number of concurrent connections to accept.</span></span> <span data-ttu-id="927dc-171">Utilisez `-1` pour signifier l’infini,</span><span class="sxs-lookup"><span data-stu-id="927dc-171">Use `-1` for infinite.</span></span> <span data-ttu-id="927dc-172">et `null` pour utiliser le paramètre du Registre qui s’applique à l’ordinateur dans son ensemble.</span><span class="sxs-lookup"><span data-stu-id="927dc-172">Use `null` to use the registry's machine-wide setting.</span></span> | `null`<br><span data-ttu-id="927dc-173">(illimité)</span><span class="sxs-lookup"><span data-stu-id="927dc-173">(unlimited)</span></span> |
   | [<span data-ttu-id="927dc-174">MaxRequestBodySize</span><span class="sxs-lookup"><span data-stu-id="927dc-174">MaxRequestBodySize</span></span>](/dotnet/api/microsoft.aspnetcore.server.httpsys.httpsysoptions.maxrequestbodysize) | <span data-ttu-id="927dc-175">Consultez la section <a href="#maxrequestbodysize">MaxRequestBodySize</a>.</span><span class="sxs-lookup"><span data-stu-id="927dc-175">See the <a href="#maxrequestbodysize">MaxRequestBodySize</a> section.</span></span> | <span data-ttu-id="927dc-176">30 000 000 octets</span><span class="sxs-lookup"><span data-stu-id="927dc-176">30000000 bytes</span></span><br><span data-ttu-id="927dc-177">(env. 28,6 Mo)</span><span class="sxs-lookup"><span data-stu-id="927dc-177">(~28.6 MB)</span></span> |
   | [<span data-ttu-id="927dc-178">RequestQueueLimit</span><span class="sxs-lookup"><span data-stu-id="927dc-178">RequestQueueLimit</span></span>](/dotnet/api/microsoft.aspnetcore.server.httpsys.httpsysoptions.requestqueuelimit) | <span data-ttu-id="927dc-179">Nombre maximal de demandes pouvant être placées en file d'attente.</span><span class="sxs-lookup"><span data-stu-id="927dc-179">The maximum number of requests that can be queued.</span></span> | <span data-ttu-id="927dc-180">1000</span><span class="sxs-lookup"><span data-stu-id="927dc-180">1000</span></span> |
   | [<span data-ttu-id="927dc-181">ThrowWriteExceptions</span><span class="sxs-lookup"><span data-stu-id="927dc-181">ThrowWriteExceptions</span></span>](/dotnet/api/microsoft.aspnetcore.server.httpsys.httpsysoptions.throwwriteexceptions) | <span data-ttu-id="927dc-182">Indique si les écritures dans le corps de la réponse qui échouent en raison d’une déconnexion du client doivent lever des exceptions ou se terminer normalement.</span><span class="sxs-lookup"><span data-stu-id="927dc-182">Indicate if response body writes that fail due to client disconnects should throw exceptions or complete normally.</span></span> | `false`<br><span data-ttu-id="927dc-183">(se terminer normalement)</span><span class="sxs-lookup"><span data-stu-id="927dc-183">(complete normally)</span></span> |
   | [<span data-ttu-id="927dc-184">Timeouts</span><span class="sxs-lookup"><span data-stu-id="927dc-184">Timeouts</span></span>](/dotnet/api/microsoft.aspnetcore.server.httpsys.httpsysoptions.timeouts) | <span data-ttu-id="927dc-185">Expose la configuration [TimeoutManager](/dotnet/api/microsoft.aspnetcore.server.httpsys.timeoutmanager) de HTTP.sys, également paramétrable dans le Registre.</span><span class="sxs-lookup"><span data-stu-id="927dc-185">Expose the HTTP.sys [TimeoutManager](/dotnet/api/microsoft.aspnetcore.server.httpsys.timeoutmanager) configuration, which may also be configured in the registry.</span></span> <span data-ttu-id="927dc-186">Suivez les liens de l’API pour en savoir plus sur chaque paramètre, y compris les valeurs par défaut :</span><span class="sxs-lookup"><span data-stu-id="927dc-186">Follow the API links to learn more about each setting, including default values:</span></span><ul><li><span data-ttu-id="927dc-187">[TimeoutManager.DrainEntityBody](/dotnet/api/microsoft.aspnetcore.server.httpsys.timeoutmanager.drainentitybody) &ndash; Temps alloué à l’API de serveur HTTP pour décharger le corps de l’entité sur une connexion persistante.</span><span class="sxs-lookup"><span data-stu-id="927dc-187">[TimeoutManager.DrainEntityBody](/dotnet/api/microsoft.aspnetcore.server.httpsys.timeoutmanager.drainentitybody) &ndash; Time allowed for the HTTP Server API to drain the entity body on a Keep-Alive connection.</span></span></li><li><span data-ttu-id="927dc-188">[TimeoutManager.EntityBody](/dotnet/api/microsoft.aspnetcore.server.httpsys.timeoutmanager.entitybody) &ndash; Temps alloué pour que le corps de l'entité de la requête arrive.</span><span class="sxs-lookup"><span data-stu-id="927dc-188">[TimeoutManager.EntityBody](/dotnet/api/microsoft.aspnetcore.server.httpsys.timeoutmanager.entitybody) &ndash; Time allowed for the request entity body to arrive.</span></span></li><li><span data-ttu-id="927dc-189">[TimeoutManager.HeaderWait](/dotnet/api/microsoft.aspnetcore.server.httpsys.timeoutmanager.headerwait) &ndash; Temps alloué à l’API de serveur HTTP pour analyser l’en-tête de la requête.</span><span class="sxs-lookup"><span data-stu-id="927dc-189">[TimeoutManager.HeaderWait](/dotnet/api/microsoft.aspnetcore.server.httpsys.timeoutmanager.headerwait) &ndash; Time allowed for the HTTP Server API to parse the request header.</span></span></li><li><span data-ttu-id="927dc-190">[TimeoutManager.IdleConnection](/dotnet/api/microsoft.aspnetcore.server.httpsys.timeoutmanager.idleconnection) &ndash; Temps alloué pour une connexion inactive.</span><span class="sxs-lookup"><span data-stu-id="927dc-190">[TimeoutManager.IdleConnection](/dotnet/api/microsoft.aspnetcore.server.httpsys.timeoutmanager.idleconnection) &ndash; Time allowed for an idle connection.</span></span></li><li><span data-ttu-id="927dc-191">[TimeoutManager.MinSendBytesPerSecond](/dotnet/api/microsoft.aspnetcore.server.httpsys.timeoutmanager.minsendbytespersecond) &ndash; Taux d’envoi minimal de la réponse.</span><span class="sxs-lookup"><span data-stu-id="927dc-191">[TimeoutManager.MinSendBytesPerSecond](/dotnet/api/microsoft.aspnetcore.server.httpsys.timeoutmanager.minsendbytespersecond) &ndash; The minimum send rate for the response.</span></span></li><li><span data-ttu-id="927dc-192">[TimeoutManager.RequestQueue](/dotnet/api/microsoft.aspnetcore.server.httpsys.timeoutmanager.requestqueue) &ndash; Temps alloué à la demande pour rester dans la file d’attente des requêtes avant que l’application ne la récupère.</span><span class="sxs-lookup"><span data-stu-id="927dc-192">[TimeoutManager.RequestQueue](/dotnet/api/microsoft.aspnetcore.server.httpsys.timeoutmanager.requestqueue) &ndash; Time allowed for the request to remain in the request queue before the app picks it up.</span></span></li></ul> |  |
   | [<span data-ttu-id="927dc-193">UrlPrefixes</span><span class="sxs-lookup"><span data-stu-id="927dc-193">UrlPrefixes</span></span>](/dotnet/api/microsoft.aspnetcore.server.httpsys.httpsysoptions.urlprefixes) | <span data-ttu-id="927dc-194">Spécifiez la [UrlPrefixCollection](/dotnet/api/microsoft.aspnetcore.server.httpsys.urlprefixcollection) à inscrire auprès de HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="927dc-194">Specify the [UrlPrefixCollection](/dotnet/api/microsoft.aspnetcore.server.httpsys.urlprefixcollection) to register with HTTP.sys.</span></span> <span data-ttu-id="927dc-195">La plus utile est [UrlPrefixCollection.Add](/dotnet/api/microsoft.aspnetcore.server.httpsys.urlprefixcollection.add), qui permet d’ajouter un préfixe à la collection.</span><span class="sxs-lookup"><span data-stu-id="927dc-195">The most useful is [UrlPrefixCollection.Add](/dotnet/api/microsoft.aspnetcore.server.httpsys.urlprefixcollection.add), which is used to add a prefix to the collection.</span></span> <span data-ttu-id="927dc-196">Ces choix peuvent être modifiés à tout moment avant la suppression de l’écouteur.</span><span class="sxs-lookup"><span data-stu-id="927dc-196">These may be modified at any time prior to disposing the listener.</span></span> |  |

   <a name="maxrequestbodysize"></a>
   <span data-ttu-id="927dc-197">**MaxRequestBodySize**</span><span class="sxs-lookup"><span data-stu-id="927dc-197">**MaxRequestBodySize**</span></span>

   <span data-ttu-id="927dc-198">Taille maximale autorisée pour le corps d’une demande, en octets.</span><span class="sxs-lookup"><span data-stu-id="927dc-198">The maximum allowed size of any request body in bytes.</span></span> <span data-ttu-id="927dc-199">Lorsque la valeur est `null`, elle est illimitée.</span><span class="sxs-lookup"><span data-stu-id="927dc-199">When set to `null`, the maximum request body size is unlimited.</span></span> <span data-ttu-id="927dc-200">Cette limite est sans effet sur les connexions mises à niveau, qui sont illimitées.</span><span class="sxs-lookup"><span data-stu-id="927dc-200">This limit has no effect on upgraded connections, which are always unlimited.</span></span>

   <span data-ttu-id="927dc-201">Pour remplacer la limite d’un seul `IActionResult` dans une application MVC ASP.NET Core, nous vous recommandons d’utiliser l’attribut [RequestSizeLimitAttribute](/dotnet/api/microsoft.aspnetcore.mvc.requestsizelimitattribute) sur une méthode d’action :</span><span class="sxs-lookup"><span data-stu-id="927dc-201">The recommended method to override the limit in an ASP.NET Core MVC app for a single `IActionResult` is to use the [RequestSizeLimitAttribute](/dotnet/api/microsoft.aspnetcore.mvc.requestsizelimitattribute) attribute on an action method:</span></span>

   ```csharp
   [RequestSizeLimit(100000000)]
   public IActionResult MyActionMethod()
   ```

   <span data-ttu-id="927dc-202">Une exception est levée si l’application tente de configurer la limite sur une demande dont l’application a commencé la lecture.</span><span class="sxs-lookup"><span data-stu-id="927dc-202">An exception is thrown if the app attempts to configure the limit on a request after the app has started reading the request.</span></span> <span data-ttu-id="927dc-203">La propriété `IsReadOnly` indique si la propriété `MaxRequestBodySize` est en lecture seule, et donc s’il est trop tard pour configurer la limite.</span><span class="sxs-lookup"><span data-stu-id="927dc-203">An `IsReadOnly` property can be used to indicate if the `MaxRequestBodySize` property is in a read-only state, meaning it's too late to configure the limit.</span></span>

   <span data-ttu-id="927dc-204">Si l’application doit remplacer [MaxRequestBodySize](/dotnet/api/microsoft.aspnetcore.server.httpsys.httpsysoptions.maxrequestbodysize) demande par demande, utilisez [IHttpMaxRequestBodySizeFeature](/dotnet/api/microsoft.aspnetcore.http.features.ihttpmaxrequestbodysizefeature) :</span><span class="sxs-lookup"><span data-stu-id="927dc-204">If the app should override [MaxRequestBodySize](/dotnet/api/microsoft.aspnetcore.server.httpsys.httpsysoptions.maxrequestbodysize) per-request, use the [IHttpMaxRequestBodySizeFeature](/dotnet/api/microsoft.aspnetcore.http.features.ihttpmaxrequestbodysizefeature):</span></span>

   [!code-csharp[](httpsys/sample/Startup.cs?name=snippet1&highlight=6-7)]

3. <span data-ttu-id="927dc-205">Si vous utilisez Visual Studio, vérifiez que l’application n’est pas configurée pour exécuter IIS ou IIS Express.</span><span class="sxs-lookup"><span data-stu-id="927dc-205">If using Visual Studio, make sure the app isn't configured to run IIS or IIS Express.</span></span>

   <span data-ttu-id="927dc-206">Dans Visual Studio, le profil de démarrage par défaut est destiné à IIS Express.</span><span class="sxs-lookup"><span data-stu-id="927dc-206">In Visual Studio, the default launch profile is for IIS Express.</span></span> <span data-ttu-id="927dc-207">Pour exécuter le projet en tant qu’application console, changez manuellement le profil sélectionné, comme dans la capture d’écran suivante :</span><span class="sxs-lookup"><span data-stu-id="927dc-207">To run the project as a console app, manually change the selected profile, as shown in the following screen shot:</span></span>

   ![Sélectionner le profil d’application console](httpsys/_static/vs-choose-profile.png)

### <a name="configure-windows-server"></a><span data-ttu-id="927dc-209">Configurer Windows Server</span><span class="sxs-lookup"><span data-stu-id="927dc-209">Configure Windows Server</span></span>

1. <span data-ttu-id="927dc-210">Si l’application est un [déploiement dépendant de .NET Framework](/dotnet/core/deploying/#framework-dependent-deployments-fdd), installez .NET Core, .NET Framework ou les deux (si l’application est une application .NET Core ciblant .NET Framework).</span><span class="sxs-lookup"><span data-stu-id="927dc-210">If the app is a [framework-dependent deployment](/dotnet/core/deploying/#framework-dependent-deployments-fdd), install .NET Core, .NET Framework, or both (if the app is a .NET Core app targeting the .NET Framework).</span></span>

   * <span data-ttu-id="927dc-211">**.NET Core** &ndash; Si l’application nécessite .NET Core, procurez-vous et exécutez le programme d’installation de .NET Core sur [Tous les téléchargements .NET](https://www.microsoft.com/net/download/all).</span><span class="sxs-lookup"><span data-stu-id="927dc-211">**.NET Core** &ndash; If the app requires .NET Core, obtain and run the .NET Core installer from [.NET All Downloads](https://www.microsoft.com/net/download/all).</span></span>
   * <span data-ttu-id="927dc-212">**.NET framework** &ndash; Si l’application nécessite .NET Framework, consultez [.NET Framework : Guide d’installation](/dotnet/framework/install/) pour obtenir les instructions d’installation.</span><span class="sxs-lookup"><span data-stu-id="927dc-212">**.NET Framework** &ndash; If the app requires .NET Framework, see [.NET Framework: Installation guide](/dotnet/framework/install/) to find installation instructions.</span></span> <span data-ttu-id="927dc-213">Installez la version requise de .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="927dc-213">Install the required .NET Framework.</span></span> <span data-ttu-id="927dc-214">Le programme d’installation de la dernière version de .NET Framework se trouve dans la page [Tous les téléchargements .NET](https://www.microsoft.com/net/download/all).</span><span class="sxs-lookup"><span data-stu-id="927dc-214">The installer for the latest .NET Framework can be found at [.NET All Downloads](https://www.microsoft.com/net/download/all).</span></span>

2. <span data-ttu-id="927dc-215">Configurez les ports et les URL de l’application.</span><span class="sxs-lookup"><span data-stu-id="927dc-215">Configure URLs and ports for the app.</span></span>

   <span data-ttu-id="927dc-216">Par défaut, ASP.NET Core est lié à `http://localhost:5000`.</span><span class="sxs-lookup"><span data-stu-id="927dc-216">By default, ASP.NET Core binds to `http://localhost:5000`.</span></span> <span data-ttu-id="927dc-217">Pour configurer les ports et les préfixes d’URL, il existe plusieurs possibilités :</span><span class="sxs-lookup"><span data-stu-id="927dc-217">To configure URL prefixes and ports, options include using:</span></span>

   * [<span data-ttu-id="927dc-218">UseUrls</span><span class="sxs-lookup"><span data-stu-id="927dc-218">UseUrls</span></span>](/dotnet/api/microsoft.aspnetcore.hosting.hostingabstractionswebhostbuilderextensions.useurls)
   * <span data-ttu-id="927dc-219">Arguments de ligne de commande `urls`</span><span class="sxs-lookup"><span data-stu-id="927dc-219">`urls` command-line argument</span></span>
   * <span data-ttu-id="927dc-220">Variable d’environnement `ASPNETCORE_URLS`</span><span class="sxs-lookup"><span data-stu-id="927dc-220">`ASPNETCORE_URLS` environment variable</span></span>
   * [<span data-ttu-id="927dc-221">UrlPrefixes</span><span class="sxs-lookup"><span data-stu-id="927dc-221">UrlPrefixes</span></span>](/dotnet/api/microsoft.aspnetcore.server.httpsys.httpsysoptions.urlprefixes)

   <span data-ttu-id="927dc-222">L’exemple de code suivant montre comment utiliser [UrlPrefixes](/dotnet/api/microsoft.aspnetcore.server.httpsys.httpsysoptions.urlprefixes) :</span><span class="sxs-lookup"><span data-stu-id="927dc-222">The following code example shows how to use [UrlPrefixes](/dotnet/api/microsoft.aspnetcore.server.httpsys.httpsysoptions.urlprefixes):</span></span>

   [!code-csharp[](httpsys/sample/Program.cs?name=snippet1&highlight=11)]

   <span data-ttu-id="927dc-223">`UrlPrefixes` présente l’avantage de générer immédiatement un message d’erreur en cas de préfixe mal formé.</span><span class="sxs-lookup"><span data-stu-id="927dc-223">An advantage of `UrlPrefixes` is that an error message is generated immediately for improperly formatted prefixes.</span></span>

   <span data-ttu-id="927dc-224">Les paramètres de `UrlPrefixes` remplacent les paramètres `UseUrls`/`urls`/`ASPNETCORE_URLS`.</span><span class="sxs-lookup"><span data-stu-id="927dc-224">The settings in `UrlPrefixes` override `UseUrls`/`urls`/`ASPNETCORE_URLS` settings.</span></span> <span data-ttu-id="927dc-225">Par conséquent, avec `UseUrls`, `urls` et la variable d’environnement `ASPNETCORE_URLS`, il est plus facile de basculer entre Kestrel et HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="927dc-225">Therefore, an advantage of `UseUrls`, `urls`, and the `ASPNETCORE_URLS` environment variable is that it's easier to switch between Kestrel and HTTP.sys.</span></span> <span data-ttu-id="927dc-226">Pour plus d’informations sur `UseUrls`, `urls` et `ASPNETCORE_URLS`, consultez la rubrique [Héberger dans ASP.NET Core](xref:fundamentals/host/index).</span><span class="sxs-lookup"><span data-stu-id="927dc-226">For more information on `UseUrls`, `urls`, and `ASPNETCORE_URLS`, see the [Host in ASP.NET Core](xref:fundamentals/host/index) topic.</span></span>

   <span data-ttu-id="927dc-227">HTTP.sys utilise les [formats de chaîne UrlPrefix de l’API de serveur HTTP](https://msdn.microsoft.com/library/windows/desktop/aa364698.aspx).</span><span class="sxs-lookup"><span data-stu-id="927dc-227">HTTP.sys uses the [HTTP Server API UrlPrefix string formats](https://msdn.microsoft.com/library/windows/desktop/aa364698.aspx).</span></span>

   > [!WARNING]
   > <span data-ttu-id="927dc-228">Les liaisons génériques de niveau supérieur (`http://*:80/` et `http://+:80`) ne doivent **pas** être utilisées.</span><span class="sxs-lookup"><span data-stu-id="927dc-228">Top-level wildcard bindings (`http://*:80/` and `http://+:80`) should **not** be used.</span></span> <span data-ttu-id="927dc-229">Les liaisons génériques de niveau supérieur peuvent exposer votre application à des failles de sécurité.</span><span class="sxs-lookup"><span data-stu-id="927dc-229">Top-level wildcard bindings can open up your app to security vulnerabilities.</span></span> <span data-ttu-id="927dc-230">Cela s’applique aux caractères génériques forts et faibles.</span><span class="sxs-lookup"><span data-stu-id="927dc-230">This applies to both strong and weak wildcards.</span></span> <span data-ttu-id="927dc-231">Utilisez des noms d’hôte explicites plutôt que des caractères génériques.</span><span class="sxs-lookup"><span data-stu-id="927dc-231">Use explicit host names rather than wildcards.</span></span> <span data-ttu-id="927dc-232">Une liaison générique de sous-domaine (par exemple, `*.mysub.com`) ne présente pas ce risque de sécurité si vous contrôlez le domaine parent en entier (par opposition à `*.com`, qui est vulnérable).</span><span class="sxs-lookup"><span data-stu-id="927dc-232">Subdomain wildcard binding (for example, `*.mysub.com`) doesn't have this security risk if you control the entire parent domain (as opposed to `*.com`, which is vulnerable).</span></span> <span data-ttu-id="927dc-233">Consultez la [rfc7230 section-5.4](https://tools.ietf.org/html/rfc7230#section-5.4) pour plus d’informations.</span><span class="sxs-lookup"><span data-stu-id="927dc-233">See [rfc7230 section-5.4](https://tools.ietf.org/html/rfc7230#section-5.4) for more information.</span></span>

3. <span data-ttu-id="927dc-234">Préinscrivez les préfixes d’URL à lier à HTTP.sys et configurez les certificats x.509.</span><span class="sxs-lookup"><span data-stu-id="927dc-234">Preregister URL prefixes to bind to HTTP.sys and set up x.509 certificates.</span></span>

   <span data-ttu-id="927dc-235">Si les préfixes d’URL ne sont pas préinscrits sous Windows, exécutez l’application avec des privilèges Administrateur.</span><span class="sxs-lookup"><span data-stu-id="927dc-235">If URL prefixes aren't preregistered in Windows, run the app with administrator privileges.</span></span> <span data-ttu-id="927dc-236">Il existe une seule exception : si vous effectuez une liaison à localhost avec HTTP (et non HTTPS) et un numéro de port supérieur à 1024,</span><span class="sxs-lookup"><span data-stu-id="927dc-236">The only exception is when binding to localhost using HTTP (not HTTPS) with a port number greater than 1024.</span></span> <span data-ttu-id="927dc-237">les privilèges Administrateur ne sont pas nécessaires.</span><span class="sxs-lookup"><span data-stu-id="927dc-237">In that case, administrator privileges aren't required.</span></span>

   1. <span data-ttu-id="927dc-238">L’outil intégré pour configurer HTTP.sys est *netsh.exe*.</span><span class="sxs-lookup"><span data-stu-id="927dc-238">The built-in tool for configuring HTTP.sys is *netsh.exe*.</span></span> <span data-ttu-id="927dc-239">*netsh.exe* permet de réserver des préfixes d’URL et d’assigner des certificats X.509.</span><span class="sxs-lookup"><span data-stu-id="927dc-239">*netsh.exe* is used to reserve URL prefixes and assign X.509 certificates.</span></span> <span data-ttu-id="927dc-240">L’outil requiert des privilèges Administrateur.</span><span class="sxs-lookup"><span data-stu-id="927dc-240">The tool requires administrator privileges.</span></span>

      <span data-ttu-id="927dc-241">L’exemple suivant montre les commandes à effectuer pour réserver des préfixes d’URL aux ports 80 et 443 :</span><span class="sxs-lookup"><span data-stu-id="927dc-241">The following example shows the commands to reserve URL prefixes for ports 80 and 443:</span></span>

      ```console
      netsh http add urlacl url=http://+:80/ user=Users
      netsh http add urlacl url=https://+:443/ user=Users
      ```

      <span data-ttu-id="927dc-242">L’exemple suivant montre comment assigner un certificat X.509 :</span><span class="sxs-lookup"><span data-stu-id="927dc-242">The following example shows how to assign an X.509 certificate:</span></span>

      ```console
      netsh http add sslcert ipport=0.0.0.0:443 certhash=MyCertHash_Here appid="{00000000-0000-0000-0000-000000000000}"
      ```

      <span data-ttu-id="927dc-243">Documentation de référence de *netsh.exe* :</span><span class="sxs-lookup"><span data-stu-id="927dc-243">Reference documentation for *netsh.exe*:</span></span>

      * [<span data-ttu-id="927dc-244">Commandes netsh pour HTTP (Hypertext Transfer Protocol)</span><span class="sxs-lookup"><span data-stu-id="927dc-244">Netsh Commands for Hypertext Transfer Protocol (HTTP)</span></span>](https://technet.microsoft.com/library/cc725882.aspx)
      * [<span data-ttu-id="927dc-245">Chaînes UrlPrefix</span><span class="sxs-lookup"><span data-stu-id="927dc-245">UrlPrefix Strings</span></span>](https://msdn.microsoft.com/library/windows/desktop/aa364698.aspx)

   2. <span data-ttu-id="927dc-246">Créez des certificats X.509 auto-signés, si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="927dc-246">Create self-signed X.509 certificates, if required.</span></span>

      [!INCLUDE [How to make an X.509 cert](~/includes/make-x509-cert.md)]

4. <span data-ttu-id="927dc-247">Ouvrez des ports du pare-feu pour autoriser le trafic à atteindre HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="927dc-247">Open firewall ports to allow traffic to reach HTTP.sys.</span></span> <span data-ttu-id="927dc-248">Utilisez *netsh.exe* ou les [cmdlets PowerShell](https://technet.microsoft.com/library/jj554906).</span><span class="sxs-lookup"><span data-stu-id="927dc-248">Use *netsh.exe* or [PowerShell cmdlets](https://technet.microsoft.com/library/jj554906).</span></span>

## <a name="proxy-server-and-load-balancer-scenarios"></a><span data-ttu-id="927dc-249">Scénarios avec un serveur proxy et un équilibreur de charge</span><span class="sxs-lookup"><span data-stu-id="927dc-249">Proxy server and load balancer scenarios</span></span>

<span data-ttu-id="927dc-250">Pour les applications hébergées par HTTP.sys qui interagissent avec les demandes provenant d’Internet ou d’un réseau d’entreprise, une configuration supplémentaire peut être nécessaire en cas d’hébergement derrière des serveurs proxy et des équilibreurs de charge.</span><span class="sxs-lookup"><span data-stu-id="927dc-250">For apps hosted by HTTP.sys that interact with requests from the Internet or a corporate network, additional configuration might be required when hosting behind proxy servers and load balancers.</span></span> <span data-ttu-id="927dc-251">Pour plus d’informations, consultez [Configurer ASP.NET Core pour l’utilisation de serveurs proxy et d’équilibreurs de charge](xref:host-and-deploy/proxy-load-balancer).</span><span class="sxs-lookup"><span data-stu-id="927dc-251">For more information, see [Configure ASP.NET Core to work with proxy servers and load balancers](xref:host-and-deploy/proxy-load-balancer).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="927dc-252">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="927dc-252">Additional resources</span></span>

* [<span data-ttu-id="927dc-253">API de serveur HTTP</span><span class="sxs-lookup"><span data-stu-id="927dc-253">HTTP Server API</span></span>](https://msdn.microsoft.com/library/windows/desktop/aa364510.aspx)
* [<span data-ttu-id="927dc-254">Référentiel GitHub aspnet/HttpSysServer (code source)</span><span class="sxs-lookup"><span data-stu-id="927dc-254">aspnet/HttpSysServer GitHub repository (source code)</span></span>](https://github.com/aspnet/HttpSysServer/)
* <xref:fundamentals/host/index>
* <xref:test/troubleshoot>
