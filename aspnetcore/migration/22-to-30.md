---
title: Migrer de ASP.NET Core 2.2 à 3.0
author: rick-anderson
description: Apprenez à migrer un projet ASP.NET Core 2.2 pour ASP.NET Core 3.0.
ms.author: riande
ms.custom: mvc
ms.date: 01/21/2020
no-loc:
- SignalR
uid: migration/22-to-30
ms.openlocfilehash: 84ef0cfd7e2d785ed4c107dcfc30434f2aa9bfa0
ms.sourcegitcommit: 77c046331f3d633d7cc247ba77e58b89e254f487
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/16/2020
ms.locfileid: "81488785"
---
# <a name="migrate-from-aspnet-core-22-to-30"></a><span data-ttu-id="a5355-103">Migrer de ASP.NET Core 2.2 à 3.0</span><span class="sxs-lookup"><span data-stu-id="a5355-103">Migrate from ASP.NET Core 2.2 to 3.0</span></span>

<span data-ttu-id="a5355-104">Par [Scott Addie](https://github.com/scottaddie) et [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="a5355-104">By [Scott Addie](https://github.com/scottaddie) and [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="a5355-105">Cet article explique comment mettre à jour un projet existant ASP.NET Core 2.2 pour ASP.NET Core 3.0.</span><span class="sxs-lookup"><span data-stu-id="a5355-105">This article explains how to update an existing ASP.NET Core 2.2 project to ASP.NET Core 3.0.</span></span> <span data-ttu-id="a5355-106">Il pourrait être utile de créer un nouveau projet ASP.NET Core 3.0 pour :</span><span class="sxs-lookup"><span data-stu-id="a5355-106">It might be helpful to create a new ASP.NET Core 3.0 project to:</span></span>

* <span data-ttu-id="a5355-107">Comparez avec le code ASP.NET Core 2.2.</span><span class="sxs-lookup"><span data-stu-id="a5355-107">Compare with the ASP.NET Core 2.2 code.</span></span>
* <span data-ttu-id="a5355-108">Copiez les modifications pertinentes à votre projet ASP.NET Core 3.0.</span><span class="sxs-lookup"><span data-stu-id="a5355-108">Copy the relevant changes to your ASP.NET Core 3.0 project.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="a5355-109">Prérequis</span><span class="sxs-lookup"><span data-stu-id="a5355-109">Prerequisites</span></span>

# <a name="visual-studio"></a>[<span data-ttu-id="a5355-110">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="a5355-110">Visual Studio</span></span>](#tab/visual-studio)

[!INCLUDE[](~/includes/net-core-prereqs-vs-3.0.md)]

# <a name="visual-studio-code"></a>[<span data-ttu-id="a5355-111">Visual Studio Code</span><span class="sxs-lookup"><span data-stu-id="a5355-111">Visual Studio Code</span></span>](#tab/visual-studio-code)

[!INCLUDE[](~/includes/net-core-prereqs-vsc-3.0.md)]

# <a name="visual-studio-for-mac"></a>[<span data-ttu-id="a5355-112">Visual Studio pour Mac</span><span class="sxs-lookup"><span data-stu-id="a5355-112">Visual Studio for Mac</span></span>](#tab/visual-studio-mac)

[!INCLUDE[](~/includes/net-core-prereqs-mac-3.0.md)]

---

## <a name="update-net-core-sdk-version-in-globaljson"></a><span data-ttu-id="a5355-113">Mettre à jour la version du SDK .NET Core dans global.json</span><span class="sxs-lookup"><span data-stu-id="a5355-113">Update .NET Core SDK version in global.json</span></span>

<span data-ttu-id="a5355-114">Si votre solution s’appuie sur un fichier [global.json](/dotnet/core/tools/global-json) pour cibler `version` une version spécifique .NET Core SDK, mettez à jour sa propriété sur la version 3.0 installée sur votre machine :</span><span class="sxs-lookup"><span data-stu-id="a5355-114">If your solution relies upon a [global.json](/dotnet/core/tools/global-json) file to target a specific .NET Core SDK version, update its `version` property to the 3.0 version installed on your machine:</span></span>

```json
{
  "sdk": {
    "version": "3.0.100"
  }
}
```

## <a name="update-the-project-file"></a><span data-ttu-id="a5355-115">Mettre à jour le dossier du projet</span><span class="sxs-lookup"><span data-stu-id="a5355-115">Update the project file</span></span>

### <a name="update-the-target-framework"></a><span data-ttu-id="a5355-116">Mettre à jour le cadre cible</span><span class="sxs-lookup"><span data-stu-id="a5355-116">Update the Target Framework</span></span>

<span data-ttu-id="a5355-117">ASP.NET Core 3.0 et plus tard ne s’exécutent que sur .NET Core.</span><span class="sxs-lookup"><span data-stu-id="a5355-117">ASP.NET Core 3.0 and later only run on .NET Core.</span></span> <span data-ttu-id="a5355-118">Définir le [Cadre-cadre cible Moniker (TFM)](/dotnet/standard/frameworks) à `netcoreapp3.0`:</span><span class="sxs-lookup"><span data-stu-id="a5355-118">Set the [Target Framework Moniker (TFM)](/dotnet/standard/frameworks) to `netcoreapp3.0`:</span></span>

[!code-xml[](22-to-30/samples/Web1.csproj?highlight=4)]

### <a name="remove-obsolete-package-references"></a><span data-ttu-id="a5355-119">Supprimer les références de paquets obsolètes</span><span class="sxs-lookup"><span data-stu-id="a5355-119">Remove obsolete package references</span></span>

<span data-ttu-id="a5355-120">Un grand nombre de paquets NuGet ne sont pas produits pour ASP.NET Core 3.0.</span><span class="sxs-lookup"><span data-stu-id="a5355-120">A large number of NuGet packages aren't produced for ASP.NET Core 3.0.</span></span> <span data-ttu-id="a5355-121">Ces références de paquet doivent être supprimées de votre dossier de projet.</span><span class="sxs-lookup"><span data-stu-id="a5355-121">Such package references should be removed from your project file.</span></span> <span data-ttu-id="a5355-122">Considérez le fichier de projet suivant pour une application web ASP.NET Core 2.2 :</span><span class="sxs-lookup"><span data-stu-id="a5355-122">Consider the following project file for an ASP.NET Core 2.2 web app:</span></span>

```xml
<Project Sdk="Microsoft.NET.Sdk.Web">

  <PropertyGroup>
    <TargetFramework>netcoreapp2.2</TargetFramework>
    <AspNetCoreHostingModel>InProcess</AspNetCoreHostingModel>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.AspNetCore.App"/>
    <PackageReference Include="Microsoft.AspNetCore.Razor.Design" Version="2.2.0" PrivateAssets="All" />
  </ItemGroup>

</Project>
```

<span data-ttu-id="a5355-123">Le dossier de projet mis à jour pour ASP.NET Core 3.0 :</span><span class="sxs-lookup"><span data-stu-id="a5355-123">The updated project file for ASP.NET Core 3.0:</span></span>

[!code-xml[](22-to-30/samples/Web1.csproj?highlight=4)]

<span data-ttu-id="a5355-124">Le fichier de projet ASP.NET Core 3.0 mis à jour :</span><span class="sxs-lookup"><span data-stu-id="a5355-124">The updated ASP.NET Core 3.0 project file:</span></span>

* <span data-ttu-id="a5355-125">Dans le `<PropertyGroup>` :</span><span class="sxs-lookup"><span data-stu-id="a5355-125">In the `<PropertyGroup>`:</span></span>
  * <span data-ttu-id="a5355-126">Mise à jour du TFM pour`netcoreapp3.0`</span><span class="sxs-lookup"><span data-stu-id="a5355-126">Updates the TFM to `netcoreapp3.0`</span></span>
  * <span data-ttu-id="a5355-127">Supprime l’élément. `<AspNetCoreHostingModel>`</span><span class="sxs-lookup"><span data-stu-id="a5355-127">Removes the `<AspNetCoreHostingModel>` element.</span></span> <span data-ttu-id="a5355-128">Pour plus d’informations, consultez [le modèle d’hébergement en cours](#in-process-hosting-model) dans ce document.</span><span class="sxs-lookup"><span data-stu-id="a5355-128">For more information, see [In-process hosting model](#in-process-hosting-model) in this document.</span></span>

* <span data-ttu-id="a5355-129">Dans le `<ItemGroup>` :</span><span class="sxs-lookup"><span data-stu-id="a5355-129">In the `<ItemGroup>`:</span></span>
  * <span data-ttu-id="a5355-130">`Microsoft.AspNetCore.App`est enlevé.</span><span class="sxs-lookup"><span data-stu-id="a5355-130">`Microsoft.AspNetCore.App` is removed.</span></span> <span data-ttu-id="a5355-131">Pour plus d’informations, voir [référence cadre](#framework-reference) dans ce document.</span><span class="sxs-lookup"><span data-stu-id="a5355-131">For more information, see [Framework reference](#framework-reference) in this document.</span></span>
  * <span data-ttu-id="a5355-132">`Microsoft.AspNetCore.Razor.Design`est supprimé et dans la liste suivante des paquets qui ne sont plus produits.</span><span class="sxs-lookup"><span data-stu-id="a5355-132">`Microsoft.AspNetCore.Razor.Design` is removed and in the following list of packages no longer being produced.</span></span>

<span data-ttu-id="a5355-133">Pour voir la liste complète des paquets qui ne sont plus produits, sélectionnez la liste d’extension suivante :</span><span class="sxs-lookup"><span data-stu-id="a5355-133">To see the full list of packages that are no longer produced, select the following expand list:</span></span>

<details>
    <summary><span data-ttu-id="a5355-134">Cliquez pour élargir la liste des paquets qui ne sont plus produits</span><span class="sxs-lookup"><span data-stu-id="a5355-134">Click to expand the list of packages no longer being produced</span></span></summary>
    <ul>
        <li><span data-ttu-id="a5355-135">Microsoft.AspNetCore</span><span class="sxs-lookup"><span data-stu-id="a5355-135">Microsoft.AspNetCore</span></span></li>
        <li><span data-ttu-id="a5355-136">Microsoft.AspNetCore.All</span><span class="sxs-lookup"><span data-stu-id="a5355-136">Microsoft.AspNetCore.All</span></span></li>
        <li><span data-ttu-id="a5355-137">Microsoft.AspNetCore.App</span><span class="sxs-lookup"><span data-stu-id="a5355-137">Microsoft.AspNetCore.App</span></span></li>
        <li><span data-ttu-id="a5355-138">Microsoft.AspNetCore.Antiforgery</span><span class="sxs-lookup"><span data-stu-id="a5355-138">Microsoft.AspNetCore.Antiforgery</span></span></li>
        <li><span data-ttu-id="a5355-139">Microsoft.AspNetCore.Authentication</span><span class="sxs-lookup"><span data-stu-id="a5355-139">Microsoft.AspNetCore.Authentication</span></span></li>
        <li><span data-ttu-id="a5355-140">Microsoft.AspNetCore.Authentication.Abstractions</span><span class="sxs-lookup"><span data-stu-id="a5355-140">Microsoft.AspNetCore.Authentication.Abstractions</span></span></li>
        <li><span data-ttu-id="a5355-141">Microsoft.AspNetCore.Authentication.Cookies</span><span class="sxs-lookup"><span data-stu-id="a5355-141">Microsoft.AspNetCore.Authentication.Cookies</span></span></li>
        <li><span data-ttu-id="a5355-142">Microsoft.AspNetCore.Authentication.Core</span><span class="sxs-lookup"><span data-stu-id="a5355-142">Microsoft.AspNetCore.Authentication.Core</span></span></li>
        <li><span data-ttu-id="a5355-143">Microsoft.AspNetCore.Authentication.OAuth</span><span class="sxs-lookup"><span data-stu-id="a5355-143">Microsoft.AspNetCore.Authentication.OAuth</span></span></li>
        <li><span data-ttu-id="a5355-144">Microsoft.AspNetCore.Authorization.Policy</span><span class="sxs-lookup"><span data-stu-id="a5355-144">Microsoft.AspNetCore.Authorization.Policy</span></span></li>
        <li><span data-ttu-id="a5355-145">Microsoft.AspNetCore.CookiePolicy</span><span class="sxs-lookup"><span data-stu-id="a5355-145">Microsoft.AspNetCore.CookiePolicy</span></span></li>
        <li><span data-ttu-id="a5355-146">Microsoft.AspNetCore.Cors</span><span class="sxs-lookup"><span data-stu-id="a5355-146">Microsoft.AspNetCore.Cors</span></span></li>
        <li><span data-ttu-id="a5355-147">Microsoft.AspNetCore.Diagnostics</span><span class="sxs-lookup"><span data-stu-id="a5355-147">Microsoft.AspNetCore.Diagnostics</span></span></li>
        <li><span data-ttu-id="a5355-148">Microsoft.AspNetCore.Diagnostics.HealthChecks</span><span class="sxs-lookup"><span data-stu-id="a5355-148">Microsoft.AspNetCore.Diagnostics.HealthChecks</span></span></li>
        <li><span data-ttu-id="a5355-149">Microsoft.AspNetCore.HostFiltering</span><span class="sxs-lookup"><span data-stu-id="a5355-149">Microsoft.AspNetCore.HostFiltering</span></span></li>
        <li><span data-ttu-id="a5355-150">Microsoft.AspNetCore.Hosting</span><span class="sxs-lookup"><span data-stu-id="a5355-150">Microsoft.AspNetCore.Hosting</span></span></li>
        <li><span data-ttu-id="a5355-151">Microsoft.AspNetCore.Hosting.Abstractions</span><span class="sxs-lookup"><span data-stu-id="a5355-151">Microsoft.AspNetCore.Hosting.Abstractions</span></span></li>
        <li><span data-ttu-id="a5355-152">Microsoft.AspNetCore.Hosting.Server.Abstractions</span><span class="sxs-lookup"><span data-stu-id="a5355-152">Microsoft.AspNetCore.Hosting.Server.Abstractions</span></span></li>
        <li><span data-ttu-id="a5355-153">Microsoft.AspNetCore.Http</span><span class="sxs-lookup"><span data-stu-id="a5355-153">Microsoft.AspNetCore.Http</span></span></li>
        <li><span data-ttu-id="a5355-154">Microsoft.AspNetCore.Http.Abstractions</span><span class="sxs-lookup"><span data-stu-id="a5355-154">Microsoft.AspNetCore.Http.Abstractions</span></span></li>
        <li><span data-ttu-id="a5355-155">Microsoft.AspNetCore.Http.Connections</span><span class="sxs-lookup"><span data-stu-id="a5355-155">Microsoft.AspNetCore.Http.Connections</span></span></li>
        <li><span data-ttu-id="a5355-156">Microsoft.AspNetCore.Http.Extensions</span><span class="sxs-lookup"><span data-stu-id="a5355-156">Microsoft.AspNetCore.Http.Extensions</span></span></li>
        <li><span data-ttu-id="a5355-157">Microsoft.AspNetCore.HttpOverrides</span><span class="sxs-lookup"><span data-stu-id="a5355-157">Microsoft.AspNetCore.HttpOverrides</span></span></li>
        <li><span data-ttu-id="a5355-158">Microsoft.AspNetCore.HttpsPolicy</span><span class="sxs-lookup"><span data-stu-id="a5355-158">Microsoft.AspNetCore.HttpsPolicy</span></span></li>
        <li><span data-ttu-id="a5355-159">Microsoft.AspNetCore.Identity</span><span class="sxs-lookup"><span data-stu-id="a5355-159">Microsoft.AspNetCore.Identity</span></span></li>
        <li><span data-ttu-id="a5355-160">Microsoft.AspNetCore.Localization</span><span class="sxs-lookup"><span data-stu-id="a5355-160">Microsoft.AspNetCore.Localization</span></span></li>
        <li><span data-ttu-id="a5355-161">Microsoft.AspNetCore.Localization.Routing</span><span class="sxs-lookup"><span data-stu-id="a5355-161">Microsoft.AspNetCore.Localization.Routing</span></span></li>
        <li><span data-ttu-id="a5355-162">Microsoft.AspNetCore.Mvc</span><span class="sxs-lookup"><span data-stu-id="a5355-162">Microsoft.AspNetCore.Mvc</span></span></li>
        <li><span data-ttu-id="a5355-163">Microsoft.AspNetCore.Mvc.Abstractions</span><span class="sxs-lookup"><span data-stu-id="a5355-163">Microsoft.AspNetCore.Mvc.Abstractions</span></span></li>
        <li><span data-ttu-id="a5355-164">Microsoft.AspNetCore.Mvc.Analyzers</span><span class="sxs-lookup"><span data-stu-id="a5355-164">Microsoft.AspNetCore.Mvc.Analyzers</span></span></li>
        <li><span data-ttu-id="a5355-165">Microsoft.AspNetCore.Mvc.ApiExplorer</span><span class="sxs-lookup"><span data-stu-id="a5355-165">Microsoft.AspNetCore.Mvc.ApiExplorer</span></span></li>
        <li><span data-ttu-id="a5355-166">Microsoft.AspNetCore.Mvc.Api.Analyzers</span><span class="sxs-lookup"><span data-stu-id="a5355-166">Microsoft.AspNetCore.Mvc.Api.Analyzers</span></span></li>
        <li><span data-ttu-id="a5355-167">Microsoft.AspNetCore.Mvc.Core</span><span class="sxs-lookup"><span data-stu-id="a5355-167">Microsoft.AspNetCore.Mvc.Core</span></span></li>
        <li><span data-ttu-id="a5355-168">Microsoft.AspNetCore.Mvc.Cors</span><span class="sxs-lookup"><span data-stu-id="a5355-168">Microsoft.AspNetCore.Mvc.Cors</span></span></li>
        <li><span data-ttu-id="a5355-169">Microsoft.AspNetCore.Mvc.DataAnnotations</span><span class="sxs-lookup"><span data-stu-id="a5355-169">Microsoft.AspNetCore.Mvc.DataAnnotations</span></span></li>
        <li><span data-ttu-id="a5355-170">Microsoft.AspNetCore.Mvc.Formatters.Json</span><span class="sxs-lookup"><span data-stu-id="a5355-170">Microsoft.AspNetCore.Mvc.Formatters.Json</span></span></li>
        <li><span data-ttu-id="a5355-171">Microsoft.AspNetCore.Mvc.Formatters.Xml</span><span class="sxs-lookup"><span data-stu-id="a5355-171">Microsoft.AspNetCore.Mvc.Formatters.Xml</span></span></li>
        <li><span data-ttu-id="a5355-172">Microsoft.AspNetCore.Mvc.Localization</span><span class="sxs-lookup"><span data-stu-id="a5355-172">Microsoft.AspNetCore.Mvc.Localization</span></span></li>
        <li><span data-ttu-id="a5355-173">Microsoft.AspNetCore.Mvc.Razor</span><span class="sxs-lookup"><span data-stu-id="a5355-173">Microsoft.AspNetCore.Mvc.Razor</span></span></li>
        <li><span data-ttu-id="a5355-174">Microsoft.AspNetCore.Mvc.Razor.ViewCompilation</span><span class="sxs-lookup"><span data-stu-id="a5355-174">Microsoft.AspNetCore.Mvc.Razor.ViewCompilation</span></span></li>
        <li><span data-ttu-id="a5355-175">Microsoft.AspNetCore.Mvc.RazorPages</span><span class="sxs-lookup"><span data-stu-id="a5355-175">Microsoft.AspNetCore.Mvc.RazorPages</span></span></li>
        <li><span data-ttu-id="a5355-176">Microsoft.AspNetCore.Mvc.TagHelpers</span><span class="sxs-lookup"><span data-stu-id="a5355-176">Microsoft.AspNetCore.Mvc.TagHelpers</span></span></li>
        <li><span data-ttu-id="a5355-177">Microsoft.AspNetCore.Mvc.ViewFeatures</span><span class="sxs-lookup"><span data-stu-id="a5355-177">Microsoft.AspNetCore.Mvc.ViewFeatures</span></span></li>
        <li><span data-ttu-id="a5355-178">Microsoft.AspNetCore.Razor</span><span class="sxs-lookup"><span data-stu-id="a5355-178">Microsoft.AspNetCore.Razor</span></span></li>
        <li><span data-ttu-id="a5355-179">Microsoft.AspNetCore.Razor.Runtime</span><span class="sxs-lookup"><span data-stu-id="a5355-179">Microsoft.AspNetCore.Razor.Runtime</span></span></li>
        <li><span data-ttu-id="a5355-180">Microsoft.AspNetCore.Razor.Design</span><span class="sxs-lookup"><span data-stu-id="a5355-180">Microsoft.AspNetCore.Razor.Design</span></span></li>
        <li><span data-ttu-id="a5355-181">Microsoft.AspNetCore.ResponseCaching</span><span class="sxs-lookup"><span data-stu-id="a5355-181">Microsoft.AspNetCore.ResponseCaching</span></span></li>
        <li><span data-ttu-id="a5355-182">Microsoft.AspNetCore.ResponseCaching.Abstractions</span><span class="sxs-lookup"><span data-stu-id="a5355-182">Microsoft.AspNetCore.ResponseCaching.Abstractions</span></span></li>
        <li><span data-ttu-id="a5355-183">Microsoft.AspNetCore.ResponseCompression</span><span class="sxs-lookup"><span data-stu-id="a5355-183">Microsoft.AspNetCore.ResponseCompression</span></span></li>
        <li><span data-ttu-id="a5355-184">Microsoft.AspNetCore.Rewrite</span><span class="sxs-lookup"><span data-stu-id="a5355-184">Microsoft.AspNetCore.Rewrite</span></span></li>
        <li><span data-ttu-id="a5355-185">Microsoft.AspNetCore.Routing</span><span class="sxs-lookup"><span data-stu-id="a5355-185">Microsoft.AspNetCore.Routing</span></span></li>
        <li><span data-ttu-id="a5355-186">Microsoft.AspNetCore.Routing.Abstractions</span><span class="sxs-lookup"><span data-stu-id="a5355-186">Microsoft.AspNetCore.Routing.Abstractions</span></span></li>
        <li><span data-ttu-id="a5355-187">Microsoft.AspNetCore.Server.HttpSys</span><span class="sxs-lookup"><span data-stu-id="a5355-187">Microsoft.AspNetCore.Server.HttpSys</span></span></li>
        <li><span data-ttu-id="a5355-188">Microsoft.AspNetCore.Server.IIS</span><span class="sxs-lookup"><span data-stu-id="a5355-188">Microsoft.AspNetCore.Server.IIS</span></span></li>
        <li><span data-ttu-id="a5355-189">Microsoft.AspNetCore.Server.IISIntegration</span><span class="sxs-lookup"><span data-stu-id="a5355-189">Microsoft.AspNetCore.Server.IISIntegration</span></span></li>
        <li><span data-ttu-id="a5355-190">Microsoft.AspNetCore.Server.Kestrel</span><span class="sxs-lookup"><span data-stu-id="a5355-190">Microsoft.AspNetCore.Server.Kestrel</span></span></li>
        <li><span data-ttu-id="a5355-191">Microsoft.AspNetCore.Server.Kestrel.Core</span><span class="sxs-lookup"><span data-stu-id="a5355-191">Microsoft.AspNetCore.Server.Kestrel.Core</span></span></li>
        <li><span data-ttu-id="a5355-192">Microsoft.AspNetCore.Server.Kestrel.Https</span><span class="sxs-lookup"><span data-stu-id="a5355-192">Microsoft.AspNetCore.Server.Kestrel.Https</span></span></li>
        <li><span data-ttu-id="a5355-193">Microsoft.AspNetCore.Server.Kestrel.Transport.Abstractions</span><span class="sxs-lookup"><span data-stu-id="a5355-193">Microsoft.AspNetCore.Server.Kestrel.Transport.Abstractions</span></span></li>
        <li><span data-ttu-id="a5355-194">Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets</span><span class="sxs-lookup"><span data-stu-id="a5355-194">Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets</span></span></li>
        <li><span data-ttu-id="a5355-195">Microsoft.AspNetCore.Session</span><span class="sxs-lookup"><span data-stu-id="a5355-195">Microsoft.AspNetCore.Session</span></span></li>
        <li><span data-ttu-id="a5355-196">Microsoft.AspNetCore.SignalR</span><span class="sxs-lookup"><span data-stu-id="a5355-196">Microsoft.AspNetCore.SignalR</span></span></li>
        <li><span data-ttu-id="a5355-197">Microsoft.AspNetCore. SignalR. Core</span><span class="sxs-lookup"><span data-stu-id="a5355-197">Microsoft.AspNetCore.SignalR.Core</span></span></li>
        <li><span data-ttu-id="a5355-198">Microsoft.AspNetCore.StaticFiles</span><span class="sxs-lookup"><span data-stu-id="a5355-198">Microsoft.AspNetCore.StaticFiles</span></span></li>
        <li><span data-ttu-id="a5355-199">Microsoft.AspNetCore.WebSockets</span><span class="sxs-lookup"><span data-stu-id="a5355-199">Microsoft.AspNetCore.WebSockets</span></span></li>
        <li><span data-ttu-id="a5355-200">Microsoft.AspNetCore.WebUtilities</span><span class="sxs-lookup"><span data-stu-id="a5355-200">Microsoft.AspNetCore.WebUtilities</span></span></li>
        <li><span data-ttu-id="a5355-201">Microsoft.Net.Http.Headers </span><span class="sxs-lookup"><span data-stu-id="a5355-201">Microsoft.Net.Http.Headers</span></span></li>
    </ul>
</details>

### <a name="review-breaking-changes"></a><span data-ttu-id="a5355-202">Revoir les changements de rupture</span><span class="sxs-lookup"><span data-stu-id="a5355-202">Review breaking changes</span></span>

[<span data-ttu-id="a5355-203">Revoir les changements de rupture</span><span class="sxs-lookup"><span data-stu-id="a5355-203">Review breaking changes</span></span>](#break)

### <a name="framework-reference"></a><span data-ttu-id="a5355-204">Référence du cadre</span><span class="sxs-lookup"><span data-stu-id="a5355-204">Framework reference</span></span>

<span data-ttu-id="a5355-205">Les caractéristiques de ASP.NET Core qui étaient disponibles dans l’un des paquets énumérés ci-dessus sont disponibles dans le `Microsoft.AspNetCore.App` cadre partagé.</span><span class="sxs-lookup"><span data-stu-id="a5355-205">Features of ASP.NET Core that were available through one of the packages listed above are available as part of the `Microsoft.AspNetCore.App` shared framework.</span></span> <span data-ttu-id="a5355-206">Le *cadre partagé* est l’ensemble d’assemblages (fichiers *.dll)* qui sont installés sur la machine et comprend un composant de temps d’exécution et un pack de ciblage.</span><span class="sxs-lookup"><span data-stu-id="a5355-206">The *shared framework* is the set of assemblies (*.dll* files) that are installed on the machine and includes a runtime component and a targeting pack.</span></span> <span data-ttu-id="a5355-207">Pour plus d’informations, consultez [Le framework partagé](https://natemcmaster.com/blog/2018/08/29/netcore-primitives-2/).</span><span class="sxs-lookup"><span data-stu-id="a5355-207">For more information, see [The shared framework](https://natemcmaster.com/blog/2018/08/29/netcore-primitives-2/).</span></span>

* <span data-ttu-id="a5355-208">Les projets `Microsoft.NET.Sdk.Web` qui ciblent le `Microsoft.AspNetCore.App` SDK font implicitement référence au cadre.</span><span class="sxs-lookup"><span data-stu-id="a5355-208">Projects that target the `Microsoft.NET.Sdk.Web` SDK implicitly reference the `Microsoft.AspNetCore.App` framework.</span></span>

  <span data-ttu-id="a5355-209">Aucune référence supplémentaire n’est requise pour ces projets :</span><span class="sxs-lookup"><span data-stu-id="a5355-209">No additional references are required for these projects:</span></span>

  ```xml
  <Project Sdk="Microsoft.NET.Sdk.Web">
    <PropertyGroup>
      <TargetFramework>netcoreapp3.0</TargetFramework>
    </PropertyGroup>
      ...
  </Project>
  ```

* <span data-ttu-id="a5355-210">Les `Microsoft.NET.Sdk` projets `Microsoft.NET.Sdk.Razor` qui ciblent ou `FrameworkReference` SDK, doivent ajouter un explicite à `Microsoft.AspNetCore.App`:</span><span class="sxs-lookup"><span data-stu-id="a5355-210">Projects that target `Microsoft.NET.Sdk` or `Microsoft.NET.Sdk.Razor` SDK, should add an explicit `FrameworkReference` to `Microsoft.AspNetCore.App`:</span></span>

  ```xml
  <Project Sdk="Microsoft.NET.Sdk.Razor">
    <PropertyGroup>
      <TargetFramework>netcoreapp3.0</TargetFramework>
    </PropertyGroup>

    <ItemGroup>
      <FrameworkReference Include="Microsoft.AspNetCore.App" />
    </ItemGroup>
      ...
  </Project>
  ```

#### <a name="framework-dependent-builds-using-docker"></a><span data-ttu-id="a5355-211">Framework-dependent construit à l’aide de Docker</span><span class="sxs-lookup"><span data-stu-id="a5355-211">Framework-dependent builds using Docker</span></span>

<span data-ttu-id="a5355-212">Les builds dépendants du cadre des applications de console qui utilisent un paquet qui dépend du [cadre partagé](https://natemcmaster.com/blog/2018/08/29/netcore-primitives-2/) ASP.NET Core peuvent donner l’erreur de temps d’exécution suivante :</span><span class="sxs-lookup"><span data-stu-id="a5355-212">Framework-dependent builds of console apps that use a package that depends on the ASP.NET Core [shared framework](https://natemcmaster.com/blog/2018/08/29/netcore-primitives-2/) may give the following runtime error:</span></span>

```console
It was not possible to find any compatible framework version
The specified framework 'Microsoft.AspNetCore.App', version '3.0.0' was not found.
  - No frameworks were found.
```

<span data-ttu-id="a5355-213">`Microsoft.AspNetCore.App`est le cadre partagé contenant le temps d’exécution ASP.NET Core et n’est présent que sur [l’image dotnet/core/aspnet](https://hub.docker.com/_/microsoft-dotnet-core-aspnet/) Docker.</span><span class="sxs-lookup"><span data-stu-id="a5355-213">`Microsoft.AspNetCore.App` is the shared framework containing the ASP.NET Core runtime and is only present on the [dotnet/core/aspnet](https://hub.docker.com/_/microsoft-dotnet-core-aspnet/) Docker image.</span></span> <span data-ttu-id="a5355-214">Le 3.0 SDK réduit la taille des constructions dépendantes du cadre à l’aide de ASP.NET Core en n’incluant pas les copies en double des bibliothèques qui sont disponibles dans le cadre partagé.</span><span class="sxs-lookup"><span data-stu-id="a5355-214">The 3.0 SDK reduces the size of framework-dependent builds using ASP.NET Core by not including duplicate copies of libraries that are available in the shared framework.</span></span> <span data-ttu-id="a5355-215">Il s’agit d’une économie potentielle allant jusqu’à 18 Mo, mais il exige que le ASP.NET Core runtime être présent / installé pour exécuter l’application.</span><span class="sxs-lookup"><span data-stu-id="a5355-215">This is a potential savings of up to 18 MB, but it requires that the ASP.NET Core runtime be present / installed to run the app.</span></span>

<span data-ttu-id="a5355-216">Pour déterminer si l’application a une dépendance (directe ou indirecte) sur le cadre partagé ASP.NET Core, examinez le fichier *runtimeconfig.json* généré lors d’une version/publication de votre application.</span><span class="sxs-lookup"><span data-stu-id="a5355-216">To determine if the app has a dependency (either direct or indirect) on the ASP.NET Core shared framework, examine the *runtimeconfig.json* file generated during a build/publish of your app.</span></span> <span data-ttu-id="a5355-217">Le dossier JSON suivant montre une dépendance à l’égard du cadre partagé ASP.NET Core :</span><span class="sxs-lookup"><span data-stu-id="a5355-217">The following JSON file shows a dependency on the ASP.NET Core shared framework:</span></span>

```json
{
  "runtimeOptions": {
    "tfm": "netcoreapp3.0",
    "framework": {
      "name": "Microsoft.AspNetCore.App",
      "version": "3.0.0"
    },
    "configProperties": {
      "System.GC.Server": true
    }
  }
}
```

<span data-ttu-id="a5355-218">Si votre application utilise Docker, utilisez une image de base qui inclut ASP.NET Core 3.0.</span><span class="sxs-lookup"><span data-stu-id="a5355-218">If your app is using Docker, use a base image that includes ASP.NET Core 3.0.</span></span> <span data-ttu-id="a5355-219">Par exemple : `docker pull mcr.microsoft.com/dotnet/core/aspnet:3.0`.</span><span class="sxs-lookup"><span data-stu-id="a5355-219">For example, `docker pull mcr.microsoft.com/dotnet/core/aspnet:3.0`.</span></span>

### <a name="add-package-references-for-removed-assemblies"></a><span data-ttu-id="a5355-220">Ajouter des références de paquets pour les assemblages supprimés</span><span class="sxs-lookup"><span data-stu-id="a5355-220">Add package references for removed assemblies</span></span>

<span data-ttu-id="a5355-221">ASP.NET Core 3.0 supprime certains assemblages qui faisaient `Microsoft.AspNetCore.App` auparavant partie de la référence du paquet.</span><span class="sxs-lookup"><span data-stu-id="a5355-221">ASP.NET Core 3.0 removes some assemblies that were previously part of the `Microsoft.AspNetCore.App` package reference.</span></span> <span data-ttu-id="a5355-222">Pour visualiser les assemblages supprimés, comparez les deux dossiers-cadres partagés.</span><span class="sxs-lookup"><span data-stu-id="a5355-222">To visualize which assemblies were removed, compare the two shared framework folders.</span></span> <span data-ttu-id="a5355-223">Par exemple, une comparaison des versions 2.2.7 et 3.0.0 :</span><span class="sxs-lookup"><span data-stu-id="a5355-223">For example, a comparison of versions 2.2.7 and 3.0.0:</span></span>

![comparaison des assemblées-cadres partagées](22-to-30/_static/assembly-diff.png)

<span data-ttu-id="a5355-225">Pour continuer à utiliser les fonctionnalités fournies par les assemblages supprimés, référencez les versions 3.0 des paquets correspondants :</span><span class="sxs-lookup"><span data-stu-id="a5355-225">To continue using features provided by the removed assemblies, reference the 3.0 versions of the corresponding packages:</span></span>

* <span data-ttu-id="a5355-226">Une application Web générée par un modèle avec **des comptes utilisateur individuels** nécessite l’ajout des paquets suivants :</span><span class="sxs-lookup"><span data-stu-id="a5355-226">A template-generated web app with **Individual User Accounts** requires adding the following packages:</span></span>

  [!code-xml[](22-to-30/samples/WebFull.csproj?highlight=9-13)]

* [<span data-ttu-id="a5355-227">Microsoft.EntityFrameworkCore</span><span class="sxs-lookup"><span data-stu-id="a5355-227">Microsoft.EntityFrameworkCore</span></span>](https://www.nuget.org/packages/Microsoft.EntityFrameworkCore)

  <span data-ttu-id="a5355-228">Pour plus d’informations sur le référencement de l’ensemble spécifique au fournisseur de bases de données, voir [Les fournisseurs de bases de données](/ef/core/providers/index).</span><span class="sxs-lookup"><span data-stu-id="a5355-228">For more information on referencing the database provider-specific package, see [Database Providers](/ef/core/providers/index).</span></span>

* <span data-ttu-id="a5355-229">Interface utilisateur d’identité</span><span class="sxs-lookup"><span data-stu-id="a5355-229">Identity UI</span></span>

  <span data-ttu-id="a5355-230">La prise en charge [de l’interface utilisateur Identity](xref:security/authentication/identity) peut être ajoutée en faisant référence au package [Microsoft.AspNetCore.Identity.UI.](https://www.nuget.org/packages/Microsoft.AspNetCore.Identity.UI)</span><span class="sxs-lookup"><span data-stu-id="a5355-230">Support for [Identity UI](xref:security/authentication/identity) can be added by referencing the [Microsoft.AspNetCore.Identity.UI](https://www.nuget.org/packages/Microsoft.AspNetCore.Identity.UI) package.</span></span>

* <span data-ttu-id="a5355-231">SPA Services</span><span class="sxs-lookup"><span data-stu-id="a5355-231">SPA Services</span></span>

  * [<span data-ttu-id="a5355-232">Microsoft.AspNetCore.SpaServices (en anglais seulement)</span><span class="sxs-lookup"><span data-stu-id="a5355-232">Microsoft.AspNetCore.SpaServices</span></span>](https://www.nuget.org/packages/Microsoft.AspNetCore.SpaServices)
  * [<span data-ttu-id="a5355-233">Microsoft.AspNetCore.SpaServices.Extensions</span><span class="sxs-lookup"><span data-stu-id="a5355-233">Microsoft.AspNetCore.SpaServices.Extensions</span></span>](https://www.nuget.org/packages/Microsoft.AspNetCore.SpaServices.Extensions)

* <span data-ttu-id="a5355-234">Le &ndash; support d’authentification pour les flux d’authentification tiers est disponible sous forme de forfaits NuGet :</span><span class="sxs-lookup"><span data-stu-id="a5355-234">Authentication &ndash; Support for third-party authentication flows are available as NuGet packages:</span></span>

  * <span data-ttu-id="a5355-235">Facebook OAuth ([Microsoft.AspNetCore.Authentication.Facebook](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.Facebook))</span><span class="sxs-lookup"><span data-stu-id="a5355-235">Facebook OAuth ([Microsoft.AspNetCore.Authentication.Facebook](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.Facebook))</span></span>
  * <span data-ttu-id="a5355-236">Google OAuth ([Microsoft.AspNetCore.Authentication.Google](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.Google))</span><span class="sxs-lookup"><span data-stu-id="a5355-236">Google OAuth ([Microsoft.AspNetCore.Authentication.Google](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.Google))</span></span>
  * <span data-ttu-id="a5355-237">Authentification du compte Microsoft ([Microsoft.AspNetCore.Authentication.MicrosoftAccount](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.MicrosoftAccount))</span><span class="sxs-lookup"><span data-stu-id="a5355-237">Microsoft Account authentication ([Microsoft.AspNetCore.Authentication.MicrosoftAccount](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.MicrosoftAccount))</span></span>
  * <span data-ttu-id="a5355-238">Authentification OpenID Connect ([Microsoft.AspNetCore.Authentication.OpenIdConnect](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.OpenIdConnect))</span><span class="sxs-lookup"><span data-stu-id="a5355-238">OpenID Connect authentication ([Microsoft.AspNetCore.Authentication.OpenIdConnect](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.OpenIdConnect))</span></span>
  * <span data-ttu-id="a5355-239">OpenID Connect porte-personnes jeton ([Microsoft.AspNetCore.Authentication.JwtBearer](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.JwtBearer))</span><span class="sxs-lookup"><span data-stu-id="a5355-239">OpenID Connect bearer token ([Microsoft.AspNetCore.Authentication.JwtBearer](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.JwtBearer))</span></span>
  * <span data-ttu-id="a5355-240">Twitter OAuth ([Microsoft.AspNetCore.Authentication.Twitter](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.Twitter))</span><span class="sxs-lookup"><span data-stu-id="a5355-240">Twitter OAuth ([Microsoft.AspNetCore.Authentication.Twitter](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.Twitter))</span></span>
  * <span data-ttu-id="a5355-241">Authentification WsFederation ([Microsoft.AspNetCore.Authentication.WsFederation](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.WsFederation))</span><span class="sxs-lookup"><span data-stu-id="a5355-241">WsFederation authentication ([Microsoft.AspNetCore.Authentication.WsFederation](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.WsFederation))</span></span>

* <span data-ttu-id="a5355-242">Le formatage et `System.Net.HttpClient` &ndash; le support de négociation de contenu pour le paquet [NuGet Microsoft.AspNet.WebApi.Client](https://www.nuget.org/packages/Microsoft.AspNet.WebApi.Client/) fournit une efficacité utile avec `System.Net.HttpClient` les API telles que `ReadAsAsync` et `PostJsonAsync`.</span><span class="sxs-lookup"><span data-stu-id="a5355-242">Formatting and content negotiation support for `System.Net.HttpClient` &ndash; The [Microsoft.AspNet.WebApi.Client](https://www.nuget.org/packages/Microsoft.AspNet.WebApi.Client/) NuGet package provides useful extensibility to `System.Net.HttpClient` with APIs such as `ReadAsAsync` and `PostJsonAsync`.</span></span>

* <span data-ttu-id="a5355-243">Razor runtime &ndash; compilation Support for runtime compilation of Razor views and pages is now part of [Microsoft.AspNetCore.Mvc.Razor.RuntimeCompilation](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Razor.RuntimeCompilation).</span><span class="sxs-lookup"><span data-stu-id="a5355-243">Razor runtime compilation &ndash; Support for runtime compilation of Razor views and pages is now part of [Microsoft.AspNetCore.Mvc.Razor.RuntimeCompilation](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Razor.RuntimeCompilation).</span></span>

* <span data-ttu-id="a5355-244">MVC `Newtonsoft.Json` (Json.NET) support &ndash; Support for using `Newtonsoft.Json` MVC with is now part of [Microsoft.AspNetCore.Mvc.NewtonsoftJson](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.NewtonsoftJson).</span><span class="sxs-lookup"><span data-stu-id="a5355-244">MVC `Newtonsoft.Json` (Json.NET) support &ndash; Support for using MVC with `Newtonsoft.Json` is now part of [Microsoft.AspNetCore.Mvc.NewtonsoftJson](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.NewtonsoftJson).</span></span>

## <a name="startup-changes"></a><span data-ttu-id="a5355-245">Changements de démarrage</span><span class="sxs-lookup"><span data-stu-id="a5355-245">Startup changes</span></span>

<span data-ttu-id="a5355-246">L’image suivante montre les lignes supprimées et modifiées dans une application Web ASP.NET Core 2.2 Razor Pages :</span><span class="sxs-lookup"><span data-stu-id="a5355-246">The following image shows the deleted and changed lines in an ASP.NET Core 2.2 Razor Pages Web app:</span></span>

![les lignes supprimées et modifiées dans une application Web ASP.NET Core 2.2 Razor](22-to-30/_static/startup2.2.png)

<span data-ttu-id="a5355-248">Dans l’image précédente, le code supprimé est affiché en rouge.</span><span class="sxs-lookup"><span data-stu-id="a5355-248">In the preceding image, deleted code is shown in red.</span></span> <span data-ttu-id="a5355-249">Le code supprimé n’affiche pas de code d’options de cookies, qui a été supprimé avant de comparer les fichiers.</span><span class="sxs-lookup"><span data-stu-id="a5355-249">The deleted code doesn't show cookie options code, which was deleted prior to comparing the files.</span></span>

<span data-ttu-id="a5355-250">L’image suivante montre les lignes ajoutées et modifiées dans une application Web ASP.NET Core 3.0 Razor Pages :</span><span class="sxs-lookup"><span data-stu-id="a5355-250">The following image shows the added and changed lines in an ASP.NET Core 3.0 Razor Pages Web app:</span></span>

![les lignes ajoutées et modifiées dans une application Web De ASP.NET Core 3.0 Razor](22-to-30/_static/startup3.0.png)

<span data-ttu-id="a5355-252">Dans l’image précédente, le code ajouté est affiché en vert.</span><span class="sxs-lookup"><span data-stu-id="a5355-252">In the preceding image, added code is shown in green.</span></span> <span data-ttu-id="a5355-253">Pour plus d’informations sur les modifications suivantes :</span><span class="sxs-lookup"><span data-stu-id="a5355-253">For information on the following changes:</span></span>

* <span data-ttu-id="a5355-254">`services.AddMvc`voir `services.AddRazorPages` [l’enregistrement du service MVC](#mvc-service-registration) dans ce document.</span><span class="sxs-lookup"><span data-stu-id="a5355-254">`services.AddMvc` to `services.AddRazorPages`, see [MVC service registration](#mvc-service-registration) in this document.</span></span>
* <span data-ttu-id="a5355-255">`CompatibilityVersion`, <xref:mvc/compatibility-version>voir .</span><span class="sxs-lookup"><span data-stu-id="a5355-255">`CompatibilityVersion`, see <xref:mvc/compatibility-version>.</span></span>
* <span data-ttu-id="a5355-256">`IHostingEnvironment`à `IWebHostEnvironment`, voir [cette annonce GitHub](https://github.com/dotnet/AspNetCore/issues/7749).</span><span class="sxs-lookup"><span data-stu-id="a5355-256">`IHostingEnvironment` to `IWebHostEnvironment`, see [this GitHub announcement](https://github.com/dotnet/AspNetCore/issues/7749).</span></span>
* <span data-ttu-id="a5355-257">`app.UseAuthorization`a été ajouté aux modèles pour montrer l’autorisation de commande middleware doit être ajouté.</span><span class="sxs-lookup"><span data-stu-id="a5355-257">`app.UseAuthorization` was added to the templates to show the order authorization middleware must be added.</span></span> <span data-ttu-id="a5355-258">Si l’application n’utilise pas l’autorisation, `app.UseAuthorization`vous pouvez supprimer l’appel en toute sécurité à .</span><span class="sxs-lookup"><span data-stu-id="a5355-258">If the app doesn't use authorization, you can safely remove the call to `app.UseAuthorization`.</span></span>
* <span data-ttu-id="a5355-259">`app.UseEndpoints`, voir [Razor Pages](#razor-pages) ou [Migrate Startup.Configure](#migrate-startupconfigure) dans ce document.</span><span class="sxs-lookup"><span data-stu-id="a5355-259">`app.UseEndpoints`, see [Razor Pages](#razor-pages) or [Migrate Startup.Configure](#migrate-startupconfigure) in this document.</span></span>

### <a name="analyzer-support"></a><span data-ttu-id="a5355-260">Soutien de l’analyseur</span><span class="sxs-lookup"><span data-stu-id="a5355-260">Analyzer support</span></span>

<span data-ttu-id="a5355-261">Projets `Microsoft.NET.Sdk.Web` qui ciblent implicitement des analyseurs de référence précédemment expédiés dans le cadre du paquet [Microsoft.AspNetCore.Mvc.Analyzers.](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Analyzers/)</span><span class="sxs-lookup"><span data-stu-id="a5355-261">Projects that target `Microsoft.NET.Sdk.Web` implicitly reference analyzers previously shipped as part of the [Microsoft.AspNetCore.Mvc.Analyzers](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Analyzers/) package.</span></span> <span data-ttu-id="a5355-262">Aucune référence supplémentaire n’est requise pour les activer.</span><span class="sxs-lookup"><span data-stu-id="a5355-262">No additional references are required to enable these.</span></span>

<span data-ttu-id="a5355-263">Si votre application utilise [des analyseurs API](xref:web-api/advanced/analyzers) précédemment expédiés à l’aide du paquet [Microsoft.AspNetCore.Mvc.Api.Analyzers,](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Api.Analyzers/) modifiez votre fichier de projet pour référencer les analyseurs expédiés dans le cadre du .NET Core Web SDK :</span><span class="sxs-lookup"><span data-stu-id="a5355-263">If your app uses [API analyzers](xref:web-api/advanced/analyzers) previously shipped using the [Microsoft.AspNetCore.Mvc.Api.Analyzers](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Api.Analyzers/) package, edit your project file to reference the analyzers shipped as part of the .NET Core Web SDK:</span></span>

```xml
<Project Sdk="Microsoft.NET.Sdk.Web">
    <PropertyGroup>
        <TargetFramework>netcoreapp3.0</TargetFramework>
        <IncludeOpenAPIAnalyzers>true</IncludeOpenAPIAnalyzers>
    </PropertyGroup>

    ...
</Project>
```

### <a name="razor-class-library"></a><span data-ttu-id="a5355-264">Bibliothèque de classes Razor</span><span class="sxs-lookup"><span data-stu-id="a5355-264">Razor Class Library</span></span>

<span data-ttu-id="a5355-265">Les projets de razor Class Library qui fournissent `AddRazorSupportForMvc` des composants d’assurance-chômage pour MVC doivent définir la propriété dans le dossier du projet :</span><span class="sxs-lookup"><span data-stu-id="a5355-265">Razor Class Library projects that provide UI components for MVC must set the `AddRazorSupportForMvc` property in the project file:</span></span>

```xml
<PropertyGroup>
  <AddRazorSupportForMvc>true</AddRazorSupportForMvc>
</PropertyGroup>
```

### <a name="in-process-hosting-model"></a><span data-ttu-id="a5355-266">Modèle d’hébergement in-process</span><span class="sxs-lookup"><span data-stu-id="a5355-266">In-process hosting model</span></span>

<span data-ttu-id="a5355-267">Projets par défaut au [modèle d’hébergement en cours](xref:host-and-deploy/aspnet-core-module#in-process-hosting-model) dans ASP.NET Core 3.0 ou plus tard.</span><span class="sxs-lookup"><span data-stu-id="a5355-267">Projects default to the [in-process hosting model](xref:host-and-deploy/aspnet-core-module#in-process-hosting-model) in ASP.NET Core 3.0 or later.</span></span> <span data-ttu-id="a5355-268">Vous pouvez supprimer `<AspNetCoreHostingModel>` la propriété dans le fichier `InProcess`du projet si sa valeur est .</span><span class="sxs-lookup"><span data-stu-id="a5355-268">You may optionally remove the `<AspNetCoreHostingModel>` property in the project file if its value is `InProcess`.</span></span>

## <a name="kestrel"></a><span data-ttu-id="a5355-269">Kestrel</span><span class="sxs-lookup"><span data-stu-id="a5355-269">Kestrel</span></span>

### <a name="configuration"></a><span data-ttu-id="a5355-270">Configuration</span><span class="sxs-lookup"><span data-stu-id="a5355-270">Configuration</span></span>

<span data-ttu-id="a5355-271">Configuration De Miigérrel au constructeur `ConfigureWebHostDefaults` d’hébergeur web fourni par (*Program.cs*) :</span><span class="sxs-lookup"><span data-stu-id="a5355-271">Migrate Kestrel configuration to the web host builder provided by `ConfigureWebHostDefaults` (*Program.cs*):</span></span>

```csharp
public static IHostBuilder CreateHostBuilder(string[] args) =>
    Host.CreateDefaultBuilder(args)
        .ConfigureWebHostDefaults(webBuilder =>
        {
            webBuilder.ConfigureKestrel(serverOptions =>
            {
                // Set properties and call methods on options
            })
            .UseStartup<Startup>();
        });
```

<span data-ttu-id="a5355-272">Si l’application crée l’hôte manuellement avec `HostBuilder`, faire appel `UseKestrel` au constructeur hébergeur dans `ConfigureWebHostDefaults`:</span><span class="sxs-lookup"><span data-stu-id="a5355-272">If the app creates the host manually with `HostBuilder`, call `UseKestrel` on the web host builder in `ConfigureWebHostDefaults`:</span></span>

```csharp
public static void Main(string[] args)
{
    var host = new HostBuilder()
        .UseContentRoot(Directory.GetCurrentDirectory())
        .ConfigureWebHostDefaults(webBuilder =>
        {
            webBuilder.UseKestrel(serverOptions =>
            {
                // Set properties and call methods on options
            })
            .UseIISIntegration()
            .UseStartup<Startup>();
        })
        .Build();

    host.Run();
}
```

### <a name="connection-middleware-replaces-connection-adapters"></a><span data-ttu-id="a5355-273">Connection Middleware remplace les adaptateurs de connexion</span><span class="sxs-lookup"><span data-stu-id="a5355-273">Connection Middleware replaces Connection Adapters</span></span>

<span data-ttu-id="a5355-274">Les adaptateurs`Microsoft.AspNetCore.Server.Kestrel.Core.Adapter.Internal.IConnectionAdapter`de connexion ( ) ont été supprimés de Kestrel.</span><span class="sxs-lookup"><span data-stu-id="a5355-274">Connection Adapters (`Microsoft.AspNetCore.Server.Kestrel.Core.Adapter.Internal.IConnectionAdapter`) have been removed from Kestrel.</span></span> <span data-ttu-id="a5355-275">Remplacer les adaptateurs de connexion par Connection Middleware.</span><span class="sxs-lookup"><span data-stu-id="a5355-275">Replace Connection Adapters with Connection Middleware.</span></span> <span data-ttu-id="a5355-276">Connexion Middleware est similaire à HTTP Middleware dans le pipeline ASP.NET Core, mais pour les connexions de niveau inférieur.</span><span class="sxs-lookup"><span data-stu-id="a5355-276">Connection Middleware is similar to HTTP Middleware in the ASP.NET Core pipeline but for lower-level connections.</span></span> <span data-ttu-id="a5355-277">HTTPS et l’enregistrement de connexion:</span><span class="sxs-lookup"><span data-stu-id="a5355-277">HTTPS and connection logging:</span></span>

* <span data-ttu-id="a5355-278">Ont été déplacés de Connection Adapters à Connection Middleware.</span><span class="sxs-lookup"><span data-stu-id="a5355-278">Have been moved from Connection Adapters to Connection Middleware.</span></span>
* <span data-ttu-id="a5355-279">Ces méthodes d’extension fonctionnent comme dans les versions précédentes de ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="a5355-279">These extension methods work as in previous versions of ASP.NET Core.</span></span> 

<span data-ttu-id="a5355-280">Pour plus d’informations, voir [l’exemple de TlsFilterConnectionHandler dans la section ListenOptions.Protocols de l’article Kestrel](/aspnet/core/fundamentals/servers/kestrel?view=aspnetcore-3.0#listenoptionsprotocols).</span><span class="sxs-lookup"><span data-stu-id="a5355-280">For more information, see [the TlsFilterConnectionHandler example in the ListenOptions.Protocols section of the Kestrel article](/aspnet/core/fundamentals/servers/kestrel?view=aspnetcore-3.0#listenoptionsprotocols).</span></span>

### <a name="transport-abstractions-moved-and-made-public"></a><span data-ttu-id="a5355-281">Les abstractions de transport se sont déplacées et rendues publiques</span><span class="sxs-lookup"><span data-stu-id="a5355-281">Transport abstractions moved and made public</span></span>

<span data-ttu-id="a5355-282">La couche de transport Kestrel a `Connections.Abstractions`été exposée comme une interface publique dans .</span><span class="sxs-lookup"><span data-stu-id="a5355-282">The Kestrel transport layer has been exposed as a public interface in `Connections.Abstractions`.</span></span> <span data-ttu-id="a5355-283">Dans le cadre de ces mises à jour :</span><span class="sxs-lookup"><span data-stu-id="a5355-283">As part of these updates:</span></span>

* <span data-ttu-id="a5355-284">`Microsoft.AspNetCore.Server.Kestrel.Transport.Abstractions`et les types associés ont été supprimés.</span><span class="sxs-lookup"><span data-stu-id="a5355-284">`Microsoft.AspNetCore.Server.Kestrel.Transport.Abstractions` and associated types have been removed.</span></span>
* <span data-ttu-id="a5355-285"><xref:Microsoft.AspNetCore.Server.Kestrel.KestrelServerOptions.NoDelay>a été <xref:Microsoft.AspNetCore.Server.Kestrel.Core.ListenOptions> déplacé des options de transport.</span><span class="sxs-lookup"><span data-stu-id="a5355-285"><xref:Microsoft.AspNetCore.Server.Kestrel.KestrelServerOptions.NoDelay> was moved from <xref:Microsoft.AspNetCore.Server.Kestrel.Core.ListenOptions> to the transport options.</span></span>
* <span data-ttu-id="a5355-286">`Microsoft.AspNetCore.Server.Kestrel.Transport.Abstractions.Internal.SchedulingMode`a été <xref:Microsoft.AspNetCore.Server.Kestrel.KestrelServerOptions>retiré de .</span><span class="sxs-lookup"><span data-stu-id="a5355-286">`Microsoft.AspNetCore.Server.Kestrel.Transport.Abstractions.Internal.SchedulingMode` was removed from <xref:Microsoft.AspNetCore.Server.Kestrel.KestrelServerOptions>.</span></span>

<span data-ttu-id="a5355-287">Pour plus d’informations, voir les ressources GitHub suivantes :</span><span class="sxs-lookup"><span data-stu-id="a5355-287">For more information, see the following GitHub resources:</span></span>

* [<span data-ttu-id="a5355-288">Abstractions de réseautage client/serveur (dotnet/AspNetCore #10308)</span><span class="sxs-lookup"><span data-stu-id="a5355-288">Client/server networking abstractions (dotnet/AspNetCore #10308)</span></span>](https://github.com/dotnet/AspNetCore/issues/10308)
* [<span data-ttu-id="a5355-289">Implémentez la nouvelle abstraction de l’auditeur de base et re-plat Kestrel sur le dessus (dotnet/AspNetCore #10321)</span><span class="sxs-lookup"><span data-stu-id="a5355-289">Implement new bedrock listener abstraction and re-plat Kestrel on top (dotnet/AspNetCore #10321)</span></span>](https://github.com/dotnet/AspNetCore/pull/10321)

### <a name="kestrel-request-trailer-headers"></a><span data-ttu-id="a5355-290">En-têtes de remorque de Kestrel Request</span><span class="sxs-lookup"><span data-stu-id="a5355-290">Kestrel Request trailer headers</span></span>

<span data-ttu-id="a5355-291">Pour les applications qui ciblent les versions antérieures de ASP.NET Core :</span><span class="sxs-lookup"><span data-stu-id="a5355-291">For apps that target earlier versions of ASP.NET Core:</span></span>

* <span data-ttu-id="a5355-292">Kestrel ajoute HTTP/1.1 en-têtes de remorque en morceaux dans la collection d’en-têtes de demande.</span><span class="sxs-lookup"><span data-stu-id="a5355-292">Kestrel adds HTTP/1.1 chunked trailer headers into the request headers collection.</span></span>
* <span data-ttu-id="a5355-293">Les remorques sont disponibles après que le corps de demande soit lu jusqu’à la fin.</span><span class="sxs-lookup"><span data-stu-id="a5355-293">Trailers are available after the request body is read to the end.</span></span>

<span data-ttu-id="a5355-294">Cela provoque des préoccupations au sujet de l’ambiguïté entre les en-têtes et les remorques, de sorte que les remorques ont été déplacés vers une nouvelle collection (`RequestTrailerExtensions`) en 3.0.</span><span class="sxs-lookup"><span data-stu-id="a5355-294">This causes some concerns about ambiguity between headers and trailers, so the trailers have been moved to a new collection (`RequestTrailerExtensions`) in 3.0.</span></span>

<span data-ttu-id="a5355-295">LES bandes-annonces de demande HTTP/2 sont les :</span><span class="sxs-lookup"><span data-stu-id="a5355-295">HTTP/2 request trailers are:</span></span>

* <span data-ttu-id="a5355-296">Non disponible en ASP.NET Core 2.2.</span><span class="sxs-lookup"><span data-stu-id="a5355-296">Not available in ASP.NET Core 2.2.</span></span>
* <span data-ttu-id="a5355-297">Disponible en 3.0 as `RequestTrailerExtensions`.</span><span class="sxs-lookup"><span data-stu-id="a5355-297">Available in 3.0 as `RequestTrailerExtensions`.</span></span>

<span data-ttu-id="a5355-298">De nouvelles méthodes d’extension de demande sont présentes pour accéder à ces remorques.</span><span class="sxs-lookup"><span data-stu-id="a5355-298">New request extension methods are present to access these trailers.</span></span> <span data-ttu-id="a5355-299">Comme avec HTTP/1.1, les remorques sont disponibles après que le corps de demande soit lu jusqu’à la fin.</span><span class="sxs-lookup"><span data-stu-id="a5355-299">As with HTTP/1.1, trailers are available after the request body is read to the end.</span></span>

<span data-ttu-id="a5355-300">Pour la version 3.0, les méthodes suivantes `RequestTrailerExtensions` sont disponibles :</span><span class="sxs-lookup"><span data-stu-id="a5355-300">For the 3.0 release, the following `RequestTrailerExtensions` methods are available:</span></span>

* <span data-ttu-id="a5355-301">`GetDeclaredTrailers`&ndash; Obtient l’en-tête de demande `Trailer` qui énumère quelles remorques à attendre après le corps.</span><span class="sxs-lookup"><span data-stu-id="a5355-301">`GetDeclaredTrailers` &ndash; Gets the request `Trailer` header that lists which trailers to expect after the body.</span></span>
* <span data-ttu-id="a5355-302">`SupportsTrailers`&ndash; Indique si la demande prend en charge la réception des en-têtes de remorque.</span><span class="sxs-lookup"><span data-stu-id="a5355-302">`SupportsTrailers` &ndash; Indicates if the request supports receiving trailer headers.</span></span>
* <span data-ttu-id="a5355-303">`CheckTrailersAvailable`&ndash; Vérifie si la demande prend en charge les remorques et si elles sont disponibles pour être lues.</span><span class="sxs-lookup"><span data-stu-id="a5355-303">`CheckTrailersAvailable` &ndash; Checks if the request supports trailers and if they're available to be read.</span></span> <span data-ttu-id="a5355-304">Cette vérification ne suppose pas qu’il ya des remorques à lire.</span><span class="sxs-lookup"><span data-stu-id="a5355-304">This check doesn't assume that there are trailers to read.</span></span> <span data-ttu-id="a5355-305">Il n’y a peut-être pas de remorques à lire même si cette `true` méthode est retournée.</span><span class="sxs-lookup"><span data-stu-id="a5355-305">There might be no trailers to read even if `true` is returned by this method.</span></span>
* <span data-ttu-id="a5355-306">`GetTrailer`&ndash; Obtient l’en-tête de fuite demandé de la réponse.</span><span class="sxs-lookup"><span data-stu-id="a5355-306">`GetTrailer` &ndash; Gets the requested trailing header from the response.</span></span> <span data-ttu-id="a5355-307">Vérifiez `SupportsTrailers` avant `GetTrailer`d’appeler, ou un <xref:System.NotSupportedException> peut se produire si la demande ne prend pas en charge les en-têtes de fuite.</span><span class="sxs-lookup"><span data-stu-id="a5355-307">Check `SupportsTrailers` before calling `GetTrailer`, or a <xref:System.NotSupportedException> may occur if the request doesn't support trailing headers.</span></span>

<span data-ttu-id="a5355-308">Pour plus d’informations, voir [les bandes-annonces De la demande Put dans une collection distincte (dotnet/AspNetCore #10410)](https://github.com/dotnet/AspNetCore/pull/10410).</span><span class="sxs-lookup"><span data-stu-id="a5355-308">For more information, see [Put request trailers in a separate collection (dotnet/AspNetCore #10410)](https://github.com/dotnet/AspNetCore/pull/10410).</span></span>

### <a name="allowsynchronousio-disabled"></a><span data-ttu-id="a5355-309">PermettreSynchronousIO désactivé</span><span class="sxs-lookup"><span data-stu-id="a5355-309">AllowSynchronousIO disabled</span></span>

<span data-ttu-id="a5355-310">`AllowSynchronousIO`permet ou désactive les API synchrones `HttpRequest.Body.Read`I/O, telles que , `HttpResponse.Body.Write`, et `Stream.Flush`.</span><span class="sxs-lookup"><span data-stu-id="a5355-310">`AllowSynchronousIO` enables or disables synchronous I/O APIs, such as `HttpRequest.Body.Read`, `HttpResponse.Body.Write`, and `Stream.Flush`.</span></span> <span data-ttu-id="a5355-311">Ces API sont une source de famine de thread conduisant à des plantages d’applications.</span><span class="sxs-lookup"><span data-stu-id="a5355-311">These APIs are a source of thread starvation leading to app crashes.</span></span> <span data-ttu-id="a5355-312">En 3.0, `AllowSynchronousIO` est désactivé par défaut.</span><span class="sxs-lookup"><span data-stu-id="a5355-312">In 3.0, `AllowSynchronousIO` is disabled by default.</span></span> <span data-ttu-id="a5355-313">Pour plus d’informations, voir [la section Synchronous I/O dans l’article de Kestrel](/aspnet/core/fundamentals/servers/kestrel?view=aspnetcore-3.0#synchronous-io).</span><span class="sxs-lookup"><span data-stu-id="a5355-313">For more information, see [the Synchronous I/O section in the Kestrel article](/aspnet/core/fundamentals/servers/kestrel?view=aspnetcore-3.0#synchronous-io).</span></span>

<span data-ttu-id="a5355-314">Si une synchronisation I/O est nécessaire, elle peut `AllowSynchronousIO` être activée en configurant l’option sur le serveur utilisé (lors de l’appel, `ConfigureKestrel`par exemple, si vous utilisez Kestrel).</span><span class="sxs-lookup"><span data-stu-id="a5355-314">If synchronous I/O is needed, it can be enabled by configuring the `AllowSynchronousIO` option on the server being used (when calling `ConfigureKestrel`, for example, if using Kestrel).</span></span> <span data-ttu-id="a5355-315">Notez que les serveurs (Kestrel, HttpSys, TestServer, `AllowSynchronousIO` etc.) ont tous leur propre option qui n’affectera pas les autres serveurs.</span><span class="sxs-lookup"><span data-stu-id="a5355-315">Note that servers (Kestrel, HttpSys, TestServer, etc.) all have their own `AllowSynchronousIO` option that won't affect other servers.</span></span> <span data-ttu-id="a5355-316">Synchronous I/O peut être activé pour tous les serveurs `IHttpBodyControlFeature.AllowSynchronousIO` sur une base par demande en utilisant l’option:</span><span class="sxs-lookup"><span data-stu-id="a5355-316">Synchronous I/O can be enabled for all servers on a per-request basis using the `IHttpBodyControlFeature.AllowSynchronousIO` option:</span></span>

```csharp
var syncIOFeature = HttpContext.Features.Get<IHttpBodyControlFeature>();

if (syncIOFeature != null)
{
    syncIOFeature.AllowSynchronousIO = true;
}
```

<span data-ttu-id="a5355-317">Si vous avez <xref:System.IO.TextWriter> des problèmes avec les implémentations ou d’autres flux qui appellent des API synchrones dans [Dispose](/dotnet/standard/garbage-collection/implementing-dispose), appelez plutôt la nouvelle <xref:System.IO.Stream.DisposeAsync*> API.</span><span class="sxs-lookup"><span data-stu-id="a5355-317">If you have trouble with <xref:System.IO.TextWriter> implementations or other streams that call synchronous APIs in [Dispose](/dotnet/standard/garbage-collection/implementing-dispose), call the new <xref:System.IO.Stream.DisposeAsync*> API instead.</span></span>

<span data-ttu-id="a5355-318">Pour plus d’informations, voir [[Annonce] AllowSynchronousIO désactivé dans tous les serveurs (dotnet/AspNetCore #7644)](https://github.com/dotnet/AspNetCore/issues/7644).</span><span class="sxs-lookup"><span data-stu-id="a5355-318">For more information, see [[Announcement] AllowSynchronousIO disabled in all servers (dotnet/AspNetCore #7644)](https://github.com/dotnet/AspNetCore/issues/7644).</span></span>

### <a name="microsoftaspnetcoreserverkestrelhttps-assembly-removed"></a><span data-ttu-id="a5355-319">Microsoft.AspNetCore.Server.Kestrel.Https assemblage supprimé</span><span class="sxs-lookup"><span data-stu-id="a5355-319">Microsoft.AspNetCore.Server.Kestrel.Https assembly removed</span></span>

<span data-ttu-id="a5355-320">Dans ASP.NET Core 2.1, le contenu de *Microsoft.AspNetCore.Server.Kestrel.https.dll* ont été transférés à *Microsoft.AspNetCore.Server.Kestrel.Core.dll*.</span><span class="sxs-lookup"><span data-stu-id="a5355-320">In ASP.NET Core 2.1, the contents of *Microsoft.AspNetCore.Server.Kestrel.Https.dll* were moved to *Microsoft.AspNetCore.Server.Kestrel.Core.dll*.</span></span> <span data-ttu-id="a5355-321">Il s’agissait d’une mise à jour non-rupture en utilisant `TypeForwardedTo` des attributs.</span><span class="sxs-lookup"><span data-stu-id="a5355-321">This was a non-breaking update using `TypeForwardedTo` attributes.</span></span> <span data-ttu-id="a5355-322">Pour 3.0, l’assemblage vide *de Microsoft.AspNetCore.Server.Kestrel.Https.dll* et le paquet NuGet ont été supprimés.</span><span class="sxs-lookup"><span data-stu-id="a5355-322">For 3.0, the empty *Microsoft.AspNetCore.Server.Kestrel.Https.dll* assembly and the NuGet package have been removed.</span></span>

<span data-ttu-id="a5355-323">Les bibliothèques faisant référence à [Microsoft.AspNetCore.Server.Kestrel.Https](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.Kestrel.Https) devraient mettre à jour ASP.NET dépendances de base à 2,1 ou plus tard.</span><span class="sxs-lookup"><span data-stu-id="a5355-323">Libraries referencing [Microsoft.AspNetCore.Server.Kestrel.Https](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.Kestrel.Https) should update ASP.NET Core dependencies to 2.1 or later.</span></span>

<span data-ttu-id="a5355-324">Les applications et les bibliothèques ciblant ASP.NET Core 2.1 ou plus tard doivent supprimer toute référence directe au package [Microsoft.AspNetCore.Server.Kestrel.Https.](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.Kestrel.Https)</span><span class="sxs-lookup"><span data-stu-id="a5355-324">Apps and libraries targeting ASP.NET Core 2.1 or later should remove any direct references to the [Microsoft.AspNetCore.Server.Kestrel.Https](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.Kestrel.Https) package.</span></span>

<a id="jsonnet-support"></a>

## <a name="newtonsoftjson-jsonnet-support"></a><span data-ttu-id="a5355-325">Soutien de Newtonsoft.Json (Json.NET)</span><span class="sxs-lookup"><span data-stu-id="a5355-325">Newtonsoft.Json (Json.NET) support</span></span>

<span data-ttu-id="a5355-326">Dans le cadre des travaux visant à [améliorer le cadre partagé ASP.NET Core](https://blogs.msdn.microsoft.com/webdev/2018/10/29/a-first-look-at-changes-coming-in-asp-net-core-3-0/), [Newtonsoft.Json (Json.NET)](https://www.newtonsoft.com/json/help/html/Introduction.htm) a été retiré du cadre partagé ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="a5355-326">As part of the work to [improve the ASP.NET Core shared framework](https://blogs.msdn.microsoft.com/webdev/2018/10/29/a-first-look-at-changes-coming-in-asp-net-core-3-0/), [Newtonsoft.Json (Json.NET)](https://www.newtonsoft.com/json/help/html/Introduction.htm) has been removed from the ASP.NET Core shared framework.</span></span>

<span data-ttu-id="a5355-327">Le sérialisateur JSON par défaut <xref:System.Text.Json>pour ASP.NET Core est maintenant , qui est nouveau dans .NET Core 3.0.</span><span class="sxs-lookup"><span data-stu-id="a5355-327">The default JSON serializer for ASP.NET Core is now <xref:System.Text.Json>, which is new in .NET Core 3.0.</span></span> <span data-ttu-id="a5355-328">Envisagez `System.Text.Json` d’utiliser lorsque c’est possible.</span><span class="sxs-lookup"><span data-stu-id="a5355-328">Consider using `System.Text.Json` when possible.</span></span> <span data-ttu-id="a5355-329">Il est de haute performance et ne nécessite pas une dépendance supplémentaire de la bibliothèque.</span><span class="sxs-lookup"><span data-stu-id="a5355-329">It's high-performance and doesn't require an additional library dependency.</span></span> <span data-ttu-id="a5355-330">Cependant, `System.Text.Json` depuis qu’il est nouveau, il pourrait actuellement manquer des fonctionnalités dont votre application a besoin.</span><span class="sxs-lookup"><span data-stu-id="a5355-330">However, since `System.Text.Json` is new, it might currently be missing features that your app needs.</span></span> <span data-ttu-id="a5355-331">Pour plus d’informations, voir [Comment migrer de Newtonsoft.Json à System.Text.Json](/dotnet/standard/serialization/system-text-json-migrate-from-newtonsoft-how-to).</span><span class="sxs-lookup"><span data-stu-id="a5355-331">For more information, see [How to migrate from Newtonsoft.Json to System.Text.Json](/dotnet/standard/serialization/system-text-json-migrate-from-newtonsoft-how-to).</span></span>

### <a name="use-newtonsoftjson-in-an-aspnet-core-30-opno-locsignalr-project"></a><span data-ttu-id="a5355-332">Utilisez Newtonsoft.Json dans un projet ASP.NET Core SignalR 3.0</span><span class="sxs-lookup"><span data-stu-id="a5355-332">Use Newtonsoft.Json in an ASP.NET Core 3.0 SignalR project</span></span>

* <span data-ttu-id="a5355-333">Installez le [SignalRMicrosoft.AspNetCore. . Paquet Protocols.NewtonsoftJson](https://www.nuget.org/packages/Microsoft.AspNetCore.SignalR.Protocols.NewtonsoftJson) NuGet.</span><span class="sxs-lookup"><span data-stu-id="a5355-333">Install the [Microsoft.AspNetCore.SignalR.Protocols.NewtonsoftJson](https://www.nuget.org/packages/Microsoft.AspNetCore.SignalR.Protocols.NewtonsoftJson) NuGet package.</span></span>

* <span data-ttu-id="a5355-334">Sur le client, `AddNewtonsoftJsonProtocol` enchaîner un appel de méthode à l’instance `HubConnectionBuilder` :</span><span class="sxs-lookup"><span data-stu-id="a5355-334">On the client, chain an `AddNewtonsoftJsonProtocol` method call to the `HubConnectionBuilder` instance:</span></span>

  ```csharp
  new HubConnectionBuilder()
      .WithUrl("/chatHub")
      .AddNewtonsoftJsonProtocol(...)
      .Build();
  ```

* <span data-ttu-id="a5355-335">Sur le serveur, `AddNewtonsoftJsonProtocol` enchaîner un appel de méthode à la `AddSignalR` méthode appelez dans `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="a5355-335">On the server, chain an `AddNewtonsoftJsonProtocol` method call to the `AddSignalR` method call in `Startup.ConfigureServices`:</span></span>

  ```csharp
  services.AddSignalR()
      .AddNewtonsoftJsonProtocol(...);
  ```

### <a name="use-newtonsoftjson-in-an-aspnet-core-30-mvc-project"></a><span data-ttu-id="a5355-336">Utilisez Newtonsoft.Json dans un projet ASP.NET Core 3.0 MVC</span><span class="sxs-lookup"><span data-stu-id="a5355-336">Use Newtonsoft.Json in an ASP.NET Core 3.0 MVC project</span></span>

* <span data-ttu-id="a5355-337">Installez le package [Microsoft.AspNetCore.Mvc.NewtonsoftJson.](https://nuget.org/packages/Microsoft.AspNetCore.Mvc.NewtonsoftJson)</span><span class="sxs-lookup"><span data-stu-id="a5355-337">Install the [Microsoft.AspNetCore.Mvc.NewtonsoftJson](https://nuget.org/packages/Microsoft.AspNetCore.Mvc.NewtonsoftJson) package.</span></span>

* <span data-ttu-id="a5355-338">Mise `Startup.ConfigureServices` à `AddNewtonsoftJson`jour pour appeler .</span><span class="sxs-lookup"><span data-stu-id="a5355-338">Update `Startup.ConfigureServices` to call `AddNewtonsoftJson`.</span></span>

  ```csharp
  services.AddMvc()
      .AddNewtonsoftJson();
  ```

  <span data-ttu-id="a5355-339">`AddNewtonsoftJson`est compatible avec les nouvelles méthodes d’enregistrement des services MVC :</span><span class="sxs-lookup"><span data-stu-id="a5355-339">`AddNewtonsoftJson` is compatible with the new MVC service registration methods:</span></span>

  * `AddRazorPages`
  * `AddControllersWithViews`
  * `AddControllers`

  ```csharp
  services.AddControllers()
      .AddNewtonsoftJson();
  ```

  <span data-ttu-id="a5355-340">`Newtonsoft.Json`les paramètres peuvent être `AddNewtonsoftJson`définis dans l’appel à :</span><span class="sxs-lookup"><span data-stu-id="a5355-340">`Newtonsoft.Json` settings can be set in the call to `AddNewtonsoftJson`:</span></span>

  ```csharp
  services.AddMvc()
      .AddNewtonsoftJson(options =>
             options.SerializerSettings.ContractResolver =
                new CamelCasePropertyNamesContractResolver());
  ```

<span data-ttu-id="a5355-341">**Note:** Si `AddNewtonsoftJson` la méthode n’est pas disponible, assurez-vous d’avoir installé le package [Microsoft.AspNetCore.Mvc.NewtonsoftJson.](https://nuget.org/packages/Microsoft.AspNetCore.Mvc.NewtonsoftJson)</span><span class="sxs-lookup"><span data-stu-id="a5355-341">**Note:** If the `AddNewtonsoftJson` method isn't available, make sure that you installed the [Microsoft.AspNetCore.Mvc.NewtonsoftJson](https://nuget.org/packages/Microsoft.AspNetCore.Mvc.NewtonsoftJson) package.</span></span> <span data-ttu-id="a5355-342">Une erreur commune est d’installer le paquet [Newtonsoft.Json](https://www.nuget.org/packages/Newtonsoft.Json/) au lieu du paquet [Microsoft.AspNetCore.Mvc.NewtonsoftJson.](https://nuget.org/packages/Microsoft.AspNetCore.Mvc.NewtonsoftJson)</span><span class="sxs-lookup"><span data-stu-id="a5355-342">A common error is to install the [Newtonsoft.Json](https://www.nuget.org/packages/Newtonsoft.Json/) package instead of the [Microsoft.AspNetCore.Mvc.NewtonsoftJson](https://nuget.org/packages/Microsoft.AspNetCore.Mvc.NewtonsoftJson) package.</span></span>

## <a name="mvc-service-registration"></a><span data-ttu-id="a5355-343">Enregistrement du service MVC</span><span class="sxs-lookup"><span data-stu-id="a5355-343">MVC service registration</span></span>

<span data-ttu-id="a5355-344">ASP.NET Core 3.0 ajoute de nouvelles options pour l’enregistrement des scénarios MVC à l’intérieur `Startup.ConfigureServices`.</span><span class="sxs-lookup"><span data-stu-id="a5355-344">ASP.NET Core 3.0 adds new options for registering MVC scenarios inside `Startup.ConfigureServices`.</span></span>

<span data-ttu-id="a5355-345">Trois nouvelles méthodes d’extension de haut `IServiceCollection` niveau liées aux scénarios MVC sont disponibles.</span><span class="sxs-lookup"><span data-stu-id="a5355-345">Three new top-level extension methods related to MVC scenarios on `IServiceCollection` are available.</span></span> <span data-ttu-id="a5355-346">Modèles utiliser ces nouvelles `AddMvc`méthodes au lieu de .</span><span class="sxs-lookup"><span data-stu-id="a5355-346">Templates use these new methods instead of `AddMvc`.</span></span> <span data-ttu-id="a5355-347">Cependant, `AddMvc` continue de se comporter comme il l’a fait dans les versions précédentes.</span><span class="sxs-lookup"><span data-stu-id="a5355-347">However, `AddMvc` continues to behave as it has in previous releases.</span></span>

<span data-ttu-id="a5355-348">L’exemple suivant ajoute la prise en charge des contrôleurs et des fonctionnalités liées à l’API, mais pas des vues ou des pages.</span><span class="sxs-lookup"><span data-stu-id="a5355-348">The following example adds support for controllers and API-related features, but not views or pages.</span></span> <span data-ttu-id="a5355-349">Le modèle API utilise ce code :</span><span class="sxs-lookup"><span data-stu-id="a5355-349">The API template uses this code:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddControllers();
}
```

<span data-ttu-id="a5355-350">L’exemple suivant ajoute la prise en charge des contrôleurs, des fonctionnalités liées à l’API et des vues, mais pas des pages.</span><span class="sxs-lookup"><span data-stu-id="a5355-350">The following example adds support for controllers, API-related features, and views, but not pages.</span></span> <span data-ttu-id="a5355-351">Le modèle d’application Web (MVC) utilise ce code :</span><span class="sxs-lookup"><span data-stu-id="a5355-351">The Web Application (MVC) template uses this code:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddControllersWithViews();
}
```

<span data-ttu-id="a5355-352">L’exemple suivant ajoute la prise en charge des pages Razor et du soutien minimal du contrôleur.</span><span class="sxs-lookup"><span data-stu-id="a5355-352">The following example adds support for Razor Pages and minimal controller support.</span></span> <span data-ttu-id="a5355-353">Le modèle d’application Web utilise ce code :</span><span class="sxs-lookup"><span data-stu-id="a5355-353">The Web Application template uses this code:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddRazorPages();
}
```

<span data-ttu-id="a5355-354">Les nouvelles méthodes peuvent également être combinées.</span><span class="sxs-lookup"><span data-stu-id="a5355-354">The new methods can also be combined.</span></span> <span data-ttu-id="a5355-355">L’exemple suivant est `AddMvc` équivalent à l’appel dans ASP.NET Core 2.2 :</span><span class="sxs-lookup"><span data-stu-id="a5355-355">The following example is equivalent to calling `AddMvc` in ASP.NET Core 2.2:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddControllersWithViews();
    services.AddRazorPages();
}
```

## <a name="routing-startup-code"></a><span data-ttu-id="a5355-356">Code de démarrage de routage</span><span class="sxs-lookup"><span data-stu-id="a5355-356">Routing startup code</span></span>

<span data-ttu-id="a5355-357">Si une `UseMvc` application `UseSignalR`appelle ou, migrez l’application vers [Endpoint Routing](xref:fundamentals/routing) si possible.</span><span class="sxs-lookup"><span data-stu-id="a5355-357">If an app calls `UseMvc` or `UseSignalR`, migrate the app to [Endpoint Routing](xref:fundamentals/routing) if possible.</span></span> <span data-ttu-id="a5355-358">Pour améliorer la compatibilité de route de point de terminaison avec les versions précédentes de MVC, nous avons retourné quelques-uns des changements dans la génération d’URL introduits dans ASP.NET Core 2.2.</span><span class="sxs-lookup"><span data-stu-id="a5355-358">To improve Endpoint Routing compatibility with previous versions of MVC, we've reverted some of the changes in URL generation introduced in ASP.NET Core 2.2.</span></span> <span data-ttu-id="a5355-359">Si vous avez éprouvé des problèmes en utilisant Endpoint Routing en 2.2, attendez-vous à des améliorations dans ASP.NET Core 3.0 avec les exceptions suivantes :</span><span class="sxs-lookup"><span data-stu-id="a5355-359">If you experienced problems using Endpoint Routing in 2.2, expect improvements in ASP.NET Core 3.0 with the following exceptions:</span></span>

* <span data-ttu-id="a5355-360">Si l’application `IRouter` implémente ou hérite de `Route`, utilisez [DynamicRouteValuesTransformer](https://github.com/dotnet/AspNetCore.Docs/issues/12997) comme remplacement.</span><span class="sxs-lookup"><span data-stu-id="a5355-360">If the app implements `IRouter` or inherits from `Route`, use [DynamicRouteValuesTransformer](https://github.com/dotnet/AspNetCore.Docs/issues/12997) as the replacement.</span></span>
* <span data-ttu-id="a5355-361">Si l’application `RouteData.Routers` accède directement à l’intérieur de MVC pour analyser les URL, vous pouvez le remplacer par l’utilisation de [LinkParser.ParsePathByEndpointName](xref:Microsoft.AspNetCore.Routing.LinkParserEndpointNameAddressExtensions.ParsePathByEndpointName*).</span><span class="sxs-lookup"><span data-stu-id="a5355-361">If the app directly accesses `RouteData.Routers` inside MVC to parse URLs, you can replace this with use of [LinkParser.ParsePathByEndpointName](xref:Microsoft.AspNetCore.Routing.LinkParserEndpointNameAddressExtensions.ParsePathByEndpointName*).</span></span> 
  * <span data-ttu-id="a5355-362">Définissez l’itinéraire avec un nom d’itinéraire.</span><span class="sxs-lookup"><span data-stu-id="a5355-362">Define the route with a route name.</span></span>
  * <span data-ttu-id="a5355-363">Utiliser `LinkParser.ParsePathByEndpointName` et passer dans le nom d’itinéraire souhaité.</span><span class="sxs-lookup"><span data-stu-id="a5355-363">Use `LinkParser.ParsePathByEndpointName` and pass in the desired route name.</span></span>

<span data-ttu-id="a5355-364">Endpoint Routing prend en charge la même syntaxe de modèle d’itinéraire et les caractéristiques de l’auteur du modèle d’itinéraire que `IRouter`.</span><span class="sxs-lookup"><span data-stu-id="a5355-364">Endpoint Routing supports the same route pattern syntax and route pattern authoring features as `IRouter`.</span></span> <span data-ttu-id="a5355-365">Point d’arrêt `IRouteConstraint`Routing prend en charge .</span><span class="sxs-lookup"><span data-stu-id="a5355-365">Endpoint Routing supports `IRouteConstraint`.</span></span> <span data-ttu-id="a5355-366">Endpoint routage `[Route]` `[HttpGet]`prend en charge , , et les autres attributs de routage MVC.</span><span class="sxs-lookup"><span data-stu-id="a5355-366">Endpoint routing supports `[Route]`, `[HttpGet]`, and the other MVC routing attributes.</span></span>

<span data-ttu-id="a5355-367">Pour la plupart `Startup` des applications, il ne faut que des modifications.</span><span class="sxs-lookup"><span data-stu-id="a5355-367">For most applications, only `Startup` requires changes.</span></span>

### <a name="migrate-startupconfigure"></a><span data-ttu-id="a5355-368">Migre Startup.Configure</span><span class="sxs-lookup"><span data-stu-id="a5355-368">Migrate Startup.Configure</span></span>

<span data-ttu-id="a5355-369">Conseil général :</span><span class="sxs-lookup"><span data-stu-id="a5355-369">General advice:</span></span>

* <span data-ttu-id="a5355-370">Ajoutez `UseRouting`.</span><span class="sxs-lookup"><span data-stu-id="a5355-370">Add `UseRouting`.</span></span>
* <span data-ttu-id="a5355-371">Si l’application `UseStaticFiles` `UseStaticFiles` appelle , **placez avant** `UseRouting`.</span><span class="sxs-lookup"><span data-stu-id="a5355-371">If the app calls `UseStaticFiles`, place `UseStaticFiles` **before** `UseRouting`.</span></span>
* <span data-ttu-id="a5355-372">Si l’application utilise des fonctionnalités d’authentification/autorisation `UseRouting` `UseCors`telles que `UseEndpoints` `AuthorizePage` ou `[Authorize]`, placez l’appel à `UseAuthentication` et `UseAuthorization`: **après**, et , mais avant :</span><span class="sxs-lookup"><span data-stu-id="a5355-372">If the app uses authentication/authorization features such as `AuthorizePage` or `[Authorize]`, place the call to `UseAuthentication` and `UseAuthorization`: **after**, `UseRouting` and `UseCors`, but before `UseEndpoints`:</span></span>

  ```csharp
  public void Configure(IApplicationBuilder app)
  {
    ...

    app.UseStaticFiles();

    app.UseRouting();
    app.UseCors();

    app.UseAuthentication();
    app.UseAuthorization();

    app.UseEndpoints(endpoints => {
       endpoints.MapControllers();
    });
  ```

* <span data-ttu-id="a5355-373">Remplacer `UseMvc` `UseSignalR` ou `UseEndpoints`par .</span><span class="sxs-lookup"><span data-stu-id="a5355-373">Replace `UseMvc` or `UseSignalR` with `UseEndpoints`.</span></span>
* <span data-ttu-id="a5355-374">Si l’application utilise des scénarios [CORS,](xref:security/cors) tels `[EnableCors]`que , placer l’appel à `UseCors` `UseCors` avant `UseAuthentication` `UseAuthorization`tout autre middleware qui utilisent CORS (par exemple, place avant , , et `UseEndpoints`).</span><span class="sxs-lookup"><span data-stu-id="a5355-374">If the app uses [CORS](xref:security/cors) scenarios, such as `[EnableCors]`, place the call to `UseCors` before any other middleware that use CORS (for example, place `UseCors` before `UseAuthentication`, `UseAuthorization`, and `UseEndpoints`).</span></span>
* <span data-ttu-id="a5355-375">`IHostingEnvironment` Remplacez `IWebHostEnvironment` et `using` ajoutez une <xref:Microsoft.Extensions.Hosting?displayProperty=fullName> déclaration pour l’espace nom.</span><span class="sxs-lookup"><span data-stu-id="a5355-375">Replace `IHostingEnvironment` with `IWebHostEnvironment` and add a `using` statement for the <xref:Microsoft.Extensions.Hosting?displayProperty=fullName> namespace.</span></span>
* <span data-ttu-id="a5355-376">Remplacer `IApplicationLifetime` <xref:Microsoft.Extensions.Hosting.IHostApplicationLifetime> par<xref:Microsoft.Extensions.Hosting?displayProperty=fullName> (namespace).</span><span class="sxs-lookup"><span data-stu-id="a5355-376">Replace `IApplicationLifetime` with <xref:Microsoft.Extensions.Hosting.IHostApplicationLifetime> (<xref:Microsoft.Extensions.Hosting?displayProperty=fullName> namespace).</span></span>
* <span data-ttu-id="a5355-377">Remplacer `EnvironmentName` <xref:Microsoft.Extensions.Hosting.Environments> par<xref:Microsoft.Extensions.Hosting?displayProperty=fullName> (namespace).</span><span class="sxs-lookup"><span data-stu-id="a5355-377">Replace `EnvironmentName` with <xref:Microsoft.Extensions.Hosting.Environments> (<xref:Microsoft.Extensions.Hosting?displayProperty=fullName> namespace).</span></span>

<span data-ttu-id="a5355-378">Le code suivant est `Startup.Configure` un exemple de dans une application ASP.NET Core 2.2 typique :</span><span class="sxs-lookup"><span data-stu-id="a5355-378">The following code is an example of `Startup.Configure` in a typical ASP.NET Core 2.2 app:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseStaticFiles();

    app.UseAuthentication();

    app.UseSignalR(hubs =>
    {
        hubs.MapHub<ChatHub>("/chat");
    });

    app.UseMvc(routes =>
    {
        routes.MapRoute("default", "{controller=Home}/{action=Index}/{id?}");
    });
}
```

<span data-ttu-id="a5355-379">Après la `Startup.Configure` mise à jour du code précédent :</span><span class="sxs-lookup"><span data-stu-id="a5355-379">After updating the previous `Startup.Configure` code:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseStaticFiles();

    app.UseRouting();

    app.UseCors();

    app.UseAuthentication();
    app.UseAuthorization();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapHub<ChatHub>("/chat");
        endpoints.MapControllerRoute("default", "{controller=Home}/{action=Index}/{id?}");
    });
}
```

> [!WARNING]
> <span data-ttu-id="a5355-380">Pour la plupart `UseAuthentication`des `UseAuthorization`applications, les appels à , et `UseCors` doivent apparaître entre les appels et `UseRouting` `UseEndpoints` pour être efficace.</span><span class="sxs-lookup"><span data-stu-id="a5355-380">For most apps, calls to `UseAuthentication`, `UseAuthorization`, and `UseCors` must appear between the calls to `UseRouting` and `UseEndpoints` to be effective.</span></span>

### <a name="health-checks"></a><span data-ttu-id="a5355-381">Contrôles d'intégrité</span><span class="sxs-lookup"><span data-stu-id="a5355-381">Health Checks</span></span>

<span data-ttu-id="a5355-382">Les contrôles de santé utilisent le routage des points de terminaison avec l’hôte générique.</span><span class="sxs-lookup"><span data-stu-id="a5355-382">Health Checks use endpoint routing with the Generic Host.</span></span> <span data-ttu-id="a5355-383">Dans `Startup.Configure`, `MapHealthChecks` appelez le constructeur de point de terminaison avec l’URL de point de terminaison ou le chemin relatif :</span><span class="sxs-lookup"><span data-stu-id="a5355-383">In `Startup.Configure`, call `MapHealthChecks` on the endpoint builder with the endpoint URL or relative path:</span></span>

```csharp
app.UseEndpoints(endpoints =>
{
    endpoints.MapHealthChecks("/health");
});
```

<span data-ttu-id="a5355-384">Les points de terminaison de contrôles de santé peuvent :</span><span class="sxs-lookup"><span data-stu-id="a5355-384">Health Checks endpoints can:</span></span>

* <span data-ttu-id="a5355-385">Spécifier un ou plusieurs hôtes/ports autorisés.</span><span class="sxs-lookup"><span data-stu-id="a5355-385">Specify one or more permitted hosts/ports.</span></span>
* <span data-ttu-id="a5355-386">Exiger l’autorisation.</span><span class="sxs-lookup"><span data-stu-id="a5355-386">Require authorization.</span></span>
* <span data-ttu-id="a5355-387">Exigez CORS.</span><span class="sxs-lookup"><span data-stu-id="a5355-387">Require CORS.</span></span>

<span data-ttu-id="a5355-388">Pour plus d’informations, consultez <xref:host-and-deploy/health-checks>.</span><span class="sxs-lookup"><span data-stu-id="a5355-388">For more information, see <xref:host-and-deploy/health-checks>.</span></span>

### <a name="security-middleware-guidance"></a><span data-ttu-id="a5355-389">Conseils de middleware de sécurité</span><span class="sxs-lookup"><span data-stu-id="a5355-389">Security middleware guidance</span></span>

<span data-ttu-id="a5355-390">Le support pour l’autorisation et corS est unifié autour de l’approche [middleware.](xref:fundamentals/middleware/index)</span><span class="sxs-lookup"><span data-stu-id="a5355-390">Support for authorization and CORS is unified around the [middleware](xref:fundamentals/middleware/index) approach.</span></span> <span data-ttu-id="a5355-391">Cela permet l’utilisation du même middleware et fonctionnalité à travers ces scénarios.</span><span class="sxs-lookup"><span data-stu-id="a5355-391">This allows use of the same middleware and functionality across these scenarios.</span></span> <span data-ttu-id="a5355-392">Un middleware d’autorisation mis à jour est fourni dans cette version, et CORS Middleware est amélioré afin qu’il puisse comprendre les attributs utilisés par les contrôleurs MVC.</span><span class="sxs-lookup"><span data-stu-id="a5355-392">An updated authorization middleware is provided in this release, and CORS Middleware is enhanced so that it can understand the attributes used by MVC controllers.</span></span>

#### <a name="cors"></a><span data-ttu-id="a5355-393">CORS</span><span class="sxs-lookup"><span data-stu-id="a5355-393">CORS</span></span>

<span data-ttu-id="a5355-394">Auparavant, CORS pouvait être difficile à configurer.</span><span class="sxs-lookup"><span data-stu-id="a5355-394">Previously, CORS could be difficult to configure.</span></span> <span data-ttu-id="a5355-395">Middleware a été fourni pour une utilisation dans certains cas d’utilisation, mais les filtres MVC ont été destinés à être utilisés **sans** le middleware dans d’autres cas d’utilisation.</span><span class="sxs-lookup"><span data-stu-id="a5355-395">Middleware was provided for use in some use cases, but MVC filters were intended to be used **without** the middleware in other use cases.</span></span> <span data-ttu-id="a5355-396">Avec ASP.NET Core 3.0, nous recommandons que toutes les applications qui nécessitent CORS utilisent le CORS Middleware en tandem avec Endpoint Routing.</span><span class="sxs-lookup"><span data-stu-id="a5355-396">With ASP.NET Core 3.0, we recommend that all apps that require CORS use the CORS Middleware in tandem with Endpoint Routing.</span></span> <span data-ttu-id="a5355-397">`UseCors`peut être fourni avec une `[EnableCors]` `[DisableCors]` stratégie par défaut, et les attributs peuvent être utilisés pour passer outre à la stratégie par défaut si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="a5355-397">`UseCors` can be provided with a default policy, and `[EnableCors]` and `[DisableCors]` attributes can be used to override the default policy where required.</span></span>

<span data-ttu-id="a5355-398">Dans l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="a5355-398">In the following example:</span></span>

* <span data-ttu-id="a5355-399">CORS est activé pour tous `default` les points de terminaison avec la stratégie nommée.</span><span class="sxs-lookup"><span data-stu-id="a5355-399">CORS is enabled for all endpoints with the `default` named policy.</span></span>
* <span data-ttu-id="a5355-400">La `MyController` classe désactive CORS avec l’attribut. `[DisableCors]`</span><span class="sxs-lookup"><span data-stu-id="a5355-400">The `MyController` class disables CORS with the `[DisableCors]` attribute.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseCors("default");

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapDefaultControllerRoute();
    });
}

[DisableCors]
public class MyController : ControllerBase
{
    ...
}
```

#### <a name="authorization"></a><span data-ttu-id="a5355-401">Autorisation</span><span class="sxs-lookup"><span data-stu-id="a5355-401">Authorization</span></span>

<span data-ttu-id="a5355-402">Dans les versions antérieures de ASP.NET Core, le `[Authorize]` support d’autorisation a été fourni via l’attribut.</span><span class="sxs-lookup"><span data-stu-id="a5355-402">In earlier versions of ASP.NET Core, authorization support was provided via the `[Authorize]` attribute.</span></span> <span data-ttu-id="a5355-403">Autorisation middleware n’était pas disponible.</span><span class="sxs-lookup"><span data-stu-id="a5355-403">Authorization middleware wasn't available.</span></span> <span data-ttu-id="a5355-404">Dans ASP.NET Core 3.0, l’autorisation middleware est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="a5355-404">In ASP.NET Core 3.0, authorization middleware is required.</span></span> <span data-ttu-id="a5355-405">Nous vous recommandons de placer le ASP.NET`UseAuthorization`Core `UseAuthentication`Authorization Middleware ( ) immédiatement après .</span><span class="sxs-lookup"><span data-stu-id="a5355-405">We recommend placing the ASP.NET Core Authorization Middleware (`UseAuthorization`) immediately after `UseAuthentication`.</span></span> <span data-ttu-id="a5355-406">Le Middleware d’autorisation peut également être configuré avec une stratégie par défaut, qui peut être remplacée.</span><span class="sxs-lookup"><span data-stu-id="a5355-406">The Authorization Middleware can also be configured with a default policy, which can be overridden.</span></span>

<span data-ttu-id="a5355-407">Dans ASP.NET Core 3.0 ou `UseAuthorization` plus tard, est `Startup.Configure` `HomeController` appelé, et ce qui suit nécessite un signé dans l’utilisateur:</span><span class="sxs-lookup"><span data-stu-id="a5355-407">In ASP.NET Core 3.0 or later, `UseAuthorization` is called in `Startup.Configure`, and the following `HomeController` requires a signed in user:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseAuthentication();
    app.UseAuthorization();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapDefaultControllerRoute();
    });
}

public class HomeController : Controller
{
    [Authorize]
    public IActionResult BuyWidgets()
    {
        ...
    }
}
```

<span data-ttu-id="a5355-408">Lors de l’utilisation du routage `<xref:Microsoft.AspNetCore.Mvc.Authorization.AuthorizeFilter>` de point de terminaison, nous recommandons de ne pas configurer et plutôt de compter sur le middleware Autorisation.</span><span class="sxs-lookup"><span data-stu-id="a5355-408">When using endpoint routing, we recommend against configuring `<xref:Microsoft.AspNetCore.Mvc.Authorization.AuthorizeFilter>` and instead relying on the Authorization middleware.</span></span>  <span data-ttu-id="a5355-409">Si l’application `AuthorizeFilter` utilise un filtre global dans MVC, nous vous recommandons de refactoriser le code pour fournir une politique dans l’appel à `AddAuthorization`.</span><span class="sxs-lookup"><span data-stu-id="a5355-409">If the app uses an `AuthorizeFilter` as a global filter in MVC, we recommend refactoring the code to provide a policy in the call to `AddAuthorization`.</span></span>

<span data-ttu-id="a5355-410">Le `DefaultPolicy` est initialement configuré pour nécessiter l’authentification, de sorte qu’aucune configuration supplémentaire n’est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="a5355-410">The `DefaultPolicy` is initially configured to require authentication, so no additional configuration is required.</span></span> <span data-ttu-id="a5355-411">Dans l’exemple suivant, les critères `RequireAuthorization` d’évaluation de MVC sont `DefaultPolicy`marqués de manière à ce que toutes les demandes soient autorisées en fonction de la .</span><span class="sxs-lookup"><span data-stu-id="a5355-411">In the following example, MVC endpoints are marked as `RequireAuthorization` so that all requests must be authorized based on the `DefaultPolicy`.</span></span> <span data-ttu-id="a5355-412">Cependant, `HomeController` l’accès permet sans que l’utilisateur se connecte à l’application en raison de `[AllowAnonymous]`:</span><span class="sxs-lookup"><span data-stu-id="a5355-412">However, the `HomeController` allows access without the user signing into the app due to `[AllowAnonymous]`:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseAuthentication();
    app.UseAuthorization();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapDefaultControllerRoute().RequireAuthorization();
    });
}

[AllowAnonymous]
public class HomeController : Controller
{
    ...
}
```

### <a name="authorization-for-specific-endpoints"></a><span data-ttu-id="a5355-413">Autorisation pour des critères d’évaluation spécifiques</span><span class="sxs-lookup"><span data-stu-id="a5355-413">Authorization for specific endpoints</span></span>

<span data-ttu-id="a5355-414">L’autorisation peut également être configurée pour des classes spécifiques de points de terminaison.</span><span class="sxs-lookup"><span data-stu-id="a5355-414">Authorization can also be configured for specific classes of endpoints.</span></span> <span data-ttu-id="a5355-415">Le code suivant est un exemple de conversion d’une application MVC qui a configuré un global `AuthorizeFilter` en une application avec une politique spécifique nécessitant une autorisation :</span><span class="sxs-lookup"><span data-stu-id="a5355-415">The following code is an example of converting an MVC app that configured a global `AuthorizeFilter` to an app with a specific policy requiring authorization:</span></span>

[!code-csharp[](22-to-30/samples/Startup.cs?name=snippet&highlight=8-9,21-22,26-27,53-54)]

<span data-ttu-id="a5355-416">Les stratégies peuvent également être personnalisées.</span><span class="sxs-lookup"><span data-stu-id="a5355-416">Policies can also be customized.</span></span> <span data-ttu-id="a5355-417">Le `DefaultPolicy` est configuré pour nécessiter l’authentification:</span><span class="sxs-lookup"><span data-stu-id="a5355-417">The `DefaultPolicy` is configured to require authentication:</span></span>

[!code-csharp[](22-to-30/samples/Startup2.cs?name=snippet&highlight=21-26,52)]

[!code-csharp[](22-to-30/samples/HomeController.cs?name=snippet)]

<span data-ttu-id="a5355-418">Alternativement, tous les critères d’évaluation `[Authorize]` peuvent `RequireAuthorization` être configurés pour exiger l’autorisation sans ou en configurant un `FallbackPolicy`.</span><span class="sxs-lookup"><span data-stu-id="a5355-418">Alternatively, all endpoints can be configured to require authorization without `[Authorize]` or `RequireAuthorization` by configuring a `FallbackPolicy`.</span></span> <span data-ttu-id="a5355-419">L’est `FallbackPolicy` différent `DefaultPolicy`de la .</span><span class="sxs-lookup"><span data-stu-id="a5355-419">The `FallbackPolicy` is different from the `DefaultPolicy`.</span></span> <span data-ttu-id="a5355-420">Le `DefaultPolicy` est `[Authorize]` déclenché `RequireAuthorization`par `FallbackPolicy` ou , tandis que le est déclenché quand aucune autre stratégie n’est définie.</span><span class="sxs-lookup"><span data-stu-id="a5355-420">The `DefaultPolicy` is triggered by `[Authorize]` or `RequireAuthorization`, while the `FallbackPolicy` is triggered when no other policy is set.</span></span> <span data-ttu-id="a5355-421">`FallbackPolicy`est initialement configuré pour permettre des demandes sans autorisation.</span><span class="sxs-lookup"><span data-stu-id="a5355-421">`FallbackPolicy` is initially configured to allow requests without authorization.</span></span>

<span data-ttu-id="a5355-422">L’exemple suivant est le `DefaultPolicy` même que `FallbackPolicy` l’exemple précédent, mais utilise `[AllowAnonymous]` le pour toujours exiger l’authentification sur tous les points de terminaison, sauf quand est spécifié:</span><span class="sxs-lookup"><span data-stu-id="a5355-422">The following example is the same as the preceding `DefaultPolicy` example but uses the `FallbackPolicy` to always require authentication on all endpoints except when `[AllowAnonymous]` is specified:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    ...

    services.AddAuthorization(options =>
    {
        options.FallbackPolicy = new AuthorizationPolicyBuilder()
          .RequireAuthenticatedUser()
          .Build();
    });
}

public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseAuthentication();
    app.UseAuthorization();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapDefaultControllerRoute();
    });
}

[AllowAnonymous]
public class HomeController : Controller
{
    ...
}
```

<span data-ttu-id="a5355-423">L’autorisation par middleware fonctionne sans que le cadre ait une connaissance spécifique de l’autorisation.</span><span class="sxs-lookup"><span data-stu-id="a5355-423">Authorization by middleware works without the framework having any specific knowledge of authorization.</span></span> <span data-ttu-id="a5355-424">Par exemple, [les contrôles de santé](xref:host-and-deploy/health-checks) n’ont aucune connaissance spécifique de l’autorisation, mais les contrôles de santé peuvent avoir une politique d’autorisation configurable appliquée par le middleware.</span><span class="sxs-lookup"><span data-stu-id="a5355-424">For instance, [health checks](xref:host-and-deploy/health-checks) has no specific knowledge of authorization, but health checks can have a configurable authorization policy applied by the middleware.</span></span>

<span data-ttu-id="a5355-425">De plus, chaque point de terminaison peut personnaliser ses exigences d’autorisation.</span><span class="sxs-lookup"><span data-stu-id="a5355-425">Additionally, each endpoint can customize its authorization requirements.</span></span> <span data-ttu-id="a5355-426">Dans l’exemple `UseAuthorization` suivant, `DefaultPolicy`traite l’autorisation avec le , mais le `/healthz` point de terminaison de bilan de santé exige un `admin` utilisateur :</span><span class="sxs-lookup"><span data-stu-id="a5355-426">In the following example, `UseAuthorization` processes authorization with the `DefaultPolicy`, but the `/healthz` health check endpoint requires an `admin` user:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseAuthentication();
    app.UseAuthorization();

    app.UseEndpoints(endpoints =>
    {
        endpoints
            .MapHealthChecks("/healthz")
            .RequireAuthorization(new AuthorizeAttribute(){ Roles = "admin", });
    });
}
```

<span data-ttu-id="a5355-427">La protection est mise en œuvre pour certains scénarios.</span><span class="sxs-lookup"><span data-stu-id="a5355-427">Protection is implemented for some scenarios.</span></span> <span data-ttu-id="a5355-428">Endpoints Middleware lance une exception si une autorisation ou une politique CORS est ignorée en raison de middleware manquant.</span><span class="sxs-lookup"><span data-stu-id="a5355-428">Endpoints Middleware throws an exception if an authorization or CORS policy is skipped due to missing middleware.</span></span> <span data-ttu-id="a5355-429">Le soutien des analyseurs pour fournir des commentaires supplémentaires sur la mauvaise configuration est en cours.</span><span class="sxs-lookup"><span data-stu-id="a5355-429">Analyzer support to provide additional feedback about misconfiguration is in progress.</span></span>

#### <a name="custom-authorization-handlers"></a><span data-ttu-id="a5355-430">Gestionnaires d’autorisation personnalisés</span><span class="sxs-lookup"><span data-stu-id="a5355-430">Custom authorization handlers</span></span>

<span data-ttu-id="a5355-431">Si l’application utilise [des gestionnaires d’autorisation personnalisés,](xref:security/authorization/policies#authorization-handlers)le routage des points de terminaison passe un type de ressource différent aux gestionnaires de MVC.</span><span class="sxs-lookup"><span data-stu-id="a5355-431">If the app uses custom [authorization handlers](xref:security/authorization/policies#authorization-handlers), endpoint routing passes a different resource type to handlers than MVC.</span></span> <span data-ttu-id="a5355-432">Les gestionnaires qui s’attendent à ce <xref:Microsoft.AspNetCore.Mvc.Filters.AuthorizationFilterContext> que la ressource contextuelle du gestionnaire d’autorisation soit de <xref:Microsoft.AspNetCore.Routing.RouteEndpoint> type (le type de ressources fournie par les [filtres MVC)](xref:security/authorization/policies#accessing-mvc-request-context-in-handlers)devront être mis à jour pour traiter les ressources de type (le type de ressources donné aux gestionnaires d’autorisation par itinéraire de point final).</span><span class="sxs-lookup"><span data-stu-id="a5355-432">Handlers that expect the authorization handler context resource to be of type <xref:Microsoft.AspNetCore.Mvc.Filters.AuthorizationFilterContext> (the resource type [provided by MVC filters](xref:security/authorization/policies#accessing-mvc-request-context-in-handlers)) will need to be updated to handle resources of type <xref:Microsoft.AspNetCore.Routing.RouteEndpoint> (the resource type given to authorization handlers by endpoint routing).</span></span>

<span data-ttu-id="a5355-433">MVC utilise `AuthorizationFilterContext` toujours des ressources, donc si l’application utilise des filtres d’autorisation MVC ainsi que l’autorisation de routage de point de terminaison, il peut être nécessaire de gérer les deux types de ressources.</span><span class="sxs-lookup"><span data-stu-id="a5355-433">MVC still uses `AuthorizationFilterContext` resources, so if the app uses MVC authorization filters along with endpoint routing authorization, it may be necessary to handle both types of resources.</span></span>

### SignalR

<span data-ttu-id="a5355-434">La SignalR cartographie des hubs `UseEndpoints`a maintenant lieu à l’intérieur .</span><span class="sxs-lookup"><span data-stu-id="a5355-434">Mapping of SignalR hubs now takes place inside `UseEndpoints`.</span></span>

<span data-ttu-id="a5355-435">Carte de `MapHub`chaque hub avec .</span><span class="sxs-lookup"><span data-stu-id="a5355-435">Map each hub with `MapHub`.</span></span> <span data-ttu-id="a5355-436">Comme dans les versions précédentes, chaque hub est explicitement répertorié.</span><span class="sxs-lookup"><span data-stu-id="a5355-436">As in previous versions, each hub is explicitly listed.</span></span>

<span data-ttu-id="a5355-437">Dans l’exemple suivant, `ChatHub` SignalR le support pour le hub est ajouté :</span><span class="sxs-lookup"><span data-stu-id="a5355-437">In the following example, support for the `ChatHub` SignalR hub is added:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapHub<ChatHub>();
    });
}
```

<span data-ttu-id="a5355-438">Il existe une nouvelle option pour contrôler les limites de taille des messages des clients.</span><span class="sxs-lookup"><span data-stu-id="a5355-438">There is a new option for controlling message size limits from clients.</span></span> <span data-ttu-id="a5355-439">Par exemple, dans `Startup.ConfigureServices` :</span><span class="sxs-lookup"><span data-stu-id="a5355-439">For example, in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddSignalR(hubOptions =>
{
    hubOptions.MaximumReceiveMessageSize = 32768;
});
```

<span data-ttu-id="a5355-440">Dans ASP.NET Core 2.2, vous pouvez `TransportMaxBufferSize` définir le et qui contrôlerait efficacement la taille maximale du message.</span><span class="sxs-lookup"><span data-stu-id="a5355-440">In ASP.NET Core 2.2, you could set the `TransportMaxBufferSize` and that would effectively control the maximum message size.</span></span> <span data-ttu-id="a5355-441">Dans ASP.NET Core 3.0, cette option ne contrôle plus que la taille maximale avant d’observer la rétropression.</span><span class="sxs-lookup"><span data-stu-id="a5355-441">In ASP.NET Core 3.0, that option now only controls the maximum size before backpressure is observed.</span></span>

### <a name="mvc-controllers"></a><span data-ttu-id="a5355-442">Contrôleurs MVC</span><span class="sxs-lookup"><span data-stu-id="a5355-442">MVC controllers</span></span>

<span data-ttu-id="a5355-443">La cartographie des contrôleurs `UseEndpoints`a maintenant lieu à l’intérieur .</span><span class="sxs-lookup"><span data-stu-id="a5355-443">Mapping of controllers now takes place inside `UseEndpoints`.</span></span>

<span data-ttu-id="a5355-444">Ajoutez `MapControllers` si l’application utilise le routage d’attribut.</span><span class="sxs-lookup"><span data-stu-id="a5355-444">Add `MapControllers` if the app uses attribute routing.</span></span> <span data-ttu-id="a5355-445">Étant donné que le routage comprend la prise en charge de nombreux cadres dans ASP.NET Core 3.0 ou plus tard, l’ajout de contrôleurs acheminés par attribut est opt-in.</span><span class="sxs-lookup"><span data-stu-id="a5355-445">Since routing includes support for many frameworks in ASP.NET Core 3.0 or later, adding attribute-routed controllers is opt-in.</span></span>

<span data-ttu-id="a5355-446">Remplacez le code suivant :</span><span class="sxs-lookup"><span data-stu-id="a5355-446">Replace the following:</span></span>

* <span data-ttu-id="a5355-447">`MapRoute` avec `MapControllerRoute`</span><span class="sxs-lookup"><span data-stu-id="a5355-447">`MapRoute` with `MapControllerRoute`</span></span>
* <span data-ttu-id="a5355-448">`MapAreaRoute` avec `MapAreaControllerRoute`</span><span class="sxs-lookup"><span data-stu-id="a5355-448">`MapAreaRoute` with `MapAreaControllerRoute`</span></span>

<span data-ttu-id="a5355-449">Depuis le routage comprend maintenant le soutien pour plus que juste MVC, la terminologie a changé pour faire ces méthodes clairement indiquer ce qu’ils font.</span><span class="sxs-lookup"><span data-stu-id="a5355-449">Since routing now includes support for more than just MVC, the terminology has changed to make these methods clearly state what they do.</span></span> <span data-ttu-id="a5355-450">Les itinéraires `MapControllerRoute` / `MapAreaControllerRoute` / `MapDefaultControllerRoute` conventionnels tels que sont appliqués dans l’ordre qu’ils sont ajoutés.</span><span class="sxs-lookup"><span data-stu-id="a5355-450">Conventional routes such as `MapControllerRoute`/`MapAreaControllerRoute`/`MapDefaultControllerRoute` are applied in the order that they're added.</span></span> <span data-ttu-id="a5355-451">Placez d’abord des itinéraires plus spécifiques (comme des itinéraires pour une zone).</span><span class="sxs-lookup"><span data-stu-id="a5355-451">Place more specific routes (such as routes for an area) first.</span></span>

<span data-ttu-id="a5355-452">Dans l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="a5355-452">In the following example:</span></span>

* <span data-ttu-id="a5355-453">`MapControllers`ajoute un support pour les contrôleurs acheminés par attribut.</span><span class="sxs-lookup"><span data-stu-id="a5355-453">`MapControllers` adds support for attribute-routed controllers.</span></span>
* <span data-ttu-id="a5355-454">`MapAreaControllerRoute`ajoute un itinéraire conventionnel pour les contrôleurs dans une zone.</span><span class="sxs-lookup"><span data-stu-id="a5355-454">`MapAreaControllerRoute` adds a conventional route for controllers in an area.</span></span>
* <span data-ttu-id="a5355-455">`MapControllerRoute`ajoute un itinéraire conventionnel pour les contrôleurs.</span><span class="sxs-lookup"><span data-stu-id="a5355-455">`MapControllerRoute` adds a conventional route for controllers.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapControllers();
        endpoints.MapAreaControllerRoute(
            "admin",
            "admin",
            "Admin/{controller=Home}/{action=Index}/{id?}");
        endpoints.MapControllerRoute(
            "default", "{controller=Home}/{action=Index}/{id?}");
    });
}
```

#### <a name="async-suffix-removal-from-controller-action-names"></a><span data-ttu-id="a5355-456">Suppression du suffixe Async des noms d’action du contrôleur</span><span class="sxs-lookup"><span data-stu-id="a5355-456">Async suffix removal from controller action names</span></span>

<span data-ttu-id="a5355-457">Dans ASP.NET Core 3.0, ASP.NET Core MVC supprime `Async` le suffixe des noms d’action du contrôleur.</span><span class="sxs-lookup"><span data-stu-id="a5355-457">In ASP.NET Core 3.0, ASP.NET Core MVC removes the `Async` suffix from controller action names.</span></span> <span data-ttu-id="a5355-458">Le routage et la génération de liaisons sont touchés par ce nouveau défaut.</span><span class="sxs-lookup"><span data-stu-id="a5355-458">Both routing and link generation are impacted by this new default.</span></span> <span data-ttu-id="a5355-459">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="a5355-459">For example:</span></span>

```csharp
public class ProductsController : Controller
{
    public async Task<IActionResult> ListAsync()
    {
        var model = await _dbContext.Products.ToListAsync();
        return View(model);
    }
}
```

<span data-ttu-id="a5355-460">Avant ASP.NET Core 3.0:</span><span class="sxs-lookup"><span data-stu-id="a5355-460">Prior to ASP.NET Core 3.0:</span></span>

* <span data-ttu-id="a5355-461">L’action précédente a pu être consultée sur la route *Produits/ListAsync.*</span><span class="sxs-lookup"><span data-stu-id="a5355-461">The preceding action could be accessed at the *Products/ListAsync* route.</span></span>
* <span data-ttu-id="a5355-462">La génération de `Async` lien nécessitait de spécifier le suffixe.</span><span class="sxs-lookup"><span data-stu-id="a5355-462">Link generation required specifying the `Async` suffix.</span></span> <span data-ttu-id="a5355-463">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="a5355-463">For example:</span></span>

    ```cshtml
    <a asp-controller="Products" asp-action="ListAsync">List</a>
    ```

<span data-ttu-id="a5355-464">Dans ASP.NET Core 3.0:</span><span class="sxs-lookup"><span data-stu-id="a5355-464">In ASP.NET Core 3.0:</span></span>

* <span data-ttu-id="a5355-465">L’action précédente est accessible sur l’itinéraire *Produits/Liste.*</span><span class="sxs-lookup"><span data-stu-id="a5355-465">The preceding action can be accessed at the *Products/List* route.</span></span>
* <span data-ttu-id="a5355-466">La génération de liens ne `Async` nécessite pas de spécifier le suffixe.</span><span class="sxs-lookup"><span data-stu-id="a5355-466">Link generation doesn't require specifying the `Async` suffix.</span></span> <span data-ttu-id="a5355-467">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="a5355-467">For example:</span></span>

    ```cshtml
    <a asp-controller="Products" asp-action="List">List</a>
    ```

<span data-ttu-id="a5355-468">Cette modification n’affecte pas [`[ActionName]`](/dotnet/api/microsoft.aspnetcore.mvc.actionnameattribute) les noms spécifiés à l’aide de l’attribut.</span><span class="sxs-lookup"><span data-stu-id="a5355-468">This change doesn't affect names specified using the [`[ActionName]`](/dotnet/api/microsoft.aspnetcore.mvc.actionnameattribute) attribute.</span></span> <span data-ttu-id="a5355-469">Le comportement par défaut peut être `Startup.ConfigureServices`désactivé avec le code suivant dans :</span><span class="sxs-lookup"><span data-stu-id="a5355-469">The default behavior can be disabled with the following code in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddMvc(options =>
    options.SuppressAsyncSuffixInActionNames = false);
```

#### <a name="changes-to-link-generation"></a><span data-ttu-id="a5355-470">Changements pour lier la génération</span><span class="sxs-lookup"><span data-stu-id="a5355-470">Changes to link generation</span></span>

<span data-ttu-id="a5355-471">Comme expliqué dans la documentation sur [les différences par rapport aux versions antérieures du routage,](xref:fundamentals/routing#differences-from-earlier-versions-of-routing)il existe certaines différences dans la génération de liens (en utilisant `Url.Link` et des API similaires, par exemple).</span><span class="sxs-lookup"><span data-stu-id="a5355-471">As explained in documentation on [differences from earlier versions of routing](xref:fundamentals/routing#differences-from-earlier-versions-of-routing), there are some differences in link generation (using `Url.Link` and similar APIs, for example).</span></span> <span data-ttu-id="a5355-472">notamment :</span><span class="sxs-lookup"><span data-stu-id="a5355-472">These include:</span></span>

* <span data-ttu-id="a5355-473">Par défaut, lors de l’utilisation du routage de point final, le boîtier des paramètres d’itinéraire dans les URL générées n’est pas nécessairement préservé.</span><span class="sxs-lookup"><span data-stu-id="a5355-473">By default, when using endpoint routing, casing of route parameters in generated URIs is not necessarily preserved.</span></span> <span data-ttu-id="a5355-474">Ce comportement peut être `IOutboundParameterTransformer` contrôlé avec l’interface.</span><span class="sxs-lookup"><span data-stu-id="a5355-474">This behavior can be controlled with the `IOutboundParameterTransformer` interface.</span></span>
* <span data-ttu-id="a5355-475">Générer un URI pour un itinéraire invalide (un contrôleur/action ou une page qui n’existe pas) produira une chaîne vide sous le routage de point de terminaison au lieu de produire une URI invalide.</span><span class="sxs-lookup"><span data-stu-id="a5355-475">Generating a URI for an invalid route (a controller/action or page that doesn't exist) will produce an empty string under endpoint routing instead of producing an invalid URI.</span></span>
* <span data-ttu-id="a5355-476">Les valeurs ambiantes (paramètres d’itinéraire du contexte actuel) ne sont pas automatiquement utilisées dans la génération de liens avec le routage de point final.</span><span class="sxs-lookup"><span data-stu-id="a5355-476">Ambient values (route parameters from the current context) are not automatically used in link generation with endpoint routing.</span></span> <span data-ttu-id="a5355-477">Auparavant, lors de la création d’un lien vers une autre action (ou page), les valeurs d’itinéraire non spécifiées seraient déduites des valeurs ambiantes *actuelles.*</span><span class="sxs-lookup"><span data-stu-id="a5355-477">Previously, when generating a link to another action (or page), unspecified route values would be inferred from the *current* routes ambient values.</span></span> <span data-ttu-id="a5355-478">Lors de l’utilisation du routage des points de terminaison, tous les paramètres d’itinéraire doivent être spécifiés explicitement pendant la génération de liens.</span><span class="sxs-lookup"><span data-stu-id="a5355-478">When using endpoint routing, all route parameters must be specified explicitly during link generation.</span></span>

### <a name="razor-pages"></a><span data-ttu-id="a5355-479">Pages Razor</span><span class="sxs-lookup"><span data-stu-id="a5355-479">Razor Pages</span></span>

<span data-ttu-id="a5355-480">Cartographier les pages `UseEndpoints`razor se déroule maintenant à l’intérieur .</span><span class="sxs-lookup"><span data-stu-id="a5355-480">Mapping Razor Pages now takes place inside `UseEndpoints`.</span></span>

<span data-ttu-id="a5355-481">Ajoutez `MapRazorPages` si l’application utilise Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="a5355-481">Add `MapRazorPages` if the app uses Razor Pages.</span></span> <span data-ttu-id="a5355-482">Étant donné que Endpoint Routing inclut la prise en charge de nombreux cadres, l’ajout de pages Razor est maintenant opt-in.</span><span class="sxs-lookup"><span data-stu-id="a5355-482">Since Endpoint Routing includes support for many frameworks, adding Razor Pages is now opt-in.</span></span>

<span data-ttu-id="a5355-483">Dans la `Startup.Configure` méthode `MapRazorPages` suivante, ajoute la prise en charge des pages Razor :</span><span class="sxs-lookup"><span data-stu-id="a5355-483">In the following `Startup.Configure` method, `MapRazorPages` adds support for Razor Pages:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapRazorPages();
    });
}
```

### <a name="use-mvc-without-endpoint-routing"></a><span data-ttu-id="a5355-484">Utiliser MVC sans itinéraire de point d’arrêt</span><span class="sxs-lookup"><span data-stu-id="a5355-484">Use MVC without Endpoint Routing</span></span>

<span data-ttu-id="a5355-485">L’utilisation `UseMvc` de `UseMvcWithDefaultRoute` MVC via ou dans ASP.NET Core 3.0 nécessite un opt-in explicite à l’intérieur `Startup.ConfigureServices`.</span><span class="sxs-lookup"><span data-stu-id="a5355-485">Using MVC via `UseMvc` or `UseMvcWithDefaultRoute` in ASP.NET Core 3.0 requires an explicit opt-in inside `Startup.ConfigureServices`.</span></span> <span data-ttu-id="a5355-486">Cela est nécessaire parce que MVC doit savoir si elle peut s’appuyer sur l’autorisation et CORS Middleware lors de l’initialisation.</span><span class="sxs-lookup"><span data-stu-id="a5355-486">This is required because MVC must know whether it can rely on the authorization and CORS Middleware during initialization.</span></span> <span data-ttu-id="a5355-487">Un analyseur est fourni qui avertit si l’application tente d’utiliser une configuration non supportée.</span><span class="sxs-lookup"><span data-stu-id="a5355-487">An analyzer is provided that warns if the app attempts to use an unsupported configuration.</span></span>

<span data-ttu-id="a5355-488">Si l’application `IRouter` nécessite un `EnableEndpointRouting` support hérité, désactiver `Startup.ConfigureServices`l’utilisation de l’une des approches suivantes dans :</span><span class="sxs-lookup"><span data-stu-id="a5355-488">If the app requires legacy `IRouter` support, disable `EnableEndpointRouting` using any of the following approaches in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddMvc(options => options.EnableEndpointRouting = false);
```

```csharp
services.AddControllers(options => options.EnableEndpointRouting = false);
```

```csharp
services.AddControllersWithViews(options => options.EnableEndpointRouting = false);
```

```csharp
services.AddRazorPages().AddMvcOptions(options => options.EnableEndpointRouting = false);
```

### <a name="health-checks"></a><span data-ttu-id="a5355-489">Contrôles d'intégrité</span><span class="sxs-lookup"><span data-stu-id="a5355-489">Health checks</span></span>

<span data-ttu-id="a5355-490">Les contrôles de santé peuvent être utilisés comme *routeur-ware* avec Endpoint Routing.</span><span class="sxs-lookup"><span data-stu-id="a5355-490">Health checks can be used as a *router-ware* with Endpoint Routing.</span></span>

<span data-ttu-id="a5355-491">Ajouter `MapHealthChecks` à utiliser des contrôles de santé avec Endpoint Routing.</span><span class="sxs-lookup"><span data-stu-id="a5355-491">Add `MapHealthChecks` to use health checks with Endpoint Routing.</span></span> <span data-ttu-id="a5355-492">La `MapHealthChecks` méthode accepte des `UseHealthChecks`arguments similaires à .</span><span class="sxs-lookup"><span data-stu-id="a5355-492">The `MapHealthChecks` method accepts arguments similar to `UseHealthChecks`.</span></span> <span data-ttu-id="a5355-493">L’avantage `MapHealthChecks` d’utiliser le sur `UseHealthChecks` est la capacité d’appliquer l’autorisation et d’avoir un plus grand contrôle à grain fin sur la politique de jumelage.</span><span class="sxs-lookup"><span data-stu-id="a5355-493">The advantage of using `MapHealthChecks` over `UseHealthChecks` is the ability to apply authorization and to have greater fine-grained control over the matching policy.</span></span>

<span data-ttu-id="a5355-494">Dans l’exemple `MapHealthChecks` suivant, est appelé pour `/healthz`un point de terminaison de bilan de santé à :</span><span class="sxs-lookup"><span data-stu-id="a5355-494">In the following example, `MapHealthChecks` is called for a health check endpoint at `/healthz`:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    ...

    app.UseRouting();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapHealthChecks("/healthz", new HealthCheckOptions() { });
    });
}
```

## <a name="hostbuilder-replaces-webhostbuilder"></a><span data-ttu-id="a5355-495">HostBuilder remplace WebHostBuilder</span><span class="sxs-lookup"><span data-stu-id="a5355-495">HostBuilder replaces WebHostBuilder</span></span>

<span data-ttu-id="a5355-496">Les modèles ASP.NET Core 3.0 utilisent [Generic Host](xref:fundamentals/host/generic-host).</span><span class="sxs-lookup"><span data-stu-id="a5355-496">The ASP.NET Core 3.0 templates use [Generic Host](xref:fundamentals/host/generic-host).</span></span> <span data-ttu-id="a5355-497">Les versions précédentes utilisaient [Web Host](xref:fundamentals/host/web-host).</span><span class="sxs-lookup"><span data-stu-id="a5355-497">Previous versions used [Web Host](xref:fundamentals/host/web-host).</span></span> <span data-ttu-id="a5355-498">Le code suivant affiche la classe générée `Program` par le modèle ASP.NET Core 3.0 :</span><span class="sxs-lookup"><span data-stu-id="a5355-498">The following code shows the ASP.NET Core 3.0 template generated `Program` class:</span></span>

[!code-csharp[](22-to-30/samples/Program.cs?name=snippet)]

<span data-ttu-id="a5355-499">Le code suivant affiche la classe générée par `Program` le modèle ASP.NET Core 2.2 :</span><span class="sxs-lookup"><span data-stu-id="a5355-499">The following code shows the ASP.NET Core 2.2 template-generated `Program` class:</span></span>

[!code-csharp[](22-to-30/samples/Program2.2.cs?name=snippet)]

<span data-ttu-id="a5355-500"><xref:Microsoft.AspNetCore.Hosting.IWebHostBuilder>reste dans 3.0 et est `webBuilder` le type de l’échantillon de code précédent.</span><span class="sxs-lookup"><span data-stu-id="a5355-500"><xref:Microsoft.AspNetCore.Hosting.IWebHostBuilder> remains in 3.0 and is the type of the `webBuilder` seen in the preceding code sample.</span></span> <span data-ttu-id="a5355-501"><xref:Microsoft.AspNetCore.Hosting.WebHostBuilder>sera déprécié dans une version `HostBuilder`future et remplacé par .</span><span class="sxs-lookup"><span data-stu-id="a5355-501"><xref:Microsoft.AspNetCore.Hosting.WebHostBuilder> will be deprecated in a future release and replaced by `HostBuilder`.</span></span>

<span data-ttu-id="a5355-502">Le changement le `WebHostBuilder` `HostBuilder` plus important de la part est [l’injection de dépendance (DI).](xref:fundamentals/dependency-injection)</span><span class="sxs-lookup"><span data-stu-id="a5355-502">The most significant change from `WebHostBuilder` to `HostBuilder` is in [dependency injection (DI)](xref:fundamentals/dependency-injection).</span></span> <span data-ttu-id="a5355-503">Lors `HostBuilder`de l’utilisation, vous `Startup`ne pouvez injecter ce qui suit dans le constructeur de 's:</span><span class="sxs-lookup"><span data-stu-id="a5355-503">When using `HostBuilder`, you can only inject the following into `Startup`'s constructor:</span></span>

* <xref:Microsoft.Extensions.Configuration.IConfiguration>
* <xref:Microsoft.Extensions.Hosting.IHostEnvironment>
* <xref:Microsoft.AspNetCore.Hosting.IWebHostEnvironment>

<span data-ttu-id="a5355-504">Les `HostBuilder` contraintes DI:</span><span class="sxs-lookup"><span data-stu-id="a5355-504">The `HostBuilder` DI constraints:</span></span>

* <span data-ttu-id="a5355-505">Permettre de construire le conteneur DI une seule fois.</span><span class="sxs-lookup"><span data-stu-id="a5355-505">Enable the DI container to be built only one time.</span></span>
* <span data-ttu-id="a5355-506">Évite les problèmes de durée de vie de l’objet qui en résultent comme la résolution de multiples cas de singletons.</span><span class="sxs-lookup"><span data-stu-id="a5355-506">Avoids the resulting object lifetime issues like resolving multiple instances of singletons.</span></span>

<span data-ttu-id="a5355-507">Pour plus d’informations, voir [l’injection de service Avoiding Startup dans ASP.NET Core 3](https://andrewlock.net/avoiding-startup-service-injection-in-asp-net-core-3/).</span><span class="sxs-lookup"><span data-stu-id="a5355-507">For more information, see [Avoiding Startup service injection in ASP.NET Core 3](https://andrewlock.net/avoiding-startup-service-injection-in-asp-net-core-3/).</span></span>

## <a name="addauthorization-moved-to-a-different-assembly"></a><span data-ttu-id="a5355-508">AddAuthorization déplacé à un assemblage différent</span><span class="sxs-lookup"><span data-stu-id="a5355-508">AddAuthorization moved to a different assembly</span></span>

<span data-ttu-id="a5355-509">Le ASP.NET Core 2.2 et `AddAuthorization` les méthodes inférieures dans *Microsoft.AspNetCore.Authorization.dll*:</span><span class="sxs-lookup"><span data-stu-id="a5355-509">The ASP.NET Core 2.2 and lower `AddAuthorization` methods in *Microsoft.AspNetCore.Authorization.dll*:</span></span>

* <span data-ttu-id="a5355-510">Ont été `AddAuthorizationCore`rebaptisés .</span><span class="sxs-lookup"><span data-stu-id="a5355-510">Have been renamed `AddAuthorizationCore`.</span></span>
* <span data-ttu-id="a5355-511">Ont été transférés à *Microsoft.AspNetCore.Authorization.policy.dll*.</span><span class="sxs-lookup"><span data-stu-id="a5355-511">Have been moved to *Microsoft.AspNetCore.Authorization.Policy.dll*.</span></span>

<span data-ttu-id="a5355-512">Les applications qui utilisent à la fois *Microsoft.AspNetCore.Authorization.dll* et *Microsoft.AspNetCore.Authorization.policy.dll* ne sont pas impactées.</span><span class="sxs-lookup"><span data-stu-id="a5355-512">Apps that are using both *Microsoft.AspNetCore.Authorization.dll* and *Microsoft.AspNetCore.Authorization.Policy.dll* aren't impacted.</span></span>

<span data-ttu-id="a5355-513">Les applications qui n’utilisent pas *Microsoft.AspNetCore.Authorization.Policy.dll* devraient faire l’un des éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="a5355-513">Apps that are not using *Microsoft.AspNetCore.Authorization.Policy.dll* should do one of the following:</span></span>

* <span data-ttu-id="a5355-514">Ajouter une référence à *Microsoft.AspNetCore.Authorization.Policy.dll*.</span><span class="sxs-lookup"><span data-stu-id="a5355-514">Add a reference to *Microsoft.AspNetCore.Authorization.Policy.dll*.</span></span> <span data-ttu-id="a5355-515">Cette approche fonctionne pour la plupart des applications et est tout ce qui est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="a5355-515">This approach works for most apps and is all that is required.</span></span>
* <span data-ttu-id="a5355-516">Passer à l’utilisation`AddAuthorizationCore`</span><span class="sxs-lookup"><span data-stu-id="a5355-516">Switch to using `AddAuthorizationCore`</span></span>

<span data-ttu-id="a5355-517">Pour plus d’informations, voir [Breaking change in `AddAuthorization(o =>`) surcharge vit dans un assemblage différent #386](https://github.com/aspnet/Announcements/issues/386).</span><span class="sxs-lookup"><span data-stu-id="a5355-517">For more information, see [Breaking change in `AddAuthorization(o =>`) overload lives in a different assembly #386](https://github.com/aspnet/Announcements/issues/386).</span></span>

## <a name="identity-ui"></a><span data-ttu-id="a5355-518">Interface utilisateur d’identité</span><span class="sxs-lookup"><span data-stu-id="a5355-518">Identity UI</span></span>

<span data-ttu-id="a5355-519">Mises à jour de l’interface utilisateur d’identité pour ASP.NET Core 3.0 :</span><span class="sxs-lookup"><span data-stu-id="a5355-519">Identity UI updates for ASP.NET Core 3.0:</span></span>

* <span data-ttu-id="a5355-520">Ajoutez une référence de paquet à [Microsoft.AspNetCore.Identity.UI](https://nuget.org/packages/Microsoft.AspNetCore.Identity.UI).</span><span class="sxs-lookup"><span data-stu-id="a5355-520">Add a package reference to [Microsoft.AspNetCore.Identity.UI](https://nuget.org/packages/Microsoft.AspNetCore.Identity.UI).</span></span>
* <span data-ttu-id="a5355-521">Les applications qui n’utilisent `MapRazorPages`pas Razor Pages doivent appeler .</span><span class="sxs-lookup"><span data-stu-id="a5355-521">Apps that don't use Razor Pages must call `MapRazorPages`.</span></span> <span data-ttu-id="a5355-522">Voir [Les pages Razor](#razor-pages) dans ce document.</span><span class="sxs-lookup"><span data-stu-id="a5355-522">See [Razor Pages](#razor-pages) in this document.</span></span>
* <span data-ttu-id="a5355-523">Bootstrap 4 est le cadre d’interface utilisateur par défaut.</span><span class="sxs-lookup"><span data-stu-id="a5355-523">Bootstrap 4 is the default UI framework.</span></span> <span data-ttu-id="a5355-524">Définissez `IdentityUIFrameworkVersion` une propriété de projet pour modifier la valeur par défaut.</span><span class="sxs-lookup"><span data-stu-id="a5355-524">Set an `IdentityUIFrameworkVersion` project property to change the default.</span></span> <span data-ttu-id="a5355-525">Pour plus d’informations, voir [cette annonce GitHub](https://github.com/aspnet/Announcements/issues/380).</span><span class="sxs-lookup"><span data-stu-id="a5355-525">For more information, see [this GitHub announcement](https://github.com/aspnet/Announcements/issues/380).</span></span>

## SignalR

<span data-ttu-id="a5355-526">Le SignalR client JavaScript `@aspnet/signalr` est `@microsoft/signalr`passé de .</span><span class="sxs-lookup"><span data-stu-id="a5355-526">The SignalR JavaScript client has changed from `@aspnet/signalr` to `@microsoft/signalr`.</span></span> <span data-ttu-id="a5355-527">Pour réagir à ce changement, modifiez les `require` références *dans* les `import` fichiers, les relevés et les relevés ECMAScript.</span><span class="sxs-lookup"><span data-stu-id="a5355-527">To react to this change, change the references in *package.json* files, `require` statements, and ECMAScript `import` statements.</span></span>

### <a name="systemtextjson-is-the-default-protocol"></a><span data-ttu-id="a5355-528">System.Text.Json est le protocole par défaut</span><span class="sxs-lookup"><span data-stu-id="a5355-528">System.Text.Json is the default protocol</span></span>

<span data-ttu-id="a5355-529">`System.Text.Json`est maintenant le protocole Hub par défaut utilisé par le client et le serveur.</span><span class="sxs-lookup"><span data-stu-id="a5355-529">`System.Text.Json` is now the default Hub protocol used by both the client and server.</span></span>

<span data-ttu-id="a5355-530">Dans `Startup.ConfigureServices`, `AddJsonProtocol` appelez pour définir des options de sérialisation.</span><span class="sxs-lookup"><span data-stu-id="a5355-530">In `Startup.ConfigureServices`, call `AddJsonProtocol` to set serializer options.</span></span>

<span data-ttu-id="a5355-531">**Serveur:**</span><span class="sxs-lookup"><span data-stu-id="a5355-531">**Server:**</span></span>

```csharp
services.AddSignalR(...)
        .AddJsonProtocol(options =>
        {
            options.PayloadSerializerOptions.WriteIndented = false;
        })
```

<span data-ttu-id="a5355-532">**Client:**</span><span class="sxs-lookup"><span data-stu-id="a5355-532">**Client:**</span></span>

```csharp
new HubConnectionBuilder()
    .WithUrl("/chatHub")
    .AddJsonProtocol(options =>
    {
        options.PayloadSerializerOptions.WriteIndented = false;
    })
    .Build();
```

### <a name="switch-to-newtonsoftjson"></a><span data-ttu-id="a5355-533">Passez à Newtonsoft.Json</span><span class="sxs-lookup"><span data-stu-id="a5355-533">Switch to Newtonsoft.Json</span></span>

<span data-ttu-id="a5355-534">Si vous utilisez [des fonctionnalités de Newtonsoft.Json qui ne sont pas pris en charge dans System.Text.Json](/dotnet/standard/serialization/system-text-json-migrate-from-newtonsoft-how-to), vous pouvez revenir à `Newtonsoft.Json`.</span><span class="sxs-lookup"><span data-stu-id="a5355-534">If you're using [features of Newtonsoft.Json that aren't supported in System.Text.Json](/dotnet/standard/serialization/system-text-json-migrate-from-newtonsoft-how-to), you can switch back to `Newtonsoft.Json`.</span></span> <span data-ttu-id="a5355-535">Voir [Use Newtonsoft.Json dans un ASP.NET projet Core SignalR 3.0](#use-newtonsoftjson-in-an-aspnet-core-30-signalr-project) plus tôt dans cet article.</span><span class="sxs-lookup"><span data-stu-id="a5355-535">See [Use Newtonsoft.Json in an ASP.NET Core 3.0 SignalR project](#use-newtonsoftjson-in-an-aspnet-core-30-signalr-project) earlier in this article.</span></span>

## <a name="redis-distributed-caches"></a><span data-ttu-id="a5355-536">Redis a distribué des caches</span><span class="sxs-lookup"><span data-stu-id="a5355-536">Redis distributed caches</span></span>

<span data-ttu-id="a5355-537">Le forfait [Microsoft.Extensions.Caching.Redis](https://www.nuget.org/packages/Microsoft.Extensions.Caching.Redis) n’est pas disponible pour ASP.NET’applications Core 3.0 ou plus tard.</span><span class="sxs-lookup"><span data-stu-id="a5355-537">The [Microsoft.Extensions.Caching.Redis](https://www.nuget.org/packages/Microsoft.Extensions.Caching.Redis) package isn't available for ASP.NET Core 3.0 or later apps.</span></span> <span data-ttu-id="a5355-538">Remplacez la référence du paquet par [Microsoft.Extensions.Caching.StackExchangeRedis](https://www.nuget.org/packages/Microsoft.Extensions.Caching.StackExchangeRedis).</span><span class="sxs-lookup"><span data-stu-id="a5355-538">Replace the package reference with [Microsoft.Extensions.Caching.StackExchangeRedis](https://www.nuget.org/packages/Microsoft.Extensions.Caching.StackExchangeRedis).</span></span> <span data-ttu-id="a5355-539">Pour plus d’informations, consultez <xref:performance/caching/distributed>.</span><span class="sxs-lookup"><span data-stu-id="a5355-539">For more information, see <xref:performance/caching/distributed>.</span></span>

## <a name="opt-in-to-runtime-compilation"></a><span data-ttu-id="a5355-540">Optez pour la compilation runtime</span><span class="sxs-lookup"><span data-stu-id="a5355-540">Opt in to runtime compilation</span></span>

<span data-ttu-id="a5355-541">Avant ASP.NET Core 3.0, la compilation des vues en temps d’exécution était une caractéristique implicite du cadre.</span><span class="sxs-lookup"><span data-stu-id="a5355-541">Prior to ASP.NET Core 3.0, runtime compilation of views was an implicit feature of the framework.</span></span> <span data-ttu-id="a5355-542">Les suppléments de compilation Runtime construisent-le-temps de la compilation des vues.</span><span class="sxs-lookup"><span data-stu-id="a5355-542">Runtime compilation supplements build-time compilation of views.</span></span> <span data-ttu-id="a5355-543">Il permet au cadre de compiler les vues et les pages Razor (fichiers *.cshtml)* lorsque les fichiers sont modifiés, sans avoir à reconstruire l’application entière.</span><span class="sxs-lookup"><span data-stu-id="a5355-543">It allows the framework to compile Razor views and pages (*.cshtml* files) when the files are modified, without having to rebuild the entire app.</span></span> <span data-ttu-id="a5355-544">Cette fonctionnalité prend en charge le scénario d’une modification rapide dans l’IDE et rafraîchissant le navigateur pour afficher les modifications.</span><span class="sxs-lookup"><span data-stu-id="a5355-544">This feature supports the scenario of making a quick edit in the IDE and refreshing the browser to view the changes.</span></span>

<span data-ttu-id="a5355-545">Dans ASP.NET Core 3.0, la compilation runtime est un scénario d’opt-in.</span><span class="sxs-lookup"><span data-stu-id="a5355-545">In ASP.NET Core 3.0, runtime compilation is an opt-in scenario.</span></span> <span data-ttu-id="a5355-546">La compilation de build-time est le seul mécanisme de compilation d’images activé par défaut.</span><span class="sxs-lookup"><span data-stu-id="a5355-546">Build-time compilation is the only mechanism for view compilation that's enabled by default.</span></span> <span data-ttu-id="a5355-547">L’exécution s’appuie sur Visual Studio ou [dotnet-watch](xref:tutorials/dotnet-watch) dans Visual Studio Code pour reconstruire le projet lorsqu’il détecte les modifications apportées aux fichiers *.cshtml.*</span><span class="sxs-lookup"><span data-stu-id="a5355-547">The runtime relies on Visual Studio or [dotnet-watch](xref:tutorials/dotnet-watch) in Visual Studio Code to rebuild the project when it detects changes to *.cshtml* files.</span></span> <span data-ttu-id="a5355-548">Dans Visual Studio, les changements à *.cs*, *.cshtml*, ou *.razor* fichiers dans le projet en cours d’exécution (<kbd>Ctrl-F5</kbd>), mais pas débugged (<kbd>F5</kbd>), déclencher la recompilation du projet.</span><span class="sxs-lookup"><span data-stu-id="a5355-548">In Visual Studio, changes to *.cs*, *.cshtml*, or *.razor* files in the project being run (<kbd>Ctrl+F5</kbd>), but not debugged (<kbd>F5</kbd>), trigger recompilation of the project.</span></span>

<span data-ttu-id="a5355-549">Pour activer la compilation en temps d’exécution dans votre projet ASP.NET Core 3.0 :</span><span class="sxs-lookup"><span data-stu-id="a5355-549">To enable runtime compilation in your ASP.NET Core 3.0 project:</span></span>

1. <span data-ttu-id="a5355-550">Installez le package [NuGet Microsoft.AspNetCore.Mvc.Razor.RuntimeCompilation.](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Razor.RuntimeCompilation)</span><span class="sxs-lookup"><span data-stu-id="a5355-550">Install the [Microsoft.AspNetCore.Mvc.Razor.RuntimeCompilation](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Razor.RuntimeCompilation) NuGet package.</span></span>
1. <span data-ttu-id="a5355-551">Mise `Startup.ConfigureServices` à `AddRazorRuntimeCompilation`jour pour appeler :</span><span class="sxs-lookup"><span data-stu-id="a5355-551">Update `Startup.ConfigureServices` to call `AddRazorRuntimeCompilation`:</span></span>

    <span data-ttu-id="a5355-552">Pour ASP.NET Core MVC, utilisez le code suivant :</span><span class="sxs-lookup"><span data-stu-id="a5355-552">For ASP.NET Core MVC, use the following code:</span></span>

    ```csharp
    services.AddControllersWithViews()
        .AddRazorRuntimeCompilation(...);
    ```
 
    <span data-ttu-id="a5355-553">Pour ASP.NET Pages de rasoir de base, utilisez le code suivant :</span><span class="sxs-lookup"><span data-stu-id="a5355-553">For ASP.NET Core Razor Pages, use the following code:</span></span>
 
    ```csharp
    services.AddRazorPages()
        .AddRazorRuntimeCompilation(...);
    ```
 
<span data-ttu-id="a5355-554">L’échantillon https://github.com/aspnet/samples/tree/master/samples/aspnetcore/mvc/runtimecompilation montre un exemple de compilation de temps d’exécution conditionnellement dans les environnements de développement.</span><span class="sxs-lookup"><span data-stu-id="a5355-554">The sample at https://github.com/aspnet/samples/tree/master/samples/aspnetcore/mvc/runtimecompilation shows an example of enabling runtime compilation conditionally in Development environments.</span></span>

<span data-ttu-id="a5355-555">Pour plus d’informations sur <xref:mvc/views/view-compilation>la compilation de fichiers Razor, voir .</span><span class="sxs-lookup"><span data-stu-id="a5355-555">For more information on Razor file compilation, see <xref:mvc/views/view-compilation>.</span></span>

## <a name="migrate-libraries-via-multi-targeting"></a><span data-ttu-id="a5355-556">Migrer les bibliothèques via le multi-ciblage</span><span class="sxs-lookup"><span data-stu-id="a5355-556">Migrate libraries via multi-targeting</span></span>

<span data-ttu-id="a5355-557">Les bibliothèques ont souvent besoin de prendre en charge plusieurs versions de ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="a5355-557">Libraries often need to support multiple versions of ASP.NET Core.</span></span> <span data-ttu-id="a5355-558">La plupart des bibliothèques qui ont été compilées par rapport aux versions précédentes de ASP.NET Core devraient continuer à travailler sans problèmes.</span><span class="sxs-lookup"><span data-stu-id="a5355-558">Most libraries that were compiled against previous versions of ASP.NET Core should continue working without issues.</span></span> <span data-ttu-id="a5355-559">Les conditions suivantes exigent que l’application soit compilée en contrecoup :</span><span class="sxs-lookup"><span data-stu-id="a5355-559">The following conditions require the app to be cross-compiled:</span></span>

* <span data-ttu-id="a5355-560">La bibliothèque s’appuie sur une fonctionnalité qui a un changement de [rupture](#breaking-api-changes)binaire .</span><span class="sxs-lookup"><span data-stu-id="a5355-560">The library relies on a feature that has a binary [breaking change](#breaking-api-changes).</span></span>
* <span data-ttu-id="a5355-561">La bibliothèque veut profiter de nouvelles fonctionnalités dans ASP.NET Core 3.0.</span><span class="sxs-lookup"><span data-stu-id="a5355-561">The library wants to take advantage of new features in ASP.NET Core 3.0.</span></span> 

<span data-ttu-id="a5355-562">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="a5355-562">For example:</span></span>

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFrameworks>netcoreapp3.0;netstandard2.0</TargetFrameworks>
  </PropertyGroup>

  <ItemGroup Condition="'$(TargetFramework)' == 'netcoreapp3.0'">
    <FrameworkReference Include="Microsoft.AspNetCore.App" />
  </ItemGroup>

  <ItemGroup Condition="'$(TargetFramework)' == 'netstandard2.0'">
    <PackageReference Include="Microsoft.AspNetCore" Version="2.1.0" />
  </ItemGroup>
</Project>
```

<span data-ttu-id="a5355-563">Utiliser `#ifdefs` pour activer ASP.NET API spécifiques à base 3.0 :</span><span class="sxs-lookup"><span data-stu-id="a5355-563">Use `#ifdefs` to enable ASP.NET Core 3.0-specific APIs:</span></span>

```csharp
var webRootFileProvider =
#if NETCOREAPP3_0
    GetRequiredService<IWebHostEnvironment>().WebRootFileProvider;
#elif NETSTANDARD2_0
    GetRequiredService<IHostingEnvironment>().WebRootFileProvider;
#else
#error unknown target framework
#endif
```

<span data-ttu-id="a5355-564">Pour plus d’informations sur l’utilisation de ASP.NET <xref:fundamentals/target-aspnetcore>API de base dans une bibliothèque de classe, voir .</span><span class="sxs-lookup"><span data-stu-id="a5355-564">For more information on using ASP.NET Core APIs in a class library, see <xref:fundamentals/target-aspnetcore>.</span></span>

## <a name="miscellaneous-changes"></a><span data-ttu-id="a5355-565">Modifications diverses</span><span class="sxs-lookup"><span data-stu-id="a5355-565">Miscellaneous changes</span></span>

<span data-ttu-id="a5355-566">Le système de validation en .NET Core 3.0 et traite plus tard des `[Required]` paramètres non annulables ou des propriétés liées comme s’ils avaient un attribut.</span><span class="sxs-lookup"><span data-stu-id="a5355-566">The validation system in .NET Core 3.0 and later treats non-nullable parameters or bound properties as if they had a `[Required]` attribute.</span></span> <span data-ttu-id="a5355-567">Pour plus d’informations, voir [[requis] attribut](xref:mvc/models/validation?view=aspnetcore-3.1#required-attribute).</span><span class="sxs-lookup"><span data-stu-id="a5355-567">For more information, see [[Required] attribute](xref:mvc/models/validation?view=aspnetcore-3.1#required-attribute).</span></span>

### <a name="publish"></a><span data-ttu-id="a5355-568">Publish</span><span class="sxs-lookup"><span data-stu-id="a5355-568">Publish</span></span>

<span data-ttu-id="a5355-569">Supprimer les *dossiers bin* et *obj* dans l’annuaire du projet.</span><span class="sxs-lookup"><span data-stu-id="a5355-569">Delete the *bin* and *obj* folders in the project directory.</span></span>

## <a name="testserver"></a><span data-ttu-id="a5355-570">TestServer</span><span class="sxs-lookup"><span data-stu-id="a5355-570">TestServer</span></span>

<span data-ttu-id="a5355-571">Pour les <xref:Microsoft.AspNetCore.TestHost.TestServer> applications qui utilisent directement `TestServer` avec <xref:Microsoft.AspNetCore.Hosting.IWebHostBuilder> l’hôte [générique](xref:fundamentals/host/web-host), créer le sur un dans <xref:Microsoft.Extensions.Hosting.GenericHostWebHostBuilderExtensions.ConfigureWebHost%2A>:</span><span class="sxs-lookup"><span data-stu-id="a5355-571">For apps that use <xref:Microsoft.AspNetCore.TestHost.TestServer> directly with the [Generic Host](xref:fundamentals/host/web-host), create the `TestServer` on an <xref:Microsoft.AspNetCore.Hosting.IWebHostBuilder> in <xref:Microsoft.Extensions.Hosting.GenericHostWebHostBuilderExtensions.ConfigureWebHost%2A>:</span></span>

```csharp
[Fact]
public async Task GenericCreateAndStartHost_GetTestServer()
{
    using var host = await new HostBuilder()
        .ConfigureWebHost(webBuilder =>
        {
            webBuilder
                .UseTestServer()
                .Configure(app => { });
        })
    .StartAsync();

    var response = await host.GetTestServer().CreateClient().GetAsync("/");

    Assert.Equal(HttpStatusCode.NotFound, response.StatusCode);
}
```

<a name="break"></a>

## <a name="breaking-api-changes"></a><span data-ttu-id="a5355-572">Briser les changements d’API</span><span class="sxs-lookup"><span data-stu-id="a5355-572">Breaking API changes</span></span>

<span data-ttu-id="a5355-573">Examen des changements de rupture:</span><span class="sxs-lookup"><span data-stu-id="a5355-573">Review breaking changes:</span></span>

* [<span data-ttu-id="a5355-574">Liste complète des changements de rupture dans la version ASP.NET Core 3.0</span><span class="sxs-lookup"><span data-stu-id="a5355-574">Complete list of breaking changes in the ASP.NET Core 3.0 release</span></span>](https://github.com/aspnet/Announcements/issues?page=1&q=is%3Aissue+is%3Aopen+label%3A%22Breaking+change%22+label%3A3.0.0)
* <span data-ttu-id="a5355-575">[Briser les changements d’API dans l’antiforgerie, corS, diagnostics, MVC, et le routage](https://github.com/aspnet/Announcements/issues/387).</span><span class="sxs-lookup"><span data-stu-id="a5355-575">[Breaking API changes in Antiforgery, CORS, Diagnostics, MVC, and Routing](https://github.com/aspnet/Announcements/issues/387).</span></span> <span data-ttu-id="a5355-576">Cette liste comprend des modifications de rupture pour les commutateurs de compatibilité.</span><span class="sxs-lookup"><span data-stu-id="a5355-576">This list includes breaking changes for compatibility switches.</span></span>
* <span data-ttu-id="a5355-577">Pour un résumé de 2,2 à 3,0 changements de rupture à travers .NET Core, ASP.NET Core, et Entity Framework Core, voir [Breaking changements pour la migration de la version 2.2 à 3.0](/dotnet/core/compatibility/2.2-3.0).</span><span class="sxs-lookup"><span data-stu-id="a5355-577">For a summary of 2.2-to-3.0 breaking changes across .NET Core, ASP.NET Core, and Entity Framework Core, see [Breaking changes for migration from version 2.2 to 3.0](/dotnet/core/compatibility/2.2-3.0).</span></span>

## <a name="net-core-30-on-azure-app-service"></a><span data-ttu-id="a5355-578">.NET Core 3.0 sur Azure App Service</span><span class="sxs-lookup"><span data-stu-id="a5355-578">.NET Core 3.0 on Azure App Service</span></span>

<span data-ttu-id="a5355-579">Pour progresser sur le déploiement de .NET Core to Azure App Service, voir le site officiel [.NET Core sur App Service.](https://aspnetcoreon.azurewebsites.net/)</span><span class="sxs-lookup"><span data-stu-id="a5355-579">For progress on the rollout of .NET Core to Azure App Service, see the official [.NET Core on App Service](https://aspnetcoreon.azurewebsites.net/) website.</span></span> <span data-ttu-id="a5355-580">Jusqu’à ce que .NET Core 3.0 soit disponible sur Azure App Service, suivez les instructions de [La version de l’aperçu De Deploy ASP.NET Core sur Azure App Service](xref:host-and-deploy/azure-apps/index#deploy-aspnet-core-preview-release-to-azure-app-service).</span><span class="sxs-lookup"><span data-stu-id="a5355-580">Until .NET Core 3.0 is available on Azure App Service, follow the instructions at [Deploy ASP.NET Core preview release to Azure App Service](xref:host-and-deploy/azure-apps/index#deploy-aspnet-core-preview-release-to-azure-app-service).</span></span>
