---
title: Vue d’ensemble des API de consommateur pour ASP.NET Core
author: rick-anderson
description: Recevez une brève présentation des différentes API de consommateur disponibles dans la bibliothèque de protection des données ASP.NET Core.
ms.author: riande
ms.date: 06/11/2019
no-loc:
- ASP.NET Core Identity
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: security/data-protection/consumer-apis/overview
ms.openlocfilehash: 0cdc5d8700357f33fcd3d361f10a5d66cccb067d
ms.sourcegitcommit: 65add17f74a29a647d812b04517e46cbc78258f9
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/19/2020
ms.locfileid: "88629897"
---
# <a name="consumer-apis-overview-for-aspnet-core"></a><span data-ttu-id="579c4-103">Vue d’ensemble des API de consommateur pour ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="579c4-103">Consumer APIs overview for ASP.NET Core</span></span>

<span data-ttu-id="579c4-104">Les `IDataProtectionProvider` `IDataProtector` interfaces et sont les interfaces de base par le biais desquelles les consommateurs utilisent le système de protection des données.</span><span class="sxs-lookup"><span data-stu-id="579c4-104">The `IDataProtectionProvider` and `IDataProtector` interfaces are the basic interfaces through which consumers use the data protection system.</span></span> <span data-ttu-id="579c4-105">Ils se trouvent dans le package [Microsoft. AspNetCore. dataprotection. Abstracts](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Abstractions/) .</span><span class="sxs-lookup"><span data-stu-id="579c4-105">They're located in the [Microsoft.AspNetCore.DataProtection.Abstractions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Abstractions/) package.</span></span>

## <a name="idataprotectionprovider"></a><span data-ttu-id="579c4-106">IDataProtectionProvider</span><span class="sxs-lookup"><span data-stu-id="579c4-106">IDataProtectionProvider</span></span>

<span data-ttu-id="579c4-107">L’interface du fournisseur représente la racine du système de protection des données.</span><span class="sxs-lookup"><span data-stu-id="579c4-107">The provider interface represents the root of the data protection system.</span></span> <span data-ttu-id="579c4-108">Il ne peut pas être utilisé directement pour protéger ou ôter la protection des données.</span><span class="sxs-lookup"><span data-stu-id="579c4-108">It cannot directly be used to protect or unprotect data.</span></span> <span data-ttu-id="579c4-109">Au lieu de cela, le consommateur doit obtenir une référence à un `IDataProtector` en appelant `IDataProtectionProvider.CreateProtector(purpose)` , où objet est une chaîne qui décrit le cas d’usage consommateur prévu.</span><span class="sxs-lookup"><span data-stu-id="579c4-109">Instead, the consumer must get a reference to an `IDataProtector` by calling `IDataProtectionProvider.CreateProtector(purpose)`, where purpose is a string that describes the intended consumer use case.</span></span> <span data-ttu-id="579c4-110">Pour plus d’informations sur l’intention de ce paramètre et sur la manière de choisir une valeur appropriée, consultez [chaînes d’objectif](xref:security/data-protection/consumer-apis/purpose-strings) .</span><span class="sxs-lookup"><span data-stu-id="579c4-110">See [Purpose Strings](xref:security/data-protection/consumer-apis/purpose-strings) for much more information on the intent of this parameter and how to choose an appropriate value.</span></span>

## <a name="idataprotector"></a><span data-ttu-id="579c4-111">IDataProtector</span><span class="sxs-lookup"><span data-stu-id="579c4-111">IDataProtector</span></span>

<span data-ttu-id="579c4-112">L’interface de protecteur est retournée par un appel à `CreateProtector` , et c’est cette interface que les consommateurs peuvent utiliser pour effectuer des opérations de protection et d’ôter la protection.</span><span class="sxs-lookup"><span data-stu-id="579c4-112">The protector interface is returned by a call to `CreateProtector`, and it's this interface which consumers can use to perform protect and unprotect operations.</span></span>

<span data-ttu-id="579c4-113">Pour protéger un élément de données, transmettez les données à la `Protect` méthode.</span><span class="sxs-lookup"><span data-stu-id="579c4-113">To protect a piece of data, pass the data to the `Protect` method.</span></span> <span data-ttu-id="579c4-114">L’interface de base définit une méthode qui convertit Byte []-> Byte [], mais il existe également une surcharge (fournie en tant que méthode d’extension) qui convertit la chaîne > chaîne.</span><span class="sxs-lookup"><span data-stu-id="579c4-114">The basic interface defines a method which converts byte[] -> byte[], but there's also an overload (provided as an extension method) which converts string -> string.</span></span> <span data-ttu-id="579c4-115">La sécurité offerte par les deux méthodes est identique ; le développeur doit choisir la surcharge la plus pratique pour le cas d’usage.</span><span class="sxs-lookup"><span data-stu-id="579c4-115">The security offered by the two methods is identical; the developer should choose whichever overload is most convenient for their use case.</span></span> <span data-ttu-id="579c4-116">Quelle que soit la surcharge choisie, la valeur retournée par la méthode Protect est désormais protégée (chiffrée et inviolable) et l’application peut l’envoyer à un client non approuvé.</span><span class="sxs-lookup"><span data-stu-id="579c4-116">Irrespective of the overload chosen, the value returned by the Protect method is now protected (enciphered and tamper-proofed), and the application can send it to an untrusted client.</span></span>

<span data-ttu-id="579c4-117">Pour ôter la protection d’un élément de données précédemment protégé, transmettez les données protégées à la `Unprotect` méthode.</span><span class="sxs-lookup"><span data-stu-id="579c4-117">To unprotect a previously-protected piece of data, pass the protected data to the `Unprotect` method.</span></span> <span data-ttu-id="579c4-118">(Il existe des surcharges basées sur un octet [] et une chaîne pour faciliter le développement.) Si la charge utile protégée a été générée par un appel antérieur à `Protect` sur ce même `IDataProtector` , la `Unprotect` méthode retourne la charge utile non protégée d’origine.</span><span class="sxs-lookup"><span data-stu-id="579c4-118">(There are byte[]-based and string-based overloads for developer convenience.) If the protected payload was generated by an earlier call to `Protect` on this same `IDataProtector`, the `Unprotect` method will return the original unprotected payload.</span></span> <span data-ttu-id="579c4-119">Si la charge utile protégée a été falsifiée ou a été produite par un différent `IDataProtector` , la `Unprotect` méthode lèvera CryptographicException.</span><span class="sxs-lookup"><span data-stu-id="579c4-119">If the protected payload has been tampered with or was produced by a different `IDataProtector`, the `Unprotect` method will throw CryptographicException.</span></span>

<span data-ttu-id="579c4-120">Le concept des mêmes différences par rapport `IDataProtector` à la notion de rôle est différent.</span><span class="sxs-lookup"><span data-stu-id="579c4-120">The concept of same vs. different `IDataProtector` ties back to the concept of purpose.</span></span> <span data-ttu-id="579c4-121">Si deux `IDataProtector` instances ont été générées à partir de la même racine `IDataProtectionProvider` mais par le biais de chaînes d’objectif différentes dans l’appel à `IDataProtectionProvider.CreateProtector` , elles sont considérées comme des [protecteurs différents](xref:security/data-protection/consumer-apis/purpose-strings)et l’une ne peut pas ôter la protection des charges utiles générées par l’autre.</span><span class="sxs-lookup"><span data-stu-id="579c4-121">If two `IDataProtector` instances were generated from the same root `IDataProtectionProvider` but via different purpose strings in the call to `IDataProtectionProvider.CreateProtector`, then they're considered [different protectors](xref:security/data-protection/consumer-apis/purpose-strings), and one won't be able to unprotect payloads generated by the other.</span></span>

## <a name="consuming-these-interfaces"></a><span data-ttu-id="579c4-122">Utilisation de ces interfaces</span><span class="sxs-lookup"><span data-stu-id="579c4-122">Consuming these interfaces</span></span>

<span data-ttu-id="579c4-123">Pour un composant de DI-Aware, l’utilisation prévue est que le composant utilise un `IDataProtectionProvider` paramètre dans son constructeur et que le système di fournit automatiquement ce service lorsque le composant est instancié.</span><span class="sxs-lookup"><span data-stu-id="579c4-123">For a DI-aware component, the intended usage is that the component takes an `IDataProtectionProvider` parameter in its constructor and that the DI system automatically provides this service when the component is instantiated.</span></span>

> [!NOTE]
> <span data-ttu-id="579c4-124">Certaines applications (telles que les applications console ou les applications ASP.NET 4. x) peuvent ne pas être compatibles avec la transprise en charge. par conséquent, il n’est pas possible d’utiliser le mécanisme décrit ici.</span><span class="sxs-lookup"><span data-stu-id="579c4-124">Some applications (such as console applications or ASP.NET 4.x applications) might not be DI-aware so cannot use the mechanism described here.</span></span> <span data-ttu-id="579c4-125">Pour ces scénarios, consultez le document relatif aux [scénarios sans di-Aware](xref:security/data-protection/configuration/non-di-scenarios) pour plus d’informations sur l’obtention d’une instance d’un `IDataProtection` fournisseur sans passer par di.</span><span class="sxs-lookup"><span data-stu-id="579c4-125">For these scenarios consult the [Non DI Aware Scenarios](xref:security/data-protection/configuration/non-di-scenarios) document for more information on getting an instance of an `IDataProtection` provider without going through DI.</span></span>

<span data-ttu-id="579c4-126">L’exemple suivant illustre trois concepts :</span><span class="sxs-lookup"><span data-stu-id="579c4-126">The following sample demonstrates three concepts:</span></span>

1. <span data-ttu-id="579c4-127">[Ajoutez le système de protection des données](xref:security/data-protection/configuration/overview) au conteneur de service,</span><span class="sxs-lookup"><span data-stu-id="579c4-127">[Add the data protection system](xref:security/data-protection/configuration/overview) to the service container,</span></span>

2. <span data-ttu-id="579c4-128">Utilisation de DI pour recevoir une instance d’un `IDataProtectionProvider` et</span><span class="sxs-lookup"><span data-stu-id="579c4-128">Using DI to receive an instance of an `IDataProtectionProvider`, and</span></span>

3. <span data-ttu-id="579c4-129">Créer un `IDataProtector` à partir d’un `IDataProtectionProvider` et l’utiliser pour protéger et ôter la protection des données.</span><span class="sxs-lookup"><span data-stu-id="579c4-129">Creating an `IDataProtector` from an `IDataProtectionProvider` and using it to protect and unprotect data.</span></span>

[!code-csharp[](../using-data-protection/samples/protectunprotect.cs?highlight=26,34,35,36,37,38,39,40)]

<span data-ttu-id="579c4-130">Le package Microsoft. AspNetCore. DataProtection. Abstracts contient une méthode d’extension `IServiceProvider.GetDataProtector` en tant que développeur.</span><span class="sxs-lookup"><span data-stu-id="579c4-130">The package Microsoft.AspNetCore.DataProtection.Abstractions contains an extension method `IServiceProvider.GetDataProtector` as a developer convenience.</span></span> <span data-ttu-id="579c4-131">Il encapsule comme une opération unique en extrayant un `IDataProtectionProvider` à partir du fournisseur de services et en appelant `IDataProtectionProvider.CreateProtector` .</span><span class="sxs-lookup"><span data-stu-id="579c4-131">It encapsulates as a single operation both retrieving an `IDataProtectionProvider` from the service provider and calling `IDataProtectionProvider.CreateProtector`.</span></span> <span data-ttu-id="579c4-132">L’exemple suivant illustre son utilisation.</span><span class="sxs-lookup"><span data-stu-id="579c4-132">The following sample demonstrates its usage.</span></span>

[!code-csharp[](./overview/samples/getdataprotector.cs?highlight=15)]

>[!TIP]
> <span data-ttu-id="579c4-133">Les instances de `IDataProtectionProvider` et de `IDataProtector` sont thread-safe pour plusieurs appelants.</span><span class="sxs-lookup"><span data-stu-id="579c4-133">Instances of `IDataProtectionProvider` and `IDataProtector` are thread-safe for multiple callers.</span></span> <span data-ttu-id="579c4-134">Il est prévu qu’une fois qu’un composant obtient une référence à un `IDataProtector` via un appel à `CreateProtector` , il utilise cette référence pour plusieurs appels à `Protect` et `Unprotect` .</span><span class="sxs-lookup"><span data-stu-id="579c4-134">It's intended that once a component gets a reference to an `IDataProtector` via a call to `CreateProtector`, it will use that reference for multiple calls to `Protect` and `Unprotect`.</span></span> <span data-ttu-id="579c4-135">Un appel à `Unprotect` lèvera CryptographicException si la charge utile protégée ne peut pas être vérifiée ou déchiffrée.</span><span class="sxs-lookup"><span data-stu-id="579c4-135">A call to `Unprotect` will throw CryptographicException if the protected payload cannot be verified or deciphered.</span></span> <span data-ttu-id="579c4-136">Certains composants peuvent souhaiter ignorer des erreurs lors de l’opération de non-protection. un composant qui lit les cookie s d’authentification peut gérer cette erreur et traiter la demande comme s’il avait un élément cookie au lieu de faire échouer la demande.</span><span class="sxs-lookup"><span data-stu-id="579c4-136">Some components may wish to ignore errors during unprotect operations; a component which reads authentication cookies might handle this error and treat the request as if it had no cookie at all rather than fail the request outright.</span></span> <span data-ttu-id="579c4-137">Les composants qui veulent ce comportement doivent intercepter spécifiquement CryptographicException au lieu d’absorber toutes les exceptions.</span><span class="sxs-lookup"><span data-stu-id="579c4-137">Components which want this behavior should specifically catch CryptographicException instead of swallowing all exceptions.</span></span>
