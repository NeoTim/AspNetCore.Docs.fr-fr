---
title: ASP.NET Core sécurisé Blazor webassembly
author: guardrex
description: Apprenez à sécuriser Blazor applications WebAssemlby en tant qu’applications à page unique (SPAs).
monikerRange: '>= aspnetcore-3.1'
ms.author: riande
ms.custom: mvc
ms.date: 03/12/2020
no-loc:
- Blazor
- SignalR
uid: security/blazor/webassembly/index
ms.openlocfilehash: 652d4c61110f786396d9d5af4f131b817c40e333
ms.sourcegitcommit: 91dc1dd3d055b4c7d7298420927b3fd161067c64
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/24/2020
ms.locfileid: "80219244"
---
# <a name="secure-aspnet-core-opno-locblazor-webassembly"></a><span data-ttu-id="4114d-103">ASP.NET Core sécurisé Blazor webassembly</span><span class="sxs-lookup"><span data-stu-id="4114d-103">Secure ASP.NET Core Blazor WebAssembly</span></span>

<span data-ttu-id="4114d-104">Par [Javier Calvarro Nelson](https://github.com/javiercn)</span><span class="sxs-lookup"><span data-stu-id="4114d-104">By [Javier Calvarro Nelson](https://github.com/javiercn)</span></span>

[!INCLUDE[](~/includes/blazorwasm-preview-notice.md)]

[!INCLUDE[](~/includes/blazorwasm-3.2-template-article-notice.md)]

Blazor<span data-ttu-id="4114d-105"> applications webassembly sont sécurisées de la même façon que les applications à page unique (SPAs).</span><span class="sxs-lookup"><span data-stu-id="4114d-105"> WebAssembly apps are secured in the same manner as Single Page Applications (SPAs).</span></span> <span data-ttu-id="4114d-106">Il existe plusieurs approches pour authentifier les utilisateurs dans la base de code, mais l’approche la plus courante et la plus complète consiste à utiliser une implémentation basée sur le [protocole oAuth 2,0](https://oauth.net/), par exemple [Open ID Connect (OIDC)](https://openid.net/connect/).</span><span class="sxs-lookup"><span data-stu-id="4114d-106">There are several approaches for authenticating users to SPAs, but the most common and comprehensive approach is to use an implementation based on the [oAuth 2.0 protocol](https://oauth.net/), such as [Open ID Connect (OIDC)](https://openid.net/connect/).</span></span>

## <a name="authentication-library"></a><span data-ttu-id="4114d-107">Bibliothèque d’authentification</span><span class="sxs-lookup"><span data-stu-id="4114d-107">Authentication library</span></span>

Blazor<span data-ttu-id="4114d-108"> webassembly prend en charge l’authentification et l’autorisation d’applications à l’aide de OIDC via la bibliothèque `Microsoft.AspNetCore.Components.WebAssembly.Authentication`.</span><span class="sxs-lookup"><span data-stu-id="4114d-108"> WebAssembly supports authenticating and authorizing apps using OIDC via the `Microsoft.AspNetCore.Components.WebAssembly.Authentication` library.</span></span> <span data-ttu-id="4114d-109">La bibliothèque fournit un ensemble de primitives pour l’authentification en toute transparence par rapport aux principaux de ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="4114d-109">The library provides a set of primitives for seamlessly authenticating against ASP.NET Core backends.</span></span> <span data-ttu-id="4114d-110">La bibliothèque intègre ASP.NET Core identité avec la prise en charge des autorisations d’API basée sur le [serveur d’identité](https://identityserver.io/).</span><span class="sxs-lookup"><span data-stu-id="4114d-110">The library integrates ASP.NET Core Identity with API authorization support built on top of [Identity Server](https://identityserver.io/).</span></span> <span data-ttu-id="4114d-111">La bibliothèque peut s’authentifier auprès d’un fournisseur d’identité (IP) tiers qui prend en charge OIDC, qui sont appelés fournisseurs OpenID.</span><span class="sxs-lookup"><span data-stu-id="4114d-111">The library can authenticate against any third-party Identity Provider (IP) that supports OIDC, which are called OpenID Providers (OP).</span></span>

<span data-ttu-id="4114d-112">La prise en charge de l’authentification dans Blazor webassembly est basée sur la bibliothèque *OIDC-client. js* , qui est utilisée pour gérer les détails du protocole d’authentification sous-jacent.</span><span class="sxs-lookup"><span data-stu-id="4114d-112">The authentication support in Blazor WebAssembly is built on top of the *oidc-client.js* library, which is used to handle the underlying authentication protocol details.</span></span>

<span data-ttu-id="4114d-113">D’autres options d’authentification de la fonction de l’interauthentification existent, telles que l’utilisation de cookies SameSite.</span><span class="sxs-lookup"><span data-stu-id="4114d-113">Other options for authenticating SPAs exist, such as the use of SameSite cookies.</span></span> <span data-ttu-id="4114d-114">Toutefois, la conception d’ingénierie de Blazor webassembly est réglée sur oAuth et OIDC comme meilleure option pour l’authentification dans Blazor applications webassembly.</span><span class="sxs-lookup"><span data-stu-id="4114d-114">However, the engineering design of Blazor WebAssembly is settled on oAuth and OIDC as the best option for authentication in Blazor WebAssembly apps.</span></span> <span data-ttu-id="4114d-115">[L’authentification basée sur les jetons](xref:security/anti-request-forgery#token-based-authentication) basée sur des [jetons Web JSON (jetons JWT)](https://self-issued.info/docs/draft-ietf-oauth-json-web-token.html) a été choisie via [l’authentification basée](xref:security/anti-request-forgery#cookie-based-authentication) sur les cookies pour des raisons fonctionnelles et de sécurité :</span><span class="sxs-lookup"><span data-stu-id="4114d-115">[Token-based authentication](xref:security/anti-request-forgery#token-based-authentication) based on [JSON Web Tokens (JWTs)](https://self-issued.info/docs/draft-ietf-oauth-json-web-token.html) was chosen over [cookie-based authentication](xref:security/anti-request-forgery#cookie-based-authentication) for functional and security reasons:</span></span>

* <span data-ttu-id="4114d-116">L’utilisation d’un protocole basé sur les jetons offre une surface d’attaque plus réduite, car les jetons ne sont pas envoyés dans toutes les demandes.</span><span class="sxs-lookup"><span data-stu-id="4114d-116">Using a token-based protocol offers a smaller attack surface area, as the tokens aren't sent in all requests.</span></span>
* <span data-ttu-id="4114d-117">Les points de terminaison de serveur ne nécessitent pas de protection contre la [falsification de requête intersites (CSRF)](xref:security/anti-request-forgery) , car les jetons sont envoyés explicitement.</span><span class="sxs-lookup"><span data-stu-id="4114d-117">Server endpoints don't require protection against [Cross-Site Request Forgery (CSRF)](xref:security/anti-request-forgery) because the tokens are sent explicitly.</span></span> <span data-ttu-id="4114d-118">Cela vous permet d’héberger des applications Blazor webassembly avec des applications MVC ou de pages Razor.</span><span class="sxs-lookup"><span data-stu-id="4114d-118">This allows you to host Blazor WebAssembly apps alongside MVC or Razor pages apps.</span></span>
* <span data-ttu-id="4114d-119">Les jetons ont des autorisations plus étroites que les cookies.</span><span class="sxs-lookup"><span data-stu-id="4114d-119">Tokens have narrower permissions than cookies.</span></span> <span data-ttu-id="4114d-120">Par exemple, les jetons ne peuvent pas être utilisés pour gérer le compte d’utilisateur ou modifier le mot de passe d’un utilisateur, sauf si une telle fonctionnalité est implémentée de manière explicite.</span><span class="sxs-lookup"><span data-stu-id="4114d-120">For example, tokens can't be used to manage the user account or change a user's password unless such functionality is explicitly implemented.</span></span>
* <span data-ttu-id="4114d-121">Les jetons ont une durée de vie brève, par défaut d’une heure, qui limite la fenêtre d’attaque.</span><span class="sxs-lookup"><span data-stu-id="4114d-121">Tokens have a short lifetime, one hour by default, which limits the attack window.</span></span> <span data-ttu-id="4114d-122">Les jetons peuvent également être révoqués à tout moment.</span><span class="sxs-lookup"><span data-stu-id="4114d-122">Tokens can also be revoked at any time.</span></span>
* <span data-ttu-id="4114d-123">Les jetons JWT autonomes offrent des garanties au client et au serveur sur le processus d’authentification.</span><span class="sxs-lookup"><span data-stu-id="4114d-123">Self-contained JWTs offer guarantees to the client and server about the authentication process.</span></span> <span data-ttu-id="4114d-124">Par exemple, un client a la possibilité de détecter et de valider que les jetons qu’il reçoit sont légitimes et ont été émis dans le cadre d’un processus d’authentification donné.</span><span class="sxs-lookup"><span data-stu-id="4114d-124">For example, a client has the means to detect and validate that the tokens it receives are legitimate and were emitted as part of a given authentication process.</span></span> <span data-ttu-id="4114d-125">Si un tiers tente de basculer un jeton au milieu du processus d’authentification, le client peut détecter le jeton commuté et éviter de l’utiliser.</span><span class="sxs-lookup"><span data-stu-id="4114d-125">If a third party attempts to switch a token in the middle of the authentication process, the client can detect the switched token and avoid using it.</span></span>
* <span data-ttu-id="4114d-126">Les jetons avec oAuth et OIDC ne reposent pas sur l’agent utilisateur qui se comporte correctement pour garantir la sécurité de l’application.</span><span class="sxs-lookup"><span data-stu-id="4114d-126">Tokens with oAuth and OIDC don't rely on the user agent behaving correctly to ensure that the app is secure.</span></span>
* <span data-ttu-id="4114d-127">Les protocoles basés sur les jetons, tels que oAuth et OIDC, permettent d’authentifier et d’autoriser des applications hébergées et autonomes avec le même ensemble de caractéristiques de sécurité.</span><span class="sxs-lookup"><span data-stu-id="4114d-127">Token-based protocols, such as oAuth and OIDC, allow for authenticating and authorizing hosted and standalone apps with the same set of security characteristics.</span></span>

## <a name="authentication-process-with-oidc"></a><span data-ttu-id="4114d-128">Processus d’authentification avec OIDC</span><span class="sxs-lookup"><span data-stu-id="4114d-128">Authentication process with OIDC</span></span>

<span data-ttu-id="4114d-129">La bibliothèque `Microsoft.AspNetCore.Components.WebAssembly.Authentication` offre plusieurs primitives pour implémenter l’authentification et l’autorisation à l’aide de OIDC.</span><span class="sxs-lookup"><span data-stu-id="4114d-129">The `Microsoft.AspNetCore.Components.WebAssembly.Authentication` library offers several primitives to implement authentication and authorization using OIDC.</span></span> <span data-ttu-id="4114d-130">En général, l’authentification fonctionne comme suit :</span><span class="sxs-lookup"><span data-stu-id="4114d-130">In broad terms, authentication works as follows:</span></span>

* <span data-ttu-id="4114d-131">Lorsqu’un utilisateur anonyme sélectionne le bouton de connexion ou demande une page avec l’attribut [`[Authorize]`](xref:Microsoft.AspNetCore.Authorization.AuthorizeAttribute) appliqué, l’utilisateur est redirigé vers la page de connexion de l’application (`/authentication/login`).</span><span class="sxs-lookup"><span data-stu-id="4114d-131">When an anonymous user selects the login button or requests a page with the [`[Authorize]`](xref:Microsoft.AspNetCore.Authorization.AuthorizeAttribute) attribute applied, the user is redirected to the app's login page (`/authentication/login`).</span></span>
* <span data-ttu-id="4114d-132">Dans la page de connexion, la bibliothèque d’authentification prépare une redirection vers le point de terminaison d’autorisation.</span><span class="sxs-lookup"><span data-stu-id="4114d-132">In the login page, the authentication library prepares for a redirect to the authorization endpoint.</span></span> <span data-ttu-id="4114d-133">Le point de terminaison d’autorisation est en dehors de l’application Blazor webassembly et peut être hébergé à une origine distincte.</span><span class="sxs-lookup"><span data-stu-id="4114d-133">The authorization endpoint is outside of the Blazor WebAssembly app and can be hosted at a separate origin.</span></span> <span data-ttu-id="4114d-134">Le point de terminaison est chargé de déterminer si l’utilisateur est authentifié et d’émettre un ou plusieurs jetons en réponse.</span><span class="sxs-lookup"><span data-stu-id="4114d-134">The endpoint is responsible for determining whether the user is authenticated and for issuing one or more tokens in response.</span></span> <span data-ttu-id="4114d-135">La bibliothèque d’authentification fournit un rappel de connexion pour recevoir la réponse d’authentification.</span><span class="sxs-lookup"><span data-stu-id="4114d-135">The authentication library provides a login callback to receive the authentication response.</span></span>
  * <span data-ttu-id="4114d-136">Si l’utilisateur n’est pas authentifié, l’utilisateur est redirigé vers le système d’authentification sous-jacent, qui est généralement ASP.NET Core identité.</span><span class="sxs-lookup"><span data-stu-id="4114d-136">If the user isn't authenticated, the user is redirected to the underlying authentication system, which is usually ASP.NET Core Identity.</span></span>
  * <span data-ttu-id="4114d-137">Si l’utilisateur a déjà été authentifié, le point de terminaison d’autorisation génère les jetons appropriés et redirige le navigateur vers le point de terminaison de rappel de connexion (`/authentication/login-callback`).</span><span class="sxs-lookup"><span data-stu-id="4114d-137">If the user was already authenticated, the authorization endpoint generates the appropriate tokens and redirects the browser back to the login callback endpoint (`/authentication/login-callback`).</span></span>
* <span data-ttu-id="4114d-138">Lorsque l' Blazor application webassembly charge le point de terminaison de rappel de connexion (`/authentication/login-callback`), la réponse d’authentification est traitée.</span><span class="sxs-lookup"><span data-stu-id="4114d-138">When the Blazor WebAssembly app loads the login callback endpoint (`/authentication/login-callback`), the authentication response is processed.</span></span>
  * <span data-ttu-id="4114d-139">Si le processus d’authentification se termine correctement, l’utilisateur est authentifié et éventuellement renvoyé à l’URL protégée d’origine que l’utilisateur a demandée.</span><span class="sxs-lookup"><span data-stu-id="4114d-139">If the authentication process completes successfully, the user is authenticated and optionally sent back to the original protected URL that the user requested.</span></span>
  * <span data-ttu-id="4114d-140">Si le processus d’authentification échoue pour une raison quelconque, l’utilisateur est envoyé à la page Échec de la connexion (`/authentication/login-failed`) et une erreur s’affiche.</span><span class="sxs-lookup"><span data-stu-id="4114d-140">If the authentication process fails for any reason, the user is sent to the login failed page (`/authentication/login-failed`), and an error is displayed.</span></span>
  
## <a name="options-for-hosted-apps-and-third-party-login-providers"></a><span data-ttu-id="4114d-141">Options pour les applications hébergées et les fournisseurs de connexion tiers</span><span class="sxs-lookup"><span data-stu-id="4114d-141">Options for hosted apps and third-party login providers</span></span>

<span data-ttu-id="4114d-142">Lors de l’authentification et de l’autorisation d’une application Blazor webassembly hébergée auprès d’un fournisseur tiers, plusieurs options sont disponibles pour l’authentification de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="4114d-142">When authenticating and authorizing a hosted Blazor WebAssembly app with a third-party provider, there are several options available for authenticating the user.</span></span> <span data-ttu-id="4114d-143">Celui que vous choisissez dépend de votre scénario.</span><span class="sxs-lookup"><span data-stu-id="4114d-143">Which one you choose depends on your scenario.</span></span>

<span data-ttu-id="4114d-144">Pour plus d’informations, consultez <xref:security/authentication/social/additional-claims>.</span><span class="sxs-lookup"><span data-stu-id="4114d-144">For more information, see <xref:security/authentication/social/additional-claims>.</span></span>

### <a name="authenticate-users-to-only-call-protected-third-party-apis"></a><span data-ttu-id="4114d-145">Authentifier les utilisateurs pour appeler uniquement des API tierces protégées</span><span class="sxs-lookup"><span data-stu-id="4114d-145">Authenticate users to only call protected third party APIs</span></span>

<span data-ttu-id="4114d-146">Authentifiez l’utilisateur avec un fluide oAuth côté client par rapport au fournisseur d’API tiers :</span><span class="sxs-lookup"><span data-stu-id="4114d-146">Authenticate the user with a client-side oAuth flow against the third-party API provider:</span></span>

 ```csharp
 builder.services.AddOidcAuthentication(options => { ... });
 ```
 
 <span data-ttu-id="4114d-147">Dans ce scénario :</span><span class="sxs-lookup"><span data-stu-id="4114d-147">In this scenario:</span></span>

* <span data-ttu-id="4114d-148">Le serveur hébergeant l’application ne joue aucun rôle.</span><span class="sxs-lookup"><span data-stu-id="4114d-148">The server hosting the app doesn't play a role.</span></span>
* <span data-ttu-id="4114d-149">Les API sur le serveur ne peuvent pas être protégées.</span><span class="sxs-lookup"><span data-stu-id="4114d-149">APIs on the server can't be protected.</span></span>
* <span data-ttu-id="4114d-150">L’application ne peut appeler que des API tierces protégées.</span><span class="sxs-lookup"><span data-stu-id="4114d-150">The app can only call protected third-party APIs.</span></span>

### <a name="authenticate-users-with-a-third-party-provider-and-call-protected-apis-on-the-host-server-and-the-third-party"></a><span data-ttu-id="4114d-151">Authentifier les utilisateurs auprès d’un fournisseur tiers et appeler des API protégées sur le serveur hôte et le tiers</span><span class="sxs-lookup"><span data-stu-id="4114d-151">Authenticate users with a third-party provider and call protected APIs on the host server and the third party</span></span>

<span data-ttu-id="4114d-152">Configurez l’identité avec un fournisseur de connexion tiers.</span><span class="sxs-lookup"><span data-stu-id="4114d-152">Configure Identity with a third-party login provider.</span></span> <span data-ttu-id="4114d-153">Obtenez les jetons requis pour l’accès de l’API tierce et stockez-les.</span><span class="sxs-lookup"><span data-stu-id="4114d-153">Obtain the tokens required for third-party API access and store them.</span></span>

<span data-ttu-id="4114d-154">Lorsqu’un utilisateur se connecte, l’identité collecte les jetons d’accès et d’actualisation dans le cadre du processus d’authentification.</span><span class="sxs-lookup"><span data-stu-id="4114d-154">When a user logs in, Identity collects access and refresh tokens as part of the authentication process.</span></span> <span data-ttu-id="4114d-155">À ce stade, il existe deux approches disponibles pour effectuer des appels d’API à des API tierces.</span><span class="sxs-lookup"><span data-stu-id="4114d-155">At that point, there are a couple of approaches available for making API calls to third-party APIs.</span></span>

#### <a name="use-a-server-access-token-to-retrieve-the-third-party-access-token"></a><span data-ttu-id="4114d-156">Utiliser un jeton d’accès au serveur pour récupérer le jeton d’accès tiers</span><span class="sxs-lookup"><span data-stu-id="4114d-156">Use a server access token to retrieve the third-party access token</span></span>

<span data-ttu-id="4114d-157">Utilisez le jeton d’accès généré sur le serveur pour récupérer le jeton d’accès tiers à partir d’un point de terminaison d’API serveur.</span><span class="sxs-lookup"><span data-stu-id="4114d-157">Use the access token generated on the server to retrieve the third-party access token from a server API endpoint.</span></span> <span data-ttu-id="4114d-158">À partir de là, utilisez le jeton d’accès tiers pour appeler des ressources d’API tierces directement à partir de l’identité sur le client.</span><span class="sxs-lookup"><span data-stu-id="4114d-158">From there, use the third-party access token to call third-party API resources directly from Identity on the client.</span></span>

<span data-ttu-id="4114d-159">Nous ne recommandons pas cette approche.</span><span class="sxs-lookup"><span data-stu-id="4114d-159">We don't recommend this approach.</span></span> <span data-ttu-id="4114d-160">Cette approche nécessite le traitement du jeton d’accès tiers comme s’il avait été généré pour un client public.</span><span class="sxs-lookup"><span data-stu-id="4114d-160">This approach requires treating the third-party access token as if it were generated for a public client.</span></span> <span data-ttu-id="4114d-161">Dans les termes oAuth, l’application publique n’a pas de clé secrète client, car elle ne peut pas être approuvée pour stocker des secrets en toute sécurité, et le jeton d’accès est généré pour un client confidentiel.</span><span class="sxs-lookup"><span data-stu-id="4114d-161">In oAuth terms, the public app doesn't have a client secret because it can't be trusted to store secrets safely, and the access token is produced for a confidential client.</span></span> <span data-ttu-id="4114d-162">Un client confidentiel est un client qui a une clé secrète client et est supposé être en mesure de stocker des secrets en toute sécurité.</span><span class="sxs-lookup"><span data-stu-id="4114d-162">A confidential client is a client that has a client secret and is assumed to be able to safely store secrets.</span></span>

* <span data-ttu-id="4114d-163">Le jeton d’accès tiers peut recevoir des étendues supplémentaires pour effectuer des opérations sensibles en fonction du fait que le tiers a émis le jeton pour un client plus fiable.</span><span class="sxs-lookup"><span data-stu-id="4114d-163">The third-party access token might be granted additional scopes to perform sensitive operations based on the fact that the third-party emitted the token for a more trusted client.</span></span>
* <span data-ttu-id="4114d-164">De même, les jetons d’actualisation ne doivent pas être émis pour un client qui n’est pas approuvé, car cela donne au client un accès illimité, sauf si d’autres restrictions sont mises en place.</span><span class="sxs-lookup"><span data-stu-id="4114d-164">Similarly, refresh tokens shouldn't be issued to a client that isn't trusted, as doing so gives the client unlimited access unless other restrictions are put into place.</span></span>

#### <a name="make-api-calls-from-the-client-to-the-server-api-in-order-to-call-third-party-apis"></a><span data-ttu-id="4114d-165">Effectuer des appels d’API à partir du client vers l’API du serveur afin d’appeler des API tierces</span><span class="sxs-lookup"><span data-stu-id="4114d-165">Make API calls from the client to the server API in order to call third-party APIs</span></span>

<span data-ttu-id="4114d-166">Effectuez un appel d’API à partir du client vers l’API serveur.</span><span class="sxs-lookup"><span data-stu-id="4114d-166">Make an API call from the client to the server API.</span></span> <span data-ttu-id="4114d-167">À partir du serveur, récupérez le jeton d’accès pour la ressource d’API tierce et émettez l’appel nécessaire.</span><span class="sxs-lookup"><span data-stu-id="4114d-167">From the server, retrieve the access token for the third-party API resource and issue whatever call is necessary.</span></span>

<span data-ttu-id="4114d-168">Bien que cette approche nécessite un saut de réseau supplémentaire par le biais du serveur pour appeler une API tierce, elle a finalement pour résultat une expérience plus sûre :</span><span class="sxs-lookup"><span data-stu-id="4114d-168">While this approach requires an extra network hop through the server to call a third-party API, it ultimately results in a safer experience:</span></span>

* <span data-ttu-id="4114d-169">Le serveur peut stocker des jetons d’actualisation et s’assurer que l’application ne perd pas l’accès aux ressources tierces.</span><span class="sxs-lookup"><span data-stu-id="4114d-169">The server can store refresh tokens and ensure that the app doesn't lose access to third-party resources.</span></span>
* <span data-ttu-id="4114d-170">L’application ne peut pas perdre les jetons d’accès du serveur qui peuvent contenir des autorisations plus sensibles.</span><span class="sxs-lookup"><span data-stu-id="4114d-170">The app can't leak access tokens from the server that might contain more sensitive permissions.</span></span>
