---
title: Liaison de données dans ASP.NET Core
author: tdykstra
description: Découvrez comment la liaison de modèle dans ASP.NET Core MVC mappe les données des requêtes HTTP à des paramètres de méthode d’action.
ms.assetid: 0be164aa-1d72-4192-bd6b-192c9c301164
ms.author: tdykstra
ms.date: 11/13/2018
uid: mvc/models/model-binding
ms.openlocfilehash: 1dc9b41328ed78440622acc1865b6f088d394403
ms.sourcegitcommit: 5b0eca8c21550f95de3bb21096bd4fd4d9098026
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/27/2019
ms.locfileid: "64883144"
---
# <a name="model-binding-in-aspnet-core"></a><span data-ttu-id="e6b7f-103">Liaison de données dans ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="e6b7f-103">Model Binding in ASP.NET Core</span></span>

<span data-ttu-id="e6b7f-104">Par [Rachel Appel](https://github.com/rachelappel)</span><span class="sxs-lookup"><span data-stu-id="e6b7f-104">By [Rachel Appel](https://github.com/rachelappel)</span></span>

## <a name="introduction-to-model-binding"></a><span data-ttu-id="e6b7f-105">Introduction à la liaison de modèle</span><span class="sxs-lookup"><span data-stu-id="e6b7f-105">Introduction to model binding</span></span>

<span data-ttu-id="e6b7f-106">La liaison de modèle dans ASP.NET Core MVC mappe les données des requêtes HTTP à des paramètres de méthode d’action.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-106">Model binding in ASP.NET Core MVC maps data from HTTP requests to action method parameters.</span></span> <span data-ttu-id="e6b7f-107">Les paramètres peuvent être des types simples, comme des chaînes, des entiers ou des nombres à virgule flottante, ou ils peuvent être des types complexes.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-107">The parameters may be simple types such as strings, integers, or floats, or they may be complex types.</span></span> <span data-ttu-id="e6b7f-108">Il s’agit d’une fonctionnalité intéressante de MVC, car le mappage des données entrantes à une contrepartie est un scénario souvent répété, quelle que soit la taille ou la complexité des données.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-108">This is a great feature of MVC because mapping incoming data to a counterpart is an often repeated scenario, regardless of size or complexity of the data.</span></span> <span data-ttu-id="e6b7f-109">MVC résout ce problème en rendant la liaison transparente : les développeurs ne doivent pas continuer à réécrire une version légèrement différente de ce même code dans chaque application.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-109">MVC solves this problem by abstracting binding away so developers don't have to keep rewriting a slightly different version of that same code in every app.</span></span> <span data-ttu-id="e6b7f-110">Écrire le code de votre propre convertisseur de texte en type est fastidieux et sujet à erreur.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-110">Writing your own text to type converter code is tedious, and error prone.</span></span>

## <a name="how-model-binding-works"></a><span data-ttu-id="e6b7f-111">Fonctionnement de la liaison de modèle</span><span class="sxs-lookup"><span data-stu-id="e6b7f-111">How model binding works</span></span>

<span data-ttu-id="e6b7f-112">Quand MVC reçoit une requête HTTP, il la route vers une méthode d’action spécifique d’un contrôleur.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-112">When MVC receives an HTTP request, it routes it to a specific action method of a controller.</span></span> <span data-ttu-id="e6b7f-113">Il détermine la méthode d’action à exécuter en fonction de ce qui se trouve dans les données de la route, puis il lie les valeurs de la requête HTTP aux paramètres de cette méthode d’action.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-113">It determines which action method to run based on what is in the route data, then it binds values from the HTTP request to that action method's parameters.</span></span> <span data-ttu-id="e6b7f-114">Considérez par exemple l’URL suivante :</span><span class="sxs-lookup"><span data-stu-id="e6b7f-114">For example, consider the following URL:</span></span>

`http://contoso.com/movies/edit/2`

<span data-ttu-id="e6b7f-115">Le modèle de route se présentant comme ceci, `{controller=Home}/{action=Index}/{id?}`, `movies/edit/2` route vers le contrôleur `Movies` et sa méthode d’action `Edit`.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-115">Since the route template looks like this, `{controller=Home}/{action=Index}/{id?}`, `movies/edit/2` routes to the `Movies` controller, and its `Edit` action method.</span></span> <span data-ttu-id="e6b7f-116">Il accepte également un paramètre facultatif nommé `id`.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-116">It also accepts an optional parameter called `id`.</span></span> <span data-ttu-id="e6b7f-117">Le code de la méthode d’action doit ressembler à ceci :</span><span class="sxs-lookup"><span data-stu-id="e6b7f-117">The code for the action method should look something like this:</span></span>

```csharp
public IActionResult Edit(int? id)
   ```

<span data-ttu-id="e6b7f-118">Remarque : Les chaînes de l’itinéraire d’URL ne respectent pas la casse.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-118">Note: The strings in the URL route are not case sensitive.</span></span>

<span data-ttu-id="e6b7f-119">MVC tente de lier les données de la requête aux paramètres de l’action avec le nom.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-119">MVC will try to bind request data to the action parameters by name.</span></span> <span data-ttu-id="e6b7f-120">MVC recherche des valeurs pour chaque paramètre en utilisant le nom du paramètre et les noms de ses propriétés définissables publiques.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-120">MVC will look for values for each parameter using the parameter name and the names of its public settable properties.</span></span> <span data-ttu-id="e6b7f-121">Dans l’exemple ci-dessus, le seul paramètre d’action est nommé `id`, que MVC lie à la valeur portant le même nom dans les valeurs de la route.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-121">In the above example, the only action parameter is named `id`, which MVC binds to the value with the same name in the route values.</span></span> <span data-ttu-id="e6b7f-122">En plus des valeurs de la route, MVC lie les données des différentes parties de la requête, ceci selon un ordre défini.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-122">In addition to route values MVC will bind data from various parts of the request and it does so in a set order.</span></span> <span data-ttu-id="e6b7f-123">Voici une liste des sources de données dans l’ordre où la liaison de modèle les recherche :</span><span class="sxs-lookup"><span data-stu-id="e6b7f-123">Below is a list of the data sources in the order that model binding looks through them:</span></span>

1. <span data-ttu-id="e6b7f-124">`Form values`: il s’agit de valeurs de formulaire qui vont dans la requête HTTP avec la méthode POST.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-124">`Form values`: These are form values that go in the HTTP request using the POST method.</span></span> <span data-ttu-id="e6b7f-125">(notamment les requêtes POST jQuery).</span><span class="sxs-lookup"><span data-stu-id="e6b7f-125">(including jQuery POST requests).</span></span>

2. <span data-ttu-id="e6b7f-126">`Route values`: l’ensemble des valeurs de l’itinéraire fournies par le [routage](xref:fundamentals/routing)</span><span class="sxs-lookup"><span data-stu-id="e6b7f-126">`Route values`: The set of route values provided by [Routing](xref:fundamentals/routing)</span></span>

3. <span data-ttu-id="e6b7f-127">`Query strings`: la partie de chaîne de la requête de l’URI.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-127">`Query strings`: The query string part of the URI.</span></span>

<!-- DocFX BUG
The link works but generates an error when building with DocFX
@fundamentals/routing
[Routing](xref:fundamentals/routing)
-->

<span data-ttu-id="e6b7f-128">Remarque : Les valeurs de formulaire, les données des itinéraires et les chaînes de requête sont toutes stockées sous la forme de paires nom-valeur.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-128">Note: Form values, route data, and query strings are all stored as name-value pairs.</span></span>

<span data-ttu-id="e6b7f-129">Comme la liaison de modèle a demandé une clé nommée `id` et qu’aucun élément n’est nommé `id` dans les valeurs de formulaire, il est passé aux valeurs de la route pour rechercher cette clé.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-129">Since model binding asked for a key named `id` and there's nothing named `id` in the form values, it moved on to the route values looking for that key.</span></span> <span data-ttu-id="e6b7f-130">Dans notre exemple, il trouve une correspondance.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-130">In our example, it's a match.</span></span> <span data-ttu-id="e6b7f-131">La liaison est effectuée et la valeur est convertie un entier dont la valeur est 2.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-131">Binding happens, and the value is converted to the integer 2.</span></span> <span data-ttu-id="e6b7f-132">La même requête qui utiliserait Edit(string id) convertirait en une chaîne « 2 ».</span><span class="sxs-lookup"><span data-stu-id="e6b7f-132">The same request using Edit(string id) would convert to the string "2".</span></span>

<span data-ttu-id="e6b7f-133">Jusqu’à présent, l’exemple utilise des types simples.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-133">So far the example uses simple types.</span></span> <span data-ttu-id="e6b7f-134">Dans MVC, les types simples sont tous les types primitifs .NET ou les types avec un convertisseur de type chaîne.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-134">In MVC simple types are any .NET primitive type or type with a string type converter.</span></span> <span data-ttu-id="e6b7f-135">Si le paramètre de la méthode d’action était une classe comme le type `Movie`, qui contient à la fois des types simples et des comme complexes comme propriétés, la liaison de modèle de MVC pourrait le gérer correctement.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-135">If the action method's parameter were a class such as the `Movie` type, which contains both simple and complex types as properties, MVC's model binding will still handle it nicely.</span></span> <span data-ttu-id="e6b7f-136">Il utilise la réflexion et la récursivité pour parcourir les propriétés des types complexes en recherchant des correspondances.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-136">It uses reflection and recursion to traverse the properties of complex types looking for matches.</span></span> <span data-ttu-id="e6b7f-137">La liaison de modèle recherche le modèle *nom_paramètre.nom_propriété* pour lier des valeurs aux propriétés.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-137">Model binding looks for the pattern *parameter_name.property_name* to bind values to properties.</span></span> <span data-ttu-id="e6b7f-138">S’il ne trouve pas de valeurs correspondantes de ce formulaire, il tente de lier en utilisant seulement le nom de propriété.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-138">If it doesn't find matching values of this form, it will attempt to bind using just the property name.</span></span> <span data-ttu-id="e6b7f-139">Pour des types comme `Collection`, la liaison de modèle recherche des correspondances avec *nom_paramètre[index]* ou simplement avec *[index]*.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-139">For those types such as `Collection` types, model binding looks for matches to *parameter_name[index]* or just *[index]*.</span></span> <span data-ttu-id="e6b7f-140">La liaison de modèle traite les types `Dictionary` de la même façon, en demandant *nom_paramètre[clé]* ou simplement *[clé]*, à condition que les clés soient des types simples.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-140">Model binding treats  `Dictionary` types similarly, asking for *parameter_name[key]* or just *[key]*, as long as the keys are simple types.</span></span> <span data-ttu-id="e6b7f-141">Les clés qui sont prises en charge correspondent aux noms de champ HTML et aux helpers de balise générés pour le même type de modèle.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-141">Keys that are supported match the field names HTML and tag helpers generated for the same model type.</span></span> <span data-ttu-id="e6b7f-142">Ceci permet l’aller-retour des valeurs, de sorte que les champs de formulaire restent remplis avec l’entrée de l’utilisateur pour lui faciliter la tâche, par exemple quand les données liées à partir d’une création ou d’une modification n’ont pas été validées.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-142">This enables round-tripping values so that the form fields remain filled with the user's input for their convenience, for example, when bound data from a create or edit didn't pass validation.</span></span>

<span data-ttu-id="e6b7f-143">Pour rendre possible la liaison de modèle, la classe doit avoir un constructeur public par défaut et des propriétés publiques accessibles en écriture à lier.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-143">To make model binding possible, the class must have a public default constructor and public writable properties to bind.</span></span> <span data-ttu-id="e6b7f-144">Quand la liaison de modèle se produit, la classe est instanciée avec le constructeur public par défaut, puis les propriétés peuvent être définies.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-144">When model binding occurs, the class is instantiated using the public default constructor, then the properties can be set.</span></span>

<span data-ttu-id="e6b7f-145">Quand un paramètre est lié, la liaison de modèle cesse de rechercher des valeurs avec ce nom et elle passe à la liaison du paramètre suivant.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-145">When a parameter is bound, model binding stops looking for values with that name and it moves on to bind the next parameter.</span></span> <span data-ttu-id="e6b7f-146">Sinon, le comportement de la liaison de modèle par défaut définit les paramètres à leurs valeurs par défaut en fonction de leur type :</span><span class="sxs-lookup"><span data-stu-id="e6b7f-146">Otherwise, the default model binding behavior sets parameters to their default values depending on their type:</span></span>

* <span data-ttu-id="e6b7f-147">`T[]`: à l’exception des tableaux de type `byte[]`, la liaison définit les paramètres de type `T[]` sur `Array.Empty<T>()`.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-147">`T[]`: With the exception of arrays of type `byte[]`, binding sets parameters of type `T[]` to `Array.Empty<T>()`.</span></span> <span data-ttu-id="e6b7f-148">Les tableaux de type `byte[]` ont la valeur `null`.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-148">Arrays of type `byte[]` are set to `null`.</span></span>

* <span data-ttu-id="e6b7f-149">Types références : la liaison crée une instance d’une classe avec le constructeur par défaut sans définir des propriétés.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-149">Reference Types: Binding creates an instance of a class with the default constructor without setting properties.</span></span> <span data-ttu-id="e6b7f-150">Cependant, la liaison de modèle définit les `string` sur `null`.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-150">However, model binding sets `string` parameters to `null`.</span></span>

* <span data-ttu-id="e6b7f-151">Types Nullable : les types Nullable sont définis sur `null`.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-151">Nullable Types: Nullable types are set to `null`.</span></span> <span data-ttu-id="e6b7f-152">Dans l’exemple ci-dessus, la liaison de modèle définit `id` sur `null`, car il est de type `int?`.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-152">In the above example, model binding sets `id` to `null` since it's of type `int?`.</span></span>

* <span data-ttu-id="e6b7f-153">Types valeur : les types valeurs non Nullables de type `T` sont définis sur `default(T)`.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-153">Value Types: Non-nullable value types of type `T` are set to `default(T)`.</span></span> <span data-ttu-id="e6b7f-154">Par exemple, la liaison de modèle définit un paramètre `int id` sur 0.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-154">For example, model binding will set a parameter `int id` to 0.</span></span> <span data-ttu-id="e6b7f-155">Envisagez d’utiliser la validation de modèle ou des types Nullables au lieu de travailler avec les valeurs par défaut.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-155">Consider using model validation or nullable types rather than relying on default values.</span></span>

<span data-ttu-id="e6b7f-156">Si la liaison échoue, MVC ne génère pas d’erreur.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-156">If binding fails, MVC doesn't throw an error.</span></span> <span data-ttu-id="e6b7f-157">Chaque action acceptant une entrée utilisateur doit vérifier la propriété `ModelState.IsValid`.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-157">Every action which accepts user input should check the `ModelState.IsValid` property.</span></span>

<span data-ttu-id="e6b7f-158">Remarque : Chaque entrée dans la propriété `ModelState` du contrôleur est une `ModelStateEntry` contenant une propriété `Errors`.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-158">Note: Each entry in the controller's `ModelState` property is a `ModelStateEntry` containing an `Errors` property.</span></span> <span data-ttu-id="e6b7f-159">Il est rarement nécessaire interroger cette collection vous-même.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-159">It's rarely necessary to query this collection yourself.</span></span> <span data-ttu-id="e6b7f-160">Utilisez plutôt `ModelState.IsValid`.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-160">Use `ModelState.IsValid` instead.</span></span>

<span data-ttu-id="e6b7f-161">En outre, MVC doit prendre en compte certains types de données spéciaux lors de la liaison de modèle :</span><span class="sxs-lookup"><span data-stu-id="e6b7f-161">Additionally, there are some special data types that MVC must consider when performing model binding:</span></span>

* <span data-ttu-id="e6b7f-162">`IFormFile`, `IEnumerable<IFormFile>` : un ou plusieurs fichiers chargés qui font partie de la requête HTTP.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-162">`IFormFile`, `IEnumerable<IFormFile>`: One or more uploaded files that are part of the HTTP request.</span></span>

* <span data-ttu-id="e6b7f-163">`CancellationToken`: utilisé pour annuler l’activité dans les contrôleurs asynchrones.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-163">`CancellationToken`: Used to cancel activity in asynchronous controllers.</span></span>

<span data-ttu-id="e6b7f-164">Ces types peuvent être liés à des paramètres d’action ou à des propriétés sur un type de classe.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-164">These types can be bound to action parameters or to properties on a class type.</span></span>

<span data-ttu-id="e6b7f-165">Une fois que la liaison de modèle est terminée, la [validation](validation.md) se produit.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-165">Once model binding is complete, [Validation](validation.md) occurs.</span></span> <span data-ttu-id="e6b7f-166">La liaison de modèle par défaut fonctionne bien pour la grande majorité des scénarios de développement.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-166">Default model binding works great for the vast majority of development scenarios.</span></span> <span data-ttu-id="e6b7f-167">Elle est également extensible : si vous avez des besoins spécifiques, vous pouvez donc personnaliser le comportement intégré.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-167">It's also extensible so if you have unique needs you can customize the built-in behavior.</span></span>

## <a name="customize-model-binding-behavior-with-attributes"></a><span data-ttu-id="e6b7f-168">Personnaliser le comportement de la liaison de modèle avec des attributs</span><span class="sxs-lookup"><span data-stu-id="e6b7f-168">Customize model binding behavior with attributes</span></span>

<span data-ttu-id="e6b7f-169">MVC contient plusieurs attributs que vous pouvez utiliser pour spécifier son comportement de liaison de modèle par défaut vers une autre source.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-169">MVC contains several attributes that you can use to direct its default model binding behavior to a different source.</span></span> <span data-ttu-id="e6b7f-170">Par exemple, vous pouvez spécifier si la liaison est obligatoire pour une propriété, ou si elle ne doit jamais se produire, avec les attributs `[BindRequired]` ou `[BindNever]`.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-170">For example, you can specify whether binding is required for a property, or if it should never happen at all by using the `[BindRequired]` or `[BindNever]` attributes.</span></span> <span data-ttu-id="e6b7f-171">Vous pouvez aussi remplacer la source de données par défaut et spécifier la source de données du classeur de modèles.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-171">Alternatively, you can override the default data source, and specify the model binder's data source.</span></span> <span data-ttu-id="e6b7f-172">Voici une liste des attributs de liaison de modèle :</span><span class="sxs-lookup"><span data-stu-id="e6b7f-172">Below is a list of model binding attributes:</span></span>

* <span data-ttu-id="e6b7f-173">`[BindRequired]`: cet attribut ajoute une erreur d’état de modèle si la liaison ne peut pas se produire.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-173">`[BindRequired]`: This attribute adds a model state error if binding cannot occur.</span></span>

* <span data-ttu-id="e6b7f-174">`[BindNever]`: indique au classeur de modèles de ne jamais lier à ce paramètre.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-174">`[BindNever]`: Tells the model binder to never bind to this parameter.</span></span>

* <span data-ttu-id="e6b7f-175">`[FromHeader]`, `[FromQuery]`, `[FromRoute]`, `[FromForm]` : utilisez ces attributs pour spécifier la source de liaison exacte que vous voulez appliquer.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-175">`[FromHeader]`, `[FromQuery]`, `[FromRoute]`, `[FromForm]`: Use these to specify the exact binding source you want to apply.</span></span>

* <span data-ttu-id="e6b7f-176">`[FromServices]`: cet attribut utilise [l’injection de dépendances](../../fundamentals/dependency-injection.md) pour lier des paramètres de services.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-176">`[FromServices]`: This attribute uses [dependency injection](../../fundamentals/dependency-injection.md) to bind parameters from services.</span></span>

* <span data-ttu-id="e6b7f-177">`[FromBody]`: utilisez les formateurs configurés pour lier des données du corps de la requête.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-177">`[FromBody]`: Use the configured formatters to bind data from the request body.</span></span> <span data-ttu-id="e6b7f-178">Le formateur est sélectionné en fonction du type de contenu de la requête.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-178">The formatter is selected based on content type of the request.</span></span>

* <span data-ttu-id="e6b7f-179">`[ModelBinder]`: utilisé pour remplacer le classeur de modèles, la source de liaison et le nom par défaut.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-179">`[ModelBinder]`: Used to override the default model binder, binding source and name.</span></span>

<span data-ttu-id="e6b7f-180">Les attributs sont très utiles quand vous devez remplacer le comportement par défaut de la liaison de modèle.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-180">Attributes are very helpful tools when you need to override the default behavior of model binding.</span></span>

## <a name="customize-model-binding-and-validation-globally"></a><span data-ttu-id="e6b7f-181">Personnaliser la validation et la liaison de modèle de manière globale</span><span class="sxs-lookup"><span data-stu-id="e6b7f-181">Customize model binding and validation globally</span></span>

<span data-ttu-id="e6b7f-182">Le comportement du système de validation et de liaison de modèle est régi par [ModelMetadata](/dotnet/api/microsoft.aspnetcore.mvc.modelbinding.modelmetadata) qui décrit :</span><span class="sxs-lookup"><span data-stu-id="e6b7f-182">The model binding and validation system's behavior is driven by [ModelMetadata](/dotnet/api/microsoft.aspnetcore.mvc.modelbinding.modelmetadata) that describes:</span></span>

* <span data-ttu-id="e6b7f-183">Comment un modèle doit être lié.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-183">How a model is to be bound.</span></span>
* <span data-ttu-id="e6b7f-184">Comment a lieu la validation sur le type et ses propriétés.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-184">How validation occurs on the type and its properties.</span></span>

<span data-ttu-id="e6b7f-185">Vous pouvez configurer les aspects du comportement du système de manière globale en ajoutant un fournisseur de détails à [MvcOptions.ModelMetadataDetailsProviders](/dotnet/api/microsoft.aspnetcore.mvc.mvcoptions.modelmetadatadetailsproviders#Microsoft_AspNetCore_Mvc_MvcOptions_ModelMetadataDetailsProviders).</span><span class="sxs-lookup"><span data-stu-id="e6b7f-185">Aspects of the system's behavior can be configured globally by adding a details provider to [MvcOptions.ModelMetadataDetailsProviders](/dotnet/api/microsoft.aspnetcore.mvc.mvcoptions.modelmetadatadetailsproviders#Microsoft_AspNetCore_Mvc_MvcOptions_ModelMetadataDetailsProviders).</span></span> <span data-ttu-id="e6b7f-186">MVC compte quelques fournisseurs de détails intégrés qui autorisent la configuration du comportement telle que la désactivation de la validation ou de la liaison de modèle pour certains types.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-186">MVC has a few built-in details providers that allow configuring behavior such as disabling model binding or validation for certain types.</span></span>

<span data-ttu-id="e6b7f-187">Pour désactiver la liaison de modèle sur tous les modèles d’un certain type, ajoutez un [ExcludeBindingMetadataProvider](/dotnet/api/microsoft.aspnetcore.mvc.modelbinding.metadata.excludebindingmetadataprovider) dans `Startup.ConfigureServices`.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-187">To disable model binding on all models of a certain type, add an [ExcludeBindingMetadataProvider](/dotnet/api/microsoft.aspnetcore.mvc.modelbinding.metadata.excludebindingmetadataprovider) in `Startup.ConfigureServices`.</span></span> <span data-ttu-id="e6b7f-188">Par exemple, pour désactiver la liaison de modèle sur tous les modèles de type `System.Version` :</span><span class="sxs-lookup"><span data-stu-id="e6b7f-188">For example, to disable model binding on all models of type `System.Version`:</span></span>

```csharp
services.AddMvc().AddMvcOptions(options =>
    options.ModelMetadataDetailsProviders.Add(
        new ExcludeBindingMetadataProvider(typeof(System.Version))));
```

<span data-ttu-id="e6b7f-189">Pour désactiver la validation sur les propriétés d’un certain type, ajoutez un [SuppressChildValidationMetadataProvider](/dotnet/api/microsoft.aspnetcore.mvc.modelbinding.suppresschildvalidationmetadataprovider) dans `Startup.ConfigureServices`.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-189">To disable validation on properties of a certain type, add a [SuppressChildValidationMetadataProvider](/dotnet/api/microsoft.aspnetcore.mvc.modelbinding.suppresschildvalidationmetadataprovider) in `Startup.ConfigureServices`.</span></span> <span data-ttu-id="e6b7f-190">Par exemple, pour désactiver la validation sur les propriétés de type `System.Guid` :</span><span class="sxs-lookup"><span data-stu-id="e6b7f-190">For example, to disable validation on properties of type `System.Guid`:</span></span>

```csharp
services.AddMvc().AddMvcOptions(options =>
    options.ModelMetadataDetailsProviders.Add(
        new SuppressChildValidationMetadataProvider(typeof(System.Guid))));
```

## <a name="bind-formatted-data-from-the-request-body"></a><span data-ttu-id="e6b7f-191">Lier des données mises en forme du corps de la requête</span><span class="sxs-lookup"><span data-stu-id="e6b7f-191">Bind formatted data from the request body</span></span>

<span data-ttu-id="e6b7f-192">Les données des requêtes peuvent exister dans différents formats, notamment JSON, XML et beaucoup d’autres.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-192">Request data can come in a variety of formats including JSON, XML and many others.</span></span> <span data-ttu-id="e6b7f-193">Quand vous utilisez l’attribut [FromBody] pour indiquer que vous voulez lier un paramètre à des données du corps de la requête, MVC utilise un ensemble de formateurs configuré pour gérer les données de la requête en fonction du type de contenu.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-193">When you use the [FromBody] attribute to indicate that you want to bind a parameter to data in the request body, MVC uses a configured set of formatters to handle the request data based on its content type.</span></span> <span data-ttu-id="e6b7f-194">Par défaut, MVC inclut une classe `JsonInputFormatter` pour la gestion des données JSON, mais vous pouvez ajouter des formateurs supplémentaires pour la gestion du format XML et d’autres formats personnalisés.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-194">By default MVC includes a `JsonInputFormatter` class for handling JSON data, but you can add additional formatters for handling XML and other custom formats.</span></span>

> [!NOTE]
> <span data-ttu-id="e6b7f-195">Il peut y avoir au plus un paramètre par action décorée avec `[FromBody]`.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-195">There can be at most one parameter per action decorated with `[FromBody]`.</span></span> <span data-ttu-id="e6b7f-196">Le runtime d’ASP.NET Core MVC délègue la responsabilité de lire le flux de la requête au formateur.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-196">The ASP.NET Core MVC run-time delegates the responsibility of reading the request stream to the formatter.</span></span> <span data-ttu-id="e6b7f-197">Une fois que le flux de la requête est lu pour un paramètre, il n’est généralement pas possible de relire le flux de la requête pour lier d’autres paramètres `[FromBody]`.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-197">Once the request stream is read for a parameter, it's generally not possible to read the request stream again for binding other `[FromBody]` parameters.</span></span>

> [!NOTE]
> <span data-ttu-id="e6b7f-198">`JsonInputFormatter` est le formateur par défaut et est basé sur [Json.NET](https://www.newtonsoft.com/json).</span><span class="sxs-lookup"><span data-stu-id="e6b7f-198">The `JsonInputFormatter` is the default formatter and is based on [Json.NET](https://www.newtonsoft.com/json).</span></span>

<span data-ttu-id="e6b7f-199">ASP.NET Core sélectionne les formateurs d’entrée en fonction de l’en-tête [Content-Type](https://www.w3.org/Protocols/rfc1341/4_Content-Type.html) et du type de paramètre, sauf si un attribut qui lui est appliqué spécifie un autre formateur.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-199">ASP.NET Core selects input formatters based on the [Content-Type](https://www.w3.org/Protocols/rfc1341/4_Content-Type.html) header and the type of the parameter, unless there's an attribute applied to it specifying otherwise.</span></span> <span data-ttu-id="e6b7f-200">Si vous voulez utiliser XML ou un autre format, vous devez le configurer dans le fichier *Startup.cs*, mais il peut être nécessaire d’obtenir d’abord une référence à `Microsoft.AspNetCore.Mvc.Formatters.Xml` en utilisant NuGet.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-200">If you'd like to use XML or another format you must configure it in the *Startup.cs* file, but you may first have to obtain a reference to `Microsoft.AspNetCore.Mvc.Formatters.Xml` using NuGet.</span></span> <span data-ttu-id="e6b7f-201">Votre code de démarrage doit ressembler à ceci :</span><span class="sxs-lookup"><span data-stu-id="e6b7f-201">Your startup code should look something like this:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddMvc()
        .AddXmlSerializerFormatters();
   }
```

<span data-ttu-id="e6b7f-202">Le code du fichier *Startup.cs* contient une méthode `ConfigureServices` avec un argument `services`, que vous pouvez utiliser pour créer des services pour votre application ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-202">Code in the *Startup.cs* file contains a `ConfigureServices` method with a `services` argument you can use to build up services for your ASP.NET Core app.</span></span> <span data-ttu-id="e6b7f-203">Dans l’exemple, nous ajoutons un formateur XML en tant que service, que MVC fournira pour cette application.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-203">In the sample, we are adding an XML formatter as a service that MVC will provide for this app.</span></span> <span data-ttu-id="e6b7f-204">L’argument `options` passé dans la méthode `AddMvc` vous permet d’ajouter et de gérer des filtres, des formateurs et d’autres options du système depuis MVC dès le démarrage de l’application.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-204">The `options` argument passed into the `AddMvc` method allows you to add and manage filters, formatters, and other system options from MVC upon app startup.</span></span> <span data-ttu-id="e6b7f-205">Appliquez ensuite l’attribut `Consumes` aux classes de contrôleur ou aux méthodes d’action pour travailler avec le format souhaité.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-205">Then apply the `Consumes` attribute to controller classes or action methods to work with the format you want.</span></span>

### <a name="custom-model-binding"></a><span data-ttu-id="e6b7f-206">Liaison de modèle personnalisée</span><span class="sxs-lookup"><span data-stu-id="e6b7f-206">Custom Model Binding</span></span>

<span data-ttu-id="e6b7f-207">Vous pouvez étendre la liaison de modèle en écrivant vos propres classeurs de modèles personnalisés.</span><span class="sxs-lookup"><span data-stu-id="e6b7f-207">You can extend model binding by writing your own custom model binders.</span></span> <span data-ttu-id="e6b7f-208">Découvrez plus d’informations sur la [liaison de modèle personnalisée](../advanced/custom-model-binding.md).</span><span class="sxs-lookup"><span data-stu-id="e6b7f-208">Learn more about [custom model binding](../advanced/custom-model-binding.md).</span></span>
