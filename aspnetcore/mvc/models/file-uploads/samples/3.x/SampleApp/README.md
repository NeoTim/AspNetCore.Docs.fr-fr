# <a name="upload-files-sample-app"></a><span data-ttu-id="09e08-101">Exemple d’application de téléchargement de fichiers</span><span class="sxs-lookup"><span data-stu-id="09e08-101">Upload Files Sample App</span></span>

<span data-ttu-id="09e08-102">Cet exemple d’application montre les concepts décrits dans la rubrique [Télécharger des fichiers dans ASP.net Core](https://docs.microsoft.com/aspnet/core/mvc/models/file-uploads) .</span><span class="sxs-lookup"><span data-stu-id="09e08-102">This sample app demonstrates concepts described in the [Upload files in ASP.NET Core](https://docs.microsoft.com/aspnet/core/mvc/models/file-uploads) topic.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="09e08-103">Considérations relatives à la sécurité</span><span class="sxs-lookup"><span data-stu-id="09e08-103">Security considerations</span></span>

<span data-ttu-id="09e08-104">Soyez prudent lorsque vous fournissez aux utilisateurs la possibilité de charger des fichiers sur un serveur.</span><span class="sxs-lookup"><span data-stu-id="09e08-104">Use caution when providing users with the ability to upload files to a server.</span></span> <span data-ttu-id="09e08-105">Les attaquants peuvent exécuter des attaques par [déni de service](/windows-hardware/drivers/ifs/denial-of-service) , tenter de charger des virus ou des programmes malveillants ou tenter de compromettre des réseaux et des serveurs d’une autre manière.</span><span class="sxs-lookup"><span data-stu-id="09e08-105">Attackers may execute [denial of service](/windows-hardware/drivers/ifs/denial-of-service) attacks, attempt to upload viruses or malware, or attempt to compromise networks and servers in other ways.</span></span>

<span data-ttu-id="09e08-106">Les étapes de sécurité qui réduisent la probabilité d’une attaque réussie sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="09e08-106">Security steps that reduce the likelihood of a successful attack are:</span></span>

* <span data-ttu-id="09e08-107">Chargez les fichiers dans une zone de chargement de fichier dédiée sur le système, de préférence sur un lecteur non-système.</span><span class="sxs-lookup"><span data-stu-id="09e08-107">Upload files to a dedicated file upload area on the system, preferably to a non-system drive.</span></span> <span data-ttu-id="09e08-108">L’utilisation d’un emplacement dédié permet d’imposer des mesures de sécurité plus faciles sur les fichiers téléchargés.</span><span class="sxs-lookup"><span data-stu-id="09e08-108">Use of a dedicated location makes it easier to impose security measures on uploaded files.</span></span> <span data-ttu-id="09e08-109">Désactivez les autorisations d’exécution sur l’emplacement de chargement du fichier. &dagger;</span><span class="sxs-lookup"><span data-stu-id="09e08-109">Disable execute permissions on the file upload location.&dagger;</span></span>
* <span data-ttu-id="09e08-110">Ne conserve jamais les fichiers téléchargés dans la même arborescence de répertoires que l’application. &dagger;</span><span class="sxs-lookup"><span data-stu-id="09e08-110">Never persist uploaded files in the same directory tree as the app.&dagger;</span></span>
* <span data-ttu-id="09e08-111">Utilisez un nom de fichier sécurisé déterminé par l’application.</span><span class="sxs-lookup"><span data-stu-id="09e08-111">Use a safe file name determined by the app.</span></span> <span data-ttu-id="09e08-112">N’utilisez pas un nom de fichier fourni par l’entrée d’utilisateur ou le nom de fichier non approuvé du fichier téléchargé. &dagger;</span><span class="sxs-lookup"><span data-stu-id="09e08-112">Don't use a file name provided by user input or the untrusted file name of the uploaded file.&dagger;</span></span>
* <span data-ttu-id="09e08-113">Autorise uniquement un ensemble spécifique d’extensions de fichiers approuvées. &dagger;</span><span class="sxs-lookup"><span data-stu-id="09e08-113">Only allow a specific set of approved file extensions.&dagger;</span></span>
* <span data-ttu-id="09e08-114">Vérifiez la signature de format de fichier pour empêcher un utilisateur de télécharger un fichier fictif (par exemple, en chargeant un fichier *. exe* avec une extension *. txt* ). &dagger;</span><span class="sxs-lookup"><span data-stu-id="09e08-114">Check the file format signature to prevent a user from uploading a masqueraded file (for example, uploading an *.exe* file with a *.txt* extension).&dagger;</span></span>
* <span data-ttu-id="09e08-115">Vérifiez que les vérifications côté client sont également effectuées sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="09e08-115">Verify that client-side checks are also performed on the server.</span></span> <span data-ttu-id="09e08-116">Les contrôles côté client sont faciles à contourner. &dagger;</span><span class="sxs-lookup"><span data-stu-id="09e08-116">Client-side checks are easy to circumvent.&dagger;</span></span>
* <span data-ttu-id="09e08-117">Vérifiez la taille du téléchargement et empêchez les chargements supérieurs à ceux attendus. &dagger;</span><span class="sxs-lookup"><span data-stu-id="09e08-117">Check the size of the upload and prevent uploads that are larger than expected.&dagger;</span></span>
* <span data-ttu-id="09e08-118">Lorsque les fichiers ne doivent pas être remplacés par un fichier téléchargé portant le même nom, vérifiez le nom du fichier par rapport à la base de données ou au stockage physique avant de charger le fichier.</span><span class="sxs-lookup"><span data-stu-id="09e08-118">When files shouldn't be overwritten by an uploaded file with the same name, check the file name against the database or physical storage before uploading the file.</span></span>
* <span data-ttu-id="09e08-119">**Exécutez un programme de détection de virus et de logiciels malveillants sur le contenu chargé avant que le fichier ne soit stocké.**</span><span class="sxs-lookup"><span data-stu-id="09e08-119">**Run a virus/malware scanner on uploaded content before the file is stored.**</span></span>

<span data-ttu-id="09e08-120">l’exemple d’application &dagger;The illustre une approche qui répond aux critères.</span><span class="sxs-lookup"><span data-stu-id="09e08-120">&dagger;The sample app demonstrates an approach that meets the criteria.</span></span>

> [!WARNING]
> <span data-ttu-id="09e08-121">Le chargement d’un code malveillant sur un système est généralement la première étape de l’exécution de code capable de :</span><span class="sxs-lookup"><span data-stu-id="09e08-121">Uploading malicious code to a system is frequently the first step to executing code that can:</span></span>
>
> * <span data-ttu-id="09e08-122">Prendre complètement en charge un système.</span><span class="sxs-lookup"><span data-stu-id="09e08-122">Completely takeover a system.</span></span>
> * <span data-ttu-id="09e08-123">Surchargez un système avec le résultat du blocage du système.</span><span class="sxs-lookup"><span data-stu-id="09e08-123">Overload a system with the result that the system crashes.</span></span>
> * <span data-ttu-id="09e08-124">Compromettre les données utilisateur ou système.</span><span class="sxs-lookup"><span data-stu-id="09e08-124">Compromise user or system data.</span></span>
> * <span data-ttu-id="09e08-125">Appliquez Graffiti à une interface utilisateur publique.</span><span class="sxs-lookup"><span data-stu-id="09e08-125">Apply graffiti to a public UI.</span></span>
>
> <span data-ttu-id="09e08-126">Pour plus d’informations sur la réduction de la surface d’attaque quand vous acceptez des fichiers d’utilisateurs, consultez les ressources suivantes :</span><span class="sxs-lookup"><span data-stu-id="09e08-126">For information on reducing the attack surface area when accepting files from users, see the following resources:</span></span>
>
> * <span data-ttu-id="09e08-127">[Unrestricted File Upload](https://www.owasp.org/index.php/Unrestricted_File_Upload) (Chargement de fichiers illimité)</span><span class="sxs-lookup"><span data-stu-id="09e08-127">[Unrestricted File Upload](https://www.owasp.org/index.php/Unrestricted_File_Upload)</span></span>
> * <span data-ttu-id="09e08-128">Sécurité de la @no__t 0Azure : Vérifiez que les contrôles appropriés sont en place lors de l’acceptation des fichiers des utilisateurs @ no__t-0</span><span class="sxs-lookup"><span data-stu-id="09e08-128">[Azure Security: Ensure appropriate controls are in place when accepting files from users](/azure/security/azure-security-threat-modeling-tool-input-validation#controls-users)</span></span>

<span data-ttu-id="09e08-129">Pour plus d’informations, consultez [charger des fichiers dans ASP.net Core](https://docs.microsoft.com/aspnet/core/mvc/models/file-uploads).</span><span class="sxs-lookup"><span data-stu-id="09e08-129">For additional information, see [Upload files in ASP.NET Core](https://docs.microsoft.com/aspnet/core/mvc/models/file-uploads).</span></span>

## <a name="how-to-use-the-sample"></a><span data-ttu-id="09e08-130">Comment utiliser l’exemple</span><span class="sxs-lookup"><span data-stu-id="09e08-130">How to use the sample</span></span>

<span data-ttu-id="09e08-131">Dans le fichier *appSettings. JSON* :</span><span class="sxs-lookup"><span data-stu-id="09e08-131">In the *appsettings.json* file:</span></span>

1. <span data-ttu-id="09e08-132">Définissez le chemin d’accès pour les fichiers stockés (`StoredFilesPath`).</span><span class="sxs-lookup"><span data-stu-id="09e08-132">Set the path for stored files (`StoredFilesPath`).</span></span>

   * <span data-ttu-id="09e08-133">L’exemple d’application définit la valeur sur `c:\\files`, ce qui suppose qu’un dossier nommé *Files* existe à la racine du lecteur C : du système.</span><span class="sxs-lookup"><span data-stu-id="09e08-133">The sample app sets the value to `c:\\files`, which assumes that a folder named *files* exists at the system's C: drive root.</span></span>
   * <span data-ttu-id="09e08-134">Le chemin doit exister.</span><span class="sxs-lookup"><span data-stu-id="09e08-134">The path must exist.</span></span> <span data-ttu-id="09e08-135">Créez un dossier de *fichiers* sur le lecteur C : du système ou définissez le chemin d’accès à un emplacement approprié.</span><span class="sxs-lookup"><span data-stu-id="09e08-135">Create a *files* folder on the system's C: drive or set the path to a suitable location.</span></span>
   * <span data-ttu-id="09e08-136">Le processus de l’application nécessite des autorisations de lecture/écriture sur le chemin d’accès.</span><span class="sxs-lookup"><span data-stu-id="09e08-136">The app's process requires read/write permissions to the path.</span></span>
   * <span data-ttu-id="09e08-137">**PRÉCIEUSE!**</span><span class="sxs-lookup"><span data-stu-id="09e08-137">**IMPORTANT!**</span></span> <span data-ttu-id="09e08-138">Désactivez les autorisations d’exécution pour tous les utilisateurs dans le chemin.</span><span class="sxs-lookup"><span data-stu-id="09e08-138">Disable execute permissions for all users at the path.</span></span>

1. <span data-ttu-id="09e08-139">Définissez la limite de taille de fichier (`FileSizeLimit`) en octets.</span><span class="sxs-lookup"><span data-stu-id="09e08-139">Set the file size limit (`FileSizeLimit`) in bytes.</span></span> <span data-ttu-id="09e08-140">La valeur par défaut de l’exemple d’application, `2097152` (2 097 152 octets), autorise les téléchargements de fichiers jusqu’à 2 Mo.</span><span class="sxs-lookup"><span data-stu-id="09e08-140">The sample app's default value of `2097152` (2,097,152 bytes) permits file uploads up to 2 MB.</span></span>
